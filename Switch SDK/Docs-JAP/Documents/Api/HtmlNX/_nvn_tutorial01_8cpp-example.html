<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NintendoSDK API Reference: NvnTutorial01.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 構築: Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>総合概要</span></a></li>
      <li><a href="pages.html"><span>諸情報</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>名前空間</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">NvnTutorial01.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>ソースコードの説明は、<a class="el" href="_page_sample_nvn_tutorial01.html">NVN Tutorial 01: Getting Started With NVN</a> および <a class="el" href="_nvn_tutorial01_8cpp.html" title="This tutorial demonstrates how to setup an application to use the NVN graphics API and performs some ...">NvnTutorial01.cpp</a> を参照してください。</p>
<div class="fragment"><div class="line"><span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><span class="comment">  Copyright (C)Nintendo All rights reserved.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nvn___func_ptr_inline_8h.html">nvn/nvn_FuncPtrInline.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nvn___func_ptr_impl_8h.html">nvn/nvn_FuncPtrImpl.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_tutorial_base_class_8h.html">nvntutorial/TutorialBaseClass.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_memory_pool_8h.html">nvntutorial/MemoryPool.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_tutorial_util_8h.html">nvntutorial/TutorialUtil.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nn___assert_8h.html">nn/nn_Assert.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nn___log_8h.html">nn/nn_Log.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> g_CommandMemorySize = 512;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> g_ControlMemorySize = 512;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    g_NumColorBuffers = 2;</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>GettingStartedWithNVN : <span class="keyword">public</span> TutorialBaseClass</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        GettingStartedWithNVN() ;</div>
<div class="line">        <span class="keyword">virtual</span> ~GettingStartedWithNVN() ;</div>
<div class="line">        <span class="keyword">virtual</span> <span class="keywordtype">void</span> Init(<a name="a0"></a><a class="code" href="group__nvn__c__funcptrs.html#ga06bf27d9bd46e20d791f91f6ef085835">PFNNVNBOOTSTRAPLOADERPROC</a> loader, <a class="code" href="group__nvn__c__api__typedefs.html#ga05b6b3dd5b965bd81efe2d03cee0bbbd">NVNnativeWindow</a> nativeWindow);</div>
<div class="line">        <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a name="a1"></a><a class="code" href="namespacenn_1_1htcs.html#af2da72858626203b882be6742eeb5993">Shutdown</a>();</div>
<div class="line"></div>
<div class="line">        <span class="keyword">virtual</span> <span class="keywordtype">void</span> Draw(uint64_t millisec) ;</div>
<div class="line">        <span class="keyword">virtual</span> <span class="keywordtype">void</span> Resize(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height) ;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">        <span class="keyword">static</span> <span class="keywordtype">void</span> NVNAPIENTRY DebugLayerCallback(</div>
<div class="line">            <a class="code" href="group__nvn__c__enum.html#ga70a49f98019e4832818240297bee7eb3">NVNdebugCallbackSource</a> source,</div>
<div class="line">            <a class="code" href="group__nvn__c__enum.html#ga661d03f0e1c886c81d5ccc67935df182">NVNdebugCallbackType</a> type,</div>
<div class="line">            <span class="keywordtype">int</span> <span class="keywordtype">id</span>,</div>
<div class="line">            <a class="code" href="group__nvn__c__enum.html#ga6d72003c068d7795201e77d27bf8c7ac">NVNdebugCallbackSeverity</a> severity,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span>* message,</div>
<div class="line">            <span class="keywordtype">void</span>* pUser</div>
<div class="line">            ) ;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> UpdateRenderTargets() ;</div>
<div class="line"></div>
<div class="line">        <a name="_a2"></a><a class="code" href="struct_n_v_ndevice.html">NVNdevice</a>         m_Device;</div>
<div class="line">        <a name="_a3"></a><a class="code" href="struct_n_v_nqueue.html">NVNqueue</a>          m_Queue;</div>
<div class="line">        <span class="keywordtype">void</span>*             m_pQueueMemory;</div>
<div class="line"></div>
<div class="line">        <a name="a4"></a><a class="code" href="namespacenn_1_1gfx.html#ad620d8208dd309eb7c4dd5973a6aeee5">MemoryPool</a>*       m_pCommandMemoryPool;</div>
<div class="line"></div>
<div class="line">        ptrdiff_t         m_CommandPoolOffset;</div>
<div class="line">        <span class="keywordtype">void</span>*             m_pControlPool;</div>
<div class="line">        <a name="_a5"></a><a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>  m_CommandBuffer;</div>
<div class="line">        <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a>  m_CommandHandle;</div>
<div class="line"></div>
<div class="line">        ptrdiff_t         m_RenderTargetCommandPoolOffset;</div>
<div class="line">        <span class="keywordtype">void</span>*             m_pRenderTargetControlPool;</div>
<div class="line">        <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>  m_RenderTargetCommandBuffer;</div>
<div class="line">        <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a>  m_RenderTargetCommandHandle;</div>
<div class="line"></div>
<div class="line">        <a name="_a6"></a><a class="code" href="struct_n_v_ntexture_builder.html">NVNtextureBuilder</a> m_RenderTargetBuilder;</div>
<div class="line">        <a name="_a7"></a><a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>*       m_RenderTargets[g_NumColorBuffers];</div>
<div class="line"></div>
<div class="line">        <a name="_a8"></a><a class="code" href="struct_n_v_nsync.html">NVNsync</a>           m_CommandBufferSync;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="namespacenn_1_1gfx.html#ad620d8208dd309eb7c4dd5973a6aeee5">MemoryPool</a>*       m_pRenderTargetMemoryPool;</div>
<div class="line"></div>
<div class="line">        <a name="_a9"></a><a class="code" href="struct_n_v_nwindow.html">NVNwindow</a>*        m_pWindow;</div>
<div class="line">        <a name="_a10"></a><a class="code" href="struct_n_v_nwindow_builder.html">NVNwindowBuilder</a>  m_WindowBuilder;</div>
<div class="line">        <span class="keywordtype">int</span>               m_CurrentWindowIndex;</div>
<div class="line">        <a class="code" href="struct_n_v_nsync.html">NVNsync</a>           m_WindowSync;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">size_t</span>            m_ColorTargetSize;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * GettingStartedWithNVN Constructor</span></div>
<div class="line"><span class="comment"> * ----------------------------</span></div>
<div class="line"><span class="comment"> * Sets up default values for the members of the class.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">GettingStartedWithNVN::GettingStartedWithNVN() :</div>
<div class="line">    m_pQueueMemory(NULL),</div>
<div class="line">    m_pCommandMemoryPool(NULL),</div>
<div class="line">    m_pControlPool(NULL),</div>
<div class="line">    m_CommandHandle(NULL),</div>
<div class="line">    m_pRenderTargetControlPool(NULL),</div>
<div class="line">    m_RenderTargetCommandHandle(NULL),</div>
<div class="line">    m_pRenderTargetMemoryPool(NULL),</div>
<div class="line">    m_pWindow(NULL),</div>
<div class="line">    m_CurrentWindowIndex(-1)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_NumColorBuffers; ++i)</div>
<div class="line">    {</div>
<div class="line">        m_RenderTargets[i] = NULL;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * GettingStartedWithNVN Destructor</span></div>
<div class="line"><span class="comment"> * --------------------------------</span></div>
<div class="line"><span class="comment"> * Empty destructor.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">GettingStartedWithNVN::~GettingStartedWithNVN()</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * GettingStartedWithNVN::Init</span></div>
<div class="line"><span class="comment"> * ---------------------------</span></div>
<div class="line"><span class="comment"> * This method demonstrates basic NVN initialization. The bootstrap loader</span></div>
<div class="line"><span class="comment"> * function pointer is obtained in the platform-specific base class.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> GettingStartedWithNVN::Init(<a class="code" href="group__nvn__c__funcptrs.html#ga06bf27d9bd46e20d791f91f6ef085835">PFNNVNBOOTSTRAPLOADERPROC</a> loader, <a class="code" href="group__nvn__c__api__typedefs.html#ga05b6b3dd5b965bd81efe2d03cee0bbbd">NVNnativeWindow</a> nativeWindow)</div>
<div class="line">{</div>
<div class="line">    <a name="a11"></a><a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(loader != NULL, <span class="stringliteral">&quot;Bootstrap loader function pointer is NULL\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * NVN Device</span></div>
<div class="line"><span class="comment">     * ----------</span></div>
<div class="line"><span class="comment">     * The NVN device object is intended to be a per-process singleton; it is</span></div>
<div class="line"><span class="comment">     * used to establish communication with the GPU, and a parent for all of</span></div>
<div class="line"><span class="comment">     * the other NVN object types.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * Device Memory</span></div>
<div class="line"><span class="comment">     * -------------</span></div>
<div class="line"><span class="comment">     * The loader function pointer allows access to the NVN device initialization</span></div>
<div class="line"><span class="comment">     * function. This function takes a structure pointer allowing the app to</span></div>
<div class="line"><span class="comment">     * set relevant parameters. One parameter is the &quot;device memory&quot;, a block</span></div>
<div class="line"><span class="comment">     * of memory the NVN driver should use for it&#39;s internal data structures.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * Debug Layer</span></div>
<div class="line"><span class="comment">     * -----------</span></div>
<div class="line"><span class="comment">     * It is possible to enable the debug layer via device initialization</span></div>
<div class="line"><span class="comment">     * parameters. The debug layer adds error checking to many NVN entry points,</span></div>
<div class="line"><span class="comment">     * but has no overhead at all when not enabled. The debug layer also will</span></div>
<div class="line"><span class="comment">     * generate error and warning messages when various programming errors are</span></div>
<div class="line"><span class="comment">     * detected, so be sure to provide a message handler callback. See below for</span></div>
<div class="line"><span class="comment">     * an example of how to do this.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * Device Thread Safety</span></div>
<div class="line"><span class="comment">     * --------------------</span></div>
<div class="line"><span class="comment">     * There is no need to provide synchronization for the NVNdevice object;</span></div>
<div class="line"><span class="comment">     * it may be passed in to any NVN function that requires it from any thread.</span></div>
<div class="line"><span class="comment">     * The exception to this rule is device initialization and finalization;</span></div>
<div class="line"><span class="comment">     * threads may not begin to use the NVNdevice until nvnDeviceInitialize has</span></div>
<div class="line"><span class="comment">     * returned sucessfully, and must cease using the device before</span></div>
<div class="line"><span class="comment">     * nvnDeviceFinalize is called.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line"></div>
<div class="line">    pfnc_nvnDeviceInitialize = <span class="keyword">reinterpret_cast&lt;</span><a name="a12"></a><a class="code" href="group__nvn__c__entryfuncptrs.html#ga0911881e0289ea09b9cf7b77458a9330">PFNNVNDEVICEINITIALIZEPROC</a><span class="keyword">&gt;</span>((*loader)(<span class="stringliteral">&quot;nvnDeviceInitialize&quot;</span>));</div>
<div class="line">    pfnc_nvnDeviceGetProcAddress = <span class="keyword">reinterpret_cast&lt;</span><a name="a13"></a><a class="code" href="group__nvn__c__entryfuncptrs.html#ga74380034a2bce7023361a7bf92b7c69a">PFNNVNDEVICEGETPROCADDRESSPROC</a><span class="keyword">&gt;</span>((*loader)(<span class="stringliteral">&quot;nvnDeviceGetProcAddress&quot;</span>));</div>
<div class="line">    <span class="keywordflow">if</span> (!pfnc_nvnDeviceInitialize)</div>
<div class="line">    {</div>
<div class="line">            <span class="comment">/* This can happen if an NVN driver is not installed on a Windows PC. */</span></div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;BootstrapLoader failed to find nvnDeviceInitialize&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Load function pointers for creating nvn device.  NULL</span></div>
<div class="line"><span class="comment">         * is passed here at first, the function is called again</span></div>
<div class="line"><span class="comment">         * after device initialization to ensure all the function</span></div>
<div class="line"><span class="comment">         * pointers work properly.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    nvnLoadCProcs( NULL, pfnc_nvnDeviceGetProcAddress );</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Version Check</span></div>
<div class="line"><span class="comment">         * -------------</span></div>
<div class="line"><span class="comment">         * Check for API version mismatches. This is a comparison between the version</span></div>
<div class="line"><span class="comment">         * support reported by the NVN library, and the version of the NVN headers this</span></div>
<div class="line"><span class="comment">         * source file is compiled with. Exit with an error if the major version</span></div>
<div class="line"><span class="comment">         * mismatches (major revisions are backward-incompatible) or if the driver</span></div>
<div class="line"><span class="comment">         * reports a lower minor version. It is possible to call nvnDeviceGetInteger</span></div>
<div class="line"><span class="comment">         * with a NULL device and get the correct result when querying</span></div>
<div class="line"><span class="comment">         * NVN_DEVICE_INFO_API_MAJOR_VERSION and NVN_DEVICE_INFO_API_MINOR_VERSION.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <span class="keywordtype">int</span> <a class="code" href="namespacenn_1_1ui2d.html#a3d128ec7087f91b3f54cbfcf73fb93b9">MajorVersion</a>, <a class="code" href="namespacenn_1_1ui2d.html#a8ebb4f5324b526c9e74f0b01037fb74c">MinorVersion</a>;</div>
<div class="line">    <a name="a14"></a><a class="code" href="group__nvn__c__functions.html#ga6f739de39c3818a65b190be3a82cf891">nvnDeviceGetInteger</a>(NULL, <a name="a15"></a><a class="code" href="group__nvn__c__enum.html#ggac887e20e2474bb76b87943b0f0be7a50a0a28757032ed570b5999474a3e9b4d2b">NVN_DEVICE_INFO_API_MAJOR_VERSION</a>, &amp;MajorVersion);</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga6f739de39c3818a65b190be3a82cf891">nvnDeviceGetInteger</a>(NULL, <a name="a16"></a><a class="code" href="group__nvn__c__enum.html#ggac887e20e2474bb76b87943b0f0be7a50ad6ff7d57f34e67a3d63ab8b5989a2c6a">NVN_DEVICE_INFO_API_MINOR_VERSION</a>, &amp;MinorVersion);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (MajorVersion != <a name="a17"></a><a class="code" href="group__nvn__c__defines.html#ga4eb83fe713146d844b1ac7f8e9c3dada">NVN_API_MAJOR_VERSION</a> || MinorVersion &lt; <a name="a18"></a><a class="code" href="group__nvn__c__defines.html#gaa8b4a49a0c4f852b73be3b50bb3f270e">NVN_API_MINOR_VERSION</a>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;NVN SDK not supported by current driver.&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* If debug or develop is enabled, turn on NVN&#39;s debug layer. */</span></div>
<div class="line">    <span class="keywordtype">int</span> deviceFlags = 0;</div>
<div class="line"><span class="preprocessor">#if defined(NN_SDK_BUILD_DEBUG) || defined(NN_SDK_BUILD_DEVELOP)</span></div>
<div class="line">    deviceFlags = <a name="a19"></a><a class="code" href="group__nvn__c__enum.html#gga9c68350bf64f2e7a90a23290c26872d3ac002cdaba27241c296213d4722dad0a6">NVN_DEVICE_FLAG_DEBUG_ENABLE_LEVEL_2_BIT</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <a name="_a20"></a><a class="code" href="struct_n_v_ndevice_builder.html">NVNdeviceBuilder</a> deviceBuilder;</div>
<div class="line">    <a name="a21"></a><a class="code" href="group__nvn__c__functions.html#gaa042629cf4bc5ef1fab4bc7bf37b6f4f">nvnDeviceBuilderSetDefaults</a>(&amp;deviceBuilder);</div>
<div class="line">    <a name="a22"></a><a class="code" href="group__nvn__c__functions.html#ga918d154a1d1f156eb61e6a3e402cbf1c">nvnDeviceBuilderSetFlags</a>(&amp;deviceBuilder, deviceFlags);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a23"></a><a class="code" href="group__nvn__c__functions.html#gac05386acab686b7614d353c9a4ea4d96">nvnDeviceInitialize</a>(&amp;m_Device, &amp;deviceBuilder) == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * This can fail for a few reasons; the most likely on Horizon is</span></div>
<div class="line"><span class="comment">             * insufficent device memory.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;nvnDeviceInitialize&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * API Loading</span></div>
<div class="line"><span class="comment">         * -----------</span></div>
<div class="line"><span class="comment">         * Once the device has been initialized, it is now possible to load all of the</span></div>
<div class="line"><span class="comment">         * remaining NVN API entry points. The bootstrap loader is used again to</span></div>
<div class="line"><span class="comment">         * locate the &quot;real&quot; loader function. The real loader may be passed along</span></div>
<div class="line"><span class="comment">         * with the device into nvnLoadProcs if using nvn_FuncPtrInline.h. It is also</span></div>
<div class="line"><span class="comment">         * completely valid for applications to load with their own entry points.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    nvnLoadCProcs(&amp;m_Device, pfnc_nvnDeviceGetProcAddress );</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Debug Layer Callback</span></div>
<div class="line"><span class="comment">         * --------------------</span></div>
<div class="line"><span class="comment">         * Install the debug layer callback if the debug layer was enabled during</span></div>
<div class="line"><span class="comment">         * device initialization. It is possible to pass a pointer to the NVN API</span></div>
<div class="line"><span class="comment">         * to remember and pass back through the debug callback.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <span class="keywordflow">if</span> (deviceFlags &amp; <a class="code" href="group__nvn__c__enum.html#gga9c68350bf64f2e7a90a23290c26872d3ac002cdaba27241c296213d4722dad0a6">NVN_DEVICE_FLAG_DEBUG_ENABLE_LEVEL_2_BIT</a>)</div>
<div class="line">    {</div>
<div class="line">        <a name="a24"></a><a class="code" href="group__nvn__c__functions.html#gab73dcc0df1012caf66620aa7c56b2592">nvnDeviceInstallDebugCallback</a>(</div>
<div class="line">            &amp;m_Device,</div>
<div class="line">            reinterpret_cast&lt;PFNNVNDEBUGCALLBACKPROC&gt;(&amp;DebugLayerCallback),</div>
<div class="line">            NULL, <span class="comment">// For testing purposes; any pointer is OK here.</span></div>
<div class="line">            <a name="a25"></a><a class="code" href="group__nvn__c__defines.html#ga48151b7e768a13685d77d1a4c464a33b">NVN_TRUE</a> <span class="comment">// NVN_TRUE = Enable the callback.</span></div>
<div class="line">            );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * NVN Queue</span></div>
<div class="line"><span class="comment">         * ---------</span></div>
<div class="line"><span class="comment">         * The NVNqueue object represent a GPU context and is used to submit command buffers</span></div>
<div class="line"><span class="comment">         * to the GPU. The queue must be associated with an NVNdevice through the Initialize</span></div>
<div class="line"><span class="comment">         * function before being used. Commands submitted to the queue through the command</span></div>
<div class="line"><span class="comment">         * buffers are processed in the order that they are submitted. Commands submitted</span></div>
<div class="line"><span class="comment">         * to one queue are processed independently from commands submitted to other queues.</span></div>
<div class="line"><span class="comment">         * The order in which commands in multiple queues are executed relative to each other</span></div>
<div class="line"><span class="comment">         * is undefined unless a synchronization primitive is used. Each queue has it&#39;s own</span></div>
<div class="line"><span class="comment">         * NVN state, meaning that state changes in one queue will not affect rendering in</span></div>
<div class="line"><span class="comment">         * another.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * It is possible to more explicitly control the size of the backing memory of a queue.</span></div>
<div class="line"><span class="comment">         * Using the Set&lt;Compute/Command&gt;MemorySize functions changes the size of the backing</span></div>
<div class="line"><span class="comment">         * memory that is automatically allocated for use in submitting command buffer commands</span></div>
<div class="line"><span class="comment">         * and dispatching work to compute shaders.  The memory a queue requires for work with</span></div>
<div class="line"><span class="comment">         * compute is significantly higher than what is needed for command, so if compute is not</span></div>
<div class="line"><span class="comment">         * being used at all then the size for compute memory should be set to zero like in this</span></div>
<div class="line"><span class="comment">         * demo.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * You can also instead provide the queue builder a manually allocated block of memory</span></div>
<div class="line"><span class="comment">         * through the function SetQueueMemory; the minimum size needed can be queried through</span></div>
<div class="line"><span class="comment">         * GetQueueMemorySize. The value returned by GetQueueMemorySize includes the (minimum)</span></div>
<div class="line"><span class="comment">         * memory necessary for command processing, the (minimum) memory necessary for compute</span></div>
<div class="line"><span class="comment">         * dispatches, and scratch memory for fragment shader interlocks and other internal GPU</span></div>
<div class="line"><span class="comment">         * operations based on the current state of the queue builder; this is why command and</span></div>
<div class="line"><span class="comment">         * compute memory sizes are set before the query, so that they will be figured into</span></div>
<div class="line"><span class="comment">         * the minimum necessary size for the queue&#39;s memory block.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * Providing a block can be useful to minimize the amount of times the internal buffer</span></div>
<div class="line"><span class="comment">         * needs to be flushed if a lot of commands are being submitted.  It is also possible</span></div>
<div class="line"><span class="comment">         * to set a threshold for the queue&#39;s memory that will flush the buffer when it is</span></div>
<div class="line"><span class="comment">         * filled past the threshold.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a name="_a26"></a><a class="code" href="struct_n_v_nqueue_builder.html">NVNqueueBuilder</a> queueBuilder;</div>
<div class="line">    <a name="a27"></a><a class="code" href="group__nvn__c__functions.html#ga7fdbe1fc82e21cf370aa7f1fa0a6141a">nvnQueueBuilderSetDevice</a>(&amp;queueBuilder, &amp;m_Device);</div>
<div class="line">    <a name="a28"></a><a class="code" href="group__nvn__c__functions.html#ga20bc093a367e06cd1f1f273289354b75">nvnQueueBuilderSetDefaults</a>(&amp;queueBuilder);</div>
<div class="line">    <a name="a29"></a><a class="code" href="group__nvn__c__functions.html#ga161b2d39535ffac2829d972058391bb6">nvnQueueBuilderSetComputeMemorySize</a>(&amp;queueBuilder, 0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Get minimum size allowed for queue&#39;s internal command memory.</span></div>
<div class="line"><span class="comment">         * More can be provided to the queue if the application requires</span></div>
<div class="line"><span class="comment">         * as long as it fulfils the necessary granularity and alignment</span></div>
<div class="line"><span class="comment">         * requirements.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <span class="keywordtype">int</span> minQueueCommandMemorySize = 0;</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga6f739de39c3818a65b190be3a82cf891">nvnDeviceGetInteger</a>(&amp;m_Device, <a name="a30"></a><a class="code" href="group__nvn__c__enum.html#ggac887e20e2474bb76b87943b0f0be7a50af620633087a96a544b6c2ff6741a7697">NVN_DEVICE_INFO_QUEUE_COMMAND_MEMORY_MIN_SIZE</a>, &amp;minQueueCommandMemorySize);</div>
<div class="line">    <a name="a31"></a><a class="code" href="group__nvn__c__functions.html#ga4291be788552aa888e9551d0e1084bfb">nvnQueueBuilderSetCommandMemorySize</a>(&amp;queueBuilder, minQueueCommandMemorySize);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Setting the flush threshold on the queue&#39;s command memory here helps</span></div>
<div class="line"><span class="comment">         * to prevent implicit flushes when a significant amount of the memory</span></div>
<div class="line"><span class="comment">         * is used (compute dispatches, shader subroutine uniform updates, etc.)</span></div>
<div class="line"><span class="comment">         * This is due to the default flush threshold being 1/8th of the available</span></div>
<div class="line"><span class="comment">         * command memory; setting it to the size of the buffer itself means a</span></div>
<div class="line"><span class="comment">         * flush will only occur automatically when it has no more room in its</span></div>
<div class="line"><span class="comment">         * internal command buffer.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a name="a32"></a><a class="code" href="group__nvn__c__functions.html#ga4de1469ce962b138ca454c034f6e649b">nvnQueueBuilderSetCommandFlushThreshold</a>(&amp;queueBuilder, minQueueCommandMemorySize);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">size_t</span> neededQueueMemorySize = <a name="a33"></a><a class="code" href="group__nvn__c__functions.html#ga2903b2910d9471307595962237d3c578">nvnQueueBuilderGetQueueMemorySize</a>(&amp;queueBuilder);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((neededQueueMemorySize % <a name="a34"></a><a class="code" href="group__nvn__c__defines.html#gadfd69601d2d9f953c55808127ba60853">NVN_MEMORY_POOL_STORAGE_GRANULARITY</a>) != 0)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;Memory size reported for queue is not the proper granularity&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * On Windows, the buffer provided to the queue here is ignored</span></div>
<div class="line"><span class="comment">         * completely and the driver allocates the memory.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line"><span class="preprocessor">#if defined( NN_BUILD_TARGET_PLATFORM_OS_WIN )</span></div>
<div class="line">    m_pQueueMemory = NULL;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    m_pQueueMemory = AlignedAllocate(neededQueueMemorySize, <a name="a35"></a><a class="code" href="group__nvn__c__defines.html#gace820e752b400cf7aa36e9684a7f45cb">NVN_MEMORY_POOL_STORAGE_ALIGNMENT</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <a name="a36"></a><a class="code" href="group__nvn__c__functions.html#ga0403d233aff80ce9cc6548b5dbe24ca2">nvnQueueBuilderSetQueueMemory</a>(&amp;queueBuilder, m_pQueueMemory, neededQueueMemorySize);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(<a name="a37"></a><a class="code" href="group__nvn__c__functions.html#ga512027cc783d925feb7261915130e2ca">nvnQueueInitialize</a>(&amp;m_Queue, &amp;queueBuilder) == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;nvnQueueInitialize failed&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * NVN Command Buffer</span></div>
<div class="line"><span class="comment">         * ------------------</span></div>
<div class="line"><span class="comment">         * The NVNcommandBuffer object is used to record a list of commands to be run</span></div>
<div class="line"><span class="comment">         * by the GPU. The command buffer is populated by calling nvnCommandBuffer***</span></div>
<div class="line"><span class="comment">         * methods between calls to the BeginRecording and EndRecording methods. The</span></div>
<div class="line"><span class="comment">         * EndRecording method returns a NVNcommandBufferHandle that can be submitted</span></div>
<div class="line"><span class="comment">         * to the queue to run the commands in the command buffer in the order they</span></div>
<div class="line"><span class="comment">         * were recorded.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * A command buffer requires two blocks of memory: command memory and control</span></div>
<div class="line"><span class="comment">         * memory. Command memory is used to record the GPU commands. The command</span></div>
<div class="line"><span class="comment">         * memory is an NVNmemoryPool object and should CPU coherent or CPU non-coherent.</span></div>
<div class="line"><span class="comment">         * Control memory is used to store additional information/data needed for the</span></div>
<div class="line"><span class="comment">         * GPU commands to be processed. This memory is simply allocated by the CPU and</span></div>
<div class="line"><span class="comment">         * is not an NVNmemoryPool.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <span class="keywordflow">if</span>(!<a name="a38"></a><a class="code" href="group__nvn__c__functions.html#gab146b70a699dfee69d0724e430d5694e">nvnCommandBufferInitialize</a>(&amp;m_CommandBuffer, &amp;m_Device))</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;nvnCommandBufferInitialize&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Queries the device for the proper control and command</span></div>
<div class="line"><span class="comment">         * memory alignment for a command buffer.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <span class="keywordtype">int</span> commandBufferCommandAlignment = 0;</div>
<div class="line">    <span class="keywordtype">int</span> commandBufferControlAlignment = 0;</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga6f739de39c3818a65b190be3a82cf891">nvnDeviceGetInteger</a>(&amp;m_Device, <a name="a39"></a><a class="code" href="group__nvn__c__enum.html#ggac887e20e2474bb76b87943b0f0be7a50ada72f2b5ef4df11606b61aaa86f6f22c">NVN_DEVICE_INFO_COMMAND_BUFFER_COMMAND_ALIGNMENT</a>, &amp;commandBufferCommandAlignment);</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga6f739de39c3818a65b190be3a82cf891">nvnDeviceGetInteger</a>(&amp;m_Device, <a name="a40"></a><a class="code" href="group__nvn__c__enum.html#ggac887e20e2474bb76b87943b0f0be7a50a743ea42e337a76b9d8ed34181a0d802e">NVN_DEVICE_INFO_COMMAND_BUFFER_CONTROL_ALIGNMENT</a>, &amp;commandBufferControlAlignment);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Setup the command buffer memory pool. */</span></div>
<div class="line">    m_pCommandMemoryPool = <span class="keyword">new</span> <a class="code" href="namespacenn_1_1gfx.html#ad620d8208dd309eb7c4dd5973a6aeee5">MemoryPool</a>();</div>
<div class="line">    m_pCommandMemoryPool-&gt;Init(</div>
<div class="line">        NULL,</div>
<div class="line">        Align(g_CommandMemorySize, commandBufferCommandAlignment) * 2,</div>
<div class="line">        <a name="a41"></a><a class="code" href="group__nvn__c__enum.html#ggaa7df4970255609d7a317631bcb37d654a93f5342f52f301cfdca9901586b9b8e1">NVN_MEMORY_POOL_FLAGS_CPU_UNCACHED_BIT</a> | <a name="a42"></a><a class="code" href="group__nvn__c__enum.html#ggaa7df4970255609d7a317631bcb37d654a81b40bf9e82d33f8c546a95fc5ce5f7e">NVN_MEMORY_POOL_FLAGS_GPU_CACHED_BIT</a>,</div>
<div class="line">        &amp;m_Device);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Setup the control memory with the proper alignment. */</span></div>
<div class="line">    m_pControlPool = AlignedAllocate(g_ControlMemorySize, commandBufferControlAlignment);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Grab the offset from the memory pool. */</span></div>
<div class="line">    m_CommandPoolOffset = m_pCommandMemoryPool-&gt;GetNewMemoryChunkOffset(g_CommandMemorySize, commandBufferCommandAlignment);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Provides the command buffer with the command and control memory blocks. */</span></div>
<div class="line">    <a name="a43"></a><a class="code" href="group__nvn__c__functions.html#ga2c0d758cfa73c25f2a34486353f46d92">nvnCommandBufferAddCommandMemory</a>(&amp;m_CommandBuffer, m_pCommandMemoryPool-&gt;GetMemoryPool(), m_CommandPoolOffset, g_CommandMemorySize);</div>
<div class="line">    <a name="a44"></a><a class="code" href="group__nvn__c__functions.html#ga8de6ce290ee0180d9bcd700c1d08d0bf">nvnCommandBufferAddControlMemory</a>(&amp;m_CommandBuffer, m_pControlPool, g_ControlMemorySize);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Render Target Setting Command Buffer */</span></div>
<div class="line">    <span class="keywordflow">if</span>(!<a class="code" href="group__nvn__c__functions.html#gab146b70a699dfee69d0724e430d5694e">nvnCommandBufferInitialize</a>(&amp;m_RenderTargetCommandBuffer, &amp;m_Device))</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;nvnCommandBufferInitialize&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Setup the control memory with the proper alignment. */</span></div>
<div class="line">    m_pRenderTargetControlPool = AlignedAllocate(g_ControlMemorySize, commandBufferControlAlignment);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Grab the offset from the memory pool. */</span></div>
<div class="line">    m_RenderTargetCommandPoolOffset = m_pCommandMemoryPool-&gt;GetNewMemoryChunkOffset(g_CommandMemorySize, commandBufferCommandAlignment);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga2c0d758cfa73c25f2a34486353f46d92">nvnCommandBufferAddCommandMemory</a>(&amp;m_RenderTargetCommandBuffer, m_pCommandMemoryPool-&gt;GetMemoryPool(), m_RenderTargetCommandPoolOffset, g_CommandMemorySize);</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga8de6ce290ee0180d9bcd700c1d08d0bf">nvnCommandBufferAddControlMemory</a>(&amp;m_RenderTargetCommandBuffer, m_pRenderTargetControlPool, g_ControlMemorySize);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * NVN Sync Object</span></div>
<div class="line"><span class="comment">         * ---------------</span></div>
<div class="line"><span class="comment">         * The NVNsync object is a synchronization primitive that can be used to</span></div>
<div class="line"><span class="comment">         * synchronize between queue or between a queue and the CPU. The condition</span></div>
<div class="line"><span class="comment">         * that causes the sync to fire is set by the nvnQueueFenceSync command.</span></div>
<div class="line"><span class="comment">         * The condition can be:</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * ALL_GPU_COMMANDS_COMPLETE     - Signals when all preceding GPU commands have</span></div>
<div class="line"><span class="comment">         *                                 been executed.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * GRAPHICS_WORLD_SPACE_COMPLETE - Signals when the vertices from the previous</span></div>
<div class="line"><span class="comment">         *                                 commands have been processed, meaning that the</span></div>
<div class="line"><span class="comment">         *                                 vertex, tessellation, and geometry shader stages</span></div>
<div class="line"><span class="comment">         *                                 and the transform feedback stage have all been</span></div>
<div class="line"><span class="comment">         *                                 fully completed.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <span class="keywordflow">if</span>(!<a name="a45"></a><a class="code" href="group__nvn__c__functions.html#gad8eeff0f19eaa7bb9b57ea8134411baa">nvnSyncInitialize</a>(&amp;m_CommandBufferSync, &amp;m_Device))</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;nvnSyncInitialize&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__nvn__c__functions.html#gad8eeff0f19eaa7bb9b57ea8134411baa">nvnSyncInitialize</a>(&amp;m_WindowSync, &amp;m_Device))</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;Failed to initialize window sync&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * NVN Builder Objects</span></div>
<div class="line"><span class="comment">         * -------------------</span></div>
<div class="line"><span class="comment">         * Some objects in NVN require a builder object to initialize them (buffers, textures, etc).</span></div>
<div class="line"><span class="comment">         * These builder objects are used to setup the state of the object to be created. Once</span></div>
<div class="line"><span class="comment">         * an object has been created through a builder, it can&#39;t be edited. Before using a builder</span></div>
<div class="line"><span class="comment">         * object, the SetDefaults method should be called to avoid having unitialized/undefined</span></div>
<div class="line"><span class="comment">         * state.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * NVN Texture</span></div>
<div class="line"><span class="comment">         * -----------</span></div>
<div class="line"><span class="comment">         * The NVNtexture object represents a block of GPU memory used to hold image data. It also</span></div>
<div class="line"><span class="comment">         * holds data to describe the image and how the image is allowed to be accessed.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * NVN Texture Builder</span></div>
<div class="line"><span class="comment">         * -------------------</span></div>
<div class="line"><span class="comment">         * The NVNtextureBuilder object is used to initialize an NVNtexture with</span></div>
<div class="line"><span class="comment">         * a specific set of states. States that can be set:</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetFlags                 - Set flags indentifying special properties of the texture.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetTarget                - Type of the texture (1D, 2D, Array, etc).</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetWidth                 - Width of the texture.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetHeight                - Height of the texture.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetDepth                 - Depth of the texture.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetSize*D                - Set width, height, and/or depth together in one call.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetLevels                - Number of mip map levels.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetFormat                - Pixel format.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetSamples               - Number of samples. Must be 0 for non multisample, 2/4/8/16 for multisample.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetSwizzle               - Specifies what is output from a texture lookup.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetDepthStencilMode      - Identifies whether texture lookups will return depth or stencil values.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetStorage               - Set the location in a memory pool where the texture will be allocated from.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetPackagedTextureData   - (Windows only) Pointer to texture data that has been run through the texture packager.</span></div>
<div class="line"><span class="comment">         *                            Converts the texture data from the packaged format back to something usable on Windows.</span></div>
<div class="line"><span class="comment">         *                            This is ignored on the target device as the packaged texture data may be used directly.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetPackagedTextureLayout - Specify the layout of packaged texture data used for texture storage.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetStride                - Specifies the stride for linear textures.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a name="a46"></a><a class="code" href="group__nvn__c__functions.html#ga3125b10128cdf01e0c489ebf9644cc36">nvnTextureBuilderSetDevice</a>(&amp;m_RenderTargetBuilder, &amp;m_Device);</div>
<div class="line">    <a name="a47"></a><a class="code" href="group__nvn__c__functions.html#ga6287f82327692478ee9040e4fe73dd36">nvnTextureBuilderSetDefaults</a>(&amp;m_RenderTargetBuilder);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Render targets that need to be displayed to the screen need both the display access and compressible bit. */</span></div>
<div class="line">    <a name="a48"></a><a class="code" href="group__nvn__c__functions.html#ga249280b0e8c57ead0fa7a82a8ebc56f9">nvnTextureBuilderSetFlags</a> (&amp;m_RenderTargetBuilder, <a name="a49"></a><a class="code" href="group__nvn__c__enum.html#gga57ab2536473c8e62f621554a2618121bad47e8f3aafe9ec5eb90d9309d591604f">NVN_TEXTURE_FLAGS_DISPLAY_BIT</a> | <a name="a50"></a><a class="code" href="group__nvn__c__enum.html#gga57ab2536473c8e62f621554a2618121ba0d4ba29569c01183e9a92cb3359da7d1">NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT</a>);</div>
<div class="line">    <a name="a51"></a><a class="code" href="group__nvn__c__functions.html#gaa7e80e3d31c6cffc51d255cbe86694b3">nvnTextureBuilderSetTarget</a>(&amp;m_RenderTargetBuilder, <a name="a52"></a><a class="code" href="group__nvn__c__enum.html#gga7f247010f53480c7dd1f3b2ad638c431a856184892b54a04cd16ec7848108ec53">NVN_TEXTURE_TARGET_2D</a>);</div>
<div class="line">    <a name="a53"></a><a class="code" href="group__nvn__c__functions.html#gad83f59e208a24b5843543e1d0c7aec8a">nvnTextureBuilderSetFormat</a>(&amp;m_RenderTargetBuilder, <a name="a54"></a><a class="code" href="group__nvn__c__enum.html#gga99463f5b9af6151e604b01dfdd5fecaba81514f73c168617e9819e91131e87426">NVN_FORMAT_RGBA8</a>);</div>
<div class="line">    <a name="a55"></a><a class="code" href="group__nvn__c__functions.html#ga1eb945f455f851adf9b738be38cfb0bc">nvnTextureBuilderSetSize2D</a>(&amp;m_RenderTargetBuilder, 1920, 1080);</div>
<div class="line">    m_ColorTargetSize = <a name="a56"></a><a class="code" href="group__nvn__c__functions.html#ga1ba9cfd0600643dbb909eaa9c36abe26">nvnTextureBuilderGetStorageSize</a>(&amp;m_RenderTargetBuilder);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Setup the render target memory pool.  Render targets are required to be compressible</span></div>
<div class="line"><span class="comment">         * textures allocated from memory pools with the NVN_MEMORY_POOL_FLAGS_COMPRESSIBLE_BIT</span></div>
<div class="line"><span class="comment">         * bit set.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * Vsync is enforced on the device, so if an application takes too long in a frame to</span></div>
<div class="line"><span class="comment">         * maintain 60 FPS it will drop to 30 FPS.  The tutorials provide 2 render targets to</span></div>
<div class="line"><span class="comment">         * the NVNwindow to swap between but more intensive applications may require more.  An</span></div>
<div class="line"><span class="comment">         * NVNwindow can support up to 6 render targets.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * For more information on memory pools see MemoryPool.cpp/.h</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    m_pRenderTargetMemoryPool = <span class="keyword">new</span> <a class="code" href="namespacenn_1_1gfx.html#ad620d8208dd309eb7c4dd5973a6aeee5">MemoryPool</a>();</div>
<div class="line">    m_pRenderTargetMemoryPool-&gt;Init(</div>
<div class="line">        NULL,</div>
<div class="line">        m_ColorTargetSize * g_NumColorBuffers,</div>
<div class="line">        <a name="a57"></a><a class="code" href="group__nvn__c__enum.html#ggaa7df4970255609d7a317631bcb37d654ae90d91fe770d2eb3e1476c404c003369">NVN_MEMORY_POOL_FLAGS_CPU_NO_ACCESS_BIT</a> | <a class="code" href="group__nvn__c__enum.html#ggaa7df4970255609d7a317631bcb37d654a81b40bf9e82d33f8c546a95fc5ce5f7e">NVN_MEMORY_POOL_FLAGS_GPU_CACHED_BIT</a> | <a name="a58"></a><a class="code" href="group__nvn__c__enum.html#ggaa7df4970255609d7a317631bcb37d654a85f45881362092d4c5f745395818cb09">NVN_MEMORY_POOL_FLAGS_COMPRESSIBLE_BIT</a>,</div>
<div class="line">        &amp;m_Device);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * NVN Window</span></div>
<div class="line"><span class="comment">         * ----------</span></div>
<div class="line"><span class="comment">         * The NVNwindow is used to present a render target to the screen. It manages</span></div>
<div class="line"><span class="comment">         * an array of render targets and associates them with an NVNnativeWindow. On</span></div>
<div class="line"><span class="comment">         * Horizon NVNnativeWindow defined as ANativeWindow* and on Windows it&#39;s defined</span></div>
<div class="line"><span class="comment">         * as HWND. Each frame, the NVNwindow needs to be queried for the active render</span></div>
<div class="line"><span class="comment">         * target for that frame.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * Window Builder Settings</span></div>
<div class="line"><span class="comment">         * -----------------------</span></div>
<div class="line"><span class="comment">         * SetTextures        - Sets the list of render targets to be used by the window.</span></div>
<div class="line"><span class="comment">         *                      Textures used by the NVNwindow must be initialized with the</span></div>
<div class="line"><span class="comment">         *                      display access bit. A window can be given a max of 6 targets.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetNativeWindow    - Sets the handle to the window.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * SetPresentInterval - Sets interval for how often the window is presented to.</span></div>
<div class="line"><span class="comment">         *                      Legal values:</span></div>
<div class="line"><span class="comment">         *                      - 0: Update without waiting for next refresh, tearing likely</span></div>
<div class="line"><span class="comment">         *                           to occur</span></div>
<div class="line"><span class="comment">         *                      - 1: Updates display on next refresh, frame rate limited to</span></div>
<div class="line"><span class="comment">         *                           display&#39;s refresh rate</span></div>
<div class="line"><span class="comment">         *                      - 2: Updates display on next refresh, no sooner than two since</span></div>
<div class="line"><span class="comment">         *                           previous update.  Halves display&#39;s refresh rate.</span></div>
<div class="line"><span class="comment">         *                      This api is not supported on Windows</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a name="a59"></a><a class="code" href="group__nvn__c__functions.html#ga3924f2d40fa227e1b405df3755ad46e7">nvnWindowBuilderSetDefaults</a>(&amp;m_WindowBuilder);</div>
<div class="line">    <a name="a60"></a><a class="code" href="group__nvn__c__functions.html#gaf93ec4cee4147e9cc004b7b16c802621">nvnWindowBuilderSetDevice</a>(&amp;m_WindowBuilder, &amp;m_Device);</div>
<div class="line">    <a name="a61"></a><a class="code" href="group__nvn__c__functions.html#gac518ddbead9eac057d3578c6195166b2">nvnWindowBuilderSetNativeWindow</a>(&amp;m_WindowBuilder, nativeWindow);</div>
<div class="line">}<span class="comment">//NOLINT(impl/function_size)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * GettingStartedWithNVN::Shutdown</span></div>
<div class="line"><span class="comment"> * -------------------------------</span></div>
<div class="line"><span class="comment"> * This method cleans up all nvn objects and dynamically allocated memory.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacenn_1_1htcs.html#af2da72858626203b882be6742eeb5993">GettingStartedWithNVN::Shutdown</a>()</div>
<div class="line">{</div>
<div class="line">    <a name="a62"></a><a class="code" href="group__nvn__c__functions.html#gaab3c15f657cefdff33dab453795ff38f">nvnQueueFinish</a>(&amp;m_Queue);</div>
<div class="line"></div>
<div class="line">    <a name="a63"></a><a class="code" href="group__nvn__c__functions.html#ga918f1f02b17ba89d048372ead736a929">nvnSyncFinalize</a>(&amp;m_CommandBufferSync);</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga918f1f02b17ba89d048372ead736a929">nvnSyncFinalize</a>(&amp;m_WindowSync);</div>
<div class="line"></div>
<div class="line">    <a name="a64"></a><a class="code" href="group__nvn__c__functions.html#ga014c41d2335d4d9ff6c776c99bc70bfb">nvnCommandBufferFinalize</a>(&amp;m_RenderTargetCommandBuffer);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_pRenderTargetControlPool)</div>
<div class="line">    {</div>
<div class="line">        AlignedDeallocate(m_pRenderTargetControlPool);</div>
<div class="line">        m_pRenderTargetControlPool = NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga014c41d2335d4d9ff6c776c99bc70bfb">nvnCommandBufferFinalize</a>(&amp;m_CommandBuffer);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_pCommandMemoryPool)</div>
<div class="line">    {</div>
<div class="line">        m_pCommandMemoryPool-&gt;Shutdown();</div>
<div class="line">        <span class="keyword">delete</span> m_pCommandMemoryPool;</div>
<div class="line">        m_pCommandMemoryPool = NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_pControlPool)</div>
<div class="line">    {</div>
<div class="line">        AlignedDeallocate(m_pControlPool);</div>
<div class="line">        m_pControlPool = NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (m_pWindow)</div>
<div class="line">    {</div>
<div class="line">        <a name="a65"></a><a class="code" href="group__nvn__c__functions.html#ga53660a4abfffea411f62415c79a65cdf">nvnWindowFinalize</a>(m_pWindow);</div>
<div class="line">        <span class="keyword">delete</span> m_pWindow;</div>
<div class="line">        m_pWindow = NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; g_NumColorBuffers; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (m_RenderTargets[i])</div>
<div class="line">        {</div>
<div class="line">            <a name="a66"></a><a class="code" href="group__nvn__c__functions.html#gaa5741253f7ab5c9075a6821a68cfa351">nvnTextureFinalize</a>(m_RenderTargets[i]);</div>
<div class="line">            <span class="keyword">delete</span> m_RenderTargets[i];</div>
<div class="line">            m_RenderTargets[i] = NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_pRenderTargetMemoryPool)</div>
<div class="line">    {</div>
<div class="line">        m_pRenderTargetMemoryPool-&gt;Shutdown();</div>
<div class="line">        <span class="keyword">delete</span> m_pRenderTargetMemoryPool;</div>
<div class="line">        m_pRenderTargetMemoryPool = NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a name="a67"></a><a class="code" href="group__nvn__c__functions.html#ga54ac57de39c708eb9758bae7770d5ccc">nvnQueueFinalize</a>(&amp;m_Queue);</div>
<div class="line">    <span class="keywordflow">if</span> (m_pQueueMemory)</div>
<div class="line">    {</div>
<div class="line">        AlignedDeallocate(m_pQueueMemory);</div>
<div class="line">        m_pQueueMemory = NULL;</div>
<div class="line">    }</div>
<div class="line">    <a name="a68"></a><a class="code" href="group__nvn__c__functions.html#ga5fccd6ba67cd2d269900832d3b7e82ff">nvnDeviceFinalize</a>(&amp;m_Device);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * GettingStartedWithNVN::Resize</span></div>
<div class="line"><span class="comment"> * -----------------------------</span></div>
<div class="line"><span class="comment"> * This method is called everytime the window is resized and is passed</span></div>
<div class="line"><span class="comment"> * the new size of the window. It frees the old render target and creates a new</span></div>
<div class="line"><span class="comment"> * render target with the new screen size. A new set of commands for the command buffer</span></div>
<div class="line"><span class="comment"> * is recorded that performs four scissored clears of different colors on the target.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> GettingStartedWithNVN::Resize(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* Check for the window being minimized or having no visible surface. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (width == 0 || height == 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Before recording a new command buffer, make sure all previous GPU</span></div>
<div class="line"><span class="comment">         * commands have finished by setting up a fence and waiting for it to</span></div>
<div class="line"><span class="comment">         * be signalled. This so that the memory the command buffer uses isn&#39;t</span></div>
<div class="line"><span class="comment">         * overwritten before the GPU is done using it.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a name="a69"></a><a class="code" href="group__nvn__c__functions.html#gae646129720b27503c239a22db9653fa0">nvnQueueFenceSync</a>(&amp;m_Queue, &amp;m_CommandBufferSync, <a name="a70"></a><a class="code" href="group__nvn__c__enum.html#gga6ab26a343b68da722799167ea97ec69da81ae43677cd72903d494e5c37e061294">NVN_SYNC_CONDITION_ALL_GPU_COMMANDS_COMPLETE</a>, 0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * A sync placed into the queue as above must first be flushed to the</span></div>
<div class="line"><span class="comment">         * GPU before nvnSyncWait can be called on it.  If not, then a dead</span></div>
<div class="line"><span class="comment">         * lock happens where the CPU is waiting for the GPU to signal a</span></div>
<div class="line"><span class="comment">         * sync it does not know about yet.  With the debug layer active</span></div>
<div class="line"><span class="comment">         * this causes the callback function to be called if the sync is not</span></div>
<div class="line"><span class="comment">         * flushed.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a name="a71"></a><a class="code" href="group__nvn__c__functions.html#ga98feac9fc906eb1a9a5eb19ef4381b46">nvnQueueFlush</a>(&amp;m_Queue);</div>
<div class="line">    <a name="a72"></a><a class="code" href="group__nvn__c__functions.html#ga2e9deb5d068866fe0c32929a3f82baf3">nvnSyncWait</a>(&amp;m_CommandBufferSync, <a name="a73"></a><a class="code" href="group__nvn__c__defines.html#ga6c3444e501307a094f1d57abf1059aed">NVN_WAIT_TIMEOUT_MAXIMUM</a>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* If it&#39;s the first time Resize is called, allocate the NVNwindow. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (m_pWindow == NULL)</div>
<div class="line">    {</div>
<div class="line">        m_pWindow = <span class="keyword">new</span> <a class="code" href="struct_n_v_nwindow.html">NVNwindow</a>;</div>
<div class="line">    }</div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Otherwise finalize (free) the NVNwindow used for the previous window size.</span></div>
<div class="line"><span class="comment">         * The NVNWindow must be finalized before a render target it owns is finalized.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__nvn__c__functions.html#ga53660a4abfffea411f62415c79a65cdf">nvnWindowFinalize</a>(m_pWindow);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Set the size of the texture to be created by the texture builder.</span></div>
<div class="line"><span class="comment">         * Implicitly sets depth to one.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga1eb945f455f851adf9b738be38cfb0bc">nvnTextureBuilderSetSize2D</a>(&amp;m_RenderTargetBuilder, width, height);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; g_NumColorBuffers; ++i)</div>
<div class="line">    {</div>
<div class="line">            <span class="comment">/* If it&#39;s the first time Resize is called, allocate the texture. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!m_RenderTargets[i])</div>
<div class="line">        {</div>
<div class="line">            m_RenderTargets[i] = <span class="keyword">new</span> <a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>;</div>
<div class="line">        }</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Otherwise, finalize (free) the texture from the previous frame.</span></div>
<div class="line"><span class="comment">             * A texture belonging to an NVNwindow must be finalized after the</span></div>
<div class="line"><span class="comment">             * window that owns it is finalized.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="group__nvn__c__functions.html#gaa5741253f7ab5c9075a6821a68cfa351">nvnTextureFinalize</a>(m_RenderTargets[i]);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* Set the memory pool the texture is to be allocated from and offset to where it will be located. */</span></div>
<div class="line">        <a name="a74"></a><a class="code" href="group__nvn__c__functions.html#gaf6530c01a016b836ad82434f6a793cd8">nvnTextureBuilderSetStorage</a>(&amp;m_RenderTargetBuilder, m_pRenderTargetMemoryPool-&gt;GetMemoryPool(), m_ColorTargetSize * i);</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* Create the texture using the current state of the texture builder. */</span></div>
<div class="line">        <a name="a75"></a><a class="code" href="group__nvn__c__functions.html#gad8c5cbaa3292721f1de9d521a66aac3e">nvnTextureInitialize</a>(m_RenderTargets[i], &amp;m_RenderTargetBuilder);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         *  Sets the number of render targets that the NVNwindow will have available and</span></div>
<div class="line"><span class="comment">         *  gives a pointer to an array of those targets.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a name="a76"></a><a class="code" href="group__nvn__c__functions.html#ga610c7f233b7bb1e02f4926fe554df5db">nvnWindowBuilderSetTextures</a>(&amp;m_WindowBuilder, g_NumColorBuffers, m_RenderTargets);</div>
<div class="line">    <a name="a77"></a><a class="code" href="group__nvn__c__functions.html#gac5c388ac1ed70cb34ea4d71d23af9a73">nvnWindowInitialize</a>(m_pWindow, &amp;m_WindowBuilder);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Clear Colors */</span></div>
<div class="line">    <span class="keywordtype">float</span> black[4] = { 0.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">    <span class="keywordtype">float</span>   red[4] = { 1.0f, 0.0f, 0.0f, 1.0f };</div>
<div class="line">    <span class="keywordtype">float</span> green[4] = { 0.0f, 1.0f, 0.0f, 1.0f };</div>
<div class="line">    <span class="keywordtype">float</span>  blue[4] = { 0.0f, 0.0f, 1.0f, 1.0f };</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Temporary variables for size/position of cleared rects. */</span></div>
<div class="line">    <span class="keywordtype">int</span> halfWidth  = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(ceil(width / 2.0f));</div>
<div class="line">    <span class="keywordtype">int</span> halfHeight = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(ceil(height / 2.0f));</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Reset the command and control memory pointers back to the beginning</span></div>
<div class="line"><span class="comment">         * of their blocks of memory. This causes the next recording to overwrite</span></div>
<div class="line"><span class="comment">         * whatever memory was there.  This is only safe to do if a sync is</span></div>
<div class="line"><span class="comment">         * used to ensure that the command memory about to be overwritten</span></div>
<div class="line"><span class="comment">         * has already been used by the gpu.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga2c0d758cfa73c25f2a34486353f46d92">nvnCommandBufferAddCommandMemory</a>(&amp;m_CommandBuffer, m_pCommandMemoryPool-&gt;GetMemoryPool(), m_CommandPoolOffset, g_CommandMemorySize);</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga8de6ce290ee0180d9bcd700c1d08d0bf">nvnCommandBufferAddControlMemory</a>(&amp;m_CommandBuffer, m_pControlPool, g_ControlMemorySize);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Starts the recording of a new set of commands for the given command buffer. */</span></div>
<div class="line">    <a name="a78"></a><a class="code" href="group__nvn__c__functions.html#gaeb763d2bdad2c058c75802190fef4748">nvnCommandBufferBeginRecording</a>(&amp;m_CommandBuffer);</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Lower left quadrant - black</span></div>
<div class="line"><span class="comment">             * Sets the scissor rectangle by the coordinates of its lower left</span></div>
<div class="line"><span class="comment">             * and its width/height.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">        <a name="a79"></a><a class="code" href="group__nvn__c__functions.html#gac6c38cac9330ae402f2f911d1e1aa757">nvnCommandBufferSetScissor</a>(&amp;m_CommandBuffer, 0, 0, halfWidth, halfHeight);</div>
<div class="line"></div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Clears the currently set render target at a given index.</span></div>
<div class="line"><span class="comment">             * Channels to be cleared are set through the clear color mask.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">        <a name="a80"></a><a class="code" href="group__nvn__c__functions.html#gab857894818dcd7f7a58d0358a9e44100">nvnCommandBufferClearColor</a>(&amp;m_CommandBuffer, 0, black, <a name="a81"></a><a class="code" href="group__nvn__c__enum.html#ggac703c5549157a2c6efb057f8047bde0fad16b7a15db3173484f7cd5496edb727f">NVN_CLEAR_COLOR_MASK_RGBA</a>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* Lower right quadrant - red */</span></div>
<div class="line">        <a class="code" href="group__nvn__c__functions.html#gac6c38cac9330ae402f2f911d1e1aa757">nvnCommandBufferSetScissor</a>(&amp;m_CommandBuffer, halfWidth, 0, width - halfWidth, halfHeight);</div>
<div class="line">        <a class="code" href="group__nvn__c__functions.html#gab857894818dcd7f7a58d0358a9e44100">nvnCommandBufferClearColor</a>(&amp;m_CommandBuffer, 0, red, <a class="code" href="group__nvn__c__enum.html#ggac703c5549157a2c6efb057f8047bde0fad16b7a15db3173484f7cd5496edb727f">NVN_CLEAR_COLOR_MASK_RGBA</a>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* Upper right quadrant - green */</span></div>
<div class="line">        <a class="code" href="group__nvn__c__functions.html#gac6c38cac9330ae402f2f911d1e1aa757">nvnCommandBufferSetScissor</a>(&amp;m_CommandBuffer, halfWidth, halfHeight, width - halfWidth, height - halfHeight);</div>
<div class="line">        <a class="code" href="group__nvn__c__functions.html#gab857894818dcd7f7a58d0358a9e44100">nvnCommandBufferClearColor</a>(&amp;m_CommandBuffer, 0, green, <a class="code" href="group__nvn__c__enum.html#ggac703c5549157a2c6efb057f8047bde0fad16b7a15db3173484f7cd5496edb727f">NVN_CLEAR_COLOR_MASK_RGBA</a>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* Upper left quadrant - blue */</span></div>
<div class="line">        <a class="code" href="group__nvn__c__functions.html#gac6c38cac9330ae402f2f911d1e1aa757">nvnCommandBufferSetScissor</a>(&amp;m_CommandBuffer, 0, halfHeight, halfWidth, height - halfHeight);</div>
<div class="line">        <a class="code" href="group__nvn__c__functions.html#gab857894818dcd7f7a58d0358a9e44100">nvnCommandBufferClearColor</a>(&amp;m_CommandBuffer, 0, blue, <a class="code" href="group__nvn__c__enum.html#ggac703c5549157a2c6efb057f8047bde0fad16b7a15db3173484f7cd5496edb727f">NVN_CLEAR_COLOR_MASK_RGBA</a>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Ends the recording of commands for the command buffer. Returns a</span></div>
<div class="line"><span class="comment">         * command handle to the compiled set of commands that can be submitted</span></div>
<div class="line"><span class="comment">         * to a queue or used as a part of another command buffer.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    m_CommandHandle = <a name="a82"></a><a class="code" href="group__nvn__c__functions.html#ga7d97d4cbf72259b6e867f3080f223b95">nvnCommandBufferEndRecording</a>(&amp;m_CommandBuffer);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef CHECK_COMMAND_BUFFER_MEMORY_USAGE</span></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * In order to pare down the memory used for command/control memory,</span></div>
<div class="line"><span class="comment">         * the command buffer can be queried for the amount of memory that is</span></div>
<div class="line"><span class="comment">         * free or used. This is useful to figure out how much memory to</span></div>
<div class="line"><span class="comment">         * allocate initially for small, reuasble command buffers.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * When a command buffer runs out of either command or control memory,</span></div>
<div class="line"><span class="comment">         * a callback function (optionally provided by the user) will be hit.</span></div>
<div class="line"><span class="comment">         * More information about how the callback function works can be found</span></div>
<div class="line"><span class="comment">         * in ManagedCommandBuffer.cpp</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <span class="keywordtype">size_t</span> commandMemoryUsed = <a name="a83"></a><a class="code" href="group__nvn__c__functions.html#ga7976af012dd82485da7127beca93e2ff">nvnCommandBufferGetCommandMemoryUsed</a>(&amp;m_CommandBuffer);</div>
<div class="line">    <span class="keywordtype">size_t</span> controlMemoryUsed = <a name="a84"></a><a class="code" href="group__nvn__c__functions.html#gaef36338c2d889d846bf1fbbe3efd25df">nvnCommandBufferGetControlMemoryUsed</a>(&amp;m_CommandBuffer);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * GettingStartedWithNVN::Draw</span></div>
<div class="line"><span class="comment"> * ---------------------------</span></div>
<div class="line"><span class="comment"> * This method submits the commands recorded in the command buffers to the queue</span></div>
<div class="line"><span class="comment"> * and presents the current render target to the screen.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> GettingStartedWithNVN::Draw(uint64_t <span class="comment">/*millisec*/</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Update the command buffer to set the current render target and grab</span></div>
<div class="line"><span class="comment">         * the index to that target.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <span class="keywordtype">int</span> index = UpdateRenderTargets();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga2e9deb5d068866fe0c32929a3f82baf3">nvnSyncWait</a>(&amp;m_WindowSync, <a class="code" href="group__nvn__c__defines.html#ga6c3444e501307a094f1d57abf1059aed">NVN_WAIT_TIMEOUT_MAXIMUM</a>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Submits the recorded commands in the command buffer to the queue</span></div>
<div class="line"><span class="comment">         * to be processed by the GPU. Multiple command buffers can be</span></div>
<div class="line"><span class="comment">         * submitted with one call by passing the number of command buffers</span></div>
<div class="line"><span class="comment">         * to be submitted and an array of command handles.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Render target setting command buffer. */</span></div>
<div class="line">    <a name="a85"></a><a class="code" href="group__nvn__c__functions.html#ga095fabdb4c81459bbe496ba45528211b">nvnQueueSubmitCommands</a>(&amp;m_Queue, 1, &amp;m_RenderTargetCommandHandle);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Scissored clears command buffer, created/update by the Resize function. */</span></div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga095fabdb4c81459bbe496ba45528211b">nvnQueueSubmitCommands</a>(&amp;m_Queue, 1, &amp;m_CommandHandle);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Displays the render target at the given index to the screen. */</span></div>
<div class="line">    <a name="a86"></a><a class="code" href="group__nvn__c__functions.html#gad317e78382b7f51a7a6f0504193d90c7">nvnQueuePresentTexture</a>(&amp;m_Queue, m_pWindow, index);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * GettingStartedWithNVN::UpdateRenderTargets</span></div>
<div class="line"><span class="comment"> * ------------------------------------------</span></div>
<div class="line"><span class="comment"> * Gets the index of the current render target from the NVNwindow</span></div>
<div class="line"><span class="comment"> * and records a command buffer that sets it up to be rendered to.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> GettingStartedWithNVN::UpdateRenderTargets()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__nvn__c__enum.html#ga58e9b155d7f2272b95044eed1f40415e">NVNwindowAcquireTextureResult</a> result = <a name="a87"></a><a class="code" href="group__nvn__c__functions.html#ga7fa0b45affa2e04d77e3c1ad11a03c32">nvnWindowAcquireTexture</a>(m_pWindow, &amp;m_WindowSync, &amp;m_CurrentWindowIndex);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(result == <a name="a88"></a><a class="code" href="group__nvn__c__enum.html#gga58e9b155d7f2272b95044eed1f40415eac9962a2f8bbcd4c01bb04d1e4111aba5">NVN_WINDOW_ACQUIRE_TEXTURE_RESULT_SUCCESS</a>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Set the sync object to signal when all gpu commands are complete and wait on the</span></div>
<div class="line"><span class="comment">         * sync object before overwriting the command buffer.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#gae646129720b27503c239a22db9653fa0">nvnQueueFenceSync</a>(&amp;m_Queue, &amp;m_CommandBufferSync, <a class="code" href="group__nvn__c__enum.html#gga6ab26a343b68da722799167ea97ec69da81ae43677cd72903d494e5c37e061294">NVN_SYNC_CONDITION_ALL_GPU_COMMANDS_COMPLETE</a>, 0);</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga98feac9fc906eb1a9a5eb19ef4381b46">nvnQueueFlush</a>(&amp;m_Queue);</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga2e9deb5d068866fe0c32929a3f82baf3">nvnSyncWait</a>(&amp;m_CommandBufferSync, <a class="code" href="group__nvn__c__defines.html#ga6c3444e501307a094f1d57abf1059aed">NVN_WAIT_TIMEOUT_MAXIMUM</a>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Reset the command and control memory pointers back to the beginning</span></div>
<div class="line"><span class="comment">         * of their blocks of memory. This causes the next recording to overwrite</span></div>
<div class="line"><span class="comment">         * whatever memory was there.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga2c0d758cfa73c25f2a34486353f46d92">nvnCommandBufferAddCommandMemory</a>(&amp;m_RenderTargetCommandBuffer, m_pCommandMemoryPool-&gt;GetMemoryPool(), m_RenderTargetCommandPoolOffset, g_CommandMemorySize);</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga8de6ce290ee0180d9bcd700c1d08d0bf">nvnCommandBufferAddControlMemory</a>(&amp;m_RenderTargetCommandBuffer, m_pRenderTargetControlPool, g_ControlMemorySize);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Records a command buffer that sets the render target at the index given</span></div>
<div class="line"><span class="comment">         * by the NVNwindow.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#gaeb763d2bdad2c058c75802190fef4748">nvnCommandBufferBeginRecording</a>(&amp;m_RenderTargetCommandBuffer);</div>
<div class="line">    <a name="a89"></a><a class="code" href="group__nvn__c__functions.html#gae3e9cdfa2eaad5ed0f5363598fa0ce7c">nvnCommandBufferSetRenderTargets</a>(&amp;m_RenderTargetCommandBuffer, 1, &amp;m_RenderTargets[m_CurrentWindowIndex], NULL, NULL, NULL);</div>
<div class="line">    m_RenderTargetCommandHandle = <a class="code" href="group__nvn__c__functions.html#ga7d97d4cbf72259b6e867f3080f223b95">nvnCommandBufferEndRecording</a>(&amp;m_RenderTargetCommandBuffer);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Return the index acquired from the NVNwindow so it can be used in the next present call. */</span></div>
<div class="line">    <span class="keywordflow">return</span> m_CurrentWindowIndex;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// static</span></div>
<div class="line"><span class="keywordtype">void</span> GettingStartedWithNVN::DebugLayerCallback(</div>
<div class="line">    <a class="code" href="group__nvn__c__enum.html#ga70a49f98019e4832818240297bee7eb3">NVNdebugCallbackSource</a> source,</div>
<div class="line">    <a class="code" href="group__nvn__c__enum.html#ga661d03f0e1c886c81d5ccc67935df182">NVNdebugCallbackType</a> type,</div>
<div class="line">    <span class="keywordtype">int</span> <span class="keywordtype">id</span>,</div>
<div class="line">    <a class="code" href="group__nvn__c__enum.html#ga6d72003c068d7795201e77d27bf8c7ac">NVNdebugCallbackSeverity</a> severity,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* message,</div>
<div class="line">    <span class="keywordtype">void</span>* pUser</div>
<div class="line">    )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(pUser == NULL);</div>
<div class="line"></div>
<div class="line">    <a name="a90"></a><a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;NVN Debug Layer Callback:\n&quot;</span>);</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;  source:       0x%08x\n&quot;</span>, source);</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;  type:         0x%08x\n&quot;</span>, type);</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;  id:           0x%08x\n&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;  severity:     0x%08x\n&quot;</span>, severity);</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;  message:      %s\n&quot;</span>,     message);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;NVN Debug layer callback hit&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">TutorialBaseClass* t()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> GettingStartedWithNVN tut;</div>
<div class="line">    <span class="keywordflow">return</span> (&amp;tut);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a name="a91"></a><a class="code" href="_socket_resolver_8cpp.html#ae79180f8ae90e05743b47a872f305a52">nnMain</a>()</div>
<div class="line">{</div>
<div class="line">    TutorialRun();</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</body>
</html>
