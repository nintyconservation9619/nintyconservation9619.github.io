<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NintendoSDK API Reference: SslSimple.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 構築: Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>総合概要</span></a></li>
      <li><a href="pages.html"><span>諸情報</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>名前空間</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SslSimple.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>ソースコードの説明は、<a class="el" href="_page_sample_ssl_simple.html">Simple Https commnucation with SSL library</a> および <a class="el" href="_ssl_simple_8cpp.html" title="Simple Https commnucation with SSL library. ">SslSimple.cpp</a> を参照してください。</p>
<div class="fragment"><div class="line"><span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><span class="comment">  Copyright (C)Nintendo All rights reserved.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nn___log_8h.html">nn/nn_Log.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nn___assert_8h.html">nn/nn_Assert.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="init_8h.html">nn/init.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;nn/os.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ssl_8h.html">nn/ssl.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="socket_8h.html">nn/socket.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;nn/nifm.h&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Build flags</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// #define PRINT_ALL_VERIFY_ERRORS // Enable this to print all verify errors that occurred</span></div>
<div class="line"><span class="comment">// #define PRINT_SERVER_CERT       // Enable this to print obtained server cert in DER format</span></div>
<div class="line"><span class="comment">// #define PERFORM_NON_BLOCKING    // Enable this to call I/O APIs in non-blocking mode</span></div>
<div class="line"><span class="comment">// #define IMPORT_SERVER_PKI       // Enable this to import CA certificate</span></div>
<div class="line"><span class="comment">// #define IMPORT_CLIENT_PKI       // Enable this to import client PKI information</span></div>
<div class="line"><span class="comment">// #define DISABLE_RENEGOTIATION   // Enable this to disable renegotiation</span></div>
<div class="line"><span class="comment">// #define DISABLE_SESSION_CACHE   // Enable this to disable session cache. This cannot be combined with SESSION_CACHE_TICKET</span></div>
<div class="line"><span class="comment">// #define SESSION_CACHE_TICKET    // Enable this to use session cache tickets. This cannot be combined with DISABLE_SESSION_CACHE</span></div>
<div class="line"><span class="comment">// #define FLUSH_SESSION_CACHE     // Enable this to flush session cache before destroying the connection</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Utils</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="preprocessor">#define PRINT_HEX_TABLE(pData,len)                                  \</span></div>
<div class="line"><span class="preprocessor">do                                                                  \</span></div>
<div class="line"><span class="preprocessor">{                                                                   \</span></div>
<div class="line"><span class="preprocessor">    unsigned char* pChar = reinterpret_cast&lt;unsigned char*&gt;(pData); \</span></div>
<div class="line"><span class="preprocessor">    for(uint32_t i = 0; i &lt; len; i++) {                             \</span></div>
<div class="line"><span class="preprocessor">        NN_LOG(&quot;0x%02x&quot;, pChar[i]);                                 \</span></div>
<div class="line"><span class="preprocessor">        if((i + 1) % 16 == 0) {                                     \</span></div>
<div class="line"><span class="preprocessor">            NN_LOG(&quot;\n&quot;);                                           \</span></div>
<div class="line"><span class="preprocessor">        } else {                                                    \</span></div>
<div class="line"><span class="preprocessor">            if(((i + 1) % 8 == 0) &amp;&amp; (i % 16 != 0)) {               \</span></div>
<div class="line"><span class="preprocessor">                NN_LOG(&quot; | &quot;);                                      \</span></div>
<div class="line"><span class="preprocessor">            } else {                                                \</span></div>
<div class="line"><span class="preprocessor">                NN_LOG(&quot; &quot;);                                        \</span></div>
<div class="line"><span class="preprocessor">            }                                                       \</span></div>
<div class="line"><span class="preprocessor">        }                                                           \</span></div>
<div class="line"><span class="preprocessor">    }                                                               \</span></div>
<div class="line"><span class="preprocessor">} while(NN_STATIC_CONDITION(false))</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace</span></div>
<div class="line">{</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span>                g_TimeoutOnNicConfigurationInSec = 15;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span>                g_TcpPortNumber                  = 443;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(DISABLE_SESSION_CACHE) &amp;&amp; defined(SESSION_CACHE_TICKET)</span></div>
<div class="line"><span class="preprocessor">    #error &quot;Error: DISABLE_SESSION_CACHE and SESSION_CACHE_TICKET are incompatible. Please only define one of them.&quot;</span></div>
<div class="line"><span class="preprocessor">#elif defined(DISABLE_SESSION_CACHE)</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classnn_1_1ssl_1_1_connection.html#ab3a78c9c7d3320a61743ff723d142f39">nn::ssl::Connection::SessionCacheMode</a>  g_sessionCacheMode = <a name="a0"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#ab3a78c9c7d3320a61743ff723d142f39a176a332fcbadb1d6401e4dd5f59b476b">nn::ssl::Connection::SessionCacheMode_None</a>;</div>
<div class="line"><span class="preprocessor">#elif defined(SESSION_CACHE_TICKET)</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classnn_1_1ssl_1_1_connection.html#ab3a78c9c7d3320a61743ff723d142f39">nn::ssl::Connection::SessionCacheMode</a>  g_sessionCacheMode = <a name="a1"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#ab3a78c9c7d3320a61743ff723d142f39a1ed4435f80dd20b4cac7f801899135ee">nn::ssl::Connection::SessionCacheMode_SessionTicket</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined (PRINT_ALL_VERIFY_ERRORS)</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span> g_IsPrintAllVerifyErrors = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span> g_IsPrintAllVerifyErrors = <span class="keyword">false</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if defined (PERFORM_NON_BLOCKING)</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span>               g_IsPerformNonBlocking           = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span>               g_IsPerformNonBlocking           = <span class="keyword">false</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if defined(PRINT_SERVER_CERT)</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span>               g_IsPrintServerCert              = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span>               g_IsPrintServerCert              = <span class="keyword">false</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Socket memory</span></div>
<div class="line"><a name="_a2"></a><a class="code" href="classnn_1_1socket_1_1_config_default_with_memory.html">nn::socket::ConfigDefaultWithMemory</a> g_SocketConfigWithMemory;</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Setup network interface</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="_a3"></a><a class="code" href="classnn_1_1_result.html">nn::Result</a> SetupNetwork()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a name="_a4"></a><a class="code" href="classnn_1_1_result_success.html">nn::ResultSuccess</a>();</div>
<div class="line">    uint32_t   timeoutSec = 0;</div>
<div class="line">    result = <a name="a5"></a><a class="code" href="namespacenn_1_1nifm.html#a0e3aaf3209696149ec22613e1d3d6705">nn::nifm::Initialize</a>();</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a name="a6"></a><a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> result;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a name="a7"></a><a class="code" href="namespacenn_1_1nifm.html#a96f83210fc74e61335caf9308a357fff">nn::nifm::SubmitNetworkRequest</a>();</div>
<div class="line">    <span class="keywordflow">while</span>(<a name="a8"></a><a class="code" href="namespacenn_1_1nifm.html#abe80d921b69bef9c0919c5bb544576f3">nn::nifm::IsNetworkRequestOnHold</a>())</div>
<div class="line">    {</div>
<div class="line">        <a name="a9"></a><a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Waiting for network interface availability...\n&quot;</span>);</div>
<div class="line">        <a name="a10"></a><a class="code" href="namespacenn_1_1os.html#a96b335e87af44c60a0d6dca75f11c9d2">nn::os::SleepThread</a>(<a name="a11"></a><a class="code" href="classnn_1_1_time_span.html#adc879772bbd4cd05381326fe0dd58b97">nn::TimeSpan::FromSeconds</a>(1));</div>
<div class="line">        <span class="keywordflow">if</span>(timeoutSec++ &gt; g_TimeoutOnNicConfigurationInSec)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to setup network interface.\n&quot;</span>);</div>
<div class="line">            result = <a name="_a12"></a><a class="code" href="classnn_1_1ssl_1_1_result_error_lower.html">nn::ssl::ResultErrorLower</a>();</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> FinalizeNetwork()</div>
<div class="line">{</div>
<div class="line">    <a name="a13"></a><a class="code" href="namespacenn_1_1nifm.html#a7704800c5ddaa16c5f0f89f6fa42174b">nn::nifm::CancelNetworkRequest</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// class SimpleHttpsClient: the class to perform simple HTTP GET request over SSL</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keyword">class </span>SimpleHttpsClient</div>
<div class="line">{</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> uint32_t ServerCertBufferSize     = 1024 * 32;  </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> uint32_t ReadBufferSize           = 1024 * 512; </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> uint32_t MaxAsyncDoHandshakeRetry = 30;         </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> uint32_t MsecPollTimeout          = 5000;       </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> uint32_t VerifyResultArrayLen     = 4;          </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> uint32_t HostNameBufLen           = 256;        </div>
<div class="line"></div>
<div class="line">    <a name="_a14"></a><a class="code" href="classnn_1_1ssl_1_1_context.html">nn::ssl::Context</a>    m_SslContext;               </div>
<div class="line">    <a name="_a15"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html">nn::ssl::Connection</a> m_SslConnection;            </div>
<div class="line">    <span class="keywordtype">char</span>                m_HostName[HostNameBufLen]; </div>
<div class="line">    <span class="keywordtype">bool</span>                m_IsNonBlocking;            </div>
<div class="line">    uint16_t            m_PortNumber;               </div>
<div class="line">    <span class="keywordtype">int</span>                 m_TcpSocket;                </div>
<div class="line">    <span class="keywordtype">bool</span>                m_IsSocketImported;         </div>
<div class="line">    <span class="keywordtype">char</span>*               m_pReceivedData;            </div>
<div class="line">    uint32_t            m_ReceivedTotalBytes;       </div>
<div class="line">    <span class="keywordtype">bool</span>                m_IsInitialized;            </div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(IMPORT_SERVER_PKI)</span></div>
<div class="line">    <a class="code" href="namespacenn_1_1ssl.html#a59dd45da9022c678840f23920a6ab0be">nn::ssl::CertStoreId</a> m_serverCertStoreId;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(IMPORT_CLIENT_PKI)</span></div>
<div class="line">    <a class="code" href="namespacenn_1_1ssl.html#a59dd45da9022c678840f23920a6ab0be">nn::ssl::CertStoreId</a> m_clientCertStoreId;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span>        SetupTcpSocket();</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> SetupSslContext(<a class="code" href="classnn_1_1ssl_1_1_context.html#a62e84b2f42eb7bc93dcaf7e52257db89">nn::ssl::Context::SslVersion</a> sslVersion);</div>
<div class="line">    <span class="keywordtype">bool</span>       SetupSslConnection(<a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12">nn::ssl::Connection::VerifyOption</a> verifyOption);</div>
<div class="line">    <span class="keywordtype">bool</span>       PrintVerifyError(<span class="keywordtype">bool</span> isPrintAllEnabled);</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    SimpleHttpsClient(<span class="keywordtype">bool</span> IsBlocking, <span class="keyword">const</span> <span class="keywordtype">char</span>* pInHostName, uint16_t portNum):</div>
<div class="line">        m_TcpSocket(-1),</div>
<div class="line">        m_IsSocketImported(<span class="keyword">false</span>),</div>
<div class="line">        m_pReceivedData(<span class="keyword">nullptr</span>),</div>
<div class="line">        m_ReceivedTotalBytes(0),</div>
<div class="line">        m_IsInitialized(<span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        strcpy(m_HostName, pInHostName);</div>
<div class="line">        m_IsNonBlocking = IsBlocking;</div>
<div class="line">        m_PortNumber    = portNum;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ~SimpleHttpsClient()</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(m_IsInitialized == <span class="keyword">true</span>)</div>
<div class="line">        {</div>
<div class="line">            this-&gt;<a name="a16"></a><a class="code" href="namespacenn_1_1htcs.html#abf5eb36f3563222450920fad56fdaf61">Finalize</a>();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a17"></a><a class="code" href="namespacenn_1_1htcs.html#a7eab72b8843a2a9ff763f52b78da680e">Initialize</a>(</div>
<div class="line">        <a class="code" href="classnn_1_1ssl_1_1_context.html#a62e84b2f42eb7bc93dcaf7e52257db89">nn::ssl::Context::SslVersion</a> SslVersion,</div>
<div class="line">        <a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12">nn::ssl::Connection::VerifyOption</a> verifyOption);</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="namespacenn_1_1htcs.html#abf5eb36f3563222450920fad56fdaf61">Finalize</a>();</div>
<div class="line">    <span class="keywordtype">bool</span> PerformSslHandshake(<span class="keywordtype">bool</span> g_IsPrintServerCert);</div>
<div class="line">    <span class="keywordtype">bool</span> SendHttpGetOverSsl();</div>
<div class="line">    <span class="keywordtype">bool</span> ReceiveAllHttpData();</div>
<div class="line">    <span class="keywordtype">void</span> PrintReceivedData();</div>
<div class="line">    <span class="keywordtype">bool</span> ConfigureHostName();</div>
<div class="line">    <span class="keywordtype">bool</span> ConfigureVerifyOption(<a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12">nn::ssl::Connection::VerifyOption</a> verifyOption);</div>
<div class="line">    <span class="keywordtype">bool</span> ConfigureSessionCacheMode();</div>
<div class="line">    <span class="keywordtype">bool</span> ConfigureRenegotiationMode();</div>
<div class="line">    <span class="keywordtype">bool</span> ConfigureIoMode();</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Create TCP socket and establish connection with the server</span></div>
<div class="line"><span class="comment">//   1. Create TCP socket by nn::socket::Socket()</span></div>
<div class="line"><span class="comment">//   2. Resolve host name by nn::socket::GetHostByName()</span></div>
<div class="line"><span class="comment">//   3. Establish TCP connection with the server by nn::socket::Connect()</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">int</span> SimpleHttpsClient::SetupTcpSocket()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span>                 tcpSocket;</div>
<div class="line">    <a name="_a18"></a><a class="code" href="structnn_1_1socket_1_1_in_addr.html">nn::socket::InAddr</a>  inetAddr;</div>
<div class="line"></div>
<div class="line">    memset(&amp;inetAddr, 0x00, <span class="keyword">sizeof</span>(inetAddr));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_HostName[0] == <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Host name is not set\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    tcpSocket = <a name="a19"></a><a class="code" href="namespacenn_1_1socket.html#a9afeb564bac1d0c04af2fec1f00c739f">nn::socket::Socket</a>(<a name="a20"></a><a class="code" href="namespacenn_1_1socket.html#a057d985148e23267303e6d00d7ed205daa4d833d8c15a76105639ddd11bcb614e">nn::socket::Family::Af_Inet</a>, <a name="a21"></a><a class="code" href="namespacenn_1_1socket.html#a1db675083dcccec6500d1435c5dfeaeaae703319723c99d2d3a7ba1ad0dc8f572">nn::socket::Type::Sock_Stream</a>, <a name="a22"></a><a class="code" href="namespacenn_1_1socket.html#a46347de69614965469ac8f3c8056468eaf07a075529789e7d91eefbce84c55d90">nn::socket::Protocol::IpProto_Tcp</a>);</div>
<div class="line">    <span class="keywordflow">if</span>(tcpSocket &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to create TCP socket (errno: %d)\n&quot;</span>, errno);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Created TCP socket (sockfd: %d).\n&quot;</span>, tcpSocket);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Resolving %s\n&quot;</span>, m_HostName);</div>
<div class="line">    <a name="_a23"></a><a class="code" href="structnn_1_1socket_1_1_host_ent.html">nn::socket::HostEnt</a> *pHostEnt = <a name="a24"></a><a class="code" href="namespacenn_1_1socket.html#a358030926e9e63c2e322de2bd3d26719">nn::socket::GetHostEntByName</a>(m_HostName);</div>
<div class="line">    <span class="keywordflow">if</span>(pHostEnt == <span class="keyword">nullptr</span>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to resolve host name (errno:%d)\n&quot;</span>, errno);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Just pick the first one</span></div>
<div class="line">    memcpy(&amp;inetAddr, pHostEnt-&gt;<a name="a25"></a><a class="code" href="structnn_1_1socket_1_1_host_ent.html#a1d26bb1a8b570fc8e1aa0a498ed5934d">h_addr_list</a>[0], <span class="keyword">sizeof</span>(inetAddr));</div>
<div class="line"></div>
<div class="line">    <a name="_a26"></a><a class="code" href="structnn_1_1socket_1_1_sock_addr_in.html">nn::socket::SockAddrIn</a> serverAddr;</div>
<div class="line">    serverAddr.<a name="a27"></a><a class="code" href="structnn_1_1socket_1_1_sock_addr_in.html#a7fe5afa2fe039b8bbf5a23fae30fe755">sin_addr</a>.<a name="a28"></a><a class="code" href="structnn_1_1socket_1_1_in_addr.html#a4bf7f3c8a8061edacb8f884b61c49a2e">S_addr</a> = inetAddr.<a class="code" href="structnn_1_1socket_1_1_in_addr.html#a4bf7f3c8a8061edacb8f884b61c49a2e">S_addr</a>;</div>
<div class="line">    serverAddr.<a name="a29"></a><a class="code" href="structnn_1_1socket_1_1_sock_addr_in.html#ac8e09f776d8331345ee1870f3aed4535">sin_family</a>      = <a class="code" href="namespacenn_1_1socket.html#a057d985148e23267303e6d00d7ed205daa4d833d8c15a76105639ddd11bcb614e">nn::socket::Family::Af_Inet</a>;</div>
<div class="line">    serverAddr.<a name="a30"></a><a class="code" href="structnn_1_1socket_1_1_sock_addr_in.html#ae37d378c458d394a0646d7bfcf72bc4d">sin_port</a>        = <a name="a31"></a><a class="code" href="namespacenn_1_1socket.html#a1b6e15ce629648357cf10cc8ada6b8d1">nn::socket::InetHtons</a>(m_PortNumber);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> rval = <a name="a32"></a><a class="code" href="namespacenn_1_1socket.html#a3aded7f0c8c072c7beb68a670d03d36f">nn::socket::Connect</a>(</div>
<div class="line">        tcpSocket,</div>
<div class="line">        (<a name="_a33"></a><a class="code" href="structnn_1_1socket_1_1_sock_addr.html">nn::socket::SockAddr</a>*)&amp;serverAddr,</div>
<div class="line">        <span class="keyword">sizeof</span>(serverAddr));</div>
<div class="line">    <span class="keywordflow">if</span>(rval &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to create TCP socket (errno: %d).\n&quot;</span>, errno);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Established TCP connection (addr:0x%x on port :%d).\n&quot;</span>,</div>
<div class="line">         serverAddr.<a class="code" href="structnn_1_1socket_1_1_sock_addr_in.html#a7fe5afa2fe039b8bbf5a23fae30fe755">sin_addr</a>.<a class="code" href="structnn_1_1socket_1_1_in_addr.html#a4bf7f3c8a8061edacb8f884b61c49a2e">S_addr</a>, <a name="a34"></a><a class="code" href="namespacenn_1_1socket.html#aa8de3f19aaf80d2233a668fc7ebe6f38">nn::socket::InetNtohs</a>(serverAddr.<a class="code" href="structnn_1_1socket_1_1_sock_addr_in.html#ae37d378c458d394a0646d7bfcf72bc4d">sin_port</a>));</div>
<div class="line"></div>
<div class="line">    m_TcpSocket = tcpSocket;</div>
<div class="line">    <span class="keywordflow">return</span> m_TcpSocket;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Setup SSL context</span></div>
<div class="line"><span class="comment">//   1. Create nn::ssl::Context by nn::ssl::Context::Create()</span></div>
<div class="line"><span class="comment">//   2. Get context ID of created context by nn::ssl::Context::GetContextId() for demonstration</span></div>
<div class="line"><span class="comment">//   3. Import CA certificate when IMPORT_SERVER_PKI is defined</span></div>
<div class="line"><span class="comment">//   4. Import client PKI information when IMPORT_CLIENT_PKI is defined</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Note that imported entities like CA certificates and client PKI information are volatile. These</span></div>
<div class="line"><span class="comment">// entities are copied into the SSL library and maintained until the SSL context created in this</span></div>
<div class="line"><span class="comment">// function is destroyed.</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a class="code" href="classnn_1_1_result.html">nn::Result</a> SimpleHttpsClient::SetupSslContext(<a class="code" href="classnn_1_1ssl_1_1_context.html#a62e84b2f42eb7bc93dcaf7e52257db89">nn::ssl::Context::SslVersion</a> sslVersion)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a class="code" href="classnn_1_1_result_success.html">nn::ResultSuccess</a>();</div>
<div class="line">    <span class="keywordflow">do</span></div>
<div class="line">    {</div>
<div class="line">        result = m_SslContext.Create(sslVersion);</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to create context (Description:%d)\n&quot;</span>,</div>
<div class="line">                result.<a name="a35"></a><a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="namespacenn_1_1ssl.html#af6fddf893f3c5d9ab9a50f9041112802">nn::ssl::SslContextId</a> contextId;</div>
<div class="line">        result = m_SslContext.GetContextId(&amp;contextId);</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to get context ID (Description:%d)\n&quot;</span>,</div>
<div class="line">                result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Created SSL context (ID:%d).\n&quot;</span>, contextId);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(IMPORT_SERVER_PKI)</span></div>
<div class="line">        <span class="keywordtype">char</span>*    pCaCert = <span class="keyword">nullptr</span>; <span class="comment">// Please provide CA certificate in PEM format!</span></div>
<div class="line">        uint32_t caCertSize = 0;    <span class="comment">// Please set the size of CA certificate!</span></div>
<div class="line">        result = m_SslContext.ImportServerPki(</div>
<div class="line">            &amp;m_serverCertStoreId,</div>
<div class="line">            pCaCert,</div>
<div class="line">            caCertSize,</div>
<div class="line">            <a name="a36"></a><a class="code" href="namespacenn_1_1ssl.html#a1fae06db81b292a8ff113c895fade02baae245959076a594c8fee8fd8e5261e33">nn::ssl::CertificateFormat_Pem</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to import server PKI (Description:%d)\n&quot;</span>,</div>
<div class="line">                result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Imported server PKI (certStoreID:%d).\n&quot;</span>, m_serverCertStoreId);</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif // IMPORT_SERVER_PKI</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(IMPORT_CLIENT_PKI)</span></div>
<div class="line">        <span class="keywordtype">char</span>*       pPkcs12Data    = <span class="keyword">nullptr</span>;    <span class="comment">// Please set pointer to the data in PKCS12 format!</span></div>
<div class="line">        uint32_t    pkcs12DataSize = 0;          <span class="comment">// Please set the size of PKCS12 data!</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* pkcs12Password = <span class="stringliteral">&quot;password&quot;</span>; <span class="comment">// Please set the appropriate password for the PKCS12 data!</span></div>
<div class="line">        uint32_t    passwordSize   = strlen(pkcs12Password);</div>
<div class="line"></div>
<div class="line">        result = m_SslContext.ImportClientPki(</div>
<div class="line">            &amp;m_clientCertStoreId,</div>
<div class="line">            pPkcs12Data,</div>
<div class="line">            pkcs12Password,</div>
<div class="line">            pkcs12DataSize,</div>
<div class="line">            passwordSize);</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to import client PKI (Description:%d)\n&quot;</span>,</div>
<div class="line">                result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Imported client PKI (certStoreID:%d).\n&quot;</span>, m_clientCertStoreId);</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif // IMPORT_CLIENT_PKI</span></div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">while</span> (<a name="a37"></a><a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(<span class="keyword">false</span>));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Setup SSL connection context</span></div>
<div class="line"><span class="comment">//   1. Create nn::ssl::Connection by nn::ssl::Connection::Create()</span></div>
<div class="line"><span class="comment">//   2. Set socket descriptor of TCP socket which alredy establised TCP connection by</span></div>
<div class="line"><span class="comment">//      nn::ssl::Connection::SetSocketDescriptor()</span></div>
<div class="line"><span class="comment">//   3. Set host name to be used for name validation during SSL handshake by</span></div>
<div class="line"><span class="comment">//      nn::ssl::Connection::SetHostName()</span></div>
<div class="line"><span class="comment">//   4. Set verify option by nn::ssl::Connection::SetVerifyOption</span></div>
<div class="line"><span class="comment">//   5. Set session cache mode by nn::ssl::Connection::SetSessionCacheMode</span></div>
<div class="line"><span class="comment">//   6. Set renegotion mode by nn::ssl::Connection::SetRenegotiationMode</span></div>
<div class="line"><span class="comment">//   7. Set blocking mode of I/O APIs (DoHandshake, Read, Write, Peek)</span></div>
<div class="line"><span class="comment">//   8. Get connection ID of created connection by nn::ssl::Context::GetConnectionId() for</span></div>
<div class="line"><span class="comment">//      demonstration</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::SetupSslConnection(<a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12">nn::ssl::Connection::VerifyOption</a> verifyOption)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = m_SslConnection.Create(&amp;m_SslContext);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;m_SslConnection.Create failed (Description:%d)\n&quot;</span>,</div>
<div class="line">            result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    result = m_SslConnection.SetSocketDescriptor(m_TcpSocket);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;m_SslConnection.SetSocketDescriptor failed (Description:%d)\n&quot;</span>,</div>
<div class="line">            result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Mark it as imported not to close it upon cleanup of SimpleHttpsClient</span></div>
<div class="line">    m_IsSocketImported = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ConfigureHostName() == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ConfigureVerifyOption(verifyOption) == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ConfigureSessionCacheMode() == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ConfigureRenegotiationMode() == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ConfigureIoMode() == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="namespacenn_1_1ssl.html#a4ae92b3d5f9129b26099c6caba90dd69">nn::ssl::SslConnectionId</a> connectiontId;</div>
<div class="line">    result = m_SslConnection.GetConnectionId(&amp;connectiontId);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to get connection ID (Description:%d)\n&quot;</span>,</div>
<div class="line">            result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Created SSL connection (ID:%d).\n&quot;</span>, connectiontId);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::ConfigureVerifyOption(<a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12">nn::ssl::Connection::VerifyOption</a> verifyOption)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = m_SslConnection.SetVerifyOption(verifyOption);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;m_SslConnection.SetVerifyOption failed (Description:%d)\n&quot;</span>,</div>
<div class="line">            result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12">nn::ssl::Connection::VerifyOption</a> currentVerifyOption = <a name="a38"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12abb59beb68a029fffc90f5d7c436361c5">nn::ssl::Connection::VerifyOption::VerifyOption_None</a>;</div>
<div class="line">    result = m_SslConnection.GetVerifyOption(&amp;currentVerifyOption);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;m_SslConnection.GetVerifyOption failed (Description:%d)\n&quot;</span>,</div>
<div class="line">            result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Verify option: %u\n&quot;</span>, currentVerifyOption);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::ConfigureSessionCacheMode()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a class="code" href="classnn_1_1_result_success.html">nn::ResultSuccess</a>();</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(DISABLE_SESSION_CACHE) || defined(SESSION_CACHE_TICKET)</span></div>
<div class="line">    result = m_SslConnection.SetSessionCacheMode(g_sessionCacheMode);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to set session cache mode.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1ssl_1_1_connection.html#ab3a78c9c7d3320a61743ff723d142f39">nn::ssl::Connection::SessionCacheMode</a> cacheMode = <a class="code" href="classnn_1_1ssl_1_1_connection.html#ab3a78c9c7d3320a61743ff723d142f39a176a332fcbadb1d6401e4dd5f59b476b">nn::ssl::Connection::SessionCacheMode_None</a>;</div>
<div class="line">    result = m_SslConnection.GetSessionCacheMode(&amp;cacheMode);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to get session cache mode. Desc: %d\n&quot;</span>, result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Session cache mode: %u\n&quot;</span>, cacheMode);</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::ConfigureRenegotiationMode()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a class="code" href="classnn_1_1_result_success.html">nn::ResultSuccess</a>();</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(DISABLE_RENEGOTIATION)</span></div>
<div class="line">    result = m_SslConnection.SetRenegotiationMode(<a name="a39"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#a20f12fa7ef56cddbd70e96c0d1fd5862adc2e5138f380d5a23d5e93cdaa38b0f2">nn::ssl::Connection::RenegotiationMode_None</a>);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to set session renegotiation mode.\n&quot;</span>, result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1ssl_1_1_connection.html#a20f12fa7ef56cddbd70e96c0d1fd5862">nn::ssl::Connection::RenegotiationMode</a> renegotiationMode = <a class="code" href="classnn_1_1ssl_1_1_connection.html#a20f12fa7ef56cddbd70e96c0d1fd5862adc2e5138f380d5a23d5e93cdaa38b0f2">nn::ssl::Connection::RenegotiationMode_None</a>;</div>
<div class="line">    result = m_SslConnection.GetRenegotiationMode(&amp;renegotiationMode);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to get session renegotiation mode.\n&quot;</span>, result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Renegotiation Mode: %u\n&quot;</span>, renegotiationMode);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::ConfigureIoMode()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a class="code" href="classnn_1_1_result_success.html">nn::ResultSuccess</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_IsNonBlocking)</div>
<div class="line">    {</div>
<div class="line">        result = m_SslConnection.SetIoMode(<a name="a40"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#a519f207d2aa0c74d025756eb78dabb58aad3407c8bc0534b14c91504d5119a0bf">nn::ssl::Connection::IoMode_NonBlocking</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to configure I/O blocking mode (Description:%d)\n&quot;</span>,</div>
<div class="line">                result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1ssl_1_1_connection.html#a519f207d2aa0c74d025756eb78dabb58">nn::ssl::Connection::IoMode</a> ioMode = <a name="a41"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#a519f207d2aa0c74d025756eb78dabb58a0f6c72bbb6bc19c928212531d1b002db">nn::ssl::Connection::IoMode_Blocking</a>;</div>
<div class="line">    result = m_SslConnection.GetIoMode(&amp;ioMode);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to get I/O blocking mode (Description:%d)\n&quot;</span>,</div>
<div class="line">            result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Io mode: %u\n&quot;</span>, ioMode);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::ConfigureHostName()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> isSuccess = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">    uint32_t hostNameLen = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(strlen(m_HostName));</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = m_SslConnection.SetHostName(m_HostName, hostNameLen);</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;m_SslConnection.SetHostName failed (Description:%d)\n&quot;</span>,</div>
<div class="line">            result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">char</span>* pOutHostname = <span class="keyword">new</span> <span class="keywordtype">char</span>[hostNameLen + 1];</div>
<div class="line">    <span class="keywordflow">if</span>(pOutHostname == <span class="keyword">nullptr</span>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to allocate hostname buffer\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">do</span></div>
<div class="line">        {</div>
<div class="line">            uint32_t outHostNameLen = 0;</div>
<div class="line">            result = m_SslConnection.GetHostName(pOutHostname, &amp;outHostNameLen, hostNameLen + 1);</div>
<div class="line">            <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;m_SslConnection.GetHostName failed (Description:%d)\n&quot;</span>,</div>
<div class="line">                    result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">                isSuccess = <span class="keyword">false</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(outHostNameLen &gt; 0)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;HostNameLen: %u, HostName: %s\n&quot;</span>, outHostNameLen, pOutHostname);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;HostNameLen: %u\n&quot;</span>, outHostNameLen);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">while</span>(<a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(<span class="keyword">false</span>));</div>
<div class="line"></div>
<div class="line">        <span class="keyword">delete</span> [] pOutHostname;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> isSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::PrintVerifyError(<span class="keywordtype">bool</span> isPrintAllEnabled)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> isSuccess = <span class="keyword">true</span>;</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a class="code" href="classnn_1_1_result_success.html">nn::ResultSuccess</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(isPrintAllEnabled)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1_result.html">nn::Result</a>* pErrorArray = <span class="keyword">new</span> <a class="code" href="classnn_1_1_result.html">nn::Result</a>[VerifyResultArrayLen];</div>
<div class="line">        <span class="keywordflow">if</span>(pErrorArray != <span class="keyword">nullptr</span>)</div>
<div class="line">        {</div>
<div class="line">            uint32_t errorsWritten = 0;</div>
<div class="line">            uint32_t totalErrors = 0;</div>
<div class="line"></div>
<div class="line">            result = m_SslConnection.GetVerifyCertErrors(pErrorArray, &amp;errorsWritten, &amp;totalErrors, VerifyResultArrayLen);</div>
<div class="line">            <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span>(nn::ssl::ResultBufferTooShort::Includes(result))</div>
<div class="line">                {</div>
<div class="line">                    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;nn::ssl::GetVerifyErrors() returned ResultBufferTooShort! ErrorsWritten: %u TotalErrors: %u\n\n&quot;</span>, errorsWritten, totalErrors);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;nn::ssl::GetVerifyErrors() failed! Desc: %d\n\n&quot;</span>, result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                isSuccess = <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;ErrorsWritten: %u TotalErrors: %u\n&quot;</span>, errorsWritten, totalErrors);</div>
<div class="line">                <span class="keywordflow">for</span>(uint32_t iError = 0; iError &lt; errorsWritten; ++iError)</div>
<div class="line">                {</div>
<div class="line">                    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Verify error %u: desc: %d\n&quot;</span>, iError, pErrorArray[iError].GetDescription());</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keyword">delete</span> [] pErrorArray;</div>
<div class="line">            pErrorArray = <span class="keyword">nullptr</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;CurlSslConnectionAfterFunction: Failed to allocate Verify result array\n\n&quot;</span>);</div>
<div class="line">            isSuccess = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1_result.html">nn::Result</a> verifyCertError;</div>
<div class="line">        result = m_SslConnection.GetVerifyCertError(&amp;verifyCertError);</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to get verify cert error (Description:%d)\n&quot;</span>,</div>
<div class="line">                result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Certificate validation failed (Description:%d)\n&quot;</span>,</div>
<div class="line">                verifyCertError.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> isSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Initialize SimpleHttpsClient</span></div>
<div class="line"><span class="comment">//   1. Allocate buffer to store received data</span></div>
<div class="line"><span class="comment">//   2. Setup TCP socket</span></div>
<div class="line"><span class="comment">//   3. Setup SSL context</span></div>
<div class="line"><span class="comment">//   4. Setup SSL connection context</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="namespacenn_1_1htcs.html#a7eab72b8843a2a9ff763f52b78da680e">SimpleHttpsClient::Initialize</a>(</div>
<div class="line">    <a class="code" href="classnn_1_1ssl_1_1_context.html#a62e84b2f42eb7bc93dcaf7e52257db89">nn::ssl::Context::SslVersion</a> SslVersion,</div>
<div class="line">    <a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12">nn::ssl::Connection::VerifyOption</a> verifyOption)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span>       IsSuccess = <span class="keyword">true</span>;</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_IsInitialized == <span class="keyword">true</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// already initialized</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">do</span></div>
<div class="line">    {</div>
<div class="line">        m_pReceivedData = <span class="keyword">new</span> <span class="keywordtype">char</span>[ReadBufferSize];</div>
<div class="line">        <span class="keywordflow">if</span>(m_pReceivedData == <span class="keyword">nullptr</span>)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to allocate memory for read buffer.\n&quot;</span>);</div>
<div class="line">            IsSuccess = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Allocated %d bytes for receive buffer.\n&quot;</span>, ReadBufferSize);</div>
<div class="line">        memset(m_pReceivedData, 0x00, ReadBufferSize);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(this-&gt;SetupTcpSocket() &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to setup TCP socket.\n&quot;</span>);</div>
<div class="line">            IsSuccess = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(SetupSslContext(SslVersion).IsFailure())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to setup SSL context.\n&quot;</span>);</div>
<div class="line">            IsSuccess = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(SetupSslConnection(verifyOption) == <span class="keyword">false</span>)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to setup SSL connection context.\n&quot;</span>);</div>
<div class="line">            IsSuccess = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">while</span> (<a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(<span class="keyword">false</span>));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>((m_pReceivedData!= <span class="keyword">nullptr</span>) &amp;&amp; (IsSuccess == <span class="keyword">false</span>))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">delete</span>[] m_pReceivedData;</div>
<div class="line">        m_pReceivedData = <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Initialized SimpleHttpsClient.\n&quot;</span>);</div>
<div class="line">    m_IsInitialized = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">return</span> IsSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Finalize SimpleHttpsClient</span></div>
<div class="line"><span class="comment">//   1. Close TCP socket (if it&#39;s created and already imported into the SSL library)</span></div>
<div class="line"><span class="comment">//   2. Destroy nn::ssl::Connection</span></div>
<div class="line"><span class="comment">//   3. Destroy nn::ssl::Context</span></div>
<div class="line"><span class="comment">//   4. Free allocated memory</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacenn_1_1htcs.html#abf5eb36f3563222450920fad56fdaf61">SimpleHttpsClient::Finalize</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Cloes TCP socket</span></div>
<div class="line">    <span class="keywordflow">if</span>(m_TcpSocket &gt; 0 &amp;&amp; m_IsSocketImported != <span class="keyword">true</span>)</div>
<div class="line">    {</div>
<div class="line">        <a name="a42"></a><a class="code" href="namespacenn_1_1socket.html#ae01110d228e2148d830b1ecfb9aaa425">nn::socket::Close</a>(m_TcpSocket);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Destroy nn::ssl::Connection first</span></div>
<div class="line">    <a class="code" href="namespacenn_1_1ssl.html#a4ae92b3d5f9129b26099c6caba90dd69">nn::ssl::SslConnectionId</a> connectiontId;</div>
<div class="line">    <span class="keywordflow">if</span>(m_SslConnection.GetConnectionId(&amp;connectiontId).IsSuccess())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(connectiontId != 0)</div>
<div class="line">        {</div>
<div class="line"><span class="preprocessor">#if defined(FLUSH_SESSION_CACHE)</span></div>
<div class="line">            <a class="code" href="classnn_1_1_result.html">nn::Result</a> flushResult = m_SslConnection.FlushSessionCache();</div>
<div class="line">            <span class="keywordflow">if</span>(flushResult.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Warning: Failed to flush session cache during SimpleHttpsClient::Finalize! Desc: %d\n&quot;</span>, flushResult.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">            m_SslConnection.Destroy();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Destroy nn::ssl::Context after nn::ssl::Connection is destroyed</span></div>
<div class="line">    <a class="code" href="namespacenn_1_1ssl.html#af6fddf893f3c5d9ab9a50f9041112802">nn::ssl::SslContextId</a> contextId;</div>
<div class="line">    <span class="keywordflow">if</span>(m_SslContext.GetContextId(&amp;contextId).IsSuccess())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(contextId != 0)</div>
<div class="line">        {</div>
<div class="line"><span class="preprocessor">#if defined(IMPORT_SERVER_PKI)</span></div>
<div class="line">            <a class="code" href="classnn_1_1_result.html">nn::Result</a> removeServerResult = m_SslContext.RemovePki(m_serverCertStoreId);</div>
<div class="line">            <span class="keywordflow">if</span>(removeServerResult.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Warning: Failed to remove server pki during SimpleHttpsClient::Finalize! Desc: %d\n&quot;</span>, removeServerResult.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(IMPORT_CLIENT_PKI)</span></div>
<div class="line">            <a class="code" href="classnn_1_1_result.html">nn::Result</a> removeClientResult = m_SslContext.RemovePki(m_clientCertStoreId);</div>
<div class="line">            <span class="keywordflow">if</span>(removeClientResult.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Warning: Failed to remove client pki during SimpleHttpsClient::Finalize! Desc: %d\n&quot;</span>, removeClientResult.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">            m_SslContext.Destroy();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Free memory</span></div>
<div class="line">    <span class="keywordflow">if</span>(m_pReceivedData != <span class="keyword">nullptr</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">delete</span>[] m_pReceivedData;</div>
<div class="line">        m_pReceivedData = <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    m_IsInitialized = <span class="keyword">false</span>;</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Finalized SimpleHttpsClient.\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Perform SSL handshake</span></div>
<div class="line"><span class="comment">//   1. Allocate buffer to store server certificate and set it to the SSL library by</span></div>
<div class="line"><span class="comment">//      nn::ssl::Connection::SetServerCertBuffer() if required</span></div>
<div class="line"><span class="comment">//   2. Start SSL handshake by nn::ssl::Connection::DoHandshake()</span></div>
<div class="line"><span class="comment">//   3. If the I/O mode of nn::ssl::Connection is non-blocking and nn::ssl::ResultIoWouldBlock is</span></div>
<div class="line"><span class="comment">//      returned from nn::ssl::Connection::DoHandshake(), try DoHandshake again</span></div>
<div class="line"><span class="comment">//   4. Print server certificate when it is requried</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::PerformSslHandshake(<span class="keywordtype">bool</span> isPrintServerCert)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result              = <a class="code" href="classnn_1_1_result_success.html">nn::ResultSuccess</a>();</div>
<div class="line">    <span class="keywordtype">bool</span>       isSuccess           = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordtype">char</span>*      serverCertBuff      = <span class="keyword">nullptr</span>;</div>
<div class="line">    uint32_t   asyncHandshakeCount = 0;</div>
<div class="line">    uint32_t   serverCertLength    = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_IsInitialized == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// not initialized</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(isPrintServerCert == <span class="keyword">true</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Allocate buffer for server certificate and pass it to the SSL library</span></div>
<div class="line">        serverCertBuff = <span class="keyword">new</span> <span class="keywordtype">char</span>[this-&gt;ServerCertBufferSize];</div>
<div class="line">        <span class="keywordflow">if</span>(serverCertBuff == <span class="keyword">nullptr</span>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Failed to allocate buffer</span></div>
<div class="line">        }</div>
<div class="line">        memset(serverCertBuff, 0x00, this-&gt;ServerCertBufferSize);</div>
<div class="line"></div>
<div class="line">        result = m_SslConnection.SetServerCertBuffer(serverCertBuff, this-&gt;ServerCertBufferSize);</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;SetServerCertBuffer failed (Description:%d)\n&quot;</span>, result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            <span class="keyword">delete</span>[] serverCertBuff;</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">do</span></div>
<div class="line">    {</div>
<div class="line">        result = (serverCertBuff)?</div>
<div class="line">            m_SslConnection.DoHandshake(&amp;serverCertLength, <span class="keyword">nullptr</span>):m_SslConnection.DoHandshake();</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a name="a43"></a><a class="code" href="classnn_1_1_result.html#a80792d8ec8b6b9e9b34025100baa67ec">IsSuccess</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;SSL Handshake completed.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(nn::ssl::ResultBufferTooShort::Includes(result))</div>
<div class="line">        {</div>
<div class="line">            uint32_t neededBufSize = 0;</div>
<div class="line">            <a class="code" href="classnn_1_1_result.html">nn::Result</a> tempResult = m_SslConnection.GetNeededServerCertBufferSize(&amp;neededBufSize);</div>
<div class="line">            <span class="keywordflow">if</span>(tempResult.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Error: GetNeededServerCertBufferSize() failed with desc: %d\n&quot;</span>, tempResult.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">                isSuccess = <span class="keyword">false</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Failed to store server certificate, but it is ok to continue</span></div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Provided buffer was not long enough to store server cert. Required buffer lenth: %u\n&quot;</span>, neededBufSize);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(nn::ssl::ResultIoWouldBlock::Includes(result))</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span>(asyncHandshakeCount++ &lt; this-&gt;MaxAsyncDoHandshakeRetry)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Handshake would block, try again after 100 msec (retry count:%d)\n&quot;</span>,</div>
<div class="line">                    asyncHandshakeCount);</div>
<div class="line">                <a class="code" href="namespacenn_1_1os.html#a96b335e87af44c60a0d6dca75f11c9d2">nn::os::SleepThread</a>(<a name="a44"></a><a class="code" href="classnn_1_1_time_span.html#a1b8582b5180ce7992fc82a148c7f8c90">nn::TimeSpan::FromMilliSeconds</a>(100));</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Handshake failed after %d times of execution\n&quot;</span>, asyncHandshakeCount);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;SSL Handshake failed (Description:%d)\n&quot;</span>, result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            <span class="keywordflow">if</span>(nn::ssl::ResultVerifyCertFailed::Includes(result))</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span>( PrintVerifyError(g_IsPrintAllVerifyErrors) == false )</div>
<div class="line">                {</div>
<div class="line">                    isSuccess = <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">while</span> (<a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(<span class="keyword">true</span>));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a80792d8ec8b6b9e9b34025100baa67ec">IsSuccess</a>() &amp;&amp; (serverCertLength &gt; 0))</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Obtained server certiticate (%d bytes) ---------------------\n&quot;</span>, serverCertLength);</div>
<div class="line">        PRINT_HEX_TABLE(serverCertBuff, serverCertLength);</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(serverCertBuff != <span class="keyword">nullptr</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">delete</span>[] serverCertBuff;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> isSuccess;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Send HTTP GET request over SSL connection</span></div>
<div class="line"><span class="comment">//   1. Setup HTTP GET request</span></div>
<div class="line"><span class="comment">//   2. Send HTTP GET request over SSL by nn::ssl::Connection::Write()</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::SendHttpGetOverSsl()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> httpReqBuff[64] = {0};</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_IsInitialized == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// not initialized</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    sprintf(httpReqBuff, <span class="stringliteral">&quot;GET / HTTP/1.0\r\nHost: %s\r\n\r\n&quot;</span>, m_HostName);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> sentBytes     = 0;</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = m_SslConnection.Write(</div>
<div class="line">        httpReqBuff,</div>
<div class="line">        &amp;sentBytes,</div>
<div class="line">        static_cast&lt;uint32_t&gt;(strlen(httpReqBuff)));</div>
<div class="line">    <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>() || sentBytes &lt; 0)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to write data. (Description:%d)\n&quot;</span>, result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Sent HTTP request via SSL (%d bytes).\n&quot;</span>, sentBytes);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (result.<a class="code" href="classnn_1_1_result.html#a80792d8ec8b6b9e9b34025100baa67ec">IsSuccess</a>())?(<span class="keyword">true</span>):(<span class="keyword">false</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Perform SSL read until:</span></div>
<div class="line"><span class="comment">//   1. If the I/O mode of nn::ssl::Connection is non-blocking Call nn::ssl::Connection::Poll() to</span></div>
<div class="line"><span class="comment">//      wait for the SSL connection becomes ready to read</span></div>
<div class="line"><span class="comment">//   2. Read received data by nn::ssl::Connection::Read() until:</span></div>
<div class="line"><span class="comment">//     - There&#39;s a space to store the data in the buffer (m_pReceivedData)</span></div>
<div class="line"><span class="comment">//     - connection gets closed by the peer</span></div>
<div class="line"><span class="comment">//     - timeout happens on nn::ssl::Connection::Poll</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">bool</span> SimpleHttpsClient::ReceiveAllHttpData()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a>                     result = <a class="code" href="classnn_1_1_result_success.html">nn::ResultSuccess</a>();</div>
<div class="line">    <a class="code" href="classnn_1_1ssl_1_1_connection.html#a2a7878b10a5bbdf0c03753f222ee7c0e">nn::ssl::Connection::PollEvent</a> pollEvent;</div>
<div class="line">    <a class="code" href="classnn_1_1ssl_1_1_connection.html#a2a7878b10a5bbdf0c03753f222ee7c0e">nn::ssl::Connection::PollEvent</a> pollOutEvent;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_IsInitialized == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// not initialized</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    memset(m_pReceivedData, 0x00, ReadBufferSize);</div>
<div class="line">    <span class="keywordflow">do</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> receivedBytes  = 0;</div>
<div class="line">        <span class="keywordtype">int</span> ReadSize       = ReadBufferSize - m_ReceivedTotalBytes;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(ReadSize &lt;= 0)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;There&#39;s no more space to store received data (%d bytes received).\n&quot;</span>,</div>
<div class="line">                m_ReceivedTotalBytes);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(m_IsNonBlocking)</div>
<div class="line">        {</div>
<div class="line">            pollEvent = <a name="a45"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#a2a7878b10a5bbdf0c03753f222ee7c0ea71e2c8e9e4893b9b2c9a27e0a8a1582a">nn::ssl::Connection::PollEvent::PollEvent_None</a>;  <span class="comment">// reset</span></div>
<div class="line">            pollEvent |= <a name="a46"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#a2a7878b10a5bbdf0c03753f222ee7c0eac55558d284f1097ac9993d30a0b31eb8">nn::ssl::Connection::PollEvent::PollEvent_Read</a>; <span class="comment">// set read event</span></div>
<div class="line"></div>
<div class="line">            result = m_SslConnection.Poll(&amp;pollOutEvent, &amp;pollEvent, MsecPollTimeout);</div>
<div class="line">            <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed due to Poll error (Description:%d)\n&quot;</span>, result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(nn::ssl::ResultIoTimeout::Includes(result))</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Finished receiving data for the timeout.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>((pollOutEvent &amp; <a class="code" href="classnn_1_1ssl_1_1_connection.html#a2a7878b10a5bbdf0c03753f222ee7c0eac55558d284f1097ac9993d30a0b31eb8">nn::ssl::Connection::PollEvent::PollEvent_Read</a>)</div>
<div class="line">               == nn::ssl::Connection::PollEvent::PollEvent_Read)</div>
<div class="line">            {</div>
<div class="line">                result = m_SslConnection.Read(</div>
<div class="line">                    (m_pReceivedData + m_ReceivedTotalBytes),</div>
<div class="line">                    &amp;receivedBytes,</div>
<div class="line">                    ReadSize);</div>
<div class="line">                <span class="keywordflow">if</span>(nn::ssl::ResultIoWouldBlock::Includes(result))</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            result = m_SslConnection.Read(</div>
<div class="line">                (m_pReceivedData + m_ReceivedTotalBytes),</div>
<div class="line">                &amp;receivedBytes,</div>
<div class="line">                ReadSize);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>() || receivedBytes &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to read data (Description:%d)\n&quot;</span>, result.<a class="code" href="classnn_1_1_result.html#a800c5bb9b58c3f2b76223ea43904120b">GetDescription</a>());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(receivedBytes == 0)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Connection closed by the server.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        m_ReceivedTotalBytes += receivedBytes;</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Received %d bytes (total:%d bytes)\n&quot;</span>, receivedBytes, m_ReceivedTotalBytes);</div>
<div class="line">    } <span class="keywordflow">while</span>(<a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(<span class="keyword">true</span>));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (result.<a class="code" href="classnn_1_1_result.html#a80792d8ec8b6b9e9b34025100baa67ec">IsSuccess</a>())?(<span class="keyword">true</span>):(<span class="keyword">false</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Print received data on the console</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keywordtype">void</span> SimpleHttpsClient::PrintReceivedData()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(m_IsInitialized == <span class="keyword">false</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span>; <span class="comment">// not initialized</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(m_ReceivedTotalBytes == 0)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Nothing is received yet.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;\n------------ Received body (total: %d bytes received)---------------\n&quot;</span>,</div>
<div class="line">            m_ReceivedTotalBytes);</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;%.*s&quot;</span>, m_ReceivedTotalBytes, m_pReceivedData);</div>
<div class="line">    <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;\n--------------------------------------------------------------------\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">} <span class="comment">// Un-named namespace</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Startup function</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a name="a47"></a><a class="code" href="_ssl_simple_8cpp.html#a3be3d0349dea9f2f48dd1994be86dafc">nninitStartup</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Setup the size of total memory heap</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> MemoryHeapSize = 16 * 1024 * 1024;</div>
<div class="line">    <span class="keyword">auto</span> result = <a name="a48"></a><a class="code" href="namespacenn_1_1os.html#a2be8bac50d8d37a91f866d9e0c55886e">nn::os::SetMemoryHeapSize</a>( MemoryHeapSize );</div>
<div class="line"></div>
<div class="line">    <a name="a49"></a><a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( result.IsSuccess() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Allcate memory block from the heap for malloc</span></div>
<div class="line">    uintptr_t address = 0;</div>
<div class="line"></div>
<div class="line">    result = <a name="a50"></a><a class="code" href="namespacenn_1_1os.html#a875bf6b3129f06654e641513c63017dd">nn::os::AllocateMemoryBlock</a>( &amp;address, MemoryHeapSize );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( result.IsSuccess() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set memory chunk for malloc</span></div>
<div class="line">    <a name="a51"></a><a class="code" href="namespacenn_1_1init.html#a216ae7a5ca53a1c1e6dc0514f7283974">nn::init::InitializeAllocator</a>( reinterpret_cast&lt;void*&gt;(address), MemoryHeapSize );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// nnMain</span></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a name="a52"></a><a class="code" href="_socket_resolver_8cpp.html#ae79180f8ae90e05743b47a872f305a52">nnMain</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span>        argc                   = <a name="a53"></a><a class="code" href="namespacenn_1_1os.html#acf2fa6b7b7074a51d0b2de1664cc7bb5">nn::os::GetHostArgc</a>();</div>
<div class="line">    <span class="keywordtype">char</span>**     argv                   = <a name="a54"></a><a class="code" href="namespacenn_1_1os.html#abd77e6bf19be140867869cc759fa492c">nn::os::GetHostArgv</a>();</div>
<div class="line">    <span class="keywordtype">char</span>       pHostName[64]          = {0};</div>
<div class="line">    uint32_t   hostNameLen            = 0;</div>
<div class="line">    <span class="keywordtype">bool</span>       isSocketLibInitialized = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span>       isSslLibInitialized    = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(argc == 2)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Will use %s as a host name\n&quot;</span>, argv[1]);</div>
<div class="line">        strncpy(pHostName, argv[1], <span class="keyword">sizeof</span>(pHostName));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        strncpy(pHostName, <span class="stringliteral">&quot;example.com&quot;</span>, <span class="keyword">sizeof</span>(pHostName));</div>
<div class="line">    }</div>
<div class="line">    hostNameLen = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(strnlen(pHostName, <span class="keyword">sizeof</span>(pHostName)));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Setup network interface</span></div>
<div class="line">    <span class="keywordflow">if</span>(SetupNetwork().IsFailure())</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to enable network interface\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">do</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a class="code" href="classnn_1_1_result_success.html">nn::ResultSuccess</a>();</div>
<div class="line">        <span class="comment">// Initialize the socket library</span></div>
<div class="line">        result = <a name="a55"></a><a class="code" href="namespacenn_1_1socket.html#adacc3405184e8f28fb630745b9f43db0">nn::socket::Initialize</a>(g_SocketConfigWithMemory);</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to initialize socket library.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        isSocketLibInitialized = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Initialize the SSL library</span></div>
<div class="line">        result = <a name="a56"></a><a class="code" href="namespacenn_1_1ssl.html#aaa943d1a4363d560d45d53dfa2182683">nn::ssl::Initialize</a>();</div>
<div class="line">        <span class="keywordflow">if</span>(result.<a class="code" href="classnn_1_1_result.html#a5d119d9cb4918fc3cd09215437b91c13">IsFailure</a>())</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="nn___log_8h.html#aa8c0b58247a2078e37f2fe0974b98a61">NN_LOG</a>(<span class="stringliteral">&quot;Failed to initialize SSL library.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        isSslLibInitialized = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">        SimpleHttpsClient httpsClient(g_IsPerformNonBlocking, pHostName, g_TcpPortNumber);</div>
<div class="line">        <span class="keywordflow">do</span>{</div>
<div class="line">            <span class="comment">// By default, this sample verifies the server certificate and its host name</span></div>
<div class="line">            <a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12">nn::ssl::Connection::VerifyOption</a> verifyOption = <a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12abb59beb68a029fffc90f5d7c436361c5">nn::ssl::Connection::VerifyOption::VerifyOption_None</a>;</div>
<div class="line">            verifyOption |= <a name="a57"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12ac67503ea6fd94f733677cf5a3020c28d">nn::ssl::Connection::VerifyOption::VerifyOption_PeerCa</a>;</div>
<div class="line">            verifyOption |= <a name="a58"></a><a class="code" href="classnn_1_1ssl_1_1_connection.html#af9b603bce2d533ca6fdd3f1d7f2f0b12a0e0df6b5f00e9308861d4e4849c941c7">nn::ssl::Connection::VerifyOption::VerifyOption_HostName</a>;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Initialize SSL context and connection context</span></div>
<div class="line">            <span class="keywordflow">if</span>(httpsClient.Initialize(nn::ssl::Context::SslVersion::SslVersion_Auto, verifyOption) == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Perform SSL handshake</span></div>
<div class="line">            <span class="keywordflow">if</span>(httpsClient.PerformSslHandshake(g_IsPrintServerCert) == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Send HTTP GET request over SSL connection</span></div>
<div class="line">            <span class="keywordflow">if</span>(httpsClient.SendHttpGetOverSsl() == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Receive HTTP data via SSL connection</span></div>
<div class="line">            <span class="keywordflow">if</span>(httpsClient.ReceiveAllHttpData() == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Print out received contents on the console</span></div>
<div class="line">            httpsClient.PrintReceivedData();</div>
<div class="line">        } <span class="keywordflow">while</span> (<a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(<span class="keyword">false</span>));</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Finalize ssl connection context and context</span></div>
<div class="line">        httpsClient.Finalize();</div>
<div class="line">    } <span class="keywordflow">while</span> (<a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(<span class="keyword">false</span>));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(isSocketLibInitialized)</div>
<div class="line">    {</div>
<div class="line">        <a name="a59"></a><a class="code" href="namespacenn_1_1socket.html#a28a801f086aadf0b731a721567f3e4b2">nn::socket::Finalize</a>();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>(isSslLibInitialized)</div>
<div class="line">    {</div>
<div class="line">        <a name="a60"></a><a class="code" href="namespacenn_1_1ssl.html#a56d990644d149228c45f0c5ece11a9d9">nn::ssl::Finalize</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    FinalizeNetwork();</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</body>
</html>
