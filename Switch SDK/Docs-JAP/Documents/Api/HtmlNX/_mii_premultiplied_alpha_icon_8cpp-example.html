<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NintendoSDK API Reference: MiiPremultipliedAlphaIcon.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 構築: Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>総合概要</span></a></li>
      <li><a href="pages.html"><span>諸情報</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>名前空間</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MiiPremultipliedAlphaIcon.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>ソースコードの説明は、<a class="el" href="_page_sample_mii_premultiplied_alpha_icon.html">MiiPremultipliedAlphaIcon</a> および <a class="el" href="_mii_premultiplied_alpha_icon_8cpp.html" title="背景とのブレンドに乗算済みアルファを使用したアイコンの生成機能サンプルプログラム ">MiiPremultipliedAlphaIcon.cpp</a> を参照してください。</p>
<div class="fragment"><div class="line"><span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><span class="comment">  Copyright (C)Nintendo All rights reserved.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nn___assert_8h.html">nn/nn_Assert.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nn___log_8h.html">nn/nn_Log.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;nn/os.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fs_8h.html">nn/fs.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="init_8h.html">nn/init.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gfx_8h.html">nn/gfx.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vi_8h.html">nn/vi.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mii_8h.html">nn/mii.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="util___matrix_8h.html">nn/util/util_Matrix.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(WIN32)</span></div>
<div class="line"><span class="preprocessor">#include &lt;filesystem&gt;</span></div>
<div class="line"><span class="preprocessor">#define WIN32_LEAN_AND_MEAN</span></div>
<div class="line"><span class="preprocessor">#define NOMINMAX</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nn___windows_8h.html">nn/nn_Windows.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;nn/hws/hws_Message.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if NN_GFX_IS_TARGET_NVN</span></div>
<div class="line"><span class="preprocessor">    #include &lt;<a class="code" href="nvn_8h.html">nvn/nvn.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">    #include &lt;<a class="code" href="nvn___func_ptr_inline_8h.html">nvn/nvn_FuncPtrInline.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined( NN_BUILD_CONFIG_OS_SUPPORTS_HORIZON ) &amp;&amp; defined( NN_BUILD_CONFIG_SPEC_NX )</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="nv___memory_management_8h.html">nv/nv_MemoryManagement.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>{</div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="preprocessor">#if defined( NN_BUILD_CONFIG_SPEC_NX )</span></div>
<div class="line"><span class="preprocessor">#if defined( NN_BUILD_CONFIG_OS_HORIZON )</span></div>
<div class="line"><span class="comment">// NX用テクスチャリソースのパス</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* TextureResourcePath = <span class="stringliteral">&quot;Contents:/Common/resource/NXTextureMidLinear.dat&quot;</span>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="comment">// WinNvn用テクスチャリソースのパス</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* TextureResourcePath = <span class="stringliteral">&quot;Contents:/Common/resource/WinNvnTextureMidLinear.dat&quot;</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"># else</span></div>
<div class="line"><span class="comment">// OpenGl用リソースのパス</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* TextureResourcePath = <span class="stringliteral">&quot;Contents:/Common/resource/WinGenericTextureMidLinear.dat&quot;</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// シェイプ用リソース</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* ShapeResourcePath = <span class="stringliteral">&quot;Contents:/Common/resource/ShapeMid.dat&quot;</span>;</div>
<div class="line"><span class="comment">// ガンマタイプ</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1mii.html#a1ca46f017cb280267571c2c688ba4fa1">nn::mii::GammaType</a> <a name="a0"></a><a class="code" href="namespacenn_1_1mii.html#a1ca46f017cb280267571c2c688ba4fa1">GammaType</a> = <a name="a1"></a><a class="code" href="namespacenn_1_1mii.html#a1ca46f017cb280267571c2c688ba4fa1a3f0ec4bee766de5587e6aafe2c9711fe">nn::mii::GammaType_Linear</a>;</div>
<div class="line"><span class="comment">// 使用するMiiのCharInfoのパス</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* CharInfoPath = <span class="stringliteral">&quot;Contents:/Common/charinfo/SampleMiiPremultipliedAlphaIcon.dat&quot;</span>;</div>
<div class="line"><span class="comment">// アイコンのサイズ</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> IconTextureResolution = 512;</div>
<div class="line"><span class="comment">// CharModelが作成するマスクの表情の種類</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> MaskExpressionFlag = <a name="a2"></a><a class="code" href="namespacenn_1_1mii.html#ac7afaf3294796e48a3cffb560292b72ba08e23978396f51ef4e0a31669a9d82dc">nn::mii::ExpressionFlag_All</a>;</div>
<div class="line"><span class="comment">// 実際に描画する表情</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1mii.html#af833241e621bf8e0de2cef4bd287a1b0">nn::mii::Expression</a> MiiExpression = <a name="a3"></a><a class="code" href="namespacenn_1_1mii.html#af833241e621bf8e0de2cef4bd287a1b0ae0f873d5e2222d161e0fd6b5d42debac">nn::mii::Expression_Normal</a>;</div>
<div class="line"><span class="comment">// アイコンの背景色</span></div>
<div class="line"><span class="keyword">const</span> <a name="_a4"></a><a class="code" href="classnn_1_1util_1_1_color4f.html">nn::util::Color4f</a> IconBackGroundColor(0.0f, 0.0f, 0.0f, 0.0f);</div>
<div class="line"><span class="comment">// スクリーンの色</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="classnn_1_1util_1_1_color4f.html">nn::util::Color4f</a> ScreenColor(0.0f, 0.0f, 1.0f, 1.0f);</div>
<div class="line"><span class="comment">// Miiのモデルタイプ</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1mii.html#a19f550cb89b2b095417f135888953bb3">nn::mii::CreateModelType</a> CharModelType = <a name="a5"></a><a class="code" href="namespacenn_1_1mii.html#a19f550cb89b2b095417f135888953bb3a10757d3c753282cab6b9b8f25b94dd95">nn::mii::CreateModelType_Normal</a>;</div>
<div class="line"><span class="comment">// Miiの鼻のタイプ</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1mii.html#ab1d08064d4a8b9788b5b123bd6a22b21">nn::mii::CreateNoseType</a> NoseType = <a name="a6"></a><a class="code" href="namespacenn_1_1mii.html#ab1d08064d4a8b9788b5b123bd6a22b21a428e4df9474f8f20a39ddcc01007b244">nn::mii::CreateNoseType_Normal</a>;</div>
<div class="line"><span class="comment">// 描画に使うMaskのインデックス</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> MaskIndex = 0;</div>
<div class="line"><span class="comment">// nn::mii::TextureShaderで使用するシェーダのパス</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* TextureShaderPath = <span class="stringliteral">&quot;Contents:/Platform/shader/TextureShader.bnsh&quot;</span>;</div>
<div class="line"><span class="comment">// nn::mii::IconShaderで使用するシェーダのパス</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* IconShaderPath = <span class="stringliteral">&quot;Contents:/Platform/shader/IconShader.bnsh&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// アイコン書き込み先テクスチャのフォーマット</span></div>
<div class="line"><a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605">nn::gfx::ImageFormat</a> IconTextureFormat = <a name="a7"></a><a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605ad679fce65d58a5b097510ff075590526">nn::gfx::ImageFormat_R8_G8_B8_A8_UnormSrgb</a>;</div>
<div class="line"><span class="comment">// アイコン書き込み用のデプスステンシルのフォーマット</span></div>
<div class="line"><a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605">nn::gfx::ImageFormat</a> IconDepthStencilFormat = <a name="a8"></a><a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605a69e9ab2c0d48ea01fdcde42e955e65a7">nn::gfx::ImageFormat_D24_Unorm_S8_Uint</a>;</div>
<div class="line"><span class="comment">// Mii の動的テクスチャ（Faceline、Mask）のフォーマット</span></div>
<div class="line"><a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605">nn::gfx::ImageFormat</a> DynamicTextureFormat = <a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605ad679fce65d58a5b097510ff075590526">nn::gfx::ImageFormat_R8_G8_B8_A8_UnormSrgb</a>;</div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// SwapChainのフォーマット</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605">nn::gfx::ImageFormat</a> SwapChainFormat = <a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605ad679fce65d58a5b097510ff075590526">nn::gfx::ImageFormat_R8_G8_B8_A8_UnormSrgb</a>;</div>
<div class="line"><span class="comment">// スキャンバッファの数</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> ScanBufferCount = 2;</div>
<div class="line"><span class="comment">// レンダリングしたアイコンの描画に使用するシェーダへのパス</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* SampleShaderPath = <span class="stringliteral">&quot;Contents:/Sample/SampleShader.bnsh&quot;</span>;</div>
<div class="line"><span class="comment">// デプスステンシルのフォーマット</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605">nn::gfx::ImageFormat</a> DepthStencilFormat = <a class="code" href="namespacenn_1_1gfx.html#ae794c2b6a518a4ae9ada4d3339b87605a69e9ab2c0d48ea01fdcde42e955e65a7">nn::gfx::ImageFormat_D24_Unorm_S8_Uint</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// デスクリプタスロットのインデックス</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> TextureDescriptorPoolSlotCount = 256;</div>
<div class="line"><span class="keywordtype">int</span> g_TextureDescriptorBaseIndex = 0;</div>
<div class="line"><span class="keywordtype">int</span> g_SamplerDescriptorBaseIndex = 0;</div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Position, Uv, Indexのデータ</span></div>
<div class="line"><span class="comment">// Positionの設定</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">float</span> Positions[] =</div>
<div class="line">{</div>
<div class="line">    -0.5f,  0.5f, 0.0f, 1.0f,</div>
<div class="line">    -0.5f, -0.5f, 0.0f, 1.0f,</div>
<div class="line">     0.5f, -0.5f, 0.0f, 1.0f,</div>
<div class="line">     0.5f,  0.5f, 0.0f, 1.0f,</div>
<div class="line">};</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> PositionStride = <span class="keyword">sizeof</span>( float ) * 4;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> PositionBufferIndex = 0;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1gfx.html#a9400d72942c2a253b3b87837380a11b8">nn::gfx::AttributeFormat</a> PositionFormat = <a name="a9"></a><a class="code" href="namespacenn_1_1gfx.html#a9400d72942c2a253b3b87837380a11b8a372b5213004de386bc054c028a94ab57">nn::gfx::AttributeFormat_32_32_32_32_Float</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Uvの設定(左下原点としています。)</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">float</span> Uvs[] =</div>
<div class="line">{</div>
<div class="line">    0.0f, 1.0f, </div>
<div class="line">    0.0f, 0.0f,</div>
<div class="line">    1.0f, 0.0f,</div>
<div class="line">    1.0f, 1.0f,</div>
<div class="line">};</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> UvStride = <span class="keyword">sizeof</span>( float ) * 2;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> UvBufferIndex = 1;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1gfx.html#a9400d72942c2a253b3b87837380a11b8">nn::gfx::AttributeFormat</a> UvFormat = <a name="a10"></a><a class="code" href="namespacenn_1_1gfx.html#a9400d72942c2a253b3b87837380a11b8a901dc076be56ddcafd693fd566e09801">nn::gfx::AttributeFormat_32_32_Float</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Index</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1gfx.html#a6ef31e9a8914c972be0e767e565b2f94">nn::gfx::PrimitiveTopology</a> <a name="a11"></a><a class="code" href="namespacenn_1_1gfx.html#a6ef31e9a8914c972be0e767e565b2f94">PrimitiveTopology</a> = <a name="a12"></a><a class="code" href="namespacenn_1_1gfx.html#a6ef31e9a8914c972be0e767e565b2f94ab5923670671fe640c8ab13c165b05f88">nn::gfx::PrimitiveTopology_TriangleList</a>;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="namespacenn_1_1gfx.html#aef2ddd2bcaa4d6af0f04681470e3f3fb">nn::gfx::IndexFormat</a> <a name="a13"></a><a class="code" href="namespacenn_1_1gfx.html#aef2ddd2bcaa4d6af0f04681470e3f3fb">IndexFormat</a> = <a name="a14"></a><a class="code" href="namespacenn_1_1gfx.html#aef2ddd2bcaa4d6af0f04681470e3f3fba0fabfe8d999fd31db8431c6e2d66ec2d">nn::gfx::IndexFormat_Uint16</a>;</div>
<div class="line"><span class="keyword">const</span> uint16_t Indices[] =</div>
<div class="line">{</div>
<div class="line">    0, 1, 2, 2, 3, 0</div>
<div class="line">};</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> IndexCount = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<span class="keyword">sizeof</span>( Indices ) / <span class="keyword">sizeof</span>( uint16_t ));</div>
<div class="line"></div>
<div class="line"><span class="comment">// Faceline, Mask の上下反転の有効無効フラグ</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">bool</span> IsVerticalFlip = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// 描画するものの種類を表す列挙型</span></div>
<div class="line"><span class="keyword">enum</span> DrawType </div>
<div class="line">{</div>
<div class="line">    DrawType_MiiFace,                 </div>
<div class="line">    DrawType_NormalIcon,              </div>
<div class="line">    DrawType_PremultipliedAlphaIcon,  </div>
<div class="line"></div>
<div class="line">    DrawType_End,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Matrix用コンスタントバッファ</span></div>
<div class="line"><span class="keyword">struct </span>MatrixConstantBuffer</div>
<div class="line">{</div>
<div class="line">    <a name="_a15"></a><a class="code" href="structnn_1_1util_1_1_float_column_major4x3.html">nn::util::FloatColumnMajor4x3</a> modelView;</div>
<div class="line">    <a name="_a16"></a><a class="code" href="structnn_1_1util_1_1_float_column_major4x4.html">nn::util::FloatColumnMajor4x4</a> projection;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// Modulate用コンスタントバッファ</span></div>
<div class="line"><span class="keyword">struct </span>ConstantBufferModulate</div>
<div class="line">{</div>
<div class="line">    int32_t modulateType; </div>
<div class="line">    int32_t gammaType;</div>
<div class="line">    int32_t drawType;</div>
<div class="line">    int32_t pad0[1];</div>
<div class="line">    <a name="_a17"></a><a class="code" href="structnn_1_1util_1_1_float4.html">nn::util::Float4</a> constantColor[3]; </div>
<div class="line">    <a class="code" href="structnn_1_1util_1_1_float4.html">nn::util::Float4</a> lightDirInView; </div>
<div class="line">    <a class="code" href="structnn_1_1util_1_1_float4.html">nn::util::Float4</a> lightColor;</div>
<div class="line">    <a class="code" href="structnn_1_1util_1_1_float4.html">nn::util::Float4</a> sssColor;</div>
<div class="line">    <a class="code" href="structnn_1_1util_1_1_float4.html">nn::util::Float4</a> specularColor;</div>
<div class="line">    <a class="code" href="structnn_1_1util_1_1_float4.html">nn::util::Float4</a> rimColor;</div>
<div class="line">    <span class="keywordtype">float</span> halfLambertFactor;</div>
<div class="line">    <span class="keywordtype">float</span> sssSpecularFactor;</div>
<div class="line">    <span class="keywordtype">float</span> specularFactorA;</div>
<div class="line">    <span class="keywordtype">float</span> specularFactorB;</div>
<div class="line">    <span class="keywordtype">float</span> specularShinness;</div>
<div class="line">    <span class="keywordtype">float</span> rimPower;</div>
<div class="line">    <span class="keywordtype">float</span> rimWidth;</div>
<div class="line">    uint32_t pad1[1];</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// メモリ</span></div>
<div class="line"><a name="_a18"></a><a class="code" href="classnn_1_1util_1_1_byte_ptr.html">nn::util::BytePtr</a> g_pMemoryHeap( NULL );</div>
<div class="line"><a class="code" href="classnn_1_1util_1_1_byte_ptr.html">nn::util::BytePtr</a> g_pMemory( NULL );</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> MemorySize = 16 * 1024 * 1024;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> VisiblePoolMemorySize = 16 * 1024 * 1024;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> CachedPoolMemorySize = 20 * 1024 * 1024;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> CachedCompressPoolMemorySize = 16 * 1024 * 1024;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* g_pVisiblePoolMemory = NULL;</div>
<div class="line"><span class="keywordtype">void</span>* g_pCachedPoolMemory = NULL;</div>
<div class="line"><span class="keywordtype">void</span>* g_pCachedCompressPoolMemory = NULL;</div>
<div class="line"><span class="keywordtype">void</span>* g_pMemoryPoolStart = NULL;</div>
<div class="line">ptrdiff_t g_MemoryPoolOffset = 0;</div>
<div class="line"><span class="keywordtype">void</span>* g_pCachedMemoryPoolStart = NULL;</div>
<div class="line">ptrdiff_t g_CachedMemoryPoolOffset = 0;</div>
<div class="line"><span class="keywordtype">void</span>* g_pCachedCompressMemoryPoolStart = NULL;</div>
<div class="line">ptrdiff_t g_CachedCompressMemoryPoolOffset = 0;</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> CommandBufferControlMemorySize = 256;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> CommandBufferMemoryPoolSize = 1024 * 1024;</div>
<div class="line"></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* ReadResource( <span class="keyword">const</span> <span class="keywordtype">char</span>* filename )</div>
<div class="line">{</div>
<div class="line">    <a name="_a19"></a><a class="code" href="classnn_1_1_result.html">nn::Result</a> result;</div>
<div class="line">    <a name="_a20"></a><a class="code" href="structnn_1_1fs_1_1_file_handle.html">nn::fs::FileHandle</a> hFile;</div>
<div class="line"></div>
<div class="line">    int64_t fileSize = 0;</div>
<div class="line">    result = <a name="a21"></a><a class="code" href="namespacenn_1_1fs.html#a0f2b5b30657b1ffaf1dec49bfb36462b">nn::fs::OpenFile</a>( &amp;hFile, filename, <a name="a22"></a><a class="code" href="namespacenn_1_1fs.html#a4c97b79cce78a95c2333dbc9053b9393afde4472d2b455879cad02aade386ac0d">nn::fs::OpenMode_Read</a> );</div>
<div class="line">    <a name="a23"></a><a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line"></div>
<div class="line">    result = <a name="a24"></a><a class="code" href="namespacenn_1_1fs.html#aba29e01d386e809349d60eccdb15ff21">nn::fs::GetFileSize</a>( &amp;fileSize, hFile );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line"></div>
<div class="line">    <a name="_a25"></a><a class="code" href="structnn_1_1util_1_1_binary_file_header.html">nn::util::BinaryFileHeader</a> fileHeader;</div>
<div class="line">    <span class="keywordtype">size_t</span> readSize;</div>
<div class="line">    result = <a name="a26"></a><a class="code" href="namespacenn_1_1fs.html#a81801a404563984f8c6cc1483cc6d730">nn::fs::ReadFile</a>( &amp;readSize, hFile, 0, &amp;fileHeader, <span class="keyword">sizeof</span>( <a class="code" href="structnn_1_1util_1_1_binary_file_header.html">nn::util::BinaryFileHeader</a> ) );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a name="a27"></a><a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( readSize == <span class="keyword">sizeof</span>( <a class="code" href="structnn_1_1util_1_1_binary_file_header.html">nn::util::BinaryFileHeader</a> ) );</div>
<div class="line">    <span class="keywordtype">size_t</span> alignment = fileHeader.<a name="a28"></a><a class="code" href="structnn_1_1util_1_1_binary_file_header.html#a5d08b613e5c8bb9fe95b3bcb53edb62b">GetAlignment</a>();</div>
<div class="line"></div>
<div class="line">    g_pMemory.<a name="a29"></a><a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( alignment );</div>
<div class="line">    <span class="keywordtype">void</span>* pBuffer = g_pMemory.<a name="a30"></a><a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>();</div>
<div class="line">    result = <a class="code" href="namespacenn_1_1fs.html#a81801a404563984f8c6cc1483cc6d730">nn::fs::ReadFile</a>( &amp;readSize, hFile, 0, pBuffer, static_cast&lt; size_t &gt;( fileSize ) );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( readSize == static_cast&lt; size_t &gt;( fileSize ) );</div>
<div class="line">    g_pMemory.<a name="a31"></a><a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( static_cast&lt; ptrdiff_t &gt;( fileSize ) );</div>
<div class="line"></div>
<div class="line">    <a name="a32"></a><a class="code" href="namespacenn_1_1fs.html#ac8bd9e828751bd4f953acfa765278f84">nn::fs::CloseFile</a>( hFile );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> pBuffer;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// デバイスを初期化</span></div>
<div class="line"><a name="_a33"></a><a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a> g_Device;</div>
<div class="line"><span class="keywordtype">void</span> InitializeDevice()</div>
<div class="line">{</div>
<div class="line">    <a name="_a34"></a><a class="code" href="classnn_1_1gfx_1_1_device_info.html">nn::gfx::Device::InfoType</a> info;</div>
<div class="line">    info.<a name="a35"></a><a class="code" href="classnn_1_1gfx_1_1_device_info.html#a2cb416e4373b83e5581daf818c4b2809">SetDefault</a>();</div>
<div class="line">    info.<a name="a36"></a><a class="code" href="classnn_1_1gfx_1_1_device_info.html#a5b400f8e8ec5b457db033faab20714af">SetApiVersion</a>( <a name="a37"></a><a class="code" href="namespacenn_1_1gfx.html#aadcb725d8dd0dd4ee3987d07fb990cfd">nn::gfx::ApiMajorVersion</a>, <a name="a38"></a><a class="code" href="namespacenn_1_1gfx.html#a810943869115c31d39dcc3598bddb92a">nn::gfx::ApiMinorVersion</a> );</div>
<div class="line">    g_Device.<a name="a39"></a><a class="code" href="classnn_1_1gfx_1_1_t_device.html#a78cd197d82ff797eeb658446e9cfe387">Initialize</a>( info );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="_a40"></a><a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html">nn::gfx::MemoryPool</a> g_MemoryPool;</div>
<div class="line"><span class="keywordtype">void</span> InitializeMemoryPool()</div>
<div class="line">{</div>
<div class="line">    <a name="_a41"></a><a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html">nn::gfx::MemoryPool::InfoType</a> info;</div>
<div class="line">    info.<a name="a42"></a><a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html#a44095ba4528dc6b167cf13b530bc332f">SetDefault</a>();</div>
<div class="line">    info.<a name="a43"></a><a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html#a49eb9305aa9e2e39b25e775c5c0bfeff">SetMemoryPoolProperty</a>( <a name="a44"></a><a class="code" href="namespacenn_1_1gfx.html#a9bad749884304c5882d4c54e57818623a52c9ef53497763d967da50e415056a2e">nn::gfx::MemoryPoolProperty_CpuUncached</a></div>
<div class="line">        | <a name="a45"></a><a class="code" href="namespacenn_1_1gfx.html#a9bad749884304c5882d4c54e57818623a98262dd58342754947cd689a64939f13">nn::gfx::MemoryPoolProperty_GpuCached</a> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Determine alignment to allocate space on an alignment boundary</span></div>
<div class="line">    <span class="keywordtype">size_t</span> alignment = <a name="a46"></a><a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#a24ea067d3fd3c752dcb7332ad2ce3b56">nn::gfx::MemoryPool::GetPoolMemoryAlignment</a>( &amp;g_Device, info );</div>
<div class="line">    g_pVisiblePoolMemory = malloc( VisiblePoolMemorySize + alignment );</div>
<div class="line"></div>
<div class="line">    g_pMemoryPoolStart = <a class="code" href="classnn_1_1util_1_1_byte_ptr.html">nn::util::BytePtr</a>( g_pVisiblePoolMemory ).<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( alignment ).<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>();</div>
<div class="line">    info.<a name="a47"></a><a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html#aba32b6de36f3db1702087a8c06d5097d">SetPoolMemory</a>( g_pMemoryPoolStart, <a name="a48"></a><a class="code" href="namespacenn_1_1util.html#a8a8aac07f25fdd659091e1065b8c89a5">nn::util::align_down</a>( VisiblePoolMemorySize,</div>
<div class="line">        <a name="a49"></a><a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#aee1bf8475049973f8637ed19653833a1">nn::gfx::MemoryPool::GetPoolMemorySizeGranularity</a>( &amp;g_Device, info ) ) );</div>
<div class="line">    g_MemoryPool.<a name="a50"></a><a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#a59045ae9d58968a0b6448d66f0b4781f">Initialize</a>( &amp;g_Device, info );</div>
<div class="line"></div>
<div class="line">    g_MemoryPoolOffset = 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html">nn::gfx::MemoryPool</a> g_CachedMemoryPool;</div>
<div class="line"><span class="keywordtype">void</span> InitializeCachedMemoryPool()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html">nn::gfx::MemoryPool::InfoType</a> info;</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html#a44095ba4528dc6b167cf13b530bc332f">SetDefault</a>();</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html#a49eb9305aa9e2e39b25e775c5c0bfeff">SetMemoryPoolProperty</a>( <a name="a51"></a><a class="code" href="namespacenn_1_1gfx.html#a9bad749884304c5882d4c54e57818623a663a11b1bc56170998d3ca281574e1f1">nn::gfx::MemoryPoolProperty_CpuCached</a></div>
<div class="line">        | <a class="code" href="namespacenn_1_1gfx.html#a9bad749884304c5882d4c54e57818623a98262dd58342754947cd689a64939f13">nn::gfx::MemoryPoolProperty_GpuCached</a> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Determine alignment to allocate space on an alignment boundary</span></div>
<div class="line">    <span class="keywordtype">size_t</span> alignment = <a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#a24ea067d3fd3c752dcb7332ad2ce3b56">nn::gfx::MemoryPool::GetPoolMemoryAlignment</a>( &amp;g_Device, info );</div>
<div class="line">    g_pCachedPoolMemory = malloc( CachedPoolMemorySize + alignment );</div>
<div class="line"></div>
<div class="line">    g_pCachedMemoryPoolStart = <a class="code" href="classnn_1_1util_1_1_byte_ptr.html">nn::util::BytePtr</a>( g_pCachedPoolMemory ).<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( alignment ).<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>();</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html#aba32b6de36f3db1702087a8c06d5097d">SetPoolMemory</a>( g_pCachedMemoryPoolStart, <a class="code" href="namespacenn_1_1util.html#a8a8aac07f25fdd659091e1065b8c89a5">nn::util::align_down</a>( CachedPoolMemorySize,</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#aee1bf8475049973f8637ed19653833a1">nn::gfx::MemoryPool::GetPoolMemorySizeGranularity</a>( &amp;g_Device, info ) ) );</div>
<div class="line">    g_CachedMemoryPool.<a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#a59045ae9d58968a0b6448d66f0b4781f">Initialize</a>( &amp;g_Device, info );</div>
<div class="line"></div>
<div class="line">    g_CachedMemoryPoolOffset = 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html">nn::gfx::MemoryPool</a> g_CachedCompressMemoryPool;</div>
<div class="line"><span class="keywordtype">void</span> InitializeCachedCompressMemoryPool()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html">nn::gfx::MemoryPool::InfoType</a> info;</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html#a44095ba4528dc6b167cf13b530bc332f">SetDefault</a>();</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html#a49eb9305aa9e2e39b25e775c5c0bfeff">SetMemoryPoolProperty</a>(<a class="code" href="namespacenn_1_1gfx.html#a9bad749884304c5882d4c54e57818623a663a11b1bc56170998d3ca281574e1f1">nn::gfx::MemoryPoolProperty_CpuCached</a></div>
<div class="line">        | <a class="code" href="namespacenn_1_1gfx.html#a9bad749884304c5882d4c54e57818623a98262dd58342754947cd689a64939f13">nn::gfx::MemoryPoolProperty_GpuCached</a></div>
<div class="line">        | <a name="a52"></a><a class="code" href="namespacenn_1_1gfx.html#a9bad749884304c5882d4c54e57818623aa4997d0d2f3098f3ad4ebae926432472">nn::gfx::MemoryPoolProperty_Compressible</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Determine alignment to allocate space on an alignment boundary</span></div>
<div class="line">    <span class="keywordtype">size_t</span> alignment = <a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#a24ea067d3fd3c752dcb7332ad2ce3b56">nn::gfx::MemoryPool::GetPoolMemoryAlignment</a>(&amp;g_Device, info);</div>
<div class="line">    g_pCachedCompressPoolMemory = malloc(CachedCompressPoolMemorySize + alignment);</div>
<div class="line"></div>
<div class="line">    g_pCachedCompressMemoryPoolStart = <a class="code" href="classnn_1_1util_1_1_byte_ptr.html">nn::util::BytePtr</a>(g_pCachedCompressPoolMemory).<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>(alignment).<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>();</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_memory_pool_info.html#aba32b6de36f3db1702087a8c06d5097d">SetPoolMemory</a>(g_pCachedCompressMemoryPoolStart, <a class="code" href="namespacenn_1_1util.html#a8a8aac07f25fdd659091e1065b8c89a5">nn::util::align_down</a>(CachedCompressPoolMemorySize,</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#aee1bf8475049973f8637ed19653833a1">nn::gfx::MemoryPool::GetPoolMemorySizeGranularity</a>(&amp;g_Device, info)));</div>
<div class="line">    g_CachedCompressMemoryPool.<a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#a59045ae9d58968a0b6448d66f0b4781f">Initialize</a>(&amp;g_Device, info);</div>
<div class="line"></div>
<div class="line">    g_CachedCompressMemoryPoolOffset = 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// レイヤを初期化</span></div>
<div class="line"><a name="_a53"></a><a class="code" href="classnn_1_1vi_1_1_display.html">nn::vi::Display</a>* g_pDisplay;</div>
<div class="line"><a name="_a54"></a><a class="code" href="classnn_1_1vi_1_1_layer.html">nn::vi::Layer</a>* g_pLayer;</div>
<div class="line"><span class="keywordtype">int</span> g_DisplayWidth = 1280;</div>
<div class="line"><span class="keywordtype">int</span> g_DisplayHeight = 720;</div>
<div class="line"><span class="keywordtype">void</span> InitializeLayer()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a name="a55"></a><a class="code" href="namespacenn_1_1vi.html#ae9cd501562a820272816af783bd798dc">nn::vi::OpenDefaultDisplay</a>(&amp;g_pDisplay);</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a name="a56"></a><a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(result);</div>
<div class="line">    </div>
<div class="line">    result = <a name="a57"></a><a class="code" href="namespacenn_1_1vi.html#a86b2688dc743e37f3acaca99ccdf8c12">nn::vi::CreateLayer</a>(&amp;g_pLayer, g_pDisplay);</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line"></div>
<div class="line">    result = <a name="a58"></a><a class="code" href="namespacenn_1_1vi.html#a2b21403527d5c914a19e58b697c7fcb3">nn::vi::SetLayerScalingMode</a>(g_pLayer, <a name="a59"></a><a class="code" href="namespacenn_1_1vi.html#ab220832b6e24cc6c01d8c7de55ab49a8a183897c0b0608120e5ebad8d7b08cc93">nn::vi::ScalingMode_FitToLayer</a>);</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// スワップチェーンを初期化</span></div>
<div class="line"><a name="_a60"></a><a class="code" href="classnn_1_1gfx_1_1_t_swap_chain.html">nn::gfx::SwapChain</a> g_SwapChain;</div>
<div class="line"><a name="_a61"></a><a class="code" href="classnn_1_1gfx_1_1_t_color_target_view.html">nn::gfx::ColorTargetView</a>* g_pScanBufferViews[ScanBufferCount];</div>
<div class="line"><span class="keywordtype">void</span> InitializeSwapChain()</div>
<div class="line">{</div>
<div class="line">    <a name="_a62"></a><a class="code" href="classnn_1_1gfx_1_1_swap_chain_info.html">nn::gfx::SwapChain::InfoType</a> info;</div>
<div class="line"></div>
<div class="line">    info.<a name="a63"></a><a class="code" href="classnn_1_1gfx_1_1_swap_chain_info.html#a3ac6ceecac07289b5580e5bf083dc037">SetDefault</a>();</div>
<div class="line">    info.<a name="a64"></a><a class="code" href="classnn_1_1gfx_1_1_swap_chain_info.html#a45d3735bcc2edc68a19ce845184a0e8f">SetLayer</a>( g_pLayer );</div>
<div class="line">    info.<a name="a65"></a><a class="code" href="classnn_1_1gfx_1_1_swap_chain_info.html#a9d43effd89913b22ceb8670ac2c2b9a4">SetWidth</a>( g_DisplayWidth );</div>
<div class="line">    info.<a name="a66"></a><a class="code" href="classnn_1_1gfx_1_1_swap_chain_info.html#afb17a5865e81f13dae1532792d406afb">SetHeight</a>( g_DisplayHeight );</div>
<div class="line">    info.<a name="a67"></a><a class="code" href="classnn_1_1gfx_1_1_swap_chain_info.html#a7b4bafd4ea97d6130e74d9763e947bff">SetFormat</a>( SwapChainFormat );</div>
<div class="line">    info.<a name="a68"></a><a class="code" href="classnn_1_1gfx_1_1_swap_chain_info.html#ab489421ecb43aae64bc8d0d22b612cd0">SetBufferCount</a>( ScanBufferCount );</div>
<div class="line">    <span class="keywordflow">if</span>( <a name="a69"></a><a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>( <a name="a70"></a><a class="code" href="classnn_1_1gfx_1_1_t_swap_chain.html#a4bba38bb9f96e845cad769f04b00bc26">nn::gfx::SwapChain::IsMemoryPoolRequired</a> ) )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">size_t</span> size = g_SwapChain.<a name="a71"></a><a class="code" href="classnn_1_1gfx_1_1_t_swap_chain.html#a9bb603e276006241f413dd2702e734ca">CalculateScanBufferSize</a>( &amp;g_Device, info );</div>
<div class="line">        g_CachedCompressMemoryPoolOffset = <a name="a72"></a><a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_CachedCompressMemoryPoolOffset,</div>
<div class="line">            <a name="a73"></a><a class="code" href="classnn_1_1gfx_1_1_t_swap_chain.html#a4223dd4e76c8d42f61983fa2c859da20">nn::gfx::SwapChain::GetScanBufferAlignment</a>( &amp;g_Device, info ) );</div>
<div class="line">        g_SwapChain.<a name="a74"></a><a class="code" href="classnn_1_1gfx_1_1_t_swap_chain.html#a9c4b1c9b1103c792c89bb111808f711e">Initialize</a>( &amp;g_Device, info, &amp;g_CachedCompressMemoryPool, g_CachedCompressMemoryPoolOffset, size );</div>
<div class="line">        g_CachedCompressMemoryPoolOffset += size;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        g_SwapChain.<a class="code" href="classnn_1_1gfx_1_1_t_swap_chain.html#a9c4b1c9b1103c792c89bb111808f711e">Initialize</a>( &amp;g_Device, info, NULL, 0, 0 );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    g_SwapChain.<a name="a75"></a><a class="code" href="classnn_1_1gfx_1_1_t_swap_chain.html#a45ea35235aa2290a663da18a68715195">GetScanBufferViews</a>(g_pScanBufferViews, ScanBufferCount);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// キューを初期化</span></div>
<div class="line"><a name="_a76"></a><a class="code" href="classnn_1_1gfx_1_1_t_queue.html">nn::gfx::Queue</a> g_Queue;</div>
<div class="line"><span class="keywordtype">void</span> InitializeQueue()</div>
<div class="line">{</div>
<div class="line">    <a name="_a77"></a><a class="code" href="classnn_1_1gfx_1_1_queue_info.html">nn::gfx::Queue::InfoType</a> info;</div>
<div class="line">    info.<a name="a78"></a><a class="code" href="classnn_1_1gfx_1_1_queue_info.html#adb123117503c34bb0c5ee707e9b619b2">SetDefault</a>();</div>
<div class="line">    info.<a name="a79"></a><a class="code" href="classnn_1_1gfx_1_1_queue_info.html#ad39eb3b3594837511c4ed024b96db180">SetCapability</a>( <a name="a80"></a><a class="code" href="namespacenn_1_1gfx.html#a305234f652e5c28bf7caed3bcfab60d3a3c85c0b4d0af93ffe600e26ea8a89e57">nn::gfx::QueueCapability_Graphics</a> );</div>
<div class="line">    g_Queue.<a name="a81"></a><a class="code" href="classnn_1_1gfx_1_1_t_queue.html#aabd6f0085d48c2af853394c2f1df1767">Initialize</a>( &amp;g_Device, info );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// コマンドバッファを初期化</span></div>
<div class="line"><a name="_a82"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html">nn::gfx::CommandBuffer</a> g_CommandBuffer;</div>
<div class="line"><span class="keywordtype">void</span>* g_pCommandBufferControlMemory;</div>
<div class="line">ptrdiff_t g_CommandBufferMemoryPoolOffset;</div>
<div class="line"><span class="keywordtype">void</span> InitializeCommandBuffer()</div>
<div class="line">{</div>
<div class="line">    <a name="_a83"></a><a class="code" href="classnn_1_1gfx_1_1_command_buffer_info.html">nn::gfx::CommandBuffer::InfoType</a> info;</div>
<div class="line">    info.<a name="a84"></a><a class="code" href="classnn_1_1gfx_1_1_command_buffer_info.html#ae2c8f9bbcf68ce7d42deba2352e4836c">SetDefault</a>();</div>
<div class="line">    info.<a name="a85"></a><a class="code" href="classnn_1_1gfx_1_1_command_buffer_info.html#a1ee219b3f9aa9bc7ffb878de1e4e7574">SetQueueCapability</a>( <a class="code" href="namespacenn_1_1gfx.html#a305234f652e5c28bf7caed3bcfab60d3a3c85c0b4d0af93ffe600e26ea8a89e57">nn::gfx::QueueCapability_Graphics</a> );</div>
<div class="line">    info.<a name="a86"></a><a class="code" href="classnn_1_1gfx_1_1_command_buffer_info.html#a2dc75925a14c5d81ebd838b730a6a026">SetCommandBufferType</a>( <a name="a87"></a><a class="code" href="namespacenn_1_1gfx.html#a0e171a31353ada1910b428cd08e7d2d3a6009481892695c8b4bcfca4ab86d9313">nn::gfx::CommandBufferType_Direct</a> );</div>
<div class="line">    g_CommandBuffer.<a name="a88"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a5ceea989aa3ee861d3d3e57316b190ec">Initialize</a>( &amp;g_Device, info );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// コントロールメモリを確</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> alignment = 256;</div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( alignment );</div>
<div class="line">    g_pCommandBufferControlMemory = g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>();</div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( CommandBufferControlMemorySize );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// メモリプール領域確保</span></div>
<div class="line">    g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_MemoryPoolOffset,</div>
<div class="line">        <a name="a89"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a83c6570a8bf3ad63a2c88604fdb64660">nn::gfx::CommandBuffer::GetCommandMemoryAlignment</a>( &amp;g_Device ) );</div>
<div class="line">    g_CommandBufferMemoryPoolOffset = g_MemoryPoolOffset;</div>
<div class="line">    g_MemoryPoolOffset += CommandBufferMemoryPoolSize;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ビューポートシザーを初期化</span></div>
<div class="line"><a name="_a90"></a><a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html">nn::gfx::ViewportScissorState</a> g_ViewportScissor;</div>
<div class="line"><span class="keywordtype">void</span> InitializeViewport()</div>
<div class="line">{</div>
<div class="line">    <a name="_a91"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html">nn::gfx::ViewportScissorState::InfoType</a> info;</div>
<div class="line">    info.<a name="a92"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html#ab9c4f718c28bbd39b9ccb11c1fc74a21">SetDefault</a>();</div>
<div class="line">    info.<a name="a93"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html#a4cfc5de9d6913b0caf3f3d61a6eaae2c">SetScissorEnabled</a>( <span class="keyword">true</span> );</div>
<div class="line">    <a name="_a94"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html">nn::gfx::ViewportStateInfo</a> viewportInfo;</div>
<div class="line">    {</div>
<div class="line">        viewportInfo.<a name="a95"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html#ab2f35b1c78bd77d5d18202cff743902a">SetDefault</a>();</div>
<div class="line">        viewportInfo.<a name="a96"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html#a5f2ee737e00c49646f66bc3eab21824a">SetWidth</a>( static_cast&lt; float &gt;( g_DisplayWidth ) );</div>
<div class="line">        viewportInfo.<a name="a97"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html#a4546e049c35d16267d7f17c29de27511">SetHeight</a>( static_cast&lt; float &gt;( g_DisplayHeight ) );</div>
<div class="line">    }</div>
<div class="line">    <a name="_a98"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html">nn::gfx::ScissorStateInfo</a> scissorInfo;</div>
<div class="line">    {</div>
<div class="line">        scissorInfo.<a name="a99"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html#a6e56a6510701c498bd9b0cf1e2bd76d8">SetDefault</a>();</div>
<div class="line">        scissorInfo.<a name="a100"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html#a32b5bcc1f381044da047847f4928285b">SetWidth</a>( g_DisplayWidth );</div>
<div class="line">        scissorInfo.<a name="a101"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html#a57465efb7793057fe855f61d7e10dea0">SetHeight</a>( g_DisplayHeight );</div>
<div class="line">    }</div>
<div class="line">    info.<a name="a102"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html#a8f4e89948a5dc8d65392565442c4bf77">SetViewportStateInfoArray</a>( &amp;viewportInfo, 1 );</div>
<div class="line">    info.<a name="a103"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html#af7b01ae781d2d2b04b88e23e4606f218">SetScissorStateInfoArray</a>( &amp;scissorInfo, 1 );</div>
<div class="line">    g_ViewportScissor.<a name="a104"></a><a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html#a0f44e5cfdd496380fc4aa818195adf9e">Initialize</a>( &amp;g_Device, info );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Position用のバッファを初期化</span></div>
<div class="line"><a name="_a105"></a><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html">nn::gfx::Buffer</a> g_PositionBuffer;</div>
<div class="line"><span class="keywordtype">void</span> InitializePositionBuffer()</div>
<div class="line">{</div>
<div class="line">    <a name="_a106"></a><a class="code" href="classnn_1_1gfx_1_1_buffer_info.html">nn::gfx::Buffer::InfoType</a> info;</div>
<div class="line">    info.<a name="a107"></a><a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a234ab03cd4d0ea8dfdfbe588a0895eac">SetDefault</a>();</div>
<div class="line">    info.<a name="a108"></a><a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#acf66bfe2703001b5c3c800d73fae0dc5">SetSize</a>( <span class="keyword">sizeof</span>( Positions ) );</div>
<div class="line">    info.<a name="a109"></a><a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a8baa33ab5cf098fcec0e1609c6ecf0c7">SetGpuAccessFlags</a>( <a name="a110"></a><a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5aa319bbae0c949cb5829c882b68e7500a">nn::gfx::GpuAccess_VertexBuffer</a> );</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>( <a name="a111"></a><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#af96326338663a23e227df75dd7d32faa">nn::gfx::Buffer::IsMemoryPoolRequired</a> ) )</div>
<div class="line">    {</div>
<div class="line">        g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( </div>
<div class="line">            g_MemoryPoolOffset, <a name="a112"></a><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a99b1cd500e55e26460655d68eee13842">nn::gfx::Buffer::GetBufferAlignment</a>( &amp;g_Device, info ) );</div>
<div class="line">        g_PositionBuffer.<a name="a113"></a><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>( </div>
<div class="line">            &amp;g_Device, info, &amp;g_MemoryPool, g_MemoryPoolOffset, info.<a name="a114"></a><a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>() );</div>
<div class="line">        g_MemoryPoolOffset += info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        g_PositionBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>( &amp;g_Device, info, NULL, 0, 0 );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span>* pMapped = g_PositionBuffer.<a name="a115"></a><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#ae4ea23c81cbef8a6cd39a378678d2df6">Map</a>();</div>
<div class="line">    memcpy( pMapped, Positions, info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>() );</div>
<div class="line">    g_PositionBuffer.<a name="a116"></a><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a8a5e6d06cc7f541da91237ddf540f4b8">Unmap</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Uv用のバッファを初期化</span></div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html">nn::gfx::Buffer</a> g_UvBuffer;</div>
<div class="line"><span class="keywordtype">void</span> InitializeUvBuffer()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_buffer_info.html">nn::gfx::Buffer::InfoType</a> info;</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a234ab03cd4d0ea8dfdfbe588a0895eac">SetDefault</a>();</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#acf66bfe2703001b5c3c800d73fae0dc5">SetSize</a>( <span class="keyword">sizeof</span>( Uvs ) );</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a8baa33ab5cf098fcec0e1609c6ecf0c7">SetGpuAccessFlags</a>( <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5aa319bbae0c949cb5829c882b68e7500a">nn::gfx::GpuAccess_VertexBuffer</a> );</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>( <a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#af96326338663a23e227df75dd7d32faa">nn::gfx::Buffer::IsMemoryPoolRequired</a> ) )</div>
<div class="line">    {</div>
<div class="line">        g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>(</div>
<div class="line">            g_MemoryPoolOffset, <a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a99b1cd500e55e26460655d68eee13842">nn::gfx::Buffer::GetBufferAlignment</a>( &amp;g_Device, info ) );</div>
<div class="line">        g_UvBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>(</div>
<div class="line">            &amp;g_Device, info, &amp;g_MemoryPool, g_MemoryPoolOffset, info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>() );</div>
<div class="line">        g_MemoryPoolOffset += info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        g_UvBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>( &amp;g_Device, info, NULL, 0, 0 );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span>* pMapped = g_UvBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#ae4ea23c81cbef8a6cd39a378678d2df6">Map</a>();</div>
<div class="line">    memcpy( pMapped, Uvs, info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>() );</div>
<div class="line">    g_UvBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a8a5e6d06cc7f541da91237ddf540f4b8">Unmap</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// インデクス用のバッファを初期化</span></div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html">nn::gfx::Buffer</a> g_IndexBuffer;</div>
<div class="line"><span class="keywordtype">void</span> InitializeIndexBuffer()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_buffer_info.html">nn::gfx::Buffer::InfoType</a> info;</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a234ab03cd4d0ea8dfdfbe588a0895eac">SetDefault</a>();</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#acf66bfe2703001b5c3c800d73fae0dc5">SetSize</a>( <span class="keyword">sizeof</span>( Indices ) );</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a8baa33ab5cf098fcec0e1609c6ecf0c7">SetGpuAccessFlags</a>( <a name="a117"></a><a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a1ba60cf566c205e5c387ecbf68a51fe6">nn::gfx::GpuAccess_IndexBuffer</a> );</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>( <a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#af96326338663a23e227df75dd7d32faa">nn::gfx::Buffer::IsMemoryPoolRequired</a> ) )</div>
<div class="line">    {</div>
<div class="line">        g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_MemoryPoolOffset, <a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a99b1cd500e55e26460655d68eee13842">nn::gfx::Buffer::GetBufferAlignment</a>( &amp;g_Device, info ) );</div>
<div class="line">        g_IndexBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>( &amp;g_Device, info, &amp;g_MemoryPool, g_MemoryPoolOffset, info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>() );</div>
<div class="line">        g_MemoryPoolOffset += info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        g_IndexBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>( &amp;g_Device, info, NULL, 0, 0 );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span>* pMapped = g_IndexBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#ae4ea23c81cbef8a6cd39a378678d2df6">Map</a>();</div>
<div class="line">    memcpy( pMapped, Indices, info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>() );</div>
<div class="line">    g_IndexBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a8a5e6d06cc7f541da91237ddf540f4b8">Unmap</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// コンスタントバッファを初期化</span></div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html">nn::gfx::Buffer</a> g_ConstantBuffer[DrawType_End];</div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html">nn::gfx::Buffer</a> g_ConstantBufferModulateIcon;</div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html">nn::gfx::Buffer</a> g_ConstantBufferModulate[<a name="a118"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa140c8eb1aa865374c94a7ad24a0a9f41">nn::mii::CharModel::DrawType_End</a>];</div>
<div class="line"><span class="keywordtype">void</span> InitializeConstantBuffer()</div>
<div class="line">{</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_buffer_info.html">nn::gfx::Buffer::InfoType</a> info;</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a234ab03cd4d0ea8dfdfbe588a0895eac">SetDefault</a>();</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#acf66bfe2703001b5c3c800d73fae0dc5">SetSize</a>(<span class="keyword">sizeof</span>(MatrixConstantBuffer));</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a8baa33ab5cf098fcec0e1609c6ecf0c7">SetGpuAccessFlags</a>(<a name="a119"></a><a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5af73fa5ff79cf33f75dfecb4cbe5c139d">nn::gfx::GpuAccess_ConstantBuffer</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; DrawType_End; ++i )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> ( <a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#af96326338663a23e227df75dd7d32faa">nn::gfx::Buffer::IsMemoryPoolRequired</a>) )</div>
<div class="line">            {</div>
<div class="line">                g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>(g_MemoryPoolOffset, <a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a99b1cd500e55e26460655d68eee13842">nn::gfx::Buffer::GetBufferAlignment</a>(&amp;g_Device, info));</div>
<div class="line">                g_ConstantBuffer[i].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>(&amp;g_Device, info, &amp;g_MemoryPool, g_MemoryPoolOffset, info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>());</div>
<div class="line">                g_MemoryPoolOffset += info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>();</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                g_ConstantBuffer[i].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>(&amp;g_Device, info, NULL, 0, 0);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            MatrixConstantBuffer* pMapped = g_ConstantBuffer[i].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#ae4ea23c81cbef8a6cd39a378678d2df6">Map</a>&lt;MatrixConstantBuffer&gt;();</div>
<div class="line"></div>
<div class="line">            <span class="comment">// 縦横比を画面にあわせる</span></div>
<div class="line">            <a name="_a120"></a><a class="code" href="structnn_1_1util_1_1_matrix_row_major4x4f_type.html">nn::util::Matrix4x4fType</a> proj;</div>
<div class="line">            <span class="keyword">auto</span> aspect = float(g_DisplayWidth) / float(g_DisplayHeight);</div>
<div class="line">            nn::util::MatrixPerspectiveFieldOfViewRightHanded(&amp;proj, 3.14f / 4.f, aspect, 1.0f, 1000.0f);</div>
<div class="line">            nn::util::MatrixStore(&amp;( pMapped-&gt;projection ), proj);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ( i == DrawType_MiiFace )</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// LookAt設定</span></div>
<div class="line">                <a name="_a121"></a><a class="code" href="structnn_1_1util_1_1_vector3f_type.html">nn::util::Vector3fType</a> camPos = <a name="a122"></a><a class="code" href="structnn_1_1util_1_1_vector3f_type.html#a27cff920e40632f831ca73d6a6f307db">NN_UTIL_VECTOR_3F_INITIALIZER</a>(0.0f,34.5f,300.0f);</div>
<div class="line">                <a class="code" href="structnn_1_1util_1_1_vector3f_type.html">nn::util::Vector3fType</a> camTarget = <a class="code" href="structnn_1_1util_1_1_vector3f_type.html#a27cff920e40632f831ca73d6a6f307db">NN_UTIL_VECTOR_3F_INITIALIZER</a>(0.0f,34.5f,0.0f);</div>
<div class="line">                <a name="_a123"></a><a class="code" href="structnn_1_1util_1_1_matrix_row_major4x3f_type.html">nn::util::Matrix4x3fType</a> modelView;</div>
<div class="line">                nn::util::MatrixLookAtRightHanded(&amp;modelView, camPos, camTarget, 0.0f);</div>
<div class="line">                nn::util::MatrixStore(&amp;pMapped-&gt;modelView, modelView);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// ちょうど良い位置に変更</span></div>
<div class="line">                <span class="comment">// LookAt設定</span></div>
<div class="line">                <a class="code" href="structnn_1_1util_1_1_vector3f_type.html">nn::util::Vector3fType</a> camPos = <a class="code" href="structnn_1_1util_1_1_vector3f_type.html#a27cff920e40632f831ca73d6a6f307db">NN_UTIL_VECTOR_3F_INITIALIZER</a>(</div>
<div class="line">                    i == DrawType_NormalIcon ? 1.0f : -1.0f , 0.0f, 3.0f);</div>
<div class="line">                <a class="code" href="structnn_1_1util_1_1_vector3f_type.html">nn::util::Vector3fType</a> camTarget = <a class="code" href="structnn_1_1util_1_1_vector3f_type.html#a27cff920e40632f831ca73d6a6f307db">NN_UTIL_VECTOR_3F_INITIALIZER</a>(</div>
<div class="line">                    i == DrawType_NormalIcon ? 1.0f : -1.0f , 0.0f, 0.0f);</div>
<div class="line">                <a class="code" href="structnn_1_1util_1_1_matrix_row_major4x3f_type.html">nn::util::Matrix4x3fType</a> modelView;</div>
<div class="line">                nn::util::MatrixLookAtRightHanded(&amp;modelView, camPos, camTarget, 0.0f);</div>
<div class="line">                nn::util::MatrixStore(&amp;pMapped-&gt;modelView, modelView);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            g_ConstantBuffer[i].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a8a5e6d06cc7f541da91237ddf540f4b8">Unmap</a>();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_buffer_info.html">nn::gfx::BufferInfo</a> info;</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a234ab03cd4d0ea8dfdfbe588a0895eac">SetDefault</a>();</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a8baa33ab5cf098fcec0e1609c6ecf0c7">SetGpuAccessFlags</a>(<a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5af73fa5ff79cf33f75dfecb4cbe5c139d">nn::gfx::GpuAccess_ConstantBuffer</a>);</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#acf66bfe2703001b5c3c800d73fae0dc5">SetSize</a>(<span class="keyword">sizeof</span>(ConstantBufferModulate));</div>
<div class="line">        <span class="keywordtype">size_t</span> alignment = <a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a99b1cd500e55e26460655d68eee13842">nn::gfx::Buffer::GetBufferAlignment</a>(&amp;g_Device, info);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa140c8eb1aa865374c94a7ad24a0a9f41">nn::mii::CharModel::DrawType_End</a>;++i)</div>
<div class="line">        {</div>
<div class="line">            g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>(g_MemoryPoolOffset, alignment);</div>
<div class="line">            g_ConstantBufferModulate[i].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>(&amp;g_Device,info</div>
<div class="line">                , &amp;g_MemoryPool</div>
<div class="line">                , g_MemoryPoolOffset</div>
<div class="line">                , info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>());</div>
<div class="line">            g_MemoryPoolOffset += info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_buffer_info.html">nn::gfx::BufferInfo</a> info;</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a234ab03cd4d0ea8dfdfbe588a0895eac">SetDefault</a>();</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#a8baa33ab5cf098fcec0e1609c6ecf0c7">SetGpuAccessFlags</a>(<a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5af73fa5ff79cf33f75dfecb4cbe5c139d">nn::gfx::GpuAccess_ConstantBuffer</a>);</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#acf66bfe2703001b5c3c800d73fae0dc5">SetSize</a>(<span class="keyword">sizeof</span>(ConstantBufferModulate));</div>
<div class="line">        <span class="keywordtype">size_t</span> alignment = <a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a99b1cd500e55e26460655d68eee13842">nn::gfx::Buffer::GetBufferAlignment</a>(&amp;g_Device, info);</div>
<div class="line">        g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>(g_MemoryPoolOffset, alignment);</div>
<div class="line">        g_ConstantBufferModulateIcon.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a4052c47a96fb7c0b60f851b423fa6d39">Initialize</a>(&amp;g_Device, info</div>
<div class="line">            , &amp;g_MemoryPool</div>
<div class="line">            , g_MemoryPoolOffset</div>
<div class="line">            , info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>());</div>
<div class="line">        g_MemoryPoolOffset += info.<a class="code" href="classnn_1_1gfx_1_1_buffer_info.html#ade5a953d5136e969a8a7a225eb91b436">GetSize</a>();</div>
<div class="line"></div>
<div class="line">        ConstantBufferModulate* pMapped = g_ConstantBufferModulateIcon.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#ae4ea23c81cbef8a6cd39a378678d2df6">Map</a>&lt;ConstantBufferModulate&gt;();</div>
<div class="line">        <span class="comment">// Modulate の DrawType に純粋なテクスチャ描画を行うように設定する。</span></div>
<div class="line">        pMapped-&gt;drawType = 3;</div>
<div class="line">        g_ConstantBufferModulateIcon.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a8a5e6d06cc7f541da91237ddf540f4b8">Unmap</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="_a124"></a><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html">nn::gfx::DescriptorPool</a> g_SamplerDescriptorPool;</div>
<div class="line"><span class="keywordtype">void</span> InitializeSamplerDescriptorPool()</div>
<div class="line">{</div>
<div class="line">    <a name="_a125"></a><a class="code" href="classnn_1_1gfx_1_1_descriptor_pool_info.html">nn::gfx::DescriptorPool::InfoType</a> info;</div>
<div class="line">    info.<a name="a126"></a><a class="code" href="classnn_1_1gfx_1_1_descriptor_pool_info.html#aadd3cda040dfc4444a8c285b7ac01e39">SetDefault</a>();</div>
<div class="line">    info.<a name="a127"></a><a class="code" href="classnn_1_1gfx_1_1_descriptor_pool_info.html#a9a411ac342c1d77a029771436d7db638">SetDescriptorPoolType</a>( <a name="a128"></a><a class="code" href="namespacenn_1_1gfx.html#a14fc8bd39227425748a8fb55c035d10ca831f2090660e1269d9440b8095bf004d">nn::gfx::DescriptorPoolType_Sampler</a> );</div>
<div class="line">    info.<a name="a129"></a><a class="code" href="classnn_1_1gfx_1_1_descriptor_pool_info.html#a0ad0426ae3ed984e03a6e4d1b390e47c">SetSlotCount</a>( g_SamplerDescriptorBaseIndex + 1 );</div>
<div class="line">    <span class="keywordtype">size_t</span> size = <a name="a130"></a><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#a82a7f8cf8719fba71ce6d652b41cc3d1">nn::gfx::DescriptorPool::CalculateDescriptorPoolSize</a>( &amp;g_Device, info );</div>
<div class="line">    g_CachedMemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_CachedMemoryPoolOffset,</div>
<div class="line">        <a name="a131"></a><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#a4daa7d7869ad16b2f02f9d3ebeb7e11c">nn::gfx::DescriptorPool::GetDescriptorPoolAlignment</a>( &amp;g_Device, info ) );</div>
<div class="line">    g_SamplerDescriptorPool.<a name="a132"></a><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#adc3149a4cf4eb2af5ed872284dc0c9a0">Initialize</a>( &amp;g_Device, info,</div>
<div class="line">        &amp;g_CachedMemoryPool, g_CachedMemoryPoolOffset, size );</div>
<div class="line">    g_CachedMemoryPoolOffset += size;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html">nn::gfx::DescriptorPool</a> g_TextureDescriptorPool;</div>
<div class="line"><span class="keywordtype">void</span> InitializeTextureDescriptorPool()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_descriptor_pool_info.html">nn::gfx::DescriptorPool::InfoType</a> info;</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_descriptor_pool_info.html#aadd3cda040dfc4444a8c285b7ac01e39">SetDefault</a>();</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_descriptor_pool_info.html#a9a411ac342c1d77a029771436d7db638">SetDescriptorPoolType</a>( <a name="a133"></a><a class="code" href="namespacenn_1_1gfx.html#a14fc8bd39227425748a8fb55c035d10cae1ab626ffc219a9f27d569a732154bd0">nn::gfx::DescriptorPoolType_TextureView</a> );</div>
<div class="line">    info.<a class="code" href="classnn_1_1gfx_1_1_descriptor_pool_info.html#a0ad0426ae3ed984e03a6e4d1b390e47c">SetSlotCount</a>( g_TextureDescriptorBaseIndex + TextureDescriptorPoolSlotCount );</div>
<div class="line">    <span class="keywordtype">size_t</span> size = <a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#a82a7f8cf8719fba71ce6d652b41cc3d1">nn::gfx::DescriptorPool::CalculateDescriptorPoolSize</a>( &amp;g_Device, info );</div>
<div class="line">    g_CachedMemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_CachedMemoryPoolOffset,</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#a4daa7d7869ad16b2f02f9d3ebeb7e11c">nn::gfx::DescriptorPool::GetDescriptorPoolAlignment</a>( &amp;g_Device, info ) );</div>
<div class="line">    g_TextureDescriptorPool.<a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#adc3149a4cf4eb2af5ed872284dc0c9a0">Initialize</a>( &amp;g_Device, info, &amp;g_CachedMemoryPool, g_CachedMemoryPoolOffset, size );</div>
<div class="line">    g_CachedMemoryPoolOffset += size;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a> GetShaderCodeType(<span class="keyword">const</span> <a name="_a134"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html">nn::gfx::ResShaderContainer</a>* pContainer)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nn::gfx::ShaderCodeType_End;++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> codeType = <a name="a135"></a><a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a>(i);</div>
<div class="line">        <span class="keywordflow">if</span>(pContainer-&gt;<a name="a136"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#a1d654b4d72d8d55937dab1fd27bbcd50">GetResShaderVariation</a>(0)-&gt;<a name="a137"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_variation.html#aec393ed8b0fd0cdf05c5f01059323902">GetResShaderProgram</a>(codeType) != <span class="keyword">nullptr</span>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> codeType;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0);</div>
<div class="line">    <span class="keywordflow">return</span> <a name="a138"></a><a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455a3cf271292131cceee9c228c73f9f788e">nn::gfx::ShaderCodeType_Source</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// nn::gfx::ResShaderFileを初期化する</span></div>
<div class="line"><a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a> InitializeResShaderFile( <a name="_a139"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html">nn::gfx::ResShaderFile</a>* pResShaderFile )</div>
<div class="line">{</div>
<div class="line">    <a name="a140"></a><a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>( pResShaderFile );</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html">nn::gfx::ResShaderContainer</a>* pContainer = pResShaderFile-&gt;<a name="a141"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html#ace0f3249523a20bb1ca3deee4c5b9b4d">GetShaderContainer</a>();</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>( pContainer );</div>
<div class="line">    pContainer-&gt;<a name="a142"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#a7bf73b23ce0cbed024030e28b411c88c">Initialize</a>( &amp;g_Device );</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> variationCount = pContainer-&gt;<a name="a143"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#af5045150eedf3948b52d4b3e181d7bb7">GetShaderVariationCount</a>();</div>
<div class="line">    <a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a> codeType = GetShaderCodeType(pContainer);</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> idx = 0; idx &lt; variationCount; ++idx )</div>
<div class="line">    {</div>
<div class="line">        <a name="_a144"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_variation.html">nn::gfx::ResShaderVariation</a>* pVariation = pContainer-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#a1d654b4d72d8d55937dab1fd27bbcd50">GetResShaderVariation</a>( idx );</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>( pVariation );</div>
<div class="line">        <a class="code" href="namespacenn_1_1gfx.html#a52eb9f5e1bec94e73a2bb152af8e3d91">nn::gfx::ShaderInitializeResult</a> result =</div>
<div class="line">            pVariation-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_variation.html#aec393ed8b0fd0cdf05c5f01059323902">GetResShaderProgram</a>( codeType )-&gt;<a name="a145"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_program.html#a45f641ef7a823b4ec17e990a0ba3ca8b">Initialize</a>( &amp;g_Device );</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( result == <a name="a146"></a><a class="code" href="namespacenn_1_1gfx.html#a52eb9f5e1bec94e73a2bb152af8e3d91ad542c72930fffff3ee80a71bef4e3c07">nn::gfx::ShaderInitializeResult_Success</a> );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> codeType;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// nn::gfx::ResShaderFileの終了処理を行う</span></div>
<div class="line"><span class="keywordtype">void</span> FinalizeResShaderFile( <a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html">nn::gfx::ResShaderFile</a>* pResShaderFile, <a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a> type )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>( pResShaderFile );</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html">nn::gfx::ResShaderContainer</a>* pContainer = pResShaderFile-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html#ace0f3249523a20bb1ca3deee4c5b9b4d">GetShaderContainer</a>();</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>( pContainer );</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> variationCount = pContainer-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#af5045150eedf3948b52d4b3e181d7bb7">GetShaderVariationCount</a>();</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> idx = 0; idx &lt; variationCount; ++idx )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_res_shader_variation.html">nn::gfx::ResShaderVariation</a>* pVariation = pContainer-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#a1d654b4d72d8d55937dab1fd27bbcd50">GetResShaderVariation</a>( idx );</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>( pVariation );</div>
<div class="line">        pVariation-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_variation.html#aec393ed8b0fd0cdf05c5f01059323902">GetResShaderProgram</a>( type )-&gt;<a name="a147"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_program.html#ade70b8c892916db6b8173e8121fe086f">Finalize</a>( &amp;g_Device );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pContainer-&gt;<a name="a148"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#aed6ba64e9ba53203507e7dd15c795cd0">Finalize</a>( &amp;g_Device );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html">nn::gfx::ResShaderFile</a>* g_pResShaderFile = NULL;</div>
<div class="line"><a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a> g_ShaderCodeType;</div>
<div class="line"><span class="keywordtype">int</span> g_SlotMat = 0;</div>
<div class="line"><span class="keywordtype">int</span> g_SlotTex = 0;</div>
<div class="line"><span class="keywordtype">int</span> g_SlotModluate = 0;</div>
<div class="line"><span class="keywordtype">void</span> InitializeShader()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span>* pResource = ReadResource( SampleShaderPath );</div>
<div class="line">    g_pResShaderFile = <a name="a149"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html#a1da4b1d76726d48dd4768b5bf37cc98e">nn::gfx::ResShaderFile::ResCast</a>( pResource );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>( g_pResShaderFile );</div>
<div class="line">    g_ShaderCodeType = InitializeResShaderFile( g_pResShaderFile );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html">nn::gfx::ResShaderContainer</a>* pContainer = g_pResShaderFile-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html#ace0f3249523a20bb1ca3deee4c5b9b4d">GetShaderContainer</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> variation = 0;</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_res_shader_variation.html">nn::gfx::ResShaderVariation</a>* pVariation = </div>
<div class="line">        pContainer-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#a1d654b4d72d8d55937dab1fd27bbcd50">GetResShaderVariation</a>( variation );</div>
<div class="line">    <a name="_a150"></a><a class="code" href="classnn_1_1gfx_1_1_t_shader.html">nn::gfx::Shader</a>* pShader = </div>
<div class="line">        pVariation-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_variation.html#aec393ed8b0fd0cdf05c5f01059323902">GetResShaderProgram</a>( g_ShaderCodeType )-&gt;<a name="a151"></a><a class="code" href="classnn_1_1gfx_1_1_res_shader_program.html#a93b925feb250168737859dfb7f072801">GetShader</a>();</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>( pShader );</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* MatrixName = <span class="stringliteral">&quot;u_Matrix&quot;</span>;</div>
<div class="line">    g_SlotMat = pShader-&gt;<a name="a152"></a><a class="code" href="classnn_1_1gfx_1_1_t_shader.html#a40f2b7445a7507aa747549259ce13a86">GetInterfaceSlot</a>(</div>
<div class="line">        <a name="a153"></a><a class="code" href="namespacenn_1_1gfx.html#a23a67c7d8f6b5765e2de8173797f73feaa5a9e711b0362499e98049d578099ac7">nn::gfx::ShaderStage_Vertex</a>, <a name="a154"></a><a class="code" href="namespacenn_1_1gfx.html#ab1daeef6bae19eb4973f832b77ce72a6ab7fbbea1768272a153568501e23161c4">nn::gfx::ShaderInterfaceType_ConstantBuffer</a>, MatrixName );</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* TexName = <span class="stringliteral">&quot;s_Tex&quot;</span>;</div>
<div class="line">    g_SlotTex = pShader-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_shader.html#a40f2b7445a7507aa747549259ce13a86">GetInterfaceSlot</a>(</div>
<div class="line">        <a name="a155"></a><a class="code" href="namespacenn_1_1gfx.html#a23a67c7d8f6b5765e2de8173797f73fea4af13ef64af0ee06eb539013de2be40a">nn::gfx::ShaderStage_Pixel</a>, <a name="a156"></a><a class="code" href="namespacenn_1_1gfx.html#ab1daeef6bae19eb4973f832b77ce72a6aad5cae847813afbd39070bb0f8a6b7fd">nn::gfx::ShaderInterfaceType_Sampler</a>, TexName );</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* ModulateName = <span class="stringliteral">&quot;u_Modulate&quot;</span>;</div>
<div class="line">    g_SlotModluate = pShader-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_shader.html#a40f2b7445a7507aa747549259ce13a86">GetInterfaceSlot</a>(</div>
<div class="line">        <a class="code" href="namespacenn_1_1gfx.html#a23a67c7d8f6b5765e2de8173797f73fea4af13ef64af0ee06eb539013de2be40a">nn::gfx::ShaderStage_Pixel</a>, <a class="code" href="namespacenn_1_1gfx.html#ab1daeef6bae19eb4973f832b77ce72a6ab7fbbea1768272a153568501e23161c4">nn::gfx::ShaderInterfaceType_ConstantBuffer</a>, ModulateName );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(g_SlotMat &gt;= 0);</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(g_SlotTex &gt;= 0);</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(g_SlotModluate &gt;= 0);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="_a157"></a><a class="code" href="classnn_1_1gfx_1_1_t_rasterizer_state.html">nn::gfx::RasterizerState</a> g_RasterizerState[nn::gfx::CullMode_End];</div>
<div class="line"><span class="keywordtype">void</span> InitializeRasterizerState()</div>
<div class="line">{</div>
<div class="line">    <a name="_a158"></a><a class="code" href="classnn_1_1gfx_1_1_rasterizer_state_info.html">nn::gfx::RasterizerStateInfo</a> info;</div>
<div class="line">    info.<a name="a159"></a><a class="code" href="classnn_1_1gfx_1_1_rasterizer_state_info.html#a45a46efee0f61cab478fd5a41be0e9b9">SetDefault</a>();</div>
<div class="line">    info.<a name="a160"></a><a class="code" href="classnn_1_1gfx_1_1_rasterizer_state_info.html#ac41e9cda160239333202215bea73c5b1">SetPrimitiveTopologyType</a>(<a name="a161"></a><a class="code" href="namespacenn_1_1gfx.html#a6fcf21493e8aeae81cec48c49eec5ad8afb917cda5a7dcb6daf3764a63786baa4">nn::gfx::PrimitiveTopologyType_Triangle</a>);</div>
<div class="line">    info.<a name="a162"></a><a class="code" href="classnn_1_1gfx_1_1_rasterizer_state_info.html#a253866f358c056a5e6e6c531cb1029f9">SetScissorEnabled</a>(<span class="keyword">true</span>);</div>
<div class="line">    info.<a name="a163"></a><a class="code" href="classnn_1_1gfx_1_1_rasterizer_state_info.html#a5358351caf04fc526dc378c45e24d238">SetDepthClipEnabled</a>(<span class="keyword">false</span>);</div>
<div class="line">    info.<a name="a164"></a><a class="code" href="classnn_1_1gfx_1_1_rasterizer_state_info.html#a39fa447f9397f0b0981853a263f5a94e">SetFillMode</a>( <a name="a165"></a><a class="code" href="namespacenn_1_1gfx.html#a6a36f240e53bdfc4cd80f82b3bd8b061ae791906257d3ef21904e3944bfade7e1">nn::gfx::FillMode_Solid</a> );</div>
<div class="line">    info.<a name="a166"></a><a class="code" href="classnn_1_1gfx_1_1_rasterizer_state_info.html#a4ff36606c85df4a667550fb82d0b8317">SetFrontFace</a>( <a name="a167"></a><a class="code" href="namespacenn_1_1gfx.html#a2b30e25ed036ceec3f6e9e88b160e122aec5153540ebf7173a9db43e829bb49b7">nn::gfx::FrontFace_Ccw</a> );</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nn::gfx::CullMode_End;++i)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="namespacenn_1_1gfx.html#af10f98bfe496b042c8efd7e5a99e8a3a">nn::gfx::CullMode</a> cullMode = <a name="a168"></a><a class="code" href="namespacenn_1_1gfx.html#af10f98bfe496b042c8efd7e5a99e8a3a">nn::gfx::CullMode</a>(i);</div>
<div class="line">        info.<a name="a169"></a><a class="code" href="classnn_1_1gfx_1_1_rasterizer_state_info.html#a92289196919c33b4b55f6379463be28d">SetCullMode</a>(cullMode);</div>
<div class="line"></div>
<div class="line">        g_RasterizerState[i].<a name="a170"></a><a class="code" href="classnn_1_1gfx_1_1_t_rasterizer_state.html#ab8bff07010deabb29f933514e25a5ddf">Initialize</a>(&amp;g_Device, info);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> DrawMode</div>
<div class="line">{</div>
<div class="line">    DrawMode_Opa,</div>
<div class="line">    DrawMode_Xlu,</div>
<div class="line">    DrawMode_PremultipliedAlpha,</div>
<div class="line">    DrawMode_End,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a name="_a171"></a><a class="code" href="classnn_1_1gfx_1_1_t_blend_state.html">nn::gfx::BlendState</a> g_BlendState[DrawMode_End];</div>
<div class="line"><span class="keywordtype">void</span> InitializeBlendState()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; DrawMode_End;++i)</div>
<div class="line">    {</div>
<div class="line">        DrawMode drawMode = DrawMode(i);</div>
<div class="line">        <a name="_a172"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html">nn::gfx::BlendTargetStateInfo</a> targetInfo;</div>
<div class="line">        targetInfo.<a name="a173"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a9895fb0508aa80516823d15b7430f717">SetDefault</a>();</div>
<div class="line">        targetInfo.<a name="a174"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a1212ad941727dec71b1d0644fc739630">SetChannelMask</a>(nn::gfx::ChannelMask_All);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (drawMode == DrawMode_Xlu)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// 補間アルファブレンド用パイプライン</span></div>
<div class="line">            targetInfo.<a name="a175"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a3c988d83930fd8f326d91b14d7eb821d">SetBlendEnabled</a>(<span class="keyword">true</span>);</div>
<div class="line">            targetInfo.<a name="a176"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a21556d912f4dbc7851c519e278f38b88">SetColorBlendFunction</a>(<a name="a177"></a><a class="code" href="namespacenn_1_1gfx.html#ad042389c2c66e7b01e99aeddbfe64640ab960c2d5195aa050f3232e766622fa02">nn::gfx::BlendFunction_Add</a>);</div>
<div class="line">            targetInfo.<a name="a178"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a342961652da2ffa11aaf948210d8eab2">SetSourceColorBlendFactor</a>(<a name="a179"></a><a class="code" href="namespacenn_1_1gfx.html#aa05188118ee45961b2cd58b625045e95a01cf6eb408eb90eaa36fc13e9d9cd866">nn::gfx::BlendFactor_SourceAlpha</a>);</div>
<div class="line">            targetInfo.<a name="a180"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a6659d428b15b153b824585f5bf95f6fa">SetDestinationColorBlendFactor</a>(<a name="a181"></a><a class="code" href="namespacenn_1_1gfx.html#aa05188118ee45961b2cd58b625045e95a5d8634daa2ee6277a4f9b37fba5dc6b6">nn::gfx::BlendFactor_OneMinusSourceAlpha</a>);</div>
<div class="line">            targetInfo.<a name="a182"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a6293033ec1a394d84d10f093624b8390">SetAlphaBlendFunction</a>(<a name="a183"></a><a class="code" href="namespacenn_1_1gfx.html#ad042389c2c66e7b01e99aeddbfe64640a3bf5607f21e3eff0ff774f1269b186f2">nn::gfx::BlendFunction_Max</a>);</div>
<div class="line">            targetInfo.<a name="a184"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a5ea71ce758c67c89f0fc318a56373d69">SetSourceAlphaBlendFactor</a>(<a name="a185"></a><a class="code" href="namespacenn_1_1gfx.html#aa05188118ee45961b2cd58b625045e95a4b7d2f0ce38222eb5a51a68c1388a475">nn::gfx::BlendFactor_One</a>);</div>
<div class="line">            targetInfo.<a name="a186"></a><a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a7e119bed18f03ce27e854c0dfa4da35b">SetDestinationAlphaBlendFactor</a>(<a class="code" href="namespacenn_1_1gfx.html#aa05188118ee45961b2cd58b625045e95a4b7d2f0ce38222eb5a51a68c1388a475">nn::gfx::BlendFactor_One</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( drawMode == DrawMode_PremultipliedAlpha )</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// 乗算済みアルファ描画用パイプライン</span></div>
<div class="line">            targetInfo.<a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a3c988d83930fd8f326d91b14d7eb821d">SetBlendEnabled</a>( <span class="keyword">true</span> );</div>
<div class="line">            targetInfo.<a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a21556d912f4dbc7851c519e278f38b88">SetColorBlendFunction</a>(<a class="code" href="namespacenn_1_1gfx.html#ad042389c2c66e7b01e99aeddbfe64640ab960c2d5195aa050f3232e766622fa02">nn::gfx::BlendFunction_Add</a>);</div>
<div class="line">            targetInfo.<a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a342961652da2ffa11aaf948210d8eab2">SetSourceColorBlendFactor</a>(<a class="code" href="namespacenn_1_1gfx.html#aa05188118ee45961b2cd58b625045e95a4b7d2f0ce38222eb5a51a68c1388a475">nn::gfx::BlendFactor_One</a>);</div>
<div class="line">            targetInfo.<a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a6659d428b15b153b824585f5bf95f6fa">SetDestinationColorBlendFactor</a>(<a class="code" href="namespacenn_1_1gfx.html#aa05188118ee45961b2cd58b625045e95a5d8634daa2ee6277a4f9b37fba5dc6b6">nn::gfx::BlendFactor_OneMinusSourceAlpha</a>);</div>
<div class="line">            targetInfo.<a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a6293033ec1a394d84d10f093624b8390">SetAlphaBlendFunction</a>(<a class="code" href="namespacenn_1_1gfx.html#ad042389c2c66e7b01e99aeddbfe64640ab960c2d5195aa050f3232e766622fa02">nn::gfx::BlendFunction_Add</a>);</div>
<div class="line">            targetInfo.<a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a5ea71ce758c67c89f0fc318a56373d69">SetSourceAlphaBlendFactor</a>(<a name="a187"></a><a class="code" href="namespacenn_1_1gfx.html#aa05188118ee45961b2cd58b625045e95a4223c11accd7e0efeffaca125ba28f4c">nn::gfx::BlendFactor_OneMinusDestinationAlpha</a>);</div>
<div class="line">            targetInfo.<a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a7e119bed18f03ce27e854c0dfa4da35b">SetDestinationAlphaBlendFactor</a>(<a class="code" href="namespacenn_1_1gfx.html#aa05188118ee45961b2cd58b625045e95a4b7d2f0ce38222eb5a51a68c1388a475">nn::gfx::BlendFactor_One</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            targetInfo.<a class="code" href="classnn_1_1gfx_1_1_blend_target_state_info.html#a3c988d83930fd8f326d91b14d7eb821d">SetBlendEnabled</a>(<span class="keyword">false</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a name="_a188"></a><a class="code" href="classnn_1_1gfx_1_1_blend_state_info.html">nn::gfx::BlendStateInfo</a> info;</div>
<div class="line">        info.<a name="a189"></a><a class="code" href="classnn_1_1gfx_1_1_blend_state_info.html#a76f3150742ecfcf23c1fae90fd3e56bb">SetDefault</a>();</div>
<div class="line">        info.<a name="a190"></a><a class="code" href="classnn_1_1gfx_1_1_blend_state_info.html#a12f36d3d65c35ccef511bace4ed8669f">SetAlphaToCoverageEnabled</a>( <span class="keyword">true</span> );</div>
<div class="line">        info.<a name="a191"></a><a class="code" href="classnn_1_1gfx_1_1_blend_state_info.html#af5443a1e809276d057e67e728c520ccc">SetBlendTargetStateInfoArray</a>( &amp;targetInfo, 1 );</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">size_t</span> size = <a name="a192"></a><a class="code" href="classnn_1_1gfx_1_1_t_blend_state.html#abe1303314a2531918705097b6d767813">nn::gfx::BlendState::GetRequiredMemorySize</a>( info );</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( <a name="a193"></a><a class="code" href="classnn_1_1gfx_1_1_t_blend_state.html#ae951838a409bd52c2898c4527eb53de5a2f66ce8fa0036dcffedf0132f377995f">nn::gfx::BlendState::RequiredMemoryInfo_Alignment</a> );</div>
<div class="line">        g_BlendState[i].<a name="a194"></a><a class="code" href="classnn_1_1gfx_1_1_t_blend_state.html#a1586662eba3503e93e0ee20667ac0c62">SetMemory</a>( g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), size );</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( size );</div>
<div class="line">        g_BlendState[i].<a name="a195"></a><a class="code" href="classnn_1_1gfx_1_1_t_blend_state.html#af5db37942061feee28e6e0ba533b8470">Initialize</a>( &amp;g_Device, info );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="_a196"></a><a class="code" href="classnn_1_1gfx_1_1_t_depth_stencil_state.html">nn::gfx::DepthStencilState</a> g_DepthStencilState[DrawMode_End];</div>
<div class="line"><span class="keywordtype">void</span> InitializeDepthStencilState()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; DrawMode_End;++i)</div>
<div class="line">    {</div>
<div class="line">        <a name="_a197"></a><a class="code" href="classnn_1_1gfx_1_1_depth_stencil_state_info.html">nn::gfx::DepthStencilStateInfo</a> info;</div>
<div class="line">        info.<a name="a198"></a><a class="code" href="classnn_1_1gfx_1_1_depth_stencil_state_info.html#a625c1e2d78a22bdfe924768332ec8a09">SetDefault</a>();</div>
<div class="line">        info.<a name="a199"></a><a class="code" href="classnn_1_1gfx_1_1_depth_stencil_state_info.html#a7b378183626b680dd8c153cd7d6cabb0">SetDepthTestEnabled</a>(<span class="keyword">true</span>);</div>
<div class="line">        info.<a name="a200"></a><a class="code" href="classnn_1_1gfx_1_1_depth_stencil_state_info.html#a5689e4c548008489d78e04af10e1ed0e">SetDepthWriteEnabled</a>(i == DrawMode_Opa);</div>
<div class="line"></div>
<div class="line">        g_DepthStencilState[i].<a name="a201"></a><a class="code" href="classnn_1_1gfx_1_1_t_depth_stencil_state.html#af6810c239aae3e3ae854634075fee8b6">Initialize</a>(&amp;g_Device, info);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="_a202"></a><a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html">nn::gfx::VertexState</a> g_VertexState;</div>
<div class="line"><span class="keywordtype">void</span> InitializeVertexState()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> NumAttributes = 4;</div>
<div class="line">    <a name="_a203"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html">nn::gfx::VertexAttributeStateInfo</a> attribs[NumAttributes];</div>
<div class="line">    attribs[0].<a name="a204"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#af2d6004ad1f4fedce84b3b6d32571807">SetDefault</a>();</div>
<div class="line">    attribs[0].<a name="a205"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a7b8b117150c06e6f15645cd370ebee83">SetBufferIndex</a>( 0 );</div>
<div class="line">    attribs[0].<a name="a206"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a0fddeb963eb51084566d728179859cce">SetFormat</a>( <a name="a207"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a850f9cd8decfce13f04c7c00579bacb5">nn::mii::DrawParam::PositionFormat</a> );</div>
<div class="line">    attribs[0].<a name="a208"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a20dafb6550061b2fb68025ec37d1bf6c">SetOffset</a>( <a name="a209"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a78bc3dd81c9675ce1892b710e1e45f96">nn::mii::DrawParam::PositionOffset</a> );</div>
<div class="line">    attribs[0].<a name="a210"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a613bcb4e2f2040d5da9d6b63ffe1dc49">SetShaderSlot</a>( 0 );</div>
<div class="line">    attribs[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#af2d6004ad1f4fedce84b3b6d32571807">SetDefault</a>();</div>
<div class="line">    attribs[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a7b8b117150c06e6f15645cd370ebee83">SetBufferIndex</a>( 1 );</div>
<div class="line">    attribs[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a0fddeb963eb51084566d728179859cce">SetFormat</a>( <a name="a211"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a4da206824f1d361073501e81a473ce5b">nn::mii::DrawParam::NormalFormat</a> );</div>
<div class="line">    attribs[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a20dafb6550061b2fb68025ec37d1bf6c">SetOffset</a>( <a name="a212"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a0918f66fecb27f6ff25d8892af9b45da">nn::mii::DrawParam::NormalOffset</a> );</div>
<div class="line">    attribs[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a613bcb4e2f2040d5da9d6b63ffe1dc49">SetShaderSlot</a>( 1 );</div>
<div class="line">    attribs[2].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#af2d6004ad1f4fedce84b3b6d32571807">SetDefault</a>();</div>
<div class="line">    attribs[2].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a7b8b117150c06e6f15645cd370ebee83">SetBufferIndex</a>( 2 );</div>
<div class="line">    attribs[2].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a0fddeb963eb51084566d728179859cce">SetFormat</a>( <a name="a213"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#aae7932c802d0f4b24dc742876d7e3592">nn::mii::DrawParam::UvFormat</a> );</div>
<div class="line">    attribs[2].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a20dafb6550061b2fb68025ec37d1bf6c">SetOffset</a>( <a name="a214"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#aeabb62279183b50f99e47cf7cff31af8">nn::mii::DrawParam::UvOffset</a> );</div>
<div class="line">    attribs[2].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a613bcb4e2f2040d5da9d6b63ffe1dc49">SetShaderSlot</a>( 2 );</div>
<div class="line">    attribs[3].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#af2d6004ad1f4fedce84b3b6d32571807">SetDefault</a>();</div>
<div class="line">    attribs[3].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a7b8b117150c06e6f15645cd370ebee83">SetBufferIndex</a>( 3 );</div>
<div class="line">    attribs[3].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a0fddeb963eb51084566d728179859cce">SetFormat</a>( <a name="a215"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7170665a69564b1fa6733f7e5a089324">nn::mii::DrawParam::ParamFormat</a> );</div>
<div class="line">    attribs[3].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a20dafb6550061b2fb68025ec37d1bf6c">SetOffset</a>( <a name="a216"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#af7c84bb78dad6a8324b35cd580c6a5b0">nn::mii::DrawParam::ParamOffset</a> );</div>
<div class="line">    attribs[3].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a613bcb4e2f2040d5da9d6b63ffe1dc49">SetShaderSlot</a>( 3 );</div>
<div class="line"></div>
<div class="line">    <a name="_a217"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html">nn::gfx::VertexBufferStateInfo</a> buffers[NumAttributes];</div>
<div class="line">    buffers[0].<a name="a218"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a101fb66a31611c4dc43a47db963b23bc">SetDefault</a>();</div>
<div class="line">    buffers[0].<a name="a219"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a93e8020f74cb57101e42aa3c718474fe">SetStride</a>(<a name="a220"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#aabb72e60eb15616c796db847dd6517e7">nn::mii::DrawParam::PositionStride</a>);</div>
<div class="line">    buffers[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a101fb66a31611c4dc43a47db963b23bc">SetDefault</a>();</div>
<div class="line">    buffers[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a93e8020f74cb57101e42aa3c718474fe">SetStride</a>(<a name="a221"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#afc979ffa2ac60965828cac3c1d8c21b0">nn::mii::DrawParam::NormalStride</a>);</div>
<div class="line">    buffers[2].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a101fb66a31611c4dc43a47db963b23bc">SetDefault</a>();</div>
<div class="line">    buffers[2].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a93e8020f74cb57101e42aa3c718474fe">SetStride</a>(<a name="a222"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7fc9e85434355b59436cb830ac400bba">nn::mii::DrawParam::UvStride</a>);</div>
<div class="line">    buffers[3].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a101fb66a31611c4dc43a47db963b23bc">SetDefault</a>();</div>
<div class="line">    buffers[3].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a93e8020f74cb57101e42aa3c718474fe">SetStride</a>(<a name="a223"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a0a5979346dc73af9078674b2ad2561d0">nn::mii::DrawParam::ParamStride</a>);</div>
<div class="line"></div>
<div class="line">    <a name="_a224"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html">nn::gfx::VertexState::InfoType</a> info;</div>
<div class="line">    info.<a name="a225"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html#a288d4df89c521ba94213c28aeda3974f">SetDefault</a>();</div>
<div class="line">    info.<a name="a226"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html#a0c77abd14a547bd4264d4bcb36bba3e3">SetVertexAttributeStateInfoArray</a>(attribs, NumAttributes);</div>
<div class="line">    info.<a name="a227"></a><a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html#ac299c861afc2be2c45c58da4b1ee4bd6">SetVertexBufferStateInfoArray</a>(buffers, NumAttributes);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">size_t</span> size = <a name="a228"></a><a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html#a794f62501ffab3aebd46dc4607536367">nn::gfx::VertexState::GetRequiredMemorySize</a>( info );</div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( <a name="a229"></a><a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html#af160b1c52f080aa17003ae2f76270f04a28f95f8dd0ae4f2463b624523c3ce715">nn::gfx::VertexState::RequiredMemoryInfo_Alignment</a> );</div>
<div class="line">    g_VertexState.<a name="a230"></a><a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html#af340c8323a047f7cbe9911ce4878235b">SetMemory</a>( g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), size );</div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( size );</div>
<div class="line">    g_VertexState.<a name="a231"></a><a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html#abf0b283095f8d47b616588b9e83369b0">Initialize</a>( &amp;g_Device, info, NULL );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html">nn::gfx::VertexState</a> g_VertexStateIcon;</div>
<div class="line"><span class="keywordtype">void</span> InitializeVertexStateIcon()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> NumAttributes = 2;</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html">nn::gfx::VertexStateInfo</a> vertexStateInfo;</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html">nn::gfx::VertexAttributeStateInfo</a> attribute[2];</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html">nn::gfx::VertexBufferStateInfo</a>    buffer[2];</div>
<div class="line">    {</div>
<div class="line">        vertexStateInfo.<a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html#a288d4df89c521ba94213c28aeda3974f">SetDefault</a>();</div>
<div class="line">        {</div>
<div class="line">            attribute[0].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#af2d6004ad1f4fedce84b3b6d32571807">SetDefault</a>();</div>
<div class="line">            attribute[0].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a7b8b117150c06e6f15645cd370ebee83">SetBufferIndex</a>(PositionBufferIndex);</div>
<div class="line">            attribute[0].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a0fddeb963eb51084566d728179859cce">SetFormat</a>(PositionFormat);</div>
<div class="line">            attribute[0].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a20dafb6550061b2fb68025ec37d1bf6c">SetOffset</a>(0);</div>
<div class="line">            attribute[0].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a613bcb4e2f2040d5da9d6b63ffe1dc49">SetShaderSlot</a>(0);</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">            attribute[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#af2d6004ad1f4fedce84b3b6d32571807">SetDefault</a>();</div>
<div class="line">            attribute[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a7b8b117150c06e6f15645cd370ebee83">SetBufferIndex</a>(UvBufferIndex);</div>
<div class="line">            attribute[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a0fddeb963eb51084566d728179859cce">SetFormat</a>(UvFormat);</div>
<div class="line">            attribute[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a20dafb6550061b2fb68025ec37d1bf6c">SetOffset</a>(0);</div>
<div class="line">            attribute[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_attribute_state_info.html#a613bcb4e2f2040d5da9d6b63ffe1dc49">SetShaderSlot</a>(2);</div>
<div class="line">        }</div>
<div class="line">        {</div>
<div class="line">            buffer[0].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a101fb66a31611c4dc43a47db963b23bc">SetDefault</a>();</div>
<div class="line">            buffer[0].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a93e8020f74cb57101e42aa3c718474fe">SetStride</a>(PositionStride);</div>
<div class="line">            buffer[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a101fb66a31611c4dc43a47db963b23bc">SetDefault</a>();</div>
<div class="line">            buffer[1].<a class="code" href="classnn_1_1gfx_1_1_vertex_buffer_state_info.html#a93e8020f74cb57101e42aa3c718474fe">SetStride</a>(UvStride);</div>
<div class="line">        }</div>
<div class="line">        vertexStateInfo.<a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html#a0c77abd14a547bd4264d4bcb36bba3e3">SetVertexAttributeStateInfoArray</a>(attribute, 2);</div>
<div class="line">        vertexStateInfo.<a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html#ac299c861afc2be2c45c58da4b1ee4bd6">SetVertexBufferStateInfoArray</a>(buffer, 2);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html">nn::gfx::VertexState::InfoType</a> info;</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html#a288d4df89c521ba94213c28aeda3974f">SetDefault</a>();</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html#a0c77abd14a547bd4264d4bcb36bba3e3">SetVertexAttributeStateInfoArray</a>(attribute, NumAttributes);</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_vertex_state_info.html#ac299c861afc2be2c45c58da4b1ee4bd6">SetVertexBufferStateInfoArray</a>(buffer, NumAttributes);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">size_t</span> size = <a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html#a794f62501ffab3aebd46dc4607536367">nn::gfx::VertexState::GetRequiredMemorySize</a>(info);</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>(<a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html#af160b1c52f080aa17003ae2f76270f04a28f95f8dd0ae4f2463b624523c3ce715">nn::gfx::VertexState::RequiredMemoryInfo_Alignment</a>);</div>
<div class="line">        g_VertexStateIcon.<a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html#af340c8323a047f7cbe9911ce4878235b">SetMemory</a>(g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), size);</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>(size);</div>
<div class="line">        g_VertexStateIcon.<a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html#abf0b283095f8d47b616588b9e83369b0">Initialize</a>(&amp;g_Device, info, NULL);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> GetDrawTypeForShader(<a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87a">nn::mii::CharModel::DrawType</a> type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span>(type)</div>
<div class="line">    {</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a232"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa9118f9a6f2de0e1ffa4e1b59be9d558a">nn::mii::CharModel::DrawType_Faceline</a>:</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a233"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aacb7cfdbb1c8223cbd71b444a9e89092d">nn::mii::CharModel::DrawType_Hair</a>:</div>
<div class="line">        <span class="keywordflow">return</span> 2;</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a234"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aae50823886d2a214eacb6f14b4aebfb12">nn::mii::CharModel::DrawType_Beard</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a235"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa13ece38440e0ae7489e724027835f82c">nn::mii::CharModel::DrawType_Forehead</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a236"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa834a26d48293989c146ab6a38506f921">nn::mii::CharModel::DrawType_Hat</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a237"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa812e5e1654522a085cf26b523537ff23">nn::mii::CharModel::DrawType_Nose</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a238"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa18d98a09b06eae933d404f464cc56fd0">nn::mii::CharModel::DrawType_Mask</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a239"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aaa6d9bff9c335e1e88199ff2b8550b3c3">nn::mii::CharModel::DrawType_Noseline</a>:</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a240"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa954b22b95beaf1767003cc65fd858463">nn::mii::CharModel::DrawType_Glass</a>:</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <a name="a241"></a><a class="code" href="nn___macro_8h.html#abfe6f7c5f80ef52b7c0616042aba59b9">NN_UNEXPECTED_DEFAULT</a>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Color3の内容をFloat4に設定する</span></div>
<div class="line"><span class="keywordtype">void</span> SetColor(<a class="code" href="structnn_1_1util_1_1_float4.html">nn::util::Float4</a>* pOut,<span class="keyword">const</span> <a name="_a242"></a><a class="code" href="structnn_1_1mii_1_1_color3.html">nn::mii::Color3</a>&amp; src)</div>
<div class="line">{</div>
<div class="line">    pOut-&gt;<a name="a243"></a>x = src.<a name="a244"></a>r;</div>
<div class="line">    pOut-&gt;<a name="a245"></a>y = src.<a name="a246"></a>g;</div>
<div class="line">    pOut-&gt;<a name="a247"></a>z = src.<a name="a248"></a>b;</div>
<div class="line">    pOut-&gt;<a name="a249"></a>w = 1.0f;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> SetupConstantBuffers(<span class="keyword">const</span> <a name="_a250"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html">nn::mii::CharModel</a>&amp; charModel, <span class="keyword">const</span> <a name="_a251"></a><a class="code" href="classnn_1_1mii_1_1_material.html">nn::mii::Material</a>&amp; material)</div>
<div class="line">{</div>
<div class="line">    <a name="_a252"></a><a class="code" href="structnn_1_1mii_1_1_icon_info.html">nn::mii::IconInfo</a> iconInfo;</div>
<div class="line">    <a name="a253"></a><a class="code" href="namespacenn_1_1mii.html#a7bb8e17e56cb8effa8e4d0bfe86ee809">nn::mii::GetIconInfo</a>(&amp;iconInfo);</div>
<div class="line">    <span class="comment">// 各描画のカラー設定を行う</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa140c8eb1aa865374c94a7ad24a0a9f41">nn::mii::CharModel::DrawType_End</a>;++i)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87a">nn::mii::CharModel::DrawType</a> drawType = <a name="a254"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87a">nn::mii::CharModel::DrawType</a>(i);</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> <a name="_a255"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html">nn::mii::DrawParam</a>* pDrawParam = </div>
<div class="line">            charModel.<a name="a256"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#afe79d1d6e4ad8519ea8a55af0259044e">GetDrawParam</a>(</div>
<div class="line">                drawType, <a class="code" href="namespacenn_1_1mii.html#a19f550cb89b2b095417f135888953bb3a10757d3c753282cab6b9b8f25b94dd95">nn::mii::CreateModelType_Normal</a>, <a class="code" href="namespacenn_1_1mii.html#ab1d08064d4a8b9788b5b123bd6a22b21a428e4df9474f8f20a39ddcc01007b244">nn::mii::CreateNoseType_Normal</a>, 0);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (pDrawParam == NULL)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        ConstantBufferModulate* pBuffer = g_ConstantBufferModulate[i].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#ae4ea23c81cbef8a6cd39a378678d2df6">Map</a>&lt;ConstantBufferModulate&gt;();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// 変調種類を設定</span></div>
<div class="line">        pBuffer-&gt;modulateType = pDrawParam-&gt;<a name="a257"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a14b14bd65cb264159c66285da915d45c">GetModulateType</a>();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// 定数カラーを設定</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a name="a258"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#abbf1e6c78b0bab74a5d75f477cad71e7">nn::mii::DrawParam::ConstantColorNum</a>;++j)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="structnn_1_1mii_1_1_color3.html">nn::mii::Color3</a>* srcColor = pDrawParam-&gt;<a name="a259"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a6be150241eafb549add268699be515f4">GetConstantColor</a>(j);</div>
<div class="line">            <span class="keywordflow">if</span> (srcColor == NULL)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            pBuffer-&gt;constantColor[j].x = srcColor-&gt;r;</div>
<div class="line">            pBuffer-&gt;constantColor[j].y = srcColor-&gt;g;</div>
<div class="line">            pBuffer-&gt;constantColor[j].z = srcColor-&gt;b;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// アイコンと同等のライトの向きとカラーを取得する</span></div>
<div class="line">        <span class="comment">// ライトの向き</span></div>
<div class="line">        <span class="keyword">const</span> <a name="_a260"></a><a class="code" href="structnn_1_1util_1_1_float3.html">nn::util::Float3</a>&amp; lightDir = iconInfo.<a name="a261"></a><a class="code" href="structnn_1_1mii_1_1_icon_info.html#a51524c4d81e60300358f63d2c14521f7">lightDir</a>;</div>
<div class="line">        pBuffer-&gt;lightDirInView.x = lightDir.<a name="a262"></a>x;</div>
<div class="line">        pBuffer-&gt;lightDirInView.y = lightDir.<a name="a263"></a>y;</div>
<div class="line">        pBuffer-&gt;lightDirInView.z = lightDir.<a name="a264"></a>z;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ライトのカラー</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="structnn_1_1mii_1_1_color3.html">nn::mii::Color3</a>&amp; lightColor = iconInfo.<a name="a265"></a><a class="code" href="structnn_1_1mii_1_1_icon_info.html#a003f3c8d7916365350f10837d2400c43">lightColor</a>;</div>
<div class="line">        pBuffer-&gt;lightColor.x = lightColor.r;</div>
<div class="line">        pBuffer-&gt;lightColor.y = lightColor.g;</div>
<div class="line">        pBuffer-&gt;lightColor.z = lightColor.b;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ガンマの設定と描画設定を指定します。</span></div>
<div class="line">        pBuffer-&gt;gammaType = <a class="code" href="namespacenn_1_1mii.html#a1ca46f017cb280267571c2c688ba4fa1">GammaType</a>;</div>
<div class="line">        pBuffer-&gt;drawType = GetDrawTypeForShader(drawType);</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// マテリアルにあわせてパラメータを設定します。</span></div>
<div class="line">            <span class="keyword">const</span> <a name="_a266"></a><a class="code" href="structnn_1_1mii_1_1_draw_param_material.html">nn::mii::DrawParamMaterial</a>&amp; drawParamMaterial = material.<a name="a267"></a><a class="code" href="classnn_1_1mii_1_1_material.html#ab3a5728e784e05586e52b950bb2cddac">Get</a>(drawType);</div>
<div class="line">            pBuffer-&gt;halfLambertFactor = drawParamMaterial.<a name="a268"></a><a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#af87f6bdaa2fe70ed40b295cd4d3a15c7">halfLambertFactor</a>;</div>
<div class="line">            pBuffer-&gt;sssSpecularFactor = drawParamMaterial.<a name="a269"></a><a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#a3b46a1f9f4851ce02111bcf520924a1d">sssSpecularBlendFactor</a>;</div>
<div class="line">            SetColor(&amp;pBuffer-&gt;rimColor,drawParamMaterial.<a name="a270"></a><a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#a2a13625f9913869bbb0072128619a626">rimLight</a>.<a name="a271"></a><a class="code" href="structnn_1_1mii_1_1_rim_light_material.html#a985858116f64cc88587c11fc6dda8579">color</a>);</div>
<div class="line">            pBuffer-&gt;rimPower = drawParamMaterial.<a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#a2a13625f9913869bbb0072128619a626">rimLight</a>.<a name="a272"></a><a class="code" href="structnn_1_1mii_1_1_rim_light_material.html#ad086d9eae0f41c6f901b33667f956901">power</a>;</div>
<div class="line">            pBuffer-&gt;rimWidth = drawParamMaterial.<a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#a2a13625f9913869bbb0072128619a626">rimLight</a>.<a name="a273"></a><a class="code" href="structnn_1_1mii_1_1_rim_light_material.html#a6198195d9e8a77dd0b3b0734e5a8b1e5">width</a>;</div>
<div class="line">            SetColor(&amp;pBuffer-&gt;specularColor, drawParamMaterial.<a name="a274"></a><a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#a600abe4ac6aafe98625d6e51090e0a68">specular</a>.<a name="a275"></a><a class="code" href="structnn_1_1mii_1_1_specular_material.html#a5609243888476f529f5df59bec18ec5f">color</a>);</div>
<div class="line">            pBuffer-&gt;specularFactorA = drawParamMaterial.<a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#a600abe4ac6aafe98625d6e51090e0a68">specular</a>.<a name="a276"></a><a class="code" href="structnn_1_1mii_1_1_specular_material.html#a6d3eb21ed1d31812fe76cfb33598721d">factorA</a>;</div>
<div class="line">            pBuffer-&gt;specularFactorB = drawParamMaterial.<a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#a600abe4ac6aafe98625d6e51090e0a68">specular</a>.<a name="a277"></a><a class="code" href="structnn_1_1mii_1_1_specular_material.html#a314caa333f137fd76adac9b842221a08">factorB</a>;</div>
<div class="line">            pBuffer-&gt;specularShinness = drawParamMaterial.<a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#a600abe4ac6aafe98625d6e51090e0a68">specular</a>.<a name="a278"></a><a class="code" href="structnn_1_1mii_1_1_specular_material.html#a44cdbe40ad7baa8d6eefdb1c566cf89c">shinness</a>;</div>
<div class="line">            SetColor(&amp;pBuffer-&gt;sssColor, drawParamMaterial.<a name="a279"></a><a class="code" href="structnn_1_1mii_1_1_draw_param_material.html#af200a74e1d103da246582e3ab1151e45">sssColor</a>);</div>
<div class="line">        }</div>
<div class="line">        g_ConstantBufferModulate[i].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a8a5e6d06cc7f541da91237ddf540f4b8">Unmap</a>();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="_a280"></a><a class="code" href="classnn_1_1gfx_1_1_t_texture.html">nn::gfx::Texture</a> g_DepthStencilTexture;</div>
<div class="line"><a name="_a281"></a><a class="code" href="classnn_1_1gfx_1_1_t_depth_stencil_view.html">nn::gfx::DepthStencilView</a> g_DepthStencilView;</div>
<div class="line"><span class="keywordtype">void</span> InitializeDepthStencilTextureAndView()</div>
<div class="line">{</div>
<div class="line">    {</div>
<div class="line">        <a name="_a282"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html">nn::gfx::Texture::InfoType</a> info;</div>
<div class="line">        info.<a name="a283"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a7347a6f3179dc816dc7eb761cdc37152">SetDefault</a>();</div>
<div class="line">        info.<a name="a284"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#ac1912ab092b3f1acd897e96ea4eb7ffc">SetImageStorageDimension</a>(<a name="a285"></a><a class="code" href="namespacenn_1_1gfx.html#a52703c69a29adb8ba4cf3d02c6be65d6aeecfd005f00573cce0430313e61bc33e">nn::gfx::ImageStorageDimension_2d</a>);</div>
<div class="line">        info.<a name="a286"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#aabd5c4ee3aaf0dfc3577843da1d8bc1f">SetImageFormat</a>(DepthStencilFormat);</div>
<div class="line">        info.<a name="a287"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a214c396c13c6086b75cf63dc374f14ab">SetGpuAccessFlags</a>(<a name="a288"></a><a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a1663c5652d151ae04844adb9a3784bea">nn::gfx::GpuAccess_DepthStencil</a>);</div>
<div class="line">        info.<a name="a289"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a8c5d2d45349d88498a860af810a23727">SetTileMode</a>(<a name="a290"></a><a class="code" href="namespacenn_1_1gfx.html#a35d6955da6f9f2af739d26025bce7502aee2025e5d379e35eff8063fb7bedf3e0">nn::gfx::TileMode_Optimal</a>);</div>
<div class="line">        info.<a name="a291"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#aa9542aaf7fe4dea102f8ec01188c3227">SetWidth</a>(g_DisplayWidth);</div>
<div class="line">        info.<a name="a292"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a2351f69b4b5c3bece70bfc416a74f96a">SetHeight</a>(g_DisplayHeight);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">size_t</span> alignment = <a name="a293"></a><a class="code" href="classnn_1_1gfx_1_1_t_texture.html#a6580c829bab613b6e9850e543f9a7203">nn::gfx::Texture::CalculateMipDataAlignment</a>(&amp;g_Device, info);</div>
<div class="line">        <span class="keywordtype">size_t</span> size = <a name="a294"></a><a class="code" href="classnn_1_1gfx_1_1_t_texture.html#ac9d3334566c6451da3f015e5ed1fd1ad">nn::gfx::Texture::CalculateMipDataSize</a>(&amp;g_Device, info);</div>
<div class="line"></div>
<div class="line">        g_CachedCompressMemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_CachedCompressMemoryPoolOffset, alignment );</div>
<div class="line"></div>
<div class="line">        g_DepthStencilTexture.<a name="a295"></a><a class="code" href="classnn_1_1gfx_1_1_t_texture.html#a8b733d649540691011c2ca3949cd5620">Initialize</a>( &amp;g_Device, info</div>
<div class="line">            , &amp;g_CachedCompressMemoryPool</div>
<div class="line">            , g_CachedCompressMemoryPoolOffset</div>
<div class="line">            , size );</div>
<div class="line"></div>
<div class="line">        g_CachedCompressMemoryPoolOffset += size;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <a name="_a296"></a><a class="code" href="classnn_1_1gfx_1_1_depth_stencil_view_info.html">nn::gfx::DepthStencilViewInfo</a> info;</div>
<div class="line">        info.<a name="a297"></a><a class="code" href="classnn_1_1gfx_1_1_depth_stencil_view_info.html#a3398861ad8d8a8caad22f50b725bf8a7">SetDefault</a>();</div>
<div class="line">        info.<a name="a298"></a><a class="code" href="classnn_1_1gfx_1_1_depth_stencil_view_info.html#ac3d84bfc8d50531d6270e0c8b328bcac">SetImageDimension</a>(<a name="a299"></a><a class="code" href="namespacenn_1_1gfx.html#ae5b7c631f74a2dbfeff59cc3764d488fa292e541aac404ecfc004b8ed4f98bbc9">nn::gfx::ImageDimension_2d</a>);</div>
<div class="line">        info.<a name="a300"></a><a class="code" href="classnn_1_1gfx_1_1_depth_stencil_view_info.html#acee0a53717ae441a6dc257d09478c2e2">SetMipLevel</a>(0);</div>
<div class="line">        info.<a name="a301"></a><a class="code" href="classnn_1_1gfx_1_1_depth_stencil_view_info.html#a0f517ffb3e39c0a96efcbb6b42e5b227">SetTexturePtr</a>(&amp;g_DepthStencilTexture);</div>
<div class="line">        g_DepthStencilView.<a name="a302"></a><a class="code" href="classnn_1_1gfx_1_1_t_depth_stencil_view.html#ab49a5deea867df6acae96bcf5a871a68">Initialize</a>(&amp;g_Device, info);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="_a303"></a><a class="code" href="classnn_1_1gfx_1_1_t_semaphore.html">nn::gfx::Semaphore</a> g_DisplaySemaphore;</div>
<div class="line"><span class="keywordtype">void</span> <a name="a304"></a><a class="code" href="namespacenn_1_1os.html#af76bc96a9333f18ed5d7bead209eb4f3">InitializeSemaphore</a>()</div>
<div class="line">{</div>
<div class="line">    <a name="_a305"></a><a class="code" href="classnn_1_1gfx_1_1_semaphore_info.html">nn::gfx::Semaphore::InfoType</a> info;</div>
<div class="line">    info.<a name="a306"></a><a class="code" href="classnn_1_1gfx_1_1_semaphore_info.html#a18ee4aa527ccd678bcb4a179e691e386">SetDefault</a>();</div>
<div class="line">    g_DisplaySemaphore.<a name="a307"></a><a class="code" href="classnn_1_1gfx_1_1_t_semaphore.html#a99f73266b33792c6918fcdd812ef038c">Initialize</a>( &amp;g_Device, info );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a name="_a308"></a><a class="code" href="classnn_1_1gfx_1_1_t_fence.html">nn::gfx::Fence</a> g_DisplayFence;</div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_fence.html">nn::gfx::Fence</a> g_GpuDoneFence;</div>
<div class="line"><span class="keywordtype">void</span> InitializeFence()</div>
<div class="line">{</div>
<div class="line">    <a name="_a309"></a><a class="code" href="classnn_1_1gfx_1_1_fence_info.html">nn::gfx::Fence::InfoType</a> info;</div>
<div class="line">    info.<a name="a310"></a><a class="code" href="classnn_1_1gfx_1_1_fence_info.html#add8ed7191d969495cb46b560192b595d">SetDefault</a>();</div>
<div class="line">    g_DisplayFence.<a name="a311"></a><a class="code" href="classnn_1_1gfx_1_1_t_fence.html#a8d7ff4eb26bd5eae8beac1058ee58d30">Initialize</a>( &amp;g_Device, info );</div>
<div class="line">    g_GpuDoneFence.<a class="code" href="classnn_1_1gfx_1_1_t_fence.html#a8d7ff4eb26bd5eae8beac1058ee58d30">Initialize</a>( &amp;g_Device, info );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> InitializeResources()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// メモリ</span></div>
<div class="line">    g_pMemoryHeap.<a name="a312"></a><a class="code" href="classnn_1_1util_1_1_byte_ptr.html#ab1bb92c783f155e2be3e84bd02bcfd61">Reset</a>( malloc( MemorySize ) );</div>
<div class="line">    g_pMemory = g_pMemoryHeap;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// レイヤの初期化</span></div>
<div class="line">    <a name="a313"></a><a class="code" href="namespacenn_1_1vi.html#acecc11f3b92d6d1e0c6b5d056d4b05fd">nn::vi::Initialize</a>();</div>
<div class="line">    InitializeLayer();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// gfxライブラリを初期化</span></div>
<div class="line">    <a name="a314"></a><a class="code" href="namespacenn_1_1gfx.html#a7fdc6aeebf1a1d6cc8a8893bcc3fd128">nn::gfx::Initialize</a>();</div>
<div class="line"></div>
<div class="line">    InitializeDevice();</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if NN_GFX_IS_TARGET_NVN</span></div>
<div class="line">    nn::gfx::Device::DataType&amp; deviceData = <a name="a315"></a><a class="code" href="namespacenn_1_1gfx.html#adbafa89439698491beeecbdb1613de50">nn::gfx::AccessorToData</a>( g_Device );</div>
<div class="line">    <a name="a316"></a><a class="code" href="group__nvn__c__functions.html#ga6f739de39c3818a65b190be3a82cf891">nvnDeviceGetInteger</a>( deviceData.pNvnDevice,</div>
<div class="line">        <a name="a317"></a><a class="code" href="group__nvn__c__enum.html#ggac887e20e2474bb76b87943b0f0be7a50a513596e8b2dc04714d6478aed173a891">NVN_DEVICE_INFO_RESERVED_TEXTURE_DESCRIPTORS</a>, &amp;g_TextureDescriptorBaseIndex );</div>
<div class="line">    <a class="code" href="group__nvn__c__functions.html#ga6f739de39c3818a65b190be3a82cf891">nvnDeviceGetInteger</a>( deviceData.pNvnDevice,</div>
<div class="line">        <a name="a318"></a><a class="code" href="group__nvn__c__enum.html#ggac887e20e2474bb76b87943b0f0be7a50a5b9a26a5aadab05c4a9f8a286718fbc7">NVN_DEVICE_INFO_RESERVED_SAMPLER_DESCRIPTORS</a>, &amp;g_SamplerDescriptorBaseIndex );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    InitializeMemoryPool();</div>
<div class="line">    InitializeCachedMemoryPool();</div>
<div class="line">    InitializeCachedCompressMemoryPool();</div>
<div class="line"></div>
<div class="line">    InitializeSwapChain();</div>
<div class="line">    InitializeQueue();</div>
<div class="line"></div>
<div class="line">    InitializeCommandBuffer();</div>
<div class="line">    InitializeViewport();</div>
<div class="line">    InitializeDepthStencilTextureAndView();</div>
<div class="line"></div>
<div class="line">    InitializeShader();</div>
<div class="line">    InitializeRasterizerState();</div>
<div class="line">    InitializeBlendState();</div>
<div class="line">    InitializeDepthStencilState();</div>
<div class="line">    InitializeVertexState();</div>
<div class="line">    InitializeVertexStateIcon();</div>
<div class="line"></div>
<div class="line">    InitializePositionBuffer();</div>
<div class="line">    InitializeUvBuffer();</div>
<div class="line">    InitializeIndexBuffer();</div>
<div class="line">    InitializeConstantBuffer();</div>
<div class="line"></div>
<div class="line">    InitializeSamplerDescriptorPool();</div>
<div class="line">    InitializeTextureDescriptorPool();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="namespacenn_1_1os.html#af76bc96a9333f18ed5d7bead209eb4f3">InitializeSemaphore</a>();</div>
<div class="line">    InitializeFence();</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( g_pMemoryHeap.<a name="a319"></a><a class="code" href="classnn_1_1util_1_1_byte_ptr.html#ab2e58750b882b4b7afb7d3930afef5f7">Distance</a>( g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>() ) &lt; 1024 * 1024 );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( g_MemoryPoolOffset &lt; VisiblePoolMemorySize );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( g_CachedMemoryPoolOffset &lt; CachedPoolMemorySize );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( g_CachedCompressMemoryPoolOffset &lt; CachedCompressPoolMemorySize );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> FinalizeResources()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// 各オブジェクトを破棄</span></div>
<div class="line">    g_GpuDoneFence.<a name="a320"></a><a class="code" href="classnn_1_1gfx_1_1_t_fence.html#a01e22e4949f3b06cb8120da6f7161d81">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_DisplayFence.<a class="code" href="classnn_1_1gfx_1_1_t_fence.html#a01e22e4949f3b06cb8120da6f7161d81">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_DisplaySemaphore.<a name="a321"></a><a class="code" href="classnn_1_1gfx_1_1_t_semaphore.html#aacacbf82b1b02a9739de5e90e3171934">Finalize</a>( &amp;g_Device );</div>
<div class="line"></div>
<div class="line">    g_TextureDescriptorPool.<a name="a322"></a><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#ab1876c09dc1056b8c9838530b70da015">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_SamplerDescriptorPool.<a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#ab1876c09dc1056b8c9838530b70da015">Finalize</a>( &amp;g_Device );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; DrawType_End; i++ )</div>
<div class="line">    {</div>
<div class="line">        g_ConstantBuffer[i].<a name="a323"></a><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a208391f1e05916badd0ed1709ee7ae39">Finalize</a>(&amp;g_Device);   </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a name="a324"></a><a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(g_ConstantBufferModulate); ++i)</div>
<div class="line">    {</div>
<div class="line">        g_ConstantBufferModulate[i].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a208391f1e05916badd0ed1709ee7ae39">Finalize</a>(&amp;g_Device);</div>
<div class="line">    }</div>
<div class="line">    g_ConstantBufferModulateIcon.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a208391f1e05916badd0ed1709ee7ae39">Finalize</a>(&amp;g_Device);</div>
<div class="line">    g_IndexBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a208391f1e05916badd0ed1709ee7ae39">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_UvBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a208391f1e05916badd0ed1709ee7ae39">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_PositionBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a208391f1e05916badd0ed1709ee7ae39">Finalize</a>( &amp;g_Device );</div>
<div class="line"></div>
<div class="line">    g_VertexState.<a name="a325"></a><a class="code" href="classnn_1_1gfx_1_1_t_vertex_state.html#a19e30cf38c0013dac475066d821abe11">Finalize</a>(&amp;g_Device);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; DrawMode_End;++i)</div>
<div class="line">    {</div>
<div class="line">        g_BlendState[i].<a name="a326"></a><a class="code" href="classnn_1_1gfx_1_1_t_blend_state.html#a6f473591839db9f6414ae43c5c00a8a9">Finalize</a>( &amp;g_Device);</div>
<div class="line">        g_DepthStencilState[i].<a name="a327"></a><a class="code" href="classnn_1_1gfx_1_1_t_depth_stencil_state.html#a2bfe347fcec21f7e1a1c5cf1b1a2a430">Finalize</a>(&amp;g_Device);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nn::gfx::CullMode_End;++i)</div>
<div class="line">    {</div>
<div class="line">        g_RasterizerState[i].<a name="a328"></a><a class="code" href="classnn_1_1gfx_1_1_t_rasterizer_state.html#a5b5201bf723256cd010bdc073255ead8">Finalize</a>(&amp;g_Device);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    FinalizeResShaderFile( g_pResShaderFile , g_ShaderCodeType );</div>
<div class="line"></div>
<div class="line">    g_ViewportScissor.<a name="a329"></a><a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html#abe11609e98c342a9739bc67d2e18d50f">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_CommandBuffer.<a name="a330"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a9f586139056ebe1b952e2aebe4be9cdf">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_SwapChain.<a name="a331"></a><a class="code" href="classnn_1_1gfx_1_1_t_swap_chain.html#a9c688b45bc96aa437db41130d9c9993c">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_Queue.<a name="a332"></a><a class="code" href="classnn_1_1gfx_1_1_t_queue.html#acf2af9f9d16498d6bd45f72d3a79b567">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_CachedCompressMemoryPool.<a name="a333"></a><a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#aad1f3e656aea98302fd5266262a46441">Finalize</a>(&amp;g_Device);</div>
<div class="line">    g_CachedMemoryPool.<a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#aad1f3e656aea98302fd5266262a46441">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_MemoryPool.<a class="code" href="classnn_1_1gfx_1_1_t_memory_pool.html#aad1f3e656aea98302fd5266262a46441">Finalize</a>( &amp;g_Device );</div>
<div class="line">    g_Device.<a name="a334"></a><a class="code" href="classnn_1_1gfx_1_1_t_device.html#a6a6db34b0acc447ff87e6d07e813ae0b">Finalize</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ライブラリを終了</span></div>
<div class="line">    <a name="a335"></a><a class="code" href="namespacenn_1_1gfx.html#a8e776d92173c3073b31a5cf65e306dfc">nn::gfx::Finalize</a>();</div>
<div class="line"></div>
<div class="line">    <a name="a336"></a><a class="code" href="namespacenn_1_1vi.html#a76acdc780c2ad611533182993df1cebe">nn::vi::DestroyLayer</a>(g_pLayer);</div>
<div class="line">    <a name="a337"></a><a class="code" href="namespacenn_1_1vi.html#a68ddf473ecdaf1c52996a2f7fad2ef61">nn::vi::CloseDisplay</a>(g_pDisplay);</div>
<div class="line">    <a name="a338"></a><a class="code" href="namespacenn_1_1vi.html#a7451676fd7f7b48369ff4c01a1fa91dd">nn::vi::Finalize</a>();</div>
<div class="line"></div>
<div class="line">    free( g_pMemoryHeap.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>() );</div>
<div class="line">    free( g_pVisiblePoolMemory );</div>
<div class="line">    free( g_pCachedPoolMemory );</div>
<div class="line">    free( g_pCachedCompressPoolMemory );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* Allocate( <span class="keywordtype">size_t</span> size )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> malloc( size );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> Deallocate( <span class="keywordtype">void</span>* ptr, <span class="keywordtype">size_t</span> )</div>
<div class="line">{</div>
<div class="line">    free( ptr );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined( NN_BUILD_CONFIG_OS_SUPPORTS_HORIZON ) &amp;&amp; defined( NN_BUILD_CONFIG_SPEC_NX )</span></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// グラフィックスシステム用メモリ割り当て・破棄関数</span></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>* NvAllocateFunction(<span class="keywordtype">size_t</span> size, <span class="keywordtype">size_t</span> alignment, <span class="keywordtype">void</span>* userPtr)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(userPtr);</div>
<div class="line">    <span class="keywordflow">return</span> aligned_alloc(alignment, <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>(size, alignment));</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> NvFreeFunction(<span class="keywordtype">void</span>* addr, <span class="keywordtype">void</span>* userPtr)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(userPtr);</div>
<div class="line">    free(addr);</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>* NvReallocateFunction(<span class="keywordtype">void</span>* addr, <span class="keywordtype">size_t</span> newSize, <span class="keywordtype">void</span>* userPtr)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(userPtr);</div>
<div class="line">    <span class="keywordflow">return</span> realloc(addr, newSize);</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span>* g_pFsCacheBuffer = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="keywordtype">void</span> InitializeFs()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result;</div>
<div class="line"></div>
<div class="line">    <a name="a339"></a><a class="code" href="namespacenn_1_1fs.html#ac021c163ba94a44a2b53cb848c462930">nn::fs::SetAllocator</a>( Allocate, Deallocate );</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// キャッシュ用のバッファを確保</span></div>
<div class="line">    <span class="keywordtype">size_t</span> cacheSize;</div>
<div class="line">    result = <a name="a340"></a><a class="code" href="namespacenn_1_1fs.html#a5df6e3385c795a5bd046790ef7f17f2d">nn::fs::QueryMountRomCacheSize</a>(&amp;cacheSize);</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    g_pFsCacheBuffer = malloc(cacheSize);</div>
<div class="line">    <span class="comment">// ROMをマウント</span></div>
<div class="line">    result = <a name="a341"></a><a class="code" href="namespacenn_1_1fs.html#a2e453fe1fbf8f818dc45bbd2897105cd">nn::fs::MountRom</a>(<span class="stringliteral">&quot;Contents&quot;</span>,g_pFsCacheBuffer,cacheSize);</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>( result );</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> FinalizeFs()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(g_pFsCacheBuffer)</div>
<div class="line">    {</div>
<div class="line">        free(g_pFsCacheBuffer);</div>
<div class="line">        g_pFsCacheBuffer = <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line">    <a name="a342"></a><a class="code" href="namespacenn_1_1fs.html#ac8a95249afd4a87a55d319dfecb0466c">nn::fs::Unmount</a>(<span class="stringliteral">&quot;Contents&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// 指定したパスのファイルサイズを取得する。</span></div>
<div class="line"><span class="keywordtype">size_t</span> <a class="code" href="namespacenn_1_1fs.html#aba29e01d386e809349d60eccdb15ff21">GetFileSize</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* path )</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="structnn_1_1fs_1_1_file_handle.html">nn::fs::FileHandle</a> handle;</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a class="code" href="namespacenn_1_1fs.html#a0f2b5b30657b1ffaf1dec49bfb36462b">nn::fs::OpenFile</a>( &amp;handle, path, <a class="code" href="namespacenn_1_1fs.html#a4c97b79cce78a95c2333dbc9053b9393afde4472d2b455879cad02aade386ac0d">nn::fs::OpenMode_Read</a> );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line"></div>
<div class="line">    int64_t size;</div>
<div class="line">    result = <a class="code" href="namespacenn_1_1fs.html#aba29e01d386e809349d60eccdb15ff21">nn::fs::GetFileSize</a>( &amp;size, handle );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="namespacenn_1_1fs.html#ac8bd9e828751bd4f953acfa765278f84">nn::fs::CloseFile</a>( handle );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>( size );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// 指定したパスのファイルを受け取ったバッファに書き込む</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacenn_1_1fs.html#a81801a404563984f8c6cc1483cc6d730">ReadFile</a>( <span class="keywordtype">void</span>* buffer, <span class="keywordtype">size_t</span> bufferSize, <span class="keyword">const</span> <span class="keywordtype">char</span>* path )</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> fileSize = <a class="code" href="namespacenn_1_1fs.html#aba29e01d386e809349d60eccdb15ff21">GetFileSize</a>( path );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( fileSize &lt;= bufferSize );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structnn_1_1fs_1_1_file_handle.html">nn::fs::FileHandle</a> handle;</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a class="code" href="namespacenn_1_1fs.html#a0f2b5b30657b1ffaf1dec49bfb36462b">nn::fs::OpenFile</a>( &amp;handle, path, <a class="code" href="namespacenn_1_1fs.html#a4c97b79cce78a95c2333dbc9053b9393afde4472d2b455879cad02aade386ac0d">nn::fs::OpenMode_Read</a> );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> int64_t offset = 0;</div>
<div class="line">    <span class="keywordtype">size_t</span> readSize;</div>
<div class="line">    result = <a class="code" href="namespacenn_1_1fs.html#a81801a404563984f8c6cc1483cc6d730">nn::fs::ReadFile</a>( &amp;readSize, handle, offset, buffer, fileSize );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( readSize == fileSize );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="namespacenn_1_1fs.html#ac8bd9e828751bd4f953acfa765278f84">nn::fs::CloseFile</a>( handle );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// nn::mii::Resourceの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeResource(</div>
<div class="line">    <a name="_a343"></a><a class="code" href="classnn_1_1mii_1_1_resource.html">nn::mii::Resource</a>* pResource, <span class="keyword">const</span> <a name="_a344"></a><a class="code" href="classnn_1_1mii_1_1_resource_info.html">nn::mii::ResourceInfo</a>&amp; resourceInfo,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">void</span>* pTextureResource, <span class="keywordtype">size_t</span> textureResourceSize,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">void</span>* pShapeResource, <span class="keywordtype">size_t</span> shapeResourceSize)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memorySize =</div>
<div class="line">        <a name="a345"></a><a class="code" href="classnn_1_1mii_1_1_resource.html#aa6097e0d51b3e3acd90c7475c52f559d">nn::mii::Resource::CalculateMemorySize</a>( </div>
<div class="line">        pTextureResource, textureResourceSize, pShapeResource, shapeResourceSize, resourceInfo );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryAlignment =</div>
<div class="line">        <a name="a346"></a><a class="code" href="classnn_1_1mii_1_1_resource.html#a17059bf1ed833c88220b7fd84db48cb7">nn::mii::Resource::CalculateMemoryAlignment</a>(</div>
<div class="line">        pTextureResource, textureResourceSize, pShapeResource, shapeResourceSize, resourceInfo);</div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( memoryAlignment );</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = pResource-&gt;<a name="a347"></a><a class="code" href="classnn_1_1mii_1_1_resource.html#afe1c72500638202d3eecf1cdeaa331c2">Initialize</a>(</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), memorySize,</div>
<div class="line">        pTextureResource, textureResourceSize, pShapeResource, shapeResourceSize,</div>
<div class="line">        resourceInfo, &amp;g_Device</div>
<div class="line">        );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( pResource-&gt;<a name="a348"></a><a class="code" href="classnn_1_1mii_1_1_resource.html#a22b7b467c6d49896253bb68d8f2f270b">IsInitialized</a>() );</div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( memorySize );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// nn::mii::CharModelの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeCharModel(<a class="code" href="classnn_1_1mii_1_1_char_model.html">nn::mii::CharModel</a>* pCharModel, </div>
<div class="line">    <span class="keyword">const</span> <a name="_a349"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html">nn::mii::CharModelInfo</a>&amp; charModelInfo,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_resource.html">nn::mii::Resource</a>&amp; resource, </div>
<div class="line">    <span class="keyword">const</span> <a name="_a350"></a><a class="code" href="structnn_1_1mii_1_1_char_info.html">nn::mii::CharInfo</a>&amp; charInfo</div>
<div class="line">    )</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memorySize =</div>
<div class="line">        <a name="a351"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a6d35d6786de2ac9f5e8e7e2d143eee9d">nn::mii::CharModel::CalculateMemorySize</a>( charModelInfo );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryAlignment =</div>
<div class="line">        <a name="a352"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#afe5e62d98c1b9ec78a2785bee2aa75c6">nn::mii::CharModel::CalculateMemoryAlignment</a>( charModelInfo );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 動的メモリプールのサイズとアライメントの取得</span></div>
<div class="line">    <span class="comment">// Faceline や Mask テクスチャ用メモリプールです。</span></div>
<div class="line">    <span class="comment">// レンダーターゲットとなるテクスチャを初期化するためのメモリプールのため、Compress 設定をしたメモリプールを渡しています。</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> dynamicMemoryPoolAlignment = </div>
<div class="line">        <a name="a353"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#af6fee313566c79a1ef2104ad9f4ec3d9">nn::mii::CharModel::CalculateDynamicMemoryPoolAlignment</a>( &amp;g_Device, charModelInfo );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> dynamicMemoryPoolSize = </div>
<div class="line">        <a name="a354"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a8fb37cf2bae0239ce35abb7ee3af6083">nn::mii::CharModel::CalculateDynamicMemoryPoolSize</a>( &amp;g_Device, charModelInfo );</div>
<div class="line">    <span class="comment">// 静的メモリプールのサイズとアライメントの取得</span></div>
<div class="line">    <span class="comment">// Faceline や Mask テクスチャ以外のテクスチャやシェイプを初期化するためのメモリプールです。</span></div>
<div class="line">    <span class="comment">// レンダーターゲットとなるテクスチャの初期化には使用されないメモリプールのため、Compress 設定は不要です。</span></div>
<div class="line">    <span class="keywordtype">size_t</span> staticMemoryPoolAlignment = <a name="a355"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a3cf9d77b6ba64a1e365b9ce1a00a8d85">nn::mii::CharModel::CalculateStaticMemoryPoolAlignment</a>(resource);</div>
<div class="line">    <span class="keywordtype">size_t</span> staticMemoryPoolSize = <a name="a356"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a03cafeba68ee2d5649154b499c35e3f1">nn::mii::CharModel::CalculateStaticMemoryPoolSize</a>(resource);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アライメント調整</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>(memoryAlignment);</div>
<div class="line">    g_CachedCompressMemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_CachedCompressMemoryPoolOffset, dynamicMemoryPoolAlignment );</div>
<div class="line">    g_CachedMemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_CachedMemoryPoolOffset, staticMemoryPoolAlignment );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 一時バッファの作成</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> temporaryBufferSize = <a name="a357"></a><a class="code" href="namespacenn_1_1mii.html#adf1ea594817b755b9c83abaaf66fcf6f">nn::mii::TemporaryBufferSize</a>;</div>
<div class="line">    <span class="keywordtype">void</span>* buffer = malloc( temporaryBufferSize );</div>
<div class="line">    <a class="code" href="classnn_1_1util_1_1_byte_ptr.html">nn::util::BytePtr</a> temporaryBuffer( buffer );</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = pCharModel-&gt;<a name="a358"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#ae1130100a72ab5e7ccee91dc155864aa">Initialize</a>( g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), memorySize, &amp;g_Device,</div>
<div class="line">        &amp;g_CachedCompressMemoryPool, g_CachedCompressMemoryPoolOffset, dynamicMemoryPoolSize,</div>
<div class="line">        &amp;g_CachedMemoryPool, g_CachedMemoryPoolOffset, staticMemoryPoolSize,</div>
<div class="line">        resource, temporaryBuffer.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>&lt;<a name="_a359"></a><a class="code" href="structnn_1_1mii_1_1_temporary_buffer.html">nn::mii::TemporaryBuffer</a>&gt;(),</div>
<div class="line">        charModelInfo, charInfo );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( pCharModel-&gt;<a name="a360"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#ac8eaf071b2bc6e5767a487db2f55380a">IsInitialized</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 一時バッファを破棄</span></div>
<div class="line">    free( buffer );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 各メモリのオフセットを進める。</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( memorySize );</div>
<div class="line">    <span class="comment">// メモリープールのオフセット位置を更新</span></div>
<div class="line">    g_CachedCompressMemoryPoolOffset += dynamicMemoryPoolSize;</div>
<div class="line">    g_CachedMemoryPoolOffset += staticMemoryPoolSize;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// nn::mii::Facelineの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeFaceline(<a name="_a361"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html">nn::mii::Faceline</a>* pFaceline, </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_resource.html">nn::mii::Resource</a>&amp; resource, <span class="keyword">const</span> <a class="code" href="structnn_1_1mii_1_1_char_info.html">nn::mii::CharInfo</a>&amp; charInfo)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memorySize = <a name="a362"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#aeaaab76dfeae3db16e5a9e10df7645f6">nn::mii::Faceline::CalculateMemorySize</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryAlignment = <a name="a363"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#a821dda7b911eabc22b3737c269d2f89b">nn::mii::Faceline::CalculateMemoryAlignment</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolSize =</div>
<div class="line">        <a name="a364"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#a047e5588833ded6e754dbace5e12938c">nn::mii::Faceline::CalculateMemoryPoolSize</a>( &amp;g_Device, resource );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolAlignment =</div>
<div class="line">        <a name="a365"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#a015540d617c673d2b08c2a62e6d31907">nn::mii::Faceline::CalculateMemoryPoolAlignment</a>( &amp;g_Device, resource );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> temporaryBufferSize = <a class="code" href="namespacenn_1_1mii.html#adf1ea594817b755b9c83abaaf66fcf6f">nn::mii::TemporaryBufferSize</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アライメントの調整</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( memoryAlignment );</div>
<div class="line">    g_CachedMemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_CachedMemoryPoolOffset, memoryPoolAlignment );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 一時バッファの作成</span></div>
<div class="line">    <span class="keywordtype">void</span>* buffer = malloc( temporaryBufferSize );</div>
<div class="line">    <a class="code" href="classnn_1_1util_1_1_byte_ptr.html">nn::util::BytePtr</a> temporaryBuffer( buffer );</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = pFaceline-&gt;<a name="a366"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#a14ee4397d72f464be2d6a1a21ee2ad70">Initialize</a>(</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), memorySize, &amp;g_Device,</div>
<div class="line">        &amp;g_CachedMemoryPool, g_CachedMemoryPoolOffset, memoryPoolSize,</div>
<div class="line">        temporaryBuffer.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>&lt;<a class="code" href="structnn_1_1mii_1_1_temporary_buffer.html">nn::mii::TemporaryBuffer</a>&gt;(), resource, charInfo, IsVerticalFlip );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( pFaceline-&gt;<a name="a367"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#a92472ae20d7fbb2204863def9857604c">IsInitialized</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 一時バッファを破棄</span></div>
<div class="line">    free( buffer );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 使用した分だけメモリのオフセットを進める</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( memorySize );</div>
<div class="line">    g_CachedMemoryPoolOffset += memoryPoolSize;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// nn::mii::Maskの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeMask(<a name="_a368"></a><a class="code" href="classnn_1_1mii_1_1_mask.html">nn::mii::Mask</a>* pMask, <span class="keywordtype">int</span> expressionFlag,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_resource.html">nn::mii::Resource</a>&amp; resource, <span class="keyword">const</span> <a class="code" href="structnn_1_1mii_1_1_char_info.html">nn::mii::CharInfo</a>&amp; charInfo)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memorySize = <a name="a369"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#ada219c5ca703bcbac6cfd1b1152a0014">nn::mii::Mask::CalculateMemorySize</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryAlignment = <a name="a370"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#a1d3f938e3b66f4723f77945c7053d132">nn::mii::Mask::CalculateMemoryAlignment</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolSize =</div>
<div class="line">        <a name="a371"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#ab48643fffb947349f92489c8c8f13ab1">nn::mii::Mask::CalculateMemoryPoolSize</a>( &amp;g_Device, resource, expressionFlag );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolAlignment =</div>
<div class="line">        <a name="a372"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#a50a254acc284f00b22038765692eb08e">nn::mii::Mask::CalculateMemoryPoolAlignment</a>( &amp;g_Device, resource, expressionFlag );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> temporaryBufferSize = <a class="code" href="namespacenn_1_1mii.html#adf1ea594817b755b9c83abaaf66fcf6f">nn::mii::TemporaryBufferSize</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アライメントの調整</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( memoryAlignment );</div>
<div class="line">    g_CachedMemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_CachedMemoryPoolOffset, memoryPoolAlignment );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 一時バッファの作成</span></div>
<div class="line">    <span class="keywordtype">void</span>* buffer = malloc( temporaryBufferSize );</div>
<div class="line">    <a class="code" href="classnn_1_1util_1_1_byte_ptr.html">nn::util::BytePtr</a> temporaryBuffer( buffer );</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = pMask-&gt;<a name="a373"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#a77a346dd83fb3ea739dc6bd03f8a80d7">Initialize</a>( g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), memorySize, &amp;g_Device,</div>
<div class="line">        &amp;g_CachedMemoryPool, g_CachedMemoryPoolOffset, memoryPoolSize,</div>
<div class="line">        temporaryBuffer.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>&lt;<a class="code" href="structnn_1_1mii_1_1_temporary_buffer.html">nn::mii::TemporaryBuffer</a>&gt;(), resource, charInfo, expressionFlag, IsVerticalFlip );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( pMask-&gt;<a name="a374"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#ad208bc43a6c062c1ded75e927c1b4327">IsInitialized</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 一時バッファを破棄</span></div>
<div class="line">    free( buffer );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 使用した分だけメモリのオフセットを進める</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( memorySize );</div>
<div class="line">    g_CachedMemoryPoolOffset += memoryPoolSize;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// それぞれのテクスチャに対してデスクリプタスロットを付与</span></div>
<div class="line"><span class="keywordtype">void</span> SetTextureDescriptorSlot(</div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_char_model.html">nn::mii::CharModel</a>* pCharModel, <a class="code" href="classnn_1_1mii_1_1_faceline.html">nn::mii::Faceline</a>* pFaceline, </div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_mask.html">nn::mii::Mask</a>* pMask, <span class="keywordtype">int</span> maskIndex)</div>
<div class="line">{</div>
<div class="line">    g_TextureDescriptorPool.<a name="a375"></a><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#acf7f87de8d82282810176876267e9e43">BeginUpdate</a>();</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// CharModelが持つ各テクスチャに対してデスクリプタスロットを付与</span></div>
<div class="line">        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> idx = 0; idx &lt; <a name="a376"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#ad8791e11a6d300b2ef65d5f3fafdc97fa60cb4da7dfcdb4126109b40f00c37a95">nn::mii::CharModel::TextureType_End</a>; ++idx )</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_char_model.html#ad8791e11a6d300b2ef65d5f3fafdc97f">nn::mii::CharModel::TextureType</a> type =</div>
<div class="line">                <span class="keyword">static_cast&lt;</span><a class="code" href="classnn_1_1mii_1_1_char_model.html#ad8791e11a6d300b2ef65d5f3fafdc97f">nn::mii::CharModel::TextureType</a><span class="keyword">&gt;</span>(idx);</div>
<div class="line">            <span class="keyword">const</span> <a name="_a377"></a><a class="code" href="classnn_1_1gfx_1_1_t_texture_view.html">nn::gfx::TextureView</a>* pTextureView = pCharModel-&gt;<a name="a378"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a647a801615966723ab2e85646c3cbce4">GetTextureView</a>( type, maskIndex );</div>
<div class="line">            <span class="keywordflow">if</span>( pTextureView == NULL )</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// NULLが返って来た場合はそのTextureTypeには</span></div>
<div class="line">                <span class="comment">// テクスチャがないので次のTextureTypeへ</span></div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// テクスチャがある場合はテクスチャビューをデスクリプタプールに登録して</span></div>
<div class="line">            <span class="comment">// 対象となるデスクリプタスロットをCharModelにセットする。</span></div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> slotIndex = g_TextureDescriptorBaseIndex;</div>
<div class="line">            g_TextureDescriptorPool.<a name="a379"></a><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#af45507b68edfff5b381d5e62e5fa4157">SetTextureView</a>( slotIndex, pTextureView );</div>
<div class="line">            <a name="_a380"></a><a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a> slot;</div>
<div class="line">            g_TextureDescriptorPool.<a name="a381"></a><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#ac2b65342f8057bd6423d99bfa6aa526b">GetDescriptorSlot</a>( &amp;slot, slotIndex );</div>
<div class="line">            <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( slot.<a name="a382"></a><a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html#adcd95d6cda65fe4ee6f5b44324dc4e1a">IsValid</a>() );</div>
<div class="line">            pCharModel-&gt;<a name="a383"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a344623958724853df91c3d7d4886cb5e">SetTextureDescriptorSlot</a>( type, slot, maskIndex );</div>
<div class="line">            ++g_TextureDescriptorBaseIndex;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Facelineが持つ各テクスチャに対してデスクリプタスロットを付与</span></div>
<div class="line">        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> idx = 0; idx &lt; <a name="a384"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#a873afe5239b55bb1aa34752560a728e6aa4c14efe0ffb2c9a063adba4a22946ed">nn::mii::Faceline::TextureType_End</a>; ++idx )</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_faceline.html#a873afe5239b55bb1aa34752560a728e6">nn::mii::Faceline::TextureType</a> type =</div>
<div class="line">                <span class="keyword">static_cast&lt;</span><a class="code" href="classnn_1_1mii_1_1_faceline.html#a873afe5239b55bb1aa34752560a728e6">nn::mii::Faceline::TextureType</a><span class="keyword">&gt;</span>(idx);</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_t_texture_view.html">nn::gfx::TextureView</a>* pTextureView = pFaceline-&gt;<a name="a385"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#aac4239a87dc47b0cdb50980f2b973bce">GetTextureView</a>( type );</div>
<div class="line">            <span class="keywordflow">if</span>( pTextureView == NULL )</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// NULLが返って来た場合はそのTextureTypeには</span></div>
<div class="line">                <span class="comment">// テクスチャがないので次のTextureTypeへ</span></div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// テクスチャがある場合はテクスチャビューをデスクリプタプールに登録して</span></div>
<div class="line">            <span class="comment">// 対象となるデスクリプタスロットをFacelineにセットする。</span></div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> slotIndex = g_TextureDescriptorBaseIndex;</div>
<div class="line">            g_TextureDescriptorPool.<a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#af45507b68edfff5b381d5e62e5fa4157">SetTextureView</a>( slotIndex, pTextureView );</div>
<div class="line">            <a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a> slot;</div>
<div class="line">            g_TextureDescriptorPool.<a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#ac2b65342f8057bd6423d99bfa6aa526b">GetDescriptorSlot</a>( &amp;slot, slotIndex );</div>
<div class="line">            <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( slot.<a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html#adcd95d6cda65fe4ee6f5b44324dc4e1a">IsValid</a>() );</div>
<div class="line">            pFaceline-&gt;<a name="a386"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#a546d88621b1d8314f5166cde3c05a9a1">SetTextureDescriptorSlot</a>( type, slot );</div>
<div class="line">            ++g_TextureDescriptorBaseIndex;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Maskが持つ各テクスチャに対してデスクリプタスロットを付与</span></div>
<div class="line">        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> idx = 0; idx &lt; <a name="a387"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#a6b9e4340d4b832c3a6d8e2ff1a9293dba1299363ad95a822dee519e1b21fbd9c6">nn::mii::Mask::TextureType_End</a>; ++idx )</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_mask.html#a6b9e4340d4b832c3a6d8e2ff1a9293db">nn::mii::Mask::TextureType</a> type =</div>
<div class="line">                <span class="keyword">static_cast&lt;</span><a class="code" href="classnn_1_1mii_1_1_mask.html#a6b9e4340d4b832c3a6d8e2ff1a9293db">nn::mii::Mask::TextureType</a><span class="keyword">&gt;</span>(idx);</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_t_texture_view.html">nn::gfx::TextureView</a>* pTextureView = pMask-&gt;<a name="a388"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#a41cd61a3d8c0a41793e8d70738f4ba69">GetTextureView</a>( type );</div>
<div class="line">            <span class="keywordflow">if</span>( pTextureView == NULL )</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// NULLが返って来た場合はそのTextureTypeには</span></div>
<div class="line">                <span class="comment">// テクスチャがないので次のTextureTypeへ</span></div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// テクスチャがある場合はテクスチャビューをデスクリプタプールに登録して</span></div>
<div class="line">            <span class="comment">// 対象となるデスクリプタスロットをMaskにセットする。</span></div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">int</span> slotIndex = g_TextureDescriptorBaseIndex;</div>
<div class="line">            g_TextureDescriptorPool.<a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#af45507b68edfff5b381d5e62e5fa4157">SetTextureView</a>( slotIndex, pTextureView );</div>
<div class="line">            <a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a> slot;</div>
<div class="line">            g_TextureDescriptorPool.<a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#ac2b65342f8057bd6423d99bfa6aa526b">GetDescriptorSlot</a>( &amp;slot, slotIndex );</div>
<div class="line">            <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( slot.<a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html#adcd95d6cda65fe4ee6f5b44324dc4e1a">IsValid</a>() );</div>
<div class="line">            pMask-&gt;<a name="a389"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#a0fd6e916a3824c2a478fcdbcd31035e1">SetTextureDescriptorSlot</a>( type, slot );</div>
<div class="line">            ++g_TextureDescriptorBaseIndex;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    g_TextureDescriptorPool.<a name="a390"></a><a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#a038a1844514768b94b47376d6105f52b">EndUpdate</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// TextureShaderの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeTextureShader(</div>
<div class="line">    <a name="_a391"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader.html">nn::mii::TextureShader</a>* pTextureShader, <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html">nn::gfx::ResShaderFile</a>&amp; resShaderFile,</div>
<div class="line">    <a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a> codeType, <span class="keyword">const</span> <a name="_a392"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader_info.html">nn::mii::TextureShaderInfo</a>&amp; info,</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memorySize = </div>
<div class="line">        <a name="a393"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader.html#a865b97c77e39e1327b9d3d4b8645feef">nn::mii::TextureShader::CalculateMemorySize</a>( resShaderFile, codeType, info, pDevice);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryAlignment = </div>
<div class="line">        <a name="a394"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader.html#a005caf75648db242f8dd7e4d0a5e066a">nn::mii::TextureShader::CalculateMemoryAlignment</a>( resShaderFile, codeType, info, pDevice);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アライメントの調整</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( memoryAlignment );</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = pTextureShader-&gt;<a name="a395"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader.html#a4a0a83bf2c8695381b482a6b74695489">Initialize</a>(</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), memorySize, &amp;g_Device, resShaderFile, codeType, info );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( pTextureShader-&gt;<a name="a396"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader.html#a4000df21fb94aa6fb8e44942147ec44a">IsInitialized</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 使用した分だけメモリのオフセットを進める</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( memorySize );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// FacelineGpuBufferの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeFacelineGpuBuffer(<a name="_a397"></a><a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html">nn::mii::FacelineGpuBuffer</a>* pFacelineGpuBuffer)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memorySize = nn::mii::FacelineGpuBuffer::CalculateMemorySize();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryAlignment = <a name="a398"></a><a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html#a75982f0eb79f3a27fb0db86c1f478ab8">nn::mii::FacelineGpuBuffer::CalculateMemoryAlignment</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolSize =</div>
<div class="line">        <a name="a399"></a><a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html#aa95b35c377bc2767fada87d0f107a0cb">nn::mii::FacelineGpuBuffer::CalculateMemoryPoolSize</a>( &amp;g_Device );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolAlignment =</div>
<div class="line">        <a name="a400"></a><a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html#a837469aee35b8c06c70bea94aa0256be">nn::mii::FacelineGpuBuffer::CalculateMemoryPoolAlignment</a>( &amp;g_Device );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アライメントの調整</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( memoryAlignment );</div>
<div class="line">    g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_MemoryPoolOffset, memoryPoolAlignment );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = pFacelineGpuBuffer-&gt;<a name="a401"></a><a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html#a3bb8dff5bf7a953882e040f151dacea1">Initialize</a>(</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), memorySize, &amp;g_Device, &amp;g_MemoryPool, g_MemoryPoolOffset, memoryPoolSize );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( pFacelineGpuBuffer-&gt;<a name="a402"></a><a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html#a174d869efabced3c5801bb2585868f44">IsInitialized</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 使用した分だけメモリのオフセットを進める</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( memorySize );</div>
<div class="line">    g_MemoryPoolOffset += memoryPoolSize;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// MaskGpuBufferの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeMaskGpuBuffer(<a name="_a403"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html">nn::mii::MaskGpuBuffer</a>* pMaskGpuBuffer)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memorySize = <a name="a404"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html#a2447dccc90a2d096079781584fd370e5">nn::mii::MaskGpuBuffer::CalculateMemorySize</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryAlignment = <a name="a405"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html#a4fb13cbf4a553a8b2f66ef9933062518">nn::mii::MaskGpuBuffer::CalculateMemoryAlignment</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolSize =</div>
<div class="line">        <a name="a406"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html#aa7308f23cced30303861cabb1a032c0b">nn::mii::MaskGpuBuffer::CalculateMemoryPoolSize</a>( &amp;g_Device );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolAlignment =</div>
<div class="line">        <a name="a407"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html#a8f1fc99a159e3d24e35a76b8717e2677">nn::mii::MaskGpuBuffer::CalculateMemoryPoolAlignment</a>( &amp;g_Device );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アライメントの調整</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( memoryAlignment );</div>
<div class="line">    g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_MemoryPoolOffset, memoryPoolAlignment );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = pMaskGpuBuffer-&gt;<a name="a408"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html#afbb0b50516bd080ea64643a0df87e313">Initialize</a>(</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), memorySize, &amp;g_Device, &amp;g_MemoryPool, g_MemoryPoolOffset, memoryPoolSize );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( pMaskGpuBuffer-&gt;<a name="a409"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html#a1011b83d31d916c45dc5327a0462036d">IsInitialized</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 使用した分だけメモリのオフセットを進める</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( memorySize );</div>
<div class="line">    g_MemoryPoolOffset += memoryPoolSize;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// レンダーターゲット用のテクスチャの初期化（ Compress 設定のメモリプールで初期化します。）</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeRenderTargetTexture( <a class="code" href="classnn_1_1gfx_1_1_t_texture.html">nn::gfx::Texture</a>* pTexture, <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_texture_info.html">nn::gfx::TextureInfo</a>&amp; info )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>( <a name="a410"></a><a class="code" href="classnn_1_1gfx_1_1_t_texture.html#ad72a001ac78d43ddcd4858d9b7793005">nn::gfx::Texture::IsMemoryPoolRequired</a> ) )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> alignment =</div>
<div class="line">            <a class="code" href="classnn_1_1gfx_1_1_t_texture.html#a6580c829bab613b6e9850e543f9a7203">nn::gfx::Texture::CalculateMipDataAlignment</a>( &amp;g_Device, info );</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> size =</div>
<div class="line">            <a class="code" href="classnn_1_1gfx_1_1_t_texture.html#ac9d3334566c6451da3f015e5ed1fd1ad">nn::gfx::Texture::CalculateMipDataSize</a>( &amp;g_Device, info );</div>
<div class="line">        <span class="comment">// アライメントの調整</span></div>
<div class="line">        g_CachedCompressMemoryPoolOffset =</div>
<div class="line">            <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_CachedCompressMemoryPoolOffset, alignment );</div>
<div class="line">        pTexture-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_texture.html#a8b733d649540691011c2ca3949cd5620">Initialize</a>( </div>
<div class="line">            &amp;g_Device, info, &amp;g_CachedCompressMemoryPool, g_CachedCompressMemoryPoolOffset, size );</div>
<div class="line">        g_CachedCompressMemoryPoolOffset += size;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        pTexture-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_texture.html#a8b733d649540691011c2ca3949cd5620">Initialize</a>( &amp;g_Device, info, NULL, 0, 0 );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// IconShaderの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeIconShader( <a name="_a411"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader.html">nn::mii::IconShader</a>* pIconShader, </div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html">nn::gfx::ResShaderFile</a>&amp; resShaderFile,</div>
<div class="line">    <a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a> codeType, <span class="keyword">const</span> <a name="_a412"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader_info.html">nn::mii::IconShaderInfo</a>&amp; info)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memorySize = <a name="a413"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader.html#a0e78185e856b67d1c3f18c19565a2077">nn::mii::IconShader::CalculateMemorySize</a>(</div>
<div class="line">        resShaderFile, codeType, info );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryAlignment = <a name="a414"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader.html#aed26d2574198a37a3e6a109bd28f5f19">nn::mii::IconShader::CalculateMemoryAlignment</a>(</div>
<div class="line">        resShaderFile, codeType, info );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アライメントの調整</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( memoryAlignment );</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1_result.html">nn::Result</a> result =</div>
<div class="line">        pIconShader-&gt;<a name="a415"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader.html#a556107b20a052d0aade92c5383372dad">Initialize</a>( g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), memorySize, &amp;g_Device,</div>
<div class="line">        resShaderFile, codeType, info );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( pIconShader-&gt;<a name="a416"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader.html#ab1c0ba67a0066547c9aa55f2511d5382">IsInitialized</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 使用した分だけメモリのオフセットを進める</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( memorySize );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// IconGpuBufferの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeIconGpuBuffer(<a name="_a417"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html">nn::mii::IconGpuBuffer</a>* pIconGpuBuffer)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memorySize = <a name="a418"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#af6fde203317f776337b85e95964c5169">nn::mii::IconGpuBuffer::CalculateMemorySize</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryAlignment = <a name="a419"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#a1529adea0c25e4cec8cdc75019a03302">nn::mii::IconGpuBuffer::CalculateMemoryAlignment</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolSize =</div>
<div class="line">        <a name="a420"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#a34b3cda5ef471c28fc79d988338bed0b">nn::mii::IconGpuBuffer::CalculateMemoryPoolSize</a>( &amp;g_Device );</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> memoryPoolAlignment =</div>
<div class="line">        <a name="a421"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#a8a4b7005e36626dcfa4c97317d26d3d1">nn::mii::IconGpuBuffer::CalculateMemoryPoolAlignment</a>( &amp;g_Device );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アライメントの調整</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aedba2c0b5997b8ca4a5536a7110aa712">AlignUp</a>( memoryAlignment );</div>
<div class="line">    g_MemoryPoolOffset = <a class="code" href="namespacenn_1_1util.html#a20f6772d3ae70168e07e0f39d416d72e">nn::util::align_up</a>( g_MemoryPoolOffset, memoryPoolAlignment );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = pIconGpuBuffer-&gt;<a name="a422"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#aa98d530f95326a03eabd9221006eb6ac">Initialize</a>(</div>
<div class="line">        g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#aec6b5a8431e11fcebf681e8ce602c2fb">Get</a>(), memorySize, &amp;g_Device, </div>
<div class="line">        &amp;g_MemoryPool, g_MemoryPoolOffset, memoryPoolSize );</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( pIconGpuBuffer-&gt;<a name="a423"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#af1dcd2d49ed8e018909057dda41a579c">IsInitialized</a>() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 使用した分だけメモリのオフセットを進める</span></div>
<div class="line">    g_pMemory.<a class="code" href="classnn_1_1util_1_1_byte_ptr.html#af44783b143e4350c3aaef5d576007f96">Advance</a>( memorySize );</div>
<div class="line">    g_MemoryPoolOffset += memoryPoolSize;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> ResetCommandBuffer()</div>
<div class="line">{</div>
<div class="line">    g_CommandBuffer.<a name="a424"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a6232e70a4abb4bfbf1e4e94ce6726f58">Reset</a>();</div>
<div class="line">    g_CommandBuffer.<a name="a425"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#acdb687c47bf13d8d1e65a499a5d8a4a9">AddCommandMemory</a>(</div>
<div class="line">        &amp;g_MemoryPool, g_CommandBufferMemoryPoolOffset, CommandBufferMemoryPoolSize );</div>
<div class="line">    g_CommandBuffer.<a name="a426"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a5803f064362d4af367f7fd061cf10f39">AddControlMemory</a>( </div>
<div class="line">        g_pCommandBufferControlMemory, CommandBufferControlMemorySize );</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> RenderedIcon(<a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html">nn::mii::IconGpuBuffer</a>* pIconGpuBuffer, <span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_icon_shader.html">nn::mii::IconShader</a>&amp; iconShader, <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a>&amp; samplerSlot)</div>
<div class="line">{</div>
<div class="line">    ResetCommandBuffer();</div>
<div class="line">    g_CommandBuffer.<a name="a427"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab22bb14832e8fca483b977dcb18d5286">Begin</a>();</div>
<div class="line">    g_CommandBuffer.<a name="a428"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a442595cd1fd51ba8054116b1e9437cf5">SetDescriptorPool</a>( &amp;g_TextureDescriptorPool );</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a442595cd1fd51ba8054116b1e9437cf5">SetDescriptorPool</a>( &amp;g_SamplerDescriptorPool );</div>
<div class="line">    g_CommandBuffer.<a name="a429"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a7e5cade7802122a5272657dfaec5d1f1">InvalidateMemory</a>(</div>
<div class="line">        <a name="a430"></a><a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a4a531ae2d7e145f647300ea67bc76ccc">nn::gfx::GpuAccess_Texture</a> | <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a1ba60cf566c205e5c387ecbf68a51fe6">nn::gfx::GpuAccess_IndexBuffer</a></div>
<div class="line">        | <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5af73fa5ff79cf33f75dfecb4cbe5c139d">nn::gfx::GpuAccess_ConstantBuffer</a> | <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5aa319bbae0c949cb5829c882b68e7500a">nn::gfx::GpuAccess_VertexBuffer</a> );</div>
<div class="line">    <span class="comment">// MiiIconのレンダリング</span></div>
<div class="line">    iconShader.<a name="a431"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader.html#a3d0417495914cbee6f33d4857940d312">DrawIcon</a>( &amp;g_CommandBuffer, pIconGpuBuffer, samplerSlot );</div>
<div class="line">    g_CommandBuffer.<a name="a432"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a3b4d64880cd75e66c314bdbac29c04f0">End</a>();</div>
<div class="line"></div>
<div class="line">    g_Queue.<a name="a433"></a><a class="code" href="classnn_1_1gfx_1_1_t_queue.html#a3513accbae08380417a92fb51043f1e8">ExecuteCommand</a>( &amp;g_CommandBuffer, <span class="keyword">nullptr</span> );</div>
<div class="line">    g_Queue.<a name="a434"></a><a class="code" href="classnn_1_1gfx_1_1_t_queue.html#afc21092b4436c72ed0ca8d23c6a2ff78">Sync</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> DrawByDrawParam(<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html">nn::gfx::CommandBuffer</a>* pCommandBuffer,<span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_draw_param.html">nn::mii::DrawParam</a>* pDrawParam, <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a>&amp; samplerSlot)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// テクスチャが有効なら</span></div>
<div class="line">    <span class="keywordflow">if</span> (pDrawParam-&gt;<a name="a435"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a8f8c28bbe5d8b658a89f97bc356983eb">IsValidTexture</a>())</div>
<div class="line">    {</div>
<div class="line">        pCommandBuffer-&gt;<a name="a436"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a9467eab0515bf34ac7db35da6ced273f">SetTextureAndSampler</a>(</div>
<div class="line">            g_SlotTex, <a class="code" href="namespacenn_1_1gfx.html#a23a67c7d8f6b5765e2de8173797f73fea4af13ef64af0ee06eb539013de2be40a">nn::gfx::ShaderStage_Pixel</a></div>
<div class="line">            , *pDrawParam-&gt;<a name="a437"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a9e9b1c3b15c65c410f7b41a656c5f42d">GetTextureDescriptorSlot</a>()</div>
<div class="line">            , samplerSlot);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a name="_a438"></a><a class="code" href="classnn_1_1gfx_1_1_gpu_address.html">nn::gfx::GpuAddress</a> gpuAddress;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_t_buffer.html">nn::gfx::Buffer</a>* pVertexBuffer = pDrawParam-&gt;<a name="a439"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a30bf1ee21f6426db96545d492ab5d70b">GetAttribute</a>(<a name="a440"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afaef49010713212b7ee37b232b1033fba7">nn::mii::DrawParam::AttributeType_Position</a>);</div>
<div class="line">    <span class="keywordtype">size_t</span> vertexBufferSize = pDrawParam-&gt;<a name="a441"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a26041ce6f287bd334be1fc117a7057cb">GetBufferSize</a>(<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afaef49010713212b7ee37b232b1033fba7">nn::mii::DrawParam::AttributeType_Position</a>);</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(pVertexBuffer);</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0 &lt; vertexBufferSize);</div>
<div class="line">    pVertexBuffer-&gt;<a name="a442"></a><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">    pCommandBuffer-&gt;<a name="a443"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af39eba323201a036bf09a1f542fa4ae0">SetVertexBuffer</a>(0, gpuAddress, <a class="code" href="classnn_1_1mii_1_1_draw_param.html#aabb72e60eb15616c796db847dd6517e7">nn::mii::DrawParam::PositionStride</a>, vertexBufferSize);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Normalが有効なときのみ更新(CharModelのDrawParamにはUVが存在しない場合がある)</span></div>
<div class="line">    <span class="keywordflow">if</span> (pDrawParam-&gt;<a name="a444"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a21a88e7b81b6bb45a5d8e559d0db7d89">IsValidAttribute</a>(<a name="a445"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afa019444dcb8c7545aa30f018a48c7f4f1">nn::mii::DrawParam::AttributeType_Normal</a>))</div>
<div class="line">    {</div>
<div class="line">        pVertexBuffer = pDrawParam-&gt;<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a30bf1ee21f6426db96545d492ab5d70b">GetAttribute</a>(<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afa019444dcb8c7545aa30f018a48c7f4f1">nn::mii::DrawParam::AttributeType_Normal</a>);</div>
<div class="line">        vertexBufferSize = pDrawParam-&gt;<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a26041ce6f287bd334be1fc117a7057cb">GetBufferSize</a>(<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afa019444dcb8c7545aa30f018a48c7f4f1">nn::mii::DrawParam::AttributeType_Normal</a>);</div>
<div class="line">    }</div>
<div class="line">    pVertexBuffer-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">    pCommandBuffer-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af39eba323201a036bf09a1f542fa4ae0">SetVertexBuffer</a>(1, gpuAddress, <a class="code" href="classnn_1_1mii_1_1_draw_param.html#afc979ffa2ac60965828cac3c1d8c21b0">nn::mii::DrawParam::NormalStride</a>, vertexBufferSize);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Uvが有効なときのみ更新(CharModelのDrawParamにはUVが存在しない場合がある)</span></div>
<div class="line">    <span class="keywordflow">if</span> (pDrawParam-&gt;<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a21a88e7b81b6bb45a5d8e559d0db7d89">IsValidAttribute</a>(<a name="a446"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afa68f53f83cf1e23e91a4e9819febe3988">nn::mii::DrawParam::AttributeType_Uv</a>))</div>
<div class="line">    {</div>
<div class="line">        pVertexBuffer = pDrawParam-&gt;<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a30bf1ee21f6426db96545d492ab5d70b">GetAttribute</a>(<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afa68f53f83cf1e23e91a4e9819febe3988">nn::mii::DrawParam::AttributeType_Uv</a>);</div>
<div class="line">        vertexBufferSize = pDrawParam-&gt;<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a26041ce6f287bd334be1fc117a7057cb">GetBufferSize</a>(<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afa68f53f83cf1e23e91a4e9819febe3988">nn::mii::DrawParam::AttributeType_Uv</a>);</div>
<div class="line">    }</div>
<div class="line">    pVertexBuffer-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">    pCommandBuffer-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af39eba323201a036bf09a1f542fa4ae0">SetVertexBuffer</a>(2, gpuAddress, <a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7fc9e85434355b59436cb830ac400bba">nn::mii::DrawParam::UvStride</a>, vertexBufferSize);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Paramが有効なときのみ更新(CharModelのDrawParamにはParamが存在しない場合がある)</span></div>
<div class="line">    <span class="keywordflow">if</span> (pDrawParam-&gt;<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a21a88e7b81b6bb45a5d8e559d0db7d89">IsValidAttribute</a>(<a name="a447"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afa8cbe0b5b2ccbe7dcd206cdaf25a623d8">nn::mii::DrawParam::AttributeType_Param</a>))</div>
<div class="line">    {</div>
<div class="line">        pVertexBuffer = pDrawParam-&gt;<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a30bf1ee21f6426db96545d492ab5d70b">GetAttribute</a>(<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afa8cbe0b5b2ccbe7dcd206cdaf25a623d8">nn::mii::DrawParam::AttributeType_Param</a>);</div>
<div class="line">        vertexBufferSize = pDrawParam-&gt;<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a26041ce6f287bd334be1fc117a7057cb">GetBufferSize</a>(<a class="code" href="classnn_1_1mii_1_1_draw_param.html#a7e600e53f4780047f6bf9386f3f944afa8cbe0b5b2ccbe7dcd206cdaf25a623d8">nn::mii::DrawParam::AttributeType_Param</a>);</div>
<div class="line">    }</div>
<div class="line">    pVertexBuffer-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">    pCommandBuffer-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af39eba323201a036bf09a1f542fa4ae0">SetVertexBuffer</a>(3, gpuAddress, <a class="code" href="classnn_1_1mii_1_1_draw_param.html#a0a5979346dc73af9078674b2ad2561d0">nn::mii::DrawParam::ParamStride</a>, vertexBufferSize);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> count = pDrawParam-&gt;<a name="a448"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a9396ef60d4d8fd3430cc0b28ff21fa54">GetIndexCount</a>();</div>
<div class="line">    pDrawParam-&gt;<a name="a449"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a1d76e2e88d2516d3ea4351c3dae34692">GetIndexBuffer</a>()-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">    pCommandBuffer-&gt;<a name="a450"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af9cfb2a18747ed8eafad571a4e1bb20c">DrawIndexed</a>(</div>
<div class="line">        <a name="a451"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#ae81ada69accb9465dfcfff24a7f29483">nn::mii::DrawParam::PrimitiveTopology</a></div>
<div class="line">        , <a name="a452"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a6f1bc99bf11ce1d5de6e62cab3557386">nn::mii::DrawParam::IndexFormat</a></div>
<div class="line">        , gpuAddress</div>
<div class="line">        , count, 0);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> DrawMiiFace(<span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_char_model.html">nn::mii::CharModel</a>&amp; charModel, <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a>&amp; samplerSlot)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> drawTypeIndex = 0; drawTypeIndex &lt; <a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa140c8eb1aa865374c94a7ad24a0a9f41">nn::mii::CharModel::DrawType_End</a>; ++drawTypeIndex)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87a">nn::mii::CharModel::DrawType</a> drawType = <a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87a">nn::mii::CharModel::DrawType</a>(drawTypeIndex);</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classnn_1_1mii_1_1_draw_param.html">nn::mii::DrawParam</a>* pDrawParam = charModel.<a class="code" href="classnn_1_1mii_1_1_char_model.html#afe79d1d6e4ad8519ea8a55af0259044e">GetDrawParam</a>(drawType</div>
<div class="line">            , <a class="code" href="namespacenn_1_1mii.html#a19f550cb89b2b095417f135888953bb3a10757d3c753282cab6b9b8f25b94dd95">nn::mii::CreateModelType_Normal</a></div>
<div class="line">            , <a class="code" href="namespacenn_1_1mii.html#ab1d08064d4a8b9788b5b123bd6a22b21a428e4df9474f8f20a39ddcc01007b244">nn::mii::CreateNoseType_Normal</a></div>
<div class="line">            , 0);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (pDrawParam == NULL)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> DrawMode drawMode = drawType &gt;= <a name="a453"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a84d199c740845263c39c52bd429be87aa5a80c2e75536256a010d6496882a2746">nn::mii::CharModel::DrawType_XluMin</a></div>
<div class="line">            ? DrawMode_Xlu : DrawMode_Opa;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// 描画設定</span></div>
<div class="line">        g_CommandBuffer.<a name="a454"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af7a11b30ffe96e7185e5b363aced45a6">SetRasterizerState</a>(&amp;g_RasterizerState[pDrawParam-&gt;<a name="a455"></a><a class="code" href="classnn_1_1mii_1_1_draw_param.html#a1a81a03d8b72b0fdca2aba876897d8bc">GetCullMode</a>()]);</div>
<div class="line">        g_CommandBuffer.<a name="a456"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab2e69208132de5735704d7399ec45927">SetBlendState</a>(&amp;g_BlendState[drawMode]);</div>
<div class="line">        g_CommandBuffer.<a name="a457"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#aff6009b3f54bdeb6fa8669bbebf5100c">SetDepthStencilState</a>(&amp;g_DepthStencilState[drawMode]);</div>
<div class="line">        g_CommandBuffer.<a name="a458"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af6703eb0e67ca9e419631c01f3677c33">SetVertexState</a>(&amp;g_VertexState);</div>
<div class="line">        g_CommandBuffer.<a name="a459"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#affa101add0b7e50e308ef467bb3a574c">SetShader</a>(</div>
<div class="line">            g_pResShaderFile-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html#ace0f3249523a20bb1ca3deee4c5b9b4d">GetShaderContainer</a>()-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#a1d654b4d72d8d55937dab1fd27bbcd50">GetResShaderVariation</a>(0)</div>
<div class="line">            -&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_variation.html#aec393ed8b0fd0cdf05c5f01059323902">GetResShaderProgram</a>(g_ShaderCodeType)-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_program.html#a93b925feb250168737859dfb7f072801">GetShader</a>()</div>
<div class="line">            ,<a name="a460"></a><a class="code" href="namespacenn_1_1gfx.html#a1e02bfe3380ee94c02ac4f0c762c4196a8e27619452b69059d788f7a91c54a40c">nn::gfx::ShaderStageBit_All</a>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// 定数バッファをバインド</span></div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_gpu_address.html">nn::gfx::GpuAddress</a> gpuAddress;</div>
<div class="line">        g_ConstantBuffer[0].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">        g_CommandBuffer.<a name="a461"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab03dd5ed3b0bbb7ab222027003a4a829">SetConstantBuffer</a>(</div>
<div class="line">            g_SlotMat, <a class="code" href="namespacenn_1_1gfx.html#a23a67c7d8f6b5765e2de8173797f73feaa5a9e711b0362499e98049d578099ac7">nn::gfx::ShaderStage_Vertex</a></div>
<div class="line">            , gpuAddress, <span class="keyword">sizeof</span>(MatrixConstantBuffer));</div>
<div class="line">        g_ConstantBufferModulate[drawTypeIndex].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">        g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab03dd5ed3b0bbb7ab222027003a4a829">SetConstantBuffer</a>(</div>
<div class="line">            g_SlotModluate, <a class="code" href="namespacenn_1_1gfx.html#a23a67c7d8f6b5765e2de8173797f73fea4af13ef64af0ee06eb539013de2be40a">nn::gfx::ShaderStage_Pixel</a></div>
<div class="line">            , gpuAddress, <span class="keyword">sizeof</span>(ConstantBufferModulate));</div>
<div class="line"></div>
<div class="line">        <span class="comment">// 描画する</span></div>
<div class="line">        DrawByDrawParam(&amp;g_CommandBuffer,pDrawParam, samplerSlot);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> DrawIconTexture(</div>
<div class="line">    DrawType type, <span class="keywordtype">int</span> textureSlotIndex, <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a>&amp; samplerSlot)</div>
<div class="line">{</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af7a11b30ffe96e7185e5b363aced45a6">SetRasterizerState</a>(&amp;g_RasterizerState[<a name="a462"></a><a class="code" href="namespacenn_1_1gfx.html#af10f98bfe496b042c8efd7e5a99e8a3aa7fb8a9e531b3753b321c74afc29ab86f">nn::gfx::CullMode_None</a>]);</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab2e69208132de5735704d7399ec45927">SetBlendState</a>(&amp;g_BlendState[</div>
<div class="line">        type == DrawType_NormalIcon ? DrawMode_Xlu : DrawMode_PremultipliedAlpha</div>
<div class="line">    ]);</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#aff6009b3f54bdeb6fa8669bbebf5100c">SetDepthStencilState</a>(&amp;g_DepthStencilState[</div>
<div class="line">        type == DrawType_NormalIcon ? DrawMode_Xlu : DrawMode_PremultipliedAlpha</div>
<div class="line">    ]);</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af6703eb0e67ca9e419631c01f3677c33">SetVertexState</a>(&amp;g_VertexStateIcon);</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#affa101add0b7e50e308ef467bb3a574c">SetShader</a>(</div>
<div class="line">        g_pResShaderFile-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html#ace0f3249523a20bb1ca3deee4c5b9b4d">GetShaderContainer</a>()-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_container.html#a1d654b4d72d8d55937dab1fd27bbcd50">GetResShaderVariation</a>(0)</div>
<div class="line">        -&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_variation.html#aec393ed8b0fd0cdf05c5f01059323902">GetResShaderProgram</a>(g_ShaderCodeType)-&gt;<a class="code" href="classnn_1_1gfx_1_1_res_shader_program.html#a93b925feb250168737859dfb7f072801">GetShader</a>()</div>
<div class="line">        , <a class="code" href="namespacenn_1_1gfx.html#a1e02bfe3380ee94c02ac4f0c762c4196a8e27619452b69059d788f7a91c54a40c">nn::gfx::ShaderStageBit_All</a>);</div>
<div class="line">    <span class="comment">// 描画設定</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_gpu_address.html">nn::gfx::GpuAddress</a> gpuAddress;</div>
<div class="line">        g_PositionBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">        g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af39eba323201a036bf09a1f542fa4ae0">SetVertexBuffer</a>(</div>
<div class="line">            PositionBufferIndex, gpuAddress, PositionStride, <span class="keyword">sizeof</span>(Positions));</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_gpu_address.html">nn::gfx::GpuAddress</a> gpuAddress;</div>
<div class="line">        g_UvBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">        g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af39eba323201a036bf09a1f542fa4ae0">SetVertexBuffer</a>(</div>
<div class="line">            UvBufferIndex, gpuAddress, UvStride, <span class="keyword">sizeof</span>(Uvs));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// テクスチャを割り当て</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a> textureSlot;</div>
<div class="line">    g_TextureDescriptorPool.<a class="code" href="classnn_1_1gfx_1_1_t_descriptor_pool.html#ac2b65342f8057bd6423d99bfa6aa526b">GetDescriptorSlot</a>(&amp;textureSlot, textureSlotIndex);</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a9467eab0515bf34ac7db35da6ced273f">SetTextureAndSampler</a>(g_SlotTex,</div>
<div class="line">        <a class="code" href="namespacenn_1_1gfx.html#a23a67c7d8f6b5765e2de8173797f73fea4af13ef64af0ee06eb539013de2be40a">nn::gfx::ShaderStage_Pixel</a>, textureSlot, samplerSlot);</div>
<div class="line">    <span class="comment">// コンスタントバッファをバインド</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_gpu_address.html">nn::gfx::GpuAddress</a> gpuAddress;</div>
<div class="line">    g_ConstantBuffer[type].<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab03dd5ed3b0bbb7ab222027003a4a829">SetConstantBuffer</a>(</div>
<div class="line">        g_SlotMat,</div>
<div class="line">        <a class="code" href="namespacenn_1_1gfx.html#a23a67c7d8f6b5765e2de8173797f73feaa5a9e711b0362499e98049d578099ac7">nn::gfx::ShaderStage_Vertex</a>,</div>
<div class="line">        gpuAddress,</div>
<div class="line">        <span class="keyword">sizeof</span>(MatrixConstantBuffer)</div>
<div class="line">    );</div>
<div class="line">    g_ConstantBufferModulateIcon.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab03dd5ed3b0bbb7ab222027003a4a829">SetConstantBuffer</a>(</div>
<div class="line">        g_SlotModluate, <a class="code" href="namespacenn_1_1gfx.html#a23a67c7d8f6b5765e2de8173797f73fea4af13ef64af0ee06eb539013de2be40a">nn::gfx::ShaderStage_Pixel</a></div>
<div class="line">        , gpuAddress, <span class="keyword">sizeof</span>(ConstantBufferModulate));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 描画</span></div>
<div class="line">    g_IndexBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_buffer.html#a67df38d01bea9fdc073b6c3657a34011">GetGpuAddress</a>(&amp;gpuAddress);</div>
<div class="line">    g_CommandBuffer.<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#af9cfb2a18747ed8eafad571a4e1bb20c">DrawIndexed</a>(</div>
<div class="line">        PrimitiveTopology, IndexFormat, gpuAddress, IndexCount, 0);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> GetNextScanBufferIndexAndWaitDisplayFence()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> nextScanBufferIndex = 0;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="namespacenn_1_1gfx.html#a985cf9ff1acdd52a02949c42fdfd21a8">nn::gfx::AcquireScanBufferResult</a> acquireResult = g_SwapChain.<a name="a463"></a><a class="code" href="classnn_1_1gfx_1_1_t_swap_chain.html#a526433e7a3ea68a3ba6092fd9732767e">AcquireNextScanBufferIndex</a>(</div>
<div class="line">        &amp;nextScanBufferIndex, &amp;g_DisplaySemaphore, &amp;g_DisplayFence);</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(acquireResult == <a name="a464"></a><a class="code" href="namespacenn_1_1gfx.html#a985cf9ff1acdd52a02949c42fdfd21a8a58e54fbd4d9caa45601b702540d432ad">nn::gfx::AcquireScanBufferResult_Success</a>);</div>
<div class="line">    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(acquireResult);</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="namespacenn_1_1gfx.html#a72827b32d720001860ddbdb33a377b5a">nn::gfx::SyncResult</a> syncResult = g_DisplayFence.<a name="a465"></a><a class="code" href="classnn_1_1gfx_1_1_t_fence.html#a22215900fc0f3db450949913a5071a40">Sync</a>(<a name="a466"></a><a class="code" href="classnn_1_1_time_span.html#adc879772bbd4cd05381326fe0dd58b97">nn::TimeSpan::FromSeconds</a>(1));</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(syncResult == <a name="a467"></a><a class="code" href="namespacenn_1_1gfx.html#a72827b32d720001860ddbdb33a377b5aa21ff87cf8dce322eac4519c2e231f736">nn::gfx::SyncResult_Success</a>);</div>
<div class="line">    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(syncResult);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> nextScanBufferIndex;</div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined( NN_BUILD_CONFIG_OS_SUPPORTS_HORIZON )</span></div>
<div class="line"><span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// nninitStartup() is invoked before calling nnMain().</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a name="a468"></a><a class="code" href="init___startup_8h.html#ac781c07f35d3d9e7a71d21ad25e25f8f">nninitStartup</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> ApplicationMemorySize = 512 * 1024 * 1024;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> MallocMemorySize = 256 * 1024 * 1024;</div>
<div class="line">    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a name="a469"></a><a class="code" href="namespacenn_1_1os.html#a2be8bac50d8d37a91f866d9e0c55886e">nn::os::SetMemoryHeapSize</a>(ApplicationMemorySize);</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    uintptr_t address;</div>
<div class="line">    result = <a name="a470"></a><a class="code" href="namespacenn_1_1os.html#a875bf6b3129f06654e641513c63017dd">nn::os::AllocateMemoryBlock</a>(&amp;address, MallocMemorySize);</div>
<div class="line">    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>( result );</div>
<div class="line">    <a name="a471"></a><a class="code" href="namespacenn_1_1init.html#a216ae7a5ca53a1c1e6dc0514f7283974">nn::init::InitializeAllocator</a>(reinterpret_cast&lt;void*&gt;(address), MallocMemorySize);</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Main Function</span></div>
<div class="line"><span class="comment">//  メイン関数です。</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a name="a472"></a><a class="code" href="_socket_resolver_8cpp.html#ae79180f8ae90e05743b47a872f305a52">nnMain</a>()</div>
<div class="line">{</div>
<div class="line">    InitializeFs();</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined( NN_BUILD_CONFIG_OS_SUPPORTS_HORIZON ) &amp;&amp; defined( NN_BUILD_CONFIG_SPEC_NX )</span></div>
<div class="line">    <span class="comment">// グラフィックスシステムのためのメモリ周りの初期化を行います。</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> GraphicsSystemMemorySize = 8 * 1024 * 1024;</div>
<div class="line">        <a name="a473"></a><a class="code" href="namespacenv.html#a7d85cfdd1bae1b635cc66b8d58077688">nv::SetGraphicsAllocator</a>(NvAllocateFunction, NvFreeFunction, NvReallocateFunction, <span class="keyword">nullptr</span>);</div>
<div class="line">        <a name="a474"></a><a class="code" href="namespacenv.html#aacadc57952b370f2286108f5835ce726">nv::InitializeGraphics</a>(malloc(GraphicsSystemMemorySize), GraphicsSystemMemorySize);</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    InitializeResources();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// リソースファイルの読み込み</span></div>
<div class="line">    <span class="keywordtype">size_t</span> textureResourceSize;</div>
<div class="line">    g_pMemory.AlignUp(<a name="a475"></a><a class="code" href="namespacenn_1_1mii.html#a9491e347fa7cac50a79bfd4b0848c06d">nn::mii::ResourceMemoryAlignment</a>);</div>
<div class="line">    <span class="keywordtype">void</span>* pTextureResource = g_pMemory.Get();</div>
<div class="line">    {</div>
<div class="line">        textureResourceSize = <a class="code" href="namespacenn_1_1fs.html#aba29e01d386e809349d60eccdb15ff21">GetFileSize</a>(TextureResourcePath);</div>
<div class="line">        <a class="code" href="namespacenn_1_1fs.html#a81801a404563984f8c6cc1483cc6d730">ReadFile</a>(pTextureResource, textureResourceSize, TextureResourcePath);</div>
<div class="line">        g_pMemory.Advance(textureResourceSize);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">size_t</span> shapeResourceSize;</div>
<div class="line">    g_pMemory.AlignUp(<a class="code" href="namespacenn_1_1mii.html#a9491e347fa7cac50a79bfd4b0848c06d">nn::mii::ResourceMemoryAlignment</a>);</div>
<div class="line">    <span class="keywordtype">void</span>* pShapeResource = g_pMemory.Get();</div>
<div class="line">    {</div>
<div class="line">        shapeResourceSize = <a class="code" href="namespacenn_1_1fs.html#aba29e01d386e809349d60eccdb15ff21">GetFileSize</a>( ShapeResourcePath );</div>
<div class="line">        <a class="code" href="namespacenn_1_1fs.html#a81801a404563984f8c6cc1483cc6d730">ReadFile</a>( pShapeResource, shapeResourceSize, ShapeResourcePath );</div>
<div class="line">        g_pMemory.Advance(shapeResourceSize);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// リソースの初期化</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_resource_info.html">nn::mii::ResourceInfo</a> resourceInfo;</div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_resource.html">nn::mii::Resource</a> resource;</div>
<div class="line">    {</div>
<div class="line">        resourceInfo.<a name="a476"></a><a class="code" href="classnn_1_1mii_1_1_resource_info.html#adeab15aed416487d39c9535310931ff6">SetDefault</a>();</div>
<div class="line">        resourceInfo.<a name="a477"></a><a class="code" href="classnn_1_1mii_1_1_resource_info.html#af360f7d2d3e4f4c2cf3a2c56bbded541">SetGammaType</a>( <a class="code" href="namespacenn_1_1mii.html#a1ca46f017cb280267571c2c688ba4fa1">GammaType</a> );</div>
<div class="line">        InitializeResource( </div>
<div class="line">            &amp;resource, resourceInfo, </div>
<div class="line">            pTextureResource, textureResourceSize,</div>
<div class="line">            pShapeResource, shapeResourceSize );</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// CharInfoを取得</span></div>
<div class="line">    <a class="code" href="structnn_1_1mii_1_1_char_info.html">nn::mii::CharInfo</a> charInfo;</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> fileSize = <a class="code" href="namespacenn_1_1fs.html#aba29e01d386e809349d60eccdb15ff21">GetFileSize</a>( CharInfoPath );</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( fileSize == <span class="keyword">sizeof</span>( charInfo ) );</div>
<div class="line">        <a class="code" href="namespacenn_1_1fs.html#a81801a404563984f8c6cc1483cc6d730">ReadFile</a>( &amp;charInfo, <span class="keyword">sizeof</span>(charInfo), CharInfoPath );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// CharModelの生成</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_char_model_info.html">nn::mii::CharModelInfo</a> charModelInfo;</div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_char_model.html">nn::mii::CharModel</a> charModel;</div>
<div class="line">    {</div>
<div class="line">        charModelInfo.<a name="a478"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html#ad76a6f8319e258484b0cc261b58221f1">SetDefault</a>();</div>
<div class="line">        charModelInfo.<a name="a479"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html#ae082868ad14a637dfaf0e71b37a7ab94">SetDynamicTextureFormat</a>(DynamicTextureFormat, DynamicTextureFormat);</div>
<div class="line">        InitializeCharModel( &amp;charModel, charModelInfo, resource, charInfo );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Facelineの作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_faceline.html">nn::mii::Faceline</a> faceline;</div>
<div class="line">    InitializeFaceline( &amp;faceline, resource, charInfo );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Maskを作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_mask.html">nn::mii::Mask</a> mask;</div>
<div class="line">    InitializeMask( &amp;mask, MaskExpressionFlag, resource, charInfo );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// CharModel, Faceline, Maskそれぞれのテクスチャに対してデスクリプタスロットを付与</span></div>
<div class="line">    SetTextureDescriptorSlot( &amp;charModel, &amp;faceline, &amp;mask, MaskIndex );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TextureShaderで使用するシェーダファイルの準備</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html">nn::gfx::ResShaderFile</a>* pTextureShaderFile = NULL;</div>
<div class="line">    <a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a> textureShaderCodeType;</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">void</span>* shaderResource = ReadResource( TextureShaderPath );</div>
<div class="line">        pTextureShaderFile = <a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html#a1da4b1d76726d48dd4768b5bf37cc98e">nn::gfx::ResShaderFile::ResCast</a>( shaderResource );</div>
<div class="line">        NN_SDK_ASSERT_NOT_NULL( pTextureShaderFile );</div>
<div class="line">        textureShaderCodeType = InitializeResShaderFile( pTextureShaderFile );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// TextureShaderの生成</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_texture_shader_info.html">nn::mii::TextureShaderInfo</a> textureShaderInfo;</div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_texture_shader.html">nn::mii::TextureShader</a> textureShader;</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// textureInfoにFacelineとMaskのイメージフォーマットを設定</span></div>
<div class="line">        textureShaderInfo.<a name="a480"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader_info.html#ae2f84a031a26aba51d21b42a764f9c0c">SetFacelineImageFormat</a>( charModelInfo.<a name="a481"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html#ab50754e3530b8255b432d751c537206f">GetFacelineFormat</a>() );</div>
<div class="line">        textureShaderInfo.<a name="a482"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader_info.html#a6d9f78c85a8152212aeba51fab1f2ea9">SetMaskImageFormat</a>( charModelInfo.<a name="a483"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html#acb29ff57f9ea9fe225a01c9f810e300b">GetMaskFormat</a>() );</div>
<div class="line">        <span class="comment">// アイコン描画する場合やこのシェーダで描画する場合はこの設定をONにする。</span></div>
<div class="line">        textureShaderInfo.<a name="a484"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader_info.html#a18e431384170ee55a95096e5f599d1f9">SetFacelineLeaveAlpha</a>(<span class="keyword">true</span>);</div>
<div class="line">        <span class="comment">// TextureShaderの初期化</span></div>
<div class="line">        InitializeTextureShader(</div>
<div class="line">            &amp;textureShader, *pTextureShaderFile, textureShaderCodeType, textureShaderInfo, &amp;g_Device );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// FacelineGpuBufferの作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html">nn::mii::FacelineGpuBuffer</a> facelineGpuBuffer;</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// FacelineGpuBufferの初期化</span></div>
<div class="line">        InitializeFacelineGpuBuffer( &amp;facelineGpuBuffer );</div>
<div class="line">        <span class="comment">// FacelinGpuBufferにFacelineと書き込み先のテクスチャの設定</span></div>
<div class="line">        facelineGpuBuffer.<a name="a485"></a><a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html#a869866d810adfbeb6094167e1fe4b578">SetFaceline</a>( faceline );</div>
<div class="line">        facelineGpuBuffer.<a name="a486"></a><a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html#a38eb4f496f382ff3739668bc055dc891">SetColorTarget</a>( &amp;g_Device, charModel.<a name="a487"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a5039b6cd42aa70d75f15104c4c823c6a">GetFacelineTexture</a>(),</div>
<div class="line">            textureShaderInfo, charModelInfo.<a name="a488"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html#a0fd424cff603480b67cb0389c2f42afc">GetFacelineWidth</a>(), charModelInfo.<a name="a489"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html#ae50b1cfc53aa59c555b1d84c218f2942">GetFacelineHeight</a>(),</div>
<div class="line">            charModelInfo.<a name="a490"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html#a494bd57dfcd7f3634ddc6f5c77184e6e">GetFacelineMipCount</a>());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// MaskGpuBufferの作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html">nn::mii::MaskGpuBuffer</a> maskGpuBuffer;</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// MaskGpuBufferの初期化</span></div>
<div class="line">        InitializeMaskGpuBuffer( &amp;maskGpuBuffer );</div>
<div class="line">        <span class="comment">// MaskGpuBufferにMaskと書き込み先のテクスチャの設定</span></div>
<div class="line">        maskGpuBuffer.<a name="a491"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html#a42f7a9fcb1796fa7eadd700a64543bb8">SetMask</a>( mask, MiiExpression );</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> maskResolution = charModelInfo.<a name="a492"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html#a55ff65949e342acfaefb9a5505718ec8">GetMaskResolution</a>();</div>
<div class="line">        maskGpuBuffer.<a name="a493"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html#a33228d259ca8937d9a1a6f5591f8cb4e">SetColorTarget</a>( &amp;g_Device, charModel.<a name="a494"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a95e4ff7a22aedb8c8a65237368778592">GetMaskTexture</a>( MaskIndex ),</div>
<div class="line">            textureShaderInfo, maskResolution,</div>
<div class="line">            charModelInfo.<a name="a495"></a><a class="code" href="classnn_1_1mii_1_1_char_model_info.html#ac6c1f1841d50707b8b46a7b2eedc0ef7">GetMaskMipCount</a>());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アイコン書き込み先テクスチャのInfoを作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_texture_info.html">nn::gfx::TextureInfo</a> renderTextureInfo;</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> mipCount = 1;</div>
<div class="line">        renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a7347a6f3179dc816dc7eb761cdc37152">SetDefault</a>();</div>
<div class="line">        renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#ac1912ab092b3f1acd897e96ea4eb7ffc">SetImageStorageDimension</a>(<a class="code" href="namespacenn_1_1gfx.html#a52703c69a29adb8ba4cf3d02c6be65d6aeecfd005f00573cce0430313e61bc33e">nn::gfx::ImageStorageDimension_2d</a>);</div>
<div class="line">        renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#aabd5c4ee3aaf0dfc3577843da1d8bc1f">SetImageFormat</a>(IconTextureFormat);</div>
<div class="line">        renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#aa9542aaf7fe4dea102f8ec01188c3227">SetWidth</a>(IconTextureResolution);</div>
<div class="line">        renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a2351f69b4b5c3bece70bfc416a74f96a">SetHeight</a>(IconTextureResolution);</div>
<div class="line">        renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a214c396c13c6086b75cf63dc374f14ab">SetGpuAccessFlags</a>(<a name="a496"></a><a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a0db6d0fe517ccdbde996e7748f0c69f8">nn::gfx::GpuAccess_ColorBuffer</a>);</div>
<div class="line">        renderTextureInfo.<a name="a497"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a8187f32da9bbbed65c49a1c00932d796">SetMipCount</a>(mipCount);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アイコン書き込み先テクスチャの作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_texture.html">nn::gfx::Texture</a> renderTexture;</div>
<div class="line">    InitializeRenderTargetTexture(&amp;renderTexture, renderTextureInfo);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 乗算済みアルファの結果を格納するテクスチャを作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_texture.html">nn::gfx::Texture</a> premultipliedAlphaTexture;</div>
<div class="line">    InitializeRenderTargetTexture(&amp;premultipliedAlphaTexture, renderTextureInfo);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// デプスステンシル用テクスチャの作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_texture_info.html">nn::gfx::TextureInfo</a> depthStencilTextureInfo;</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> mipCount = 1;</div>
<div class="line">        depthStencilTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a7347a6f3179dc816dc7eb761cdc37152">SetDefault</a>();</div>
<div class="line">        depthStencilTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#aabd5c4ee3aaf0dfc3577843da1d8bc1f">SetImageFormat</a>( IconDepthStencilFormat );</div>
<div class="line">        depthStencilTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#aa9542aaf7fe4dea102f8ec01188c3227">SetWidth</a>( IconTextureResolution );</div>
<div class="line">        depthStencilTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a2351f69b4b5c3bece70bfc416a74f96a">SetHeight</a>( IconTextureResolution );</div>
<div class="line">        depthStencilTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a214c396c13c6086b75cf63dc374f14ab">SetGpuAccessFlags</a>( <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a1663c5652d151ae04844adb9a3784bea">nn::gfx::GpuAccess_DepthStencil</a> );</div>
<div class="line">        depthStencilTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a8187f32da9bbbed65c49a1c00932d796">SetMipCount</a>( mipCount );</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_texture.html">nn::gfx::Texture</a> depthStencilTexture;</div>
<div class="line">    InitializeRenderTargetTexture(&amp;depthStencilTexture, depthStencilTextureInfo);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// IconShaderで使用するシェーダファイルの準備</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html">nn::gfx::ResShaderFile</a>* pIconShaderFile = <span class="keyword">nullptr</span>;</div>
<div class="line">    <a class="code" href="namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455">nn::gfx::ShaderCodeType</a> iconShaderCodeType;</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">void</span>* shaderResource = ReadResource( IconShaderPath );</div>
<div class="line">        pIconShaderFile = <a class="code" href="classnn_1_1gfx_1_1_res_shader_file.html#a1da4b1d76726d48dd4768b5bf37cc98e">nn::gfx::ResShaderFile::ResCast</a>( shaderResource );</div>
<div class="line">        NN_SDK_ASSERT_NOT_NULL( pIconShaderFile );</div>
<div class="line">        iconShaderCodeType = InitializeResShaderFile( pIconShaderFile );</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// IconShaderの作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_icon_shader_info.html">nn::mii::IconShaderInfo</a> iconShaderInfo;</div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_icon_shader.html">nn::mii::IconShader</a> iconShader;</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// 書き込み先テクスチャとデプスステンシル用のイメージフォーマットを設定</span></div>
<div class="line">        iconShaderInfo.<a name="a498"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader_info.html#a9ea361a2e674e8a90142dec8f897a7ec">SetColorTargetImageFormat</a>( renderTextureInfo.<a name="a499"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a10e760136016b925066005929242c2da">GetImageFormat</a>() );</div>
<div class="line">        iconShaderInfo.<a name="a500"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader_info.html#aa550d3bb4062a377d8516e67bcbed5d4">SetDepthStencilImageFormat</a>( depthStencilTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a10e760136016b925066005929242c2da">GetImageFormat</a>() );</div>
<div class="line">        <span class="comment">// IconShaderの初期化</span></div>
<div class="line">        InitializeIconShader( &amp;iconShader, *pIconShaderFile, iconShaderCodeType, iconShaderInfo );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// IconGpuBufferの作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html">nn::mii::IconGpuBuffer</a> iconGpuBuffer;</div>
<div class="line">    {</div>
<div class="line">        InitializeIconGpuBuffer( &amp;iconGpuBuffer );</div>
<div class="line">        <span class="comment">// IconGpuBufferに必要な情報の設定</span></div>
<div class="line">        <span class="comment">// 背景色を設定</span></div>
<div class="line">        iconGpuBuffer.<a name="a501"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#ad28337c73d108db7749b2782e2deab3a">SetBackgroundColor</a>( IconBackGroundColor );</div>
<div class="line">        <span class="comment">// 描画するキャラモデルを設定</span></div>
<div class="line">        iconGpuBuffer.<a name="a502"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#a5691b1b7d6f8cfab84670b1b1cf2fdad">SetCharModel</a>( charModel,charInfo, CharModelType, NoseType, MaskIndex );</div>
<div class="line">        <span class="comment">// 書き込み先テクスチャとデプスステンシルを設定</span></div>
<div class="line">        iconGpuBuffer.<a name="a503"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#a1885c9fe772a288591b1be3002a61c8b">SetColorTargetAndDepthStencil</a>(</div>
<div class="line">            &amp;g_Device, renderTexture, depthStencilTexture, iconShaderInfo,</div>
<div class="line">            renderTextureInfo.<a name="a504"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a0ba54295e5e7a1ce5c5df85bfd6d1fca">GetWidth</a>(), renderTextureInfo.<a name="a505"></a><a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a6396ddb8217db6fb649eacf01f42e75d">GetHeight</a>() );</div>
<div class="line">        <span class="comment">// 乗算済みアルファはオフ</span></div>
<div class="line">        iconGpuBuffer.<a name="a506"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#a5de11f39c5b63e20ba9845b0dc9a1b87">SetPremultipliedAlphaBlendForBackground</a>(<span class="keyword">false</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// サンプラを初期化</span></div>
<div class="line">    <a name="_a507"></a><a class="code" href="classnn_1_1gfx_1_1_t_sampler.html">nn::gfx::Sampler</a> sampler;</div>
<div class="line">    {</div>
<div class="line">        <a name="_a508"></a><a class="code" href="classnn_1_1gfx_1_1_sampler_info.html">nn::gfx::SamplerInfo</a> samplerInfo;</div>
<div class="line">        <span class="comment">// GetSamplerInfoでサンプラの設定を受け取る</span></div>
<div class="line">        <a name="a509"></a><a class="code" href="namespacenn_1_1mii.html#a7b31fffe1758ba0a5ec80843410a0549">nn::mii::GetSamplerInfo</a>( &amp;samplerInfo );</div>
<div class="line">        sampler.<a name="a510"></a><a class="code" href="classnn_1_1gfx_1_1_t_sampler.html#a409b6c740f965c39549d46d496d1ba0d">Initialize</a>( &amp;g_Device, samplerInfo );</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// サンプラのデスクリプタを設定</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a> samplerSlot;</div>
<div class="line">    g_SamplerDescriptorPool.BeginUpdate();</div>
<div class="line">    g_SamplerDescriptorPool.SetSampler( g_SamplerDescriptorBaseIndex, &amp;sampler );</div>
<div class="line">    g_SamplerDescriptorPool.EndUpdate();</div>
<div class="line">    g_SamplerDescriptorPool.GetDescriptorSlot( &amp;samplerSlot, g_SamplerDescriptorBaseIndex );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アイコンの書き込み先テクスチャのビューを作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_texture_view.html">nn::gfx::TextureView</a> renderTextureView;</div>
<div class="line">    {</div>
<div class="line">        <a name="_a511"></a><a class="code" href="classnn_1_1gfx_1_1_texture_view_info.html">nn::gfx::TextureViewInfo</a> info;</div>
<div class="line">        info.<a name="a512"></a><a class="code" href="classnn_1_1gfx_1_1_texture_view_info.html#a85314df45dd260c6f915685d835e2d3e">SetDefault</a>();</div>
<div class="line">        info.<a name="a513"></a><a class="code" href="classnn_1_1gfx_1_1_texture_view_info.html#accbd6647f7d583cfeaddeecfdc48843e">SetImageFormat</a>( renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a10e760136016b925066005929242c2da">GetImageFormat</a>() );</div>
<div class="line">        info.<a name="a514"></a><a class="code" href="classnn_1_1gfx_1_1_texture_view_info.html#a541b3523db0743886085c5f17a13acf2">SetTexturePtr</a>( &amp;renderTexture );</div>
<div class="line">        renderTextureView.<a name="a515"></a><a class="code" href="classnn_1_1gfx_1_1_t_texture_view.html#abd4b6a9cb75d19c446b1c8cedcf8d5f2">Initialize</a>( &amp;g_Device, info );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 乗算済みアルファ用のテクスチャのビュー作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_texture_view.html">nn::gfx::TextureView</a> premultipliedAlphaTextureView;</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_texture_view_info.html">nn::gfx::TextureViewInfo</a> info;</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_texture_view_info.html#a85314df45dd260c6f915685d835e2d3e">SetDefault</a>();</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_texture_view_info.html#accbd6647f7d583cfeaddeecfdc48843e">SetImageFormat</a>(renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a10e760136016b925066005929242c2da">GetImageFormat</a>());</div>
<div class="line">        info.<a class="code" href="classnn_1_1gfx_1_1_texture_view_info.html#a541b3523db0743886085c5f17a13acf2">SetTexturePtr</a>(&amp;premultipliedAlphaTexture);</div>
<div class="line">        premultipliedAlphaTextureView.<a class="code" href="classnn_1_1gfx_1_1_t_texture_view.html#abd4b6a9cb75d19c446b1c8cedcf8d5f2">Initialize</a>(&amp;g_Device, info);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アイコン書き込み先テクスチャビューをデスクリプタプールに登録</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> renderTextureSlotIndex = g_TextureDescriptorBaseIndex++;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> premultipliedAlphaTextureSlotIndex = g_TextureDescriptorBaseIndex++;</div>
<div class="line">    g_TextureDescriptorPool.BeginUpdate();</div>
<div class="line">    g_TextureDescriptorPool.SetTextureView( renderTextureSlotIndex, &amp;renderTextureView );</div>
<div class="line">    g_TextureDescriptorPool.SetTextureView(premultipliedAlphaTextureSlotIndex, &amp;premultipliedAlphaTextureView);</div>
<div class="line">    g_TextureDescriptorPool.EndUpdate();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 作成したTextureShaderを使用してFacelineとMaskのテクスチャのレンダリング</span></div>
<div class="line">    ResetCommandBuffer();</div>
<div class="line">    g_CommandBuffer.Begin();</div>
<div class="line">    g_CommandBuffer.SetDescriptorPool( &amp;g_TextureDescriptorPool );</div>
<div class="line">    g_CommandBuffer.SetDescriptorPool( &amp;g_SamplerDescriptorPool );</div>
<div class="line">    g_CommandBuffer.InvalidateMemory(</div>
<div class="line">        <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a4a531ae2d7e145f647300ea67bc76ccc">nn::gfx::GpuAccess_Texture</a> | <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a1ba60cf566c205e5c387ecbf68a51fe6">nn::gfx::GpuAccess_IndexBuffer</a></div>
<div class="line">        | <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5af73fa5ff79cf33f75dfecb4cbe5c139d">nn::gfx::GpuAccess_ConstantBuffer</a> | <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5aa319bbae0c949cb5829c882b68e7500a">nn::gfx::GpuAccess_VertexBuffer</a> );</div>
<div class="line">    <span class="comment">// Facelineのレンダリング</span></div>
<div class="line">    textureShader.<a name="a516"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader.html#a5afa8087e7bca441159195dd32567314">DrawFaceline</a>( &amp;g_CommandBuffer, &amp;facelineGpuBuffer, samplerSlot );</div>
<div class="line">    <span class="comment">// Maskのレンダリング</span></div>
<div class="line">    textureShader.<a name="a517"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader.html#af4637e08073f1598162a266af3bd3cbd">DrawMask</a>( &amp;g_CommandBuffer, &amp;maskGpuBuffer, samplerSlot );</div>
<div class="line">    g_CommandBuffer.End();</div>
<div class="line">    g_Queue.ExecuteCommand( &amp;g_CommandBuffer, <span class="keyword">nullptr</span>);</div>
<div class="line">    g_Queue.Sync();</div>
<div class="line">    <span class="comment">// 作成したIconShaderを使用してアイコンの描画</span></div>
<div class="line">    RenderedIcon(&amp;iconGpuBuffer, iconShader, samplerSlot);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 設定を変えてもう一つのアイコンを描画</span></div>
<div class="line">    iconGpuBuffer.<a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#a1885c9fe772a288591b1be3002a61c8b">SetColorTargetAndDepthStencil</a>(</div>
<div class="line">        &amp;g_Device, premultipliedAlphaTexture, depthStencilTexture, iconShaderInfo,</div>
<div class="line">        renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a0ba54295e5e7a1ce5c5df85bfd6d1fca">GetWidth</a>(), renderTextureInfo.<a class="code" href="classnn_1_1gfx_1_1_texture_info.html#a6396ddb8217db6fb649eacf01f42e75d">GetHeight</a>());</div>
<div class="line">    <span class="comment">// 背景色を乗算済みアルファに変換する</span></div>
<div class="line">    <span class="keyword">auto</span> bgColor = IconBackGroundColor;</div>
<div class="line">    bgColor.SetR(bgColor.GetR() * bgColor.GetA());</div>
<div class="line">    bgColor.SetG(bgColor.GetG() * bgColor.GetA());</div>
<div class="line">    bgColor.SetB(bgColor.GetB() * bgColor.GetA());</div>
<div class="line">    iconGpuBuffer.<a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#ad28337c73d108db7749b2782e2deab3a">SetBackgroundColor</a>(bgColor);</div>
<div class="line">    <span class="comment">// 乗算済みアルファをオン</span></div>
<div class="line">    iconGpuBuffer.<a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#a5de11f39c5b63e20ba9845b0dc9a1b87">SetPremultipliedAlphaBlendForBackground</a>(<span class="keyword">true</span>);</div>
<div class="line">    RenderedIcon(&amp;iconGpuBuffer, iconShader, samplerSlot);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Mii 描画用のマテリアルを作成</span></div>
<div class="line">    <a class="code" href="classnn_1_1mii_1_1_material.html">nn::mii::Material</a> material;</div>
<div class="line">    <span class="comment">// Mii描画用のマテリアルを初期化します。</span></div>
<div class="line">    material.<a name="a518"></a><a class="code" href="classnn_1_1mii_1_1_material.html#ab60b3c86e1cb48786948e0c4faeffe08">Initialize</a>(charInfo);</div>
<div class="line">    <span class="comment">// 定数バッファに値を設定</span></div>
<div class="line">    SetupConstantBuffers(charModel, material);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> nextScanBufferIndex = GetNextScanBufferIndexAndWaitDisplayFence();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Mii の顔モデルと作成したアイコンテクスチャの描画</span></div>
<div class="line">    <span class="comment">// 毎フレームのレンダリング</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> frame = 0; frame &lt; 60 * 5; ++frame)</div>
<div class="line">    {</div>
<div class="line">        ResetCommandBuffer();</div>
<div class="line">        g_CommandBuffer.Begin();</div>
<div class="line">        <a class="code" href="classnn_1_1gfx_1_1_t_color_target_view.html">nn::gfx::ColorTargetView</a>* pTarget = g_pScanBufferViews[nextScanBufferIndex];</div>
<div class="line">        g_CommandBuffer.ClearColor( pTarget</div>
<div class="line">                                   , ScreenColor.GetR()</div>
<div class="line">                                   , ScreenColor.GetG()</div>
<div class="line">                                   , ScreenColor.GetB()</div>
<div class="line">                                   , ScreenColor.GetA(), NULL );</div>
<div class="line">        g_CommandBuffer.ClearDepthStencil(&amp;g_DepthStencilView, 1.0f, 255</div>
<div class="line">            , <a name="a519"></a><a class="code" href="namespacenn_1_1gfx.html#a733cd65018ead22dd2cd0a62a8bd2ec9a93c09969027b90e4794060197dedb5fb">nn::gfx::DepthStencilClearMode_DepthStencil</a>, NULL);</div>
<div class="line">        g_CommandBuffer.SetRenderTargets( 1, &amp;pTarget, &amp;g_DepthStencilView );</div>
<div class="line">        g_CommandBuffer.SetViewportScissorState( &amp;g_ViewportScissor );</div>
<div class="line"></div>
<div class="line">        g_CommandBuffer.SetDescriptorPool( &amp;g_TextureDescriptorPool );</div>
<div class="line">        g_CommandBuffer.SetDescriptorPool( &amp;g_SamplerDescriptorPool );</div>
<div class="line"></div>
<div class="line">        g_CommandBuffer.InvalidateMemory(</div>
<div class="line">            <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a4a531ae2d7e145f647300ea67bc76ccc">nn::gfx::GpuAccess_Texture</a> | <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a1ba60cf566c205e5c387ecbf68a51fe6">nn::gfx::GpuAccess_IndexBuffer</a></div>
<div class="line">            | <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5af73fa5ff79cf33f75dfecb4cbe5c139d">nn::gfx::GpuAccess_ConstantBuffer</a> | <a class="code" href="namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5aa319bbae0c949cb5829c882b68e7500a">nn::gfx::GpuAccess_VertexBuffer</a> );</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> idx = 0; idx &lt; DrawType_End; ++idx )</div>
<div class="line">        {</div>
<div class="line">            DrawType drawType = DrawType(idx);</div>
<div class="line">            <span class="keywordflow">switch</span> ( drawType )</div>
<div class="line">            {</div>
<div class="line">            <span class="keywordflow">case</span> DrawType_MiiFace:</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// Mii の顔モデルを直接レンダーターゲットに描画</span></div>
<div class="line">                    DrawMiiFace(charModel, samplerSlot);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            <span class="keywordflow">case</span> DrawType_NormalIcon:</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// 通常のアイコンをレンダーターゲットに描画;</span></div>
<div class="line">                    DrawIconTexture(drawType, renderTextureSlotIndex, samplerSlot);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            <span class="keywordflow">case</span> DrawType_PremultipliedAlphaIcon:</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// 乗算済みアルファを使用したアイコンをレンダーターゲットに描画</span></div>
<div class="line">                    DrawIconTexture(drawType, premultipliedAlphaTextureSlotIndex, samplerSlot);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            <span class="keywordflow">default</span>: <a class="code" href="nn___macro_8h.html#abfe6f7c5f80ef52b7c0616042aba59b9">NN_UNEXPECTED_DEFAULT</a>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        g_CommandBuffer.End();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// コマンドの実行</span></div>
<div class="line">        g_Queue.ExecuteCommand( &amp;g_CommandBuffer, &amp;g_GpuDoneFence );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// 結果の表示</span></div>
<div class="line">        g_Queue.Present( &amp;g_SwapChain, 1 );</div>
<div class="line"></div>
<div class="line">        nextScanBufferIndex = GetNextScanBufferIndexAndWaitDisplayFence();</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="namespacenn_1_1gfx.html#a72827b32d720001860ddbdb33a377b5a">nn::gfx::SyncResult</a> syncResult = g_GpuDoneFence.Sync(<a class="code" href="classnn_1_1_time_span.html#adc879772bbd4cd05381326fe0dd58b97">nn::TimeSpan::FromSeconds</a>(1));</div>
<div class="line">        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( syncResult == <a class="code" href="namespacenn_1_1gfx.html#a72827b32d720001860ddbdb33a377b5aa21ff87cf8dce322eac4519c2e231f736">nn::gfx::SyncResult_Success</a> );</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef WIN32</span></div>
<div class="line">        nn::hws::ProcessMessage();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    material.<a name="a520"></a><a class="code" href="classnn_1_1mii_1_1_material.html#ab97767b55ad6882f1e7a4f8ab2bf1b9f">Finalize</a>();</div>
<div class="line">    iconGpuBuffer.<a name="a521"></a><a class="code" href="classnn_1_1mii_1_1_icon_gpu_buffer.html#a6bc12d1870bf6df80872ae812373d09f">Finalize</a>( &amp;g_Device );</div>
<div class="line">    iconShader.<a name="a522"></a><a class="code" href="classnn_1_1mii_1_1_icon_shader.html#a933285f8a818b9e260b3c0781211a727">Finalize</a>( &amp;g_Device );</div>
<div class="line">    FinalizeResShaderFile( pIconShaderFile, iconShaderCodeType );</div>
<div class="line">    depthStencilTexture.<a name="a523"></a><a class="code" href="classnn_1_1gfx_1_1_t_texture.html#a6c338d7cb41ca394337e5ed8573dbd3b">Finalize</a>( &amp;g_Device );</div>
<div class="line">    premultipliedAlphaTexture.<a class="code" href="classnn_1_1gfx_1_1_t_texture.html#a6c338d7cb41ca394337e5ed8573dbd3b">Finalize</a>(&amp;g_Device);</div>
<div class="line">    premultipliedAlphaTextureView.<a name="a524"></a><a class="code" href="classnn_1_1gfx_1_1_t_texture_view.html#a081d672b58ed42d9609bcebc0dbdf635">Finalize</a>(&amp;g_Device);</div>
<div class="line">    renderTexture.<a class="code" href="classnn_1_1gfx_1_1_t_texture.html#a6c338d7cb41ca394337e5ed8573dbd3b">Finalize</a>( &amp;g_Device );</div>
<div class="line">    renderTextureView.<a class="code" href="classnn_1_1gfx_1_1_t_texture_view.html#a081d672b58ed42d9609bcebc0dbdf635">Finalize</a>( &amp;g_Device );</div>
<div class="line">    sampler.<a name="a525"></a><a class="code" href="classnn_1_1gfx_1_1_t_sampler.html#af725b5cfc86c86d203b292253db4c12b">Finalize</a>( &amp;g_Device );</div>
<div class="line">    maskGpuBuffer.<a name="a526"></a><a class="code" href="classnn_1_1mii_1_1_mask_gpu_buffer.html#a15a42db4ec6662d6de38a991b937852b">Finalize</a>( &amp;g_Device );</div>
<div class="line">    facelineGpuBuffer.<a name="a527"></a><a class="code" href="classnn_1_1mii_1_1_faceline_gpu_buffer.html#a8f7986e2edf85007d3c9eddedaed7f05">Finalize</a>( &amp;g_Device );</div>
<div class="line">    textureShader.<a name="a528"></a><a class="code" href="classnn_1_1mii_1_1_texture_shader.html#a13c162a8817d443e688c80f33aa39c8b">Finalize</a>( &amp;g_Device );</div>
<div class="line">    FinalizeResShaderFile( pTextureShaderFile, textureShaderCodeType );</div>
<div class="line">    mask.<a name="a529"></a><a class="code" href="classnn_1_1mii_1_1_mask.html#a009020edff303723ec0651891dd8ffb0">Finalize</a>( &amp;g_Device );</div>
<div class="line">    faceline.<a name="a530"></a><a class="code" href="classnn_1_1mii_1_1_faceline.html#a4d61c39a466c6e18b74ee649931024e6">Finalize</a>( &amp;g_Device );</div>
<div class="line">    charModel.<a name="a531"></a><a class="code" href="classnn_1_1mii_1_1_char_model.html#a178de0136699ac9dda603c3182fde57a">Finalize</a>( &amp;g_Device );</div>
<div class="line">    resource.<a name="a532"></a><a class="code" href="classnn_1_1mii_1_1_resource.html#a0d9626cded78680b7b44522445889d24">Finalize</a>( &amp;g_Device );</div>
<div class="line">    FinalizeResources();</div>
<div class="line">    FinalizeFs();</div>
<div class="line">}<span class="comment">//NOLINT(impl/function_size)</span></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</body>
</html>
