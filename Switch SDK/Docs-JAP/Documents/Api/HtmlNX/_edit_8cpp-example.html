<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NintendoSDK API Reference: Edit.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 構築: Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>総合概要</span></a></li>
      <li><a href="pages.html"><span>諸情報</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>名前空間</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Edit.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>ソースコードの説明は、<a class="el" href="_page_sample_g3d_edit.html">G3dDemo Edit</a> および <a class="el" href="_edit_8cpp.html" title="ビューアーライブラリーを使用して 3DEditor によるリアルタイム編集を行うサンプルプログラム ...">Edit.cpp</a> を参照してください。</p>
<div class="fragment"><div class="line"><span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><span class="comment">  Copyright (C)Nintendo All rights reserved.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;Edit.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="g3d___viewer_8h.html">nn/g3d/g3d_Viewer.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacenn_1_1util.html">nn::util</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacenn_1_1g3d.html">nn::g3d</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacenn_1_1g3d_1_1viewer.html">nn::g3d::viewer</a>;</div>
<div class="line"></div>
<div class="line"><a name="_a0"></a><a class="code" href="classnn_1_1g3d_1_1_res_shader_archive.html">nn::g3d::ResShaderArchive</a>*  g_pDemoShaderArchive = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="_a1"></a><a class="code" href="classnn_1_1g3d_1_1_res_shading_model.html">nn::g3d::ResShadingModel</a>*   g_pDebugShader = <span class="keyword">nullptr</span>;</div>
<div class="line"><a class="code" href="classnn_1_1g3d_1_1_res_shader_archive.html">nn::g3d::ResShaderArchive</a>*  g_pBranchShader = <span class="keyword">nullptr</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>{</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define RESOURCE_PATH &quot;Resource:/&quot;</span></div>
<div class="line"><span class="preprocessor">#define SHADER_PATH RESOURCE_PATH &quot;shader/&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* BfshaPath[] = {</div>
<div class="line">    SHADER_PATH <span class="stringliteral">&quot;demo.bfsha&quot;</span>,</div>
<div class="line">    SHADER_PATH <span class="stringliteral">&quot;debug.bfsha&quot;</span>,</div>
<div class="line">    SHADER_PATH <span class="stringliteral">&quot;demo_branch.bfsha&quot;</span>, <span class="comment">// アタッチ用の静的分岐シェーダー</span></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* BfresPath[] = {</div>
<div class="line">    RESOURCE_PATH <span class="stringliteral">&quot;env.bfres&quot;</span>,</div>
<div class="line">    RESOURCE_PATH <span class="stringliteral">&quot;human.bfres&quot;</span>,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">EditViewer  g_EditViewer;</div>
<div class="line">EditMenu    g_EditMenu;</div>
<div class="line"></div>
<div class="line">g3ddemo::ResourceHolder     g_Holder;</div>
<div class="line"><a name="_a2"></a><a class="code" href="classnn_1_1g3d_1_1_res_shader_option.html">nn::g3d::ResShaderOption</a>*   g_pOutputOption = <span class="keyword">nullptr</span>;</div>
<div class="line"></div>
<div class="line"><a name="_a3"></a><a class="code" href="classnns_1_1g3d_1_1_render_view.html">nns::g3d::RenderView</a>        g_RenderView;</div>
<div class="line"><a name="_a4"></a><a class="code" href="classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a>*          g_pEnvModelObj;</div>
<div class="line"></div>
<div class="line">g3ddemo::ScreenInfo    g_ScreenInfo;</div>
<div class="line"><a name="_a5"></a><a class="code" href="structnn_1_1util_1_1_vector3f_type.html">nn::util::Vector3fType</a> g_ClearColor;</div>
<div class="line"></div>
<div class="line"><a class="code" href="structnn_1_1util_1_1_vector3f_type.html">nn::util::Vector3fType</a> g_CameraPosition;</div>
<div class="line"><a class="code" href="structnn_1_1util_1_1_vector3f_type.html">nn::util::Vector3fType</a> g_CameraTarget;</div>
<div class="line"><a class="code" href="structnn_1_1util_1_1_vector3f_type.html">nn::util::Vector3fType</a> g_CameraUp;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> g_ViewportWidth;</div>
<div class="line"><span class="keywordtype">int</span> g_ViewportHeight;</div>
<div class="line"></div>
<div class="line"><a name="_a6"></a><a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html">nn::gfx::ViewportScissorState</a> g_ViewportScissorStateForNormal;</div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html">nn::gfx::ViewportScissorState</a> g_ViewportScissorStateForDebug;</div>
<div class="line"><a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html">nn::gfx::ViewportScissorState</a> g_ViewportScissorState;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> g_OutputOptionIndex = -1;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> g_BufferingCount = 1;</div>
<div class="line"></div>
<div class="line"><span class="comment">// nns::g3d::RenderModelObj を生成し、ResourceHolder に登録します。</span></div>
<div class="line"><span class="keywordtype">void</span> CreateRenderModelObjs(<a name="_a7"></a><a class="code" href="classnn_1_1g3d_1_1_res_model.html">nn::g3d::ResModel</a>* pResModel, <span class="keywordtype">int</span> instanceCount) <a name="a8"></a><a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    ::CreateRenderModelObjs(pResModel, instanceCount, <span class="keyword">nullptr</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// リソースの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeResource(<a name="_a9"></a><a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    g_Holder.Initialize();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// サンプラーの参照テクスチャーが空の場合に割り当てられるダミーテクスチャーの初期化</span></div>
<div class="line">    g3ddemo::CreateDummyTextureAndSampler(pDevice);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1g3d_1_1_res_shader_archive.html">nn::g3d::ResShaderArchive</a>* pDemoShaderArchive;</div>
<div class="line">    <a class="code" href="classnn_1_1g3d_1_1_res_shader_archive.html">nn::g3d::ResShaderArchive</a>* pDebugShaderArchive;</div>
<div class="line">    <a class="code" href="classnn_1_1g3d_1_1_res_shader_archive.html">nn::g3d::ResShaderArchive</a>* pDemoBranchArchive;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1g3d_1_1_res_shader_archive.html">nn::g3d::ResShaderArchive</a>** pShaderArchivePtr[] = {</div>
<div class="line">        &amp;pDemoShaderArchive,</div>
<div class="line">        &amp;pDebugShaderArchive,</div>
<div class="line">        &amp;pDemoBranchArchive</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// シェーダーの初期化</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pathIndex = 0; pathIndex &lt; <a name="a10"></a><a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(BfshaPath); ++pathIndex)</div>
<div class="line">    {</div>
<div class="line">        <a name="_a11"></a><a class="code" href="classnn_1_1g3d_1_1_res_shader_file.html">nn::g3d::ResShaderFile</a>* pResShader = g3ddemo::LoadResource&lt;nn::g3d::ResShaderFile&gt;(BfshaPath[pathIndex]);</div>
<div class="line">        pResShader-&gt;<a name="a12"></a><a class="code" href="classnn_1_1g3d_1_1_res_shader_file.html#a6ca625333d1fb3f4b903d0ee4533666c">Setup</a>(pDevice);</div>
<div class="line">        g_Holder.shaderFiles.PushBack(pResShader);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classnn_1_1g3d_1_1_res_shader_archive.html">nn::g3d::ResShaderArchive</a>* pResShaderArchive = pResShader-&gt;<a name="a13"></a><a class="code" href="classnn_1_1g3d_1_1_res_shader_file.html#ab2a9392d9a139efe97b011ac5aec96c4">GetResShaderArchive</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (strstr(BfshaPath[pathIndex], <span class="stringliteral">&quot;demo_branch&quot;</span>))</div>
<div class="line">        {</div>
<div class="line">            g_pBranchShader = pResShaderArchive;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        *pShaderArchivePtr[pathIndex] = pResShaderArchive;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    g_pDemoShaderArchive = pDemoShaderArchive;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code" href="classnn_1_1g3d_1_1_res_shader_file.html">nn::g3d::ResShaderFile</a>* pShaderFile : g_Holder.shaderFiles)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1g3d_1_1_res_shader_archive.html">nn::g3d::ResShaderArchive</a>* pShaderArchive = pShaderFile-&gt;<a class="code" href="classnn_1_1g3d_1_1_res_shader_file.html#ab2a9392d9a139efe97b011ac5aec96c4">GetResShaderArchive</a>();</div>
<div class="line">        g_pDebugShader = pShaderArchive-&gt;<a name="a14"></a><a class="code" href="classnn_1_1g3d_1_1_res_shader_archive.html#a17c81d3fe346cbcc531ad38138b7117b">FindShadingModel</a>(<span class="stringliteral">&quot;debug&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (g_pDebugShader)</div>
<div class="line">        {</div>
<div class="line">            g_OutputOptionIndex = g_pDebugShader-&gt;<a name="a15"></a><a class="code" href="classnn_1_1g3d_1_1_res_shading_model.html#ab65578302250a7b450313ee2f509db5f">FindDynamicOptionIndex</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">            g_pOutputOption = g_pDebugShader-&gt;<a name="a16"></a><a class="code" href="classnn_1_1g3d_1_1_res_shading_model.html#ab3cb25af132609e33f6d2d950e8108f7">FindDynamicOption</a>(<span class="stringliteral">&quot;output&quot;</span>);</div>
<div class="line">            <a name="a17"></a><a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(g_pOutputOption);</div>
<div class="line">            g_EditMenu.SetSelectedItemIndex(EditMenu::ItemShader, g_pOutputOption-&gt;<a name="a18"></a><a class="code" href="classnn_1_1g3d_1_1_res_shader_option.html#a61a2990a60fad21e0c5222081ded79ee">GetDefaultIndex</a>());</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(g_pDebugShader);</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(g_pBranchShader);</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(g_pDemoShaderArchive);</div>
<div class="line"></div>
<div class="line">    <a name="_a19"></a><a class="code" href="classnn_1_1g3d_1_1_res_file.html">nn::g3d::ResFile</a>* pEnvModelFile;</div>
<div class="line">    <a class="code" href="classnn_1_1g3d_1_1_res_file.html">nn::g3d::ResFile</a>* pHumanModelFile;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classnn_1_1g3d_1_1_res_file.html">nn::g3d::ResFile</a>** pResFilePtrArray[] =</div>
<div class="line">    {</div>
<div class="line">        &amp;pEnvModelFile,</div>
<div class="line">        &amp;pHumanModelFile</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// リソースファイルの初期化</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pathIndex = 0; pathIndex &lt; <a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(BfresPath); ++pathIndex)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1g3d_1_1_res_file.html">nn::g3d::ResFile</a>* pResFile = g3ddemo::LoadResource&lt;nn::g3d::ResFile&gt;(BfresPath[pathIndex]);</div>
<div class="line">        pResFile-&gt;<a name="a20"></a><a class="code" href="classnn_1_1g3d_1_1_res_file.html#afeaf3b666d229f4e30fe374ee5707909">Setup</a>(pDevice);</div>
<div class="line">        g_Holder.files.PushBack(pResFile);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// テクスチャーの初期化</span></div>
<div class="line">        g3ddemo::SetupTexture(pDevice, pResFile, g3ddemo::TextureBindCallback);</div>
<div class="line">        g3ddemo::RegisterSamplerToDescriptorPool(pResFile);</div>
<div class="line">        *pResFilePtrArray[pathIndex] = pResFile;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// アニメーションリソースの登録</span></div>
<div class="line">    g3ddemo::RegistAnim(&amp;g_Holder);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// モデルリソースとシェーダーの関連付け</span></div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code" href="classnn_1_1g3d_1_1_res_file.html">nn::g3d::ResFile</a>* pResFile : g_Holder.files)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> modelIndex = 0, modelCount = pResFile-&gt;<a name="a21"></a><a class="code" href="classnn_1_1g3d_1_1_res_file.html#a11812c9a4decdc580ae89986b9454498">GetModelCount</a>(); modelIndex &lt; modelCount; ++modelIndex)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="classnn_1_1g3d_1_1_res_model.html">nn::g3d::ResModel</a>* pResModel = pResFile-&gt;<a name="a22"></a><a class="code" href="classnn_1_1g3d_1_1_res_file.html#ab776cb75749d955956b5b2d4522da962">GetModel</a>(modelIndex);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// 同じリソースから複数のインスタンスを作る例として human_mini は 2 体作成します。</span></div>
<div class="line">            <span class="keywordtype">int</span> instanceCount = (0 == strcmp(<span class="stringliteral">&quot;human_mini&quot;</span>, pResModel-&gt;<a name="a23"></a><a class="code" href="classnn_1_1g3d_1_1_res_model.html#aca2ca478cace80e46c68071c86330880">GetName</a>())) ? 2 : 1;</div>
<div class="line">            CreateRenderModelObjs(pResModel, instanceCount);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ユニフォームブロックの管理を簡単にするため、ライティングなどの設定がマテリアルに設定されているモデルを生成し、</span></div>
<div class="line">    <span class="comment">// そのモデルのユニフォームブロックを他のモデルに割り当てます。</span></div>
<div class="line">    g_pEnvModelObj = g_Holder.renderModelObjs[0]-&gt;GetModelObj();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<a name="_a24"></a><a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj : g_Holder.renderModelObjs)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// ユニフォームブロックを設定</span></div>
<div class="line">        RegisterUniformBlock(pRenderModelObj);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ダミーテクスチャー・サンプラーを設定</span></div>
<div class="line">        <a name="_a25"></a><a class="code" href="classnn_1_1gfx_1_1_descriptor_slot.html">nn::gfx::DescriptorSlot</a> dummyTextureDescriptorSlot;</div>
<div class="line">        g3ddemo::GetDummyTexture()-&gt;GetUserDescriptorSlot(&amp;dummyTextureDescriptorSlot);</div>
<div class="line">        pRenderModelObj-&gt;<a name="a26"></a><a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#a683d1f2d656a642018e98a96025c4e1b">BindDummySampler</a>(dummyTextureDescriptorSlot, g3ddemo::GetDummySamplerDescriptorSlot());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    g3ddemo::SetShaderScratchMemory(g_Holder.shaderFiles);</div>
<div class="line">} <span class="comment">// NOLINT</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// モデルの位置をバウンディング球を元に計算し配置</span></div>
<div class="line"><span class="keywordtype">void</span> ResetModelPositions() <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<a name="_a27"></a><a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html">nns::g3d::ModelAnimObj</a>* pModelAnimObj : g_Holder.modelAnimObjs)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1g3d_1_1_model_obj.html">ModelObj</a>* pModelObj = pModelAnimObj-&gt;<a name="a28"></a><a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a75f2e005c7b06d62f33d69508db503e9">GetModelObj</a>();</div>
<div class="line">        ResetModelPosition(pModelObj);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// スクリーン情報表示を初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeScreenInfo(<a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    g_ScreenInfo.Initialize(pDevice);</div>
<div class="line">    g_ScreenInfo.SetWindowPosition(16, 16);</div>
<div class="line">    g_ScreenInfo.SetFontSize(20);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ビューポートシザーステートの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeViewportScissorState(<a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice, <a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html">nn::gfx::ViewportScissorState</a>* pViewportScissorState, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <a name="_a29"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html">nn::gfx::ViewportScissorState::InfoType</a> info;</div>
<div class="line">    info.<a name="a30"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html#ab9c4f718c28bbd39b9ccb11c1fc74a21">SetDefault</a>();</div>
<div class="line">    info.<a name="a31"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html#a4cfc5de9d6913b0caf3f3d61a6eaae2c">SetScissorEnabled</a>(<span class="keyword">true</span>);</div>
<div class="line">    <a name="_a32"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html">nn::gfx::ViewportStateInfo</a> viewportInfo;</div>
<div class="line">    {</div>
<div class="line">        viewportInfo.<a name="a33"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html#ab2f35b1c78bd77d5d18202cff743902a">SetDefault</a>();</div>
<div class="line">        viewportInfo.<a name="a34"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html#aee472a60b2afe71db02c3de01bf70fa6">SetOriginX</a>(static_cast&lt;float&gt;(x));</div>
<div class="line">        viewportInfo.<a name="a35"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html#a17e063aa6c3ba875844f72d4317642dc">SetOriginY</a>(static_cast&lt;float&gt;(y));</div>
<div class="line">        viewportInfo.<a name="a36"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html#a5f2ee737e00c49646f66bc3eab21824a">SetWidth</a>(static_cast&lt;float&gt;(width));</div>
<div class="line">        viewportInfo.<a name="a37"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_state_info.html#a4546e049c35d16267d7f17c29de27511">SetHeight</a>(static_cast&lt;float&gt;(height));</div>
<div class="line">    }</div>
<div class="line">    <a name="_a38"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html">nn::gfx::ScissorStateInfo</a> scissorInfo;</div>
<div class="line">    {</div>
<div class="line">        scissorInfo.<a name="a39"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html#a6e56a6510701c498bd9b0cf1e2bd76d8">SetDefault</a>();</div>
<div class="line">        scissorInfo.<a name="a40"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html#a038f1d84c3becd6b13a4e233c06684ad">SetOriginX</a>(x);</div>
<div class="line">        scissorInfo.<a name="a41"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html#a306b8d443af1b76e88bc26230f9664a9">SetOriginY</a>(y);</div>
<div class="line">        scissorInfo.<a name="a42"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html#a32b5bcc1f381044da047847f4928285b">SetWidth</a>(width);</div>
<div class="line">        scissorInfo.<a name="a43"></a><a class="code" href="classnn_1_1gfx_1_1_scissor_state_info.html#a57465efb7793057fe855f61d7e10dea0">SetHeight</a>(height);</div>
<div class="line">    }</div>
<div class="line">    info.<a name="a44"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html#a8f4e89948a5dc8d65392565442c4bf77">SetViewportStateInfoArray</a>(&amp;viewportInfo, 1);</div>
<div class="line">    info.<a name="a45"></a><a class="code" href="classnn_1_1gfx_1_1_viewport_scissor_state_info.html#af7b01ae781d2d2b04b88e23e4606f218">SetScissorStateInfoArray</a>(&amp;scissorInfo, 1);</div>
<div class="line">    pViewportScissorState-&gt;<a name="a46"></a><a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html#a0f44e5cfdd496380fc4aa818195adf9e">Initialize</a>(pDevice, info);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ビューポート初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeViewports(<a name="_a47"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html">nns::gfx::GraphicsFramework</a>* pGfxFramework, <a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> viewWidth = pGfxFramework-&gt;<a name="a48"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a68decd5e5c7a89df27eb8d428515e92d">GetDisplayWidth</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> viewHeight = pGfxFramework-&gt;<a name="a49"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#af0da71ea5a113a27c596366259db882e">GetDisplayHeight</a>();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> viewportWidth = viewWidth;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> viewportHeight = viewHeight / 2;</div>
<div class="line">    {</div>
<div class="line">        nn::util::VectorSetX(&amp;g_ClearColor, 0.0f);</div>
<div class="line">        nn::util::VectorSetY(&amp;g_ClearColor, 0.0f);</div>
<div class="line">        nn::util::VectorSetZ(&amp;g_ClearColor, 0.0f);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    g_ViewportWidth = viewportWidth;</div>
<div class="line">    g_ViewportHeight = viewportHeight;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ビューポート初期化</span></div>
<div class="line">    InitializeViewportScissorState(pDevice, &amp;g_ViewportScissorStateForNormal, 0, viewportHeight, viewportWidth, viewportHeight);</div>
<div class="line">    InitializeViewportScissorState(pDevice, &amp;g_ViewportScissorStateForDebug, 0, 0, viewportWidth, viewportHeight);</div>
<div class="line">    InitializeViewportScissorState(pDevice, &amp;g_ViewportScissorState, 0, 0, viewWidth, viewHeight);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ビューポートシザーステートの破棄</span></div>
<div class="line"><span class="keywordtype">void</span> FinalizeViewports(<a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    g_ViewportScissorStateForNormal.<a name="a50"></a><a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html#abe11609e98c342a9739bc67d2e18d50f">Finalize</a>(pDevice);</div>
<div class="line">    g_ViewportScissorStateForDebug.<a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html#abe11609e98c342a9739bc67d2e18d50f">Finalize</a>(pDevice);</div>
<div class="line">    g_ViewportScissorState.<a class="code" href="classnn_1_1gfx_1_1_t_viewport_scissor_state.html#abe11609e98c342a9739bc67d2e18d50f">Finalize</a>(pDevice);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// カメラ初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeView(<a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    nn::util::VectorSet(&amp;g_CameraPosition, 0.0f, 82.5f, 330.0f);</div>
<div class="line">    nn::util::VectorSet(&amp;g_CameraUp, 0.0f, 1.0f, 0.0f);</div>
<div class="line">    nn::util::VectorSet(&amp;g_CameraTarget, 0.0f, 33.0f, 0.0f);</div>
<div class="line"></div>
<div class="line">    g_RenderView.<a name="a51"></a><a class="code" href="classnns_1_1g3d_1_1_render_view.html#a6520169e698d615f7cc77553e32ca88c">Initialize</a>(pDevice, ViewCount, g_BufferingCount);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ビューアーライブラリーの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeViewer() <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    g_EditViewer.Initialize(g_Holder);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ViewerServer の通信処理は別スレッドにすることができます</span></div>
<div class="line">    g_EditViewer.StartPollThread();</div>
<div class="line"></div>
<div class="line">    g_EditViewer.Open();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ビューアーライブラリーの終了処理</span></div>
<div class="line"><span class="keywordtype">void</span> FinalizeViewer() <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    g_EditViewer.Close();</div>
<div class="line">    g_EditViewer.StopPollThread();</div>
<div class="line">    g_EditViewer.Finalize();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// 更新関数</span></div>
<div class="line"><span class="keywordtype">void</span> Calculate(<a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html">nns::gfx::GraphicsFramework</a>* pGfxFramework, <span class="keywordtype">void</span>* pUserData) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// 描画関数</span></div>
<div class="line"><span class="keywordtype">void</span> MakeCommand(<a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html">nns::gfx::GraphicsFramework</a>* pGfxFramework, <span class="keywordtype">int</span> bufferIndex, <span class="keywordtype">void</span>* pUserData) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Edit デモの初期化</span></div>
<div class="line"><span class="keywordtype">void</span> InitializeEdit(<a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html">nns::gfx::GraphicsFramework</a>* pGfxFramework) NN_NOEXCEPT</div>
<div class="line">{</div>
<div class="line">    pGfxFramework-&gt;<a name="a52"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a4d3c1d1a8351f709865afed46452f793">SetFrameworkMode</a>(<a name="a53"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a4987555fae0e257658ffef4beb51a674a8891c59de90c4791c12cbdd0ae4839aa">nns::gfx::GraphicsFramework::FrameworkMode_Immediate</a>);</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice = pGfxFramework-&gt;<a name="a54"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a6dbabc4b1fab1df227e879443468b749">GetDevice</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// スクリーン情報表示を初期化</span></div>
<div class="line">    InitializeScreenInfo(pDevice);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ビューポート初期化</span></div>
<div class="line">    InitializeViewports(pGfxFramework, pDevice);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// カメラ初期化</span></div>
<div class="line">    InitializeView(pDevice);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// リソース初期化</span></div>
<div class="line">    InitializeResource(pDevice);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// モデルの位置を初期化</span></div>
<div class="line">    ResetModelPositions();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 環境モデルの描画情報のクリアカラーを適用</span></div>
<div class="line">    SetClearColorFromEnvModel();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// メニューの初期化</span></div>
<div class="line">    g_EditMenu.Initialize(g_Holder, g_pBranchShader, g_pOutputOption);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ビューアーライブラリーの初期化</span></div>
<div class="line">    InitializeViewer();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// フレームワークに更新・描画関数を設定</span></div>
<div class="line">    pGfxFramework-&gt;<a name="a55"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#af8b095e85b8a9c7aec4f4b9748295885">SetCalculateCallback</a>(Calculate, <span class="keyword">nullptr</span>);</div>
<div class="line">    pGfxFramework-&gt;<a name="a56"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a5bd57c06d0e55d2f66ecc9c6058c8302">SetMakeCommandCallback</a>(MakeCommand, <span class="keyword">nullptr</span>);</div>
<div class="line">    pGfxFramework-&gt;<a name="a57"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a3c1198bea42a57bd909746fd0c5af266">ResetFrame</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Edit デモの終了処理</span></div>
<div class="line"><span class="keywordtype">void</span> FinalizeEdit(<a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice) NN_NOEXCEPT</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ビューアーライブラリーの終了処理</span></div>
<div class="line">    FinalizeViewer();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ビューアーライブラリーが所有しているモデルを破棄しないように、</span></div>
<div class="line">    <span class="comment">// ビューアの終了処理後に残りのデータの破棄を行います</span></div>
<div class="line">    g3ddemo::DestroyAll(pDevice, &amp;g_Holder);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ビュー用ユニフォームブロックの破棄</span></div>
<div class="line">    g_RenderView.<a name="a58"></a><a class="code" href="classnns_1_1g3d_1_1_render_view.html#ae2461a77f4a4a5f2c954516604f35a9e">Finalize</a>(pDevice);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ダミーテクスチャーの破棄</span></div>
<div class="line">    g3ddemo::DeleteDummyTextureAndSampler(pDevice);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ビューポートの破棄</span></div>
<div class="line">    FinalizeViewports(pDevice);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// スクリーン情報表示の破棄</span></div>
<div class="line">    g_ScreenInfo.Cleanup(pDevice);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Env ユニフォームブロックの更新</span></div>
<div class="line"><span class="keywordtype">void</span> RegisterEnvUniformBlock(<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj) NN_NOEXCEPT</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <a name="_a59"></a><a class="code" href="classnn_1_1gfx_1_1_t_buffer.html">nn::gfx::Buffer</a>* buffer = g_pEnvModelObj-&gt;<a name="a60"></a><a class="code" href="classnn_1_1g3d_1_1_model_obj.html#a225cda4a0e7881df5dc4ebb15ac6c6f6">GetMaterial</a>(0)-&gt;<a name="a61"></a><a class="code" href="classnn_1_1g3d_1_1_material_obj.html#aef15d5bfda74edf022aa6337f13d52ed">GetMaterialBlock</a>(0);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// シェーダーアサインに定義されてるシェーディングモデル名が env だった場合には、</span></div>
<div class="line">    <span class="comment">// マテリアルユニフォームブロックを利用するため設定を行いません。</span></div>
<div class="line">    <a class="code" href="classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a>* pModelObj = pRenderModelObj-&gt;<a name="a62"></a><a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#aa0a852cc2943033071f80f6660185518">GetModelObj</a>();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> shapeIndex = 0, shapeCount = pModelObj-&gt;<a name="a63"></a><a class="code" href="classnn_1_1g3d_1_1_model_obj.html#a54e1cf48111ecb56b8dde5824d13a1fd">GetShapeCount</a>(); shapeIndex &lt; shapeCount; ++shapeIndex)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> materialIndex = pModelObj-&gt;<a name="a64"></a><a class="code" href="classnn_1_1g3d_1_1_model_obj.html#a4f56c9a4a685ff577c44b60bc50f5a8b">GetShape</a>(shapeIndex)-&gt;<a name="a65"></a><a class="code" href="classnn_1_1g3d_1_1_shape_obj.html#af40ab5352dfd30bc5e42f9aff17a70dc">GetMaterialIndex</a>();</div>
<div class="line">        <span class="keyword">const</span> <a name="_a66"></a><a class="code" href="classnn_1_1g3d_1_1_material_obj.html">nn::g3d::MaterialObj</a>* pMaterialObj = pModelObj-&gt;<a class="code" href="classnn_1_1g3d_1_1_model_obj.html#a225cda4a0e7881df5dc4ebb15ac6c6f6">GetMaterial</a>(materialIndex);</div>
<div class="line">        <span class="keyword">const</span> <a name="_a67"></a><a class="code" href="classnn_1_1g3d_1_1_res_shader_assign.html">nn::g3d::ResShaderAssign</a>* pShaderAssign = pMaterialObj-&gt;<a name="a68"></a><a class="code" href="classnn_1_1g3d_1_1_material_obj.html#ac83012bf24ce5dafd6fed058a9700975">GetResource</a>()-&gt;<a name="a69"></a><a class="code" href="classnn_1_1g3d_1_1_res_material.html#a264b8eaf26b01fcf6dc0771b27c03aad">GetShaderAssign</a>();</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* shadingModelName = pShaderAssign-&gt;<a name="a70"></a><a class="code" href="classnn_1_1g3d_1_1_res_shader_assign.html#af19bb02607868a0ee63245e8eda8d642">GetShadingModelName</a>();</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(shadingModelName, <span class="stringliteral">&quot;env&quot;</span>) == 0)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        pRenderModelObj-&gt;<a name="a71"></a><a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#a7c323f2e5100196cc55a5d778de6630a">GetRenderUnitObj</a>(shapeIndex)-&gt;<a name="a72"></a><a class="code" href="classnns_1_1g3d_1_1_render_unit_obj.html#a879b6856bffb1352bc6a4f5ba5ee93cc">BindUniformBlock</a>(DrawPassType_Default, <span class="stringliteral">&quot;env&quot;</span>, &amp;buffer, g_BufferingCount);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Edit デモの更新処理</span></div>
<div class="line"><span class="keywordtype">void</span> Calculate(<a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html">nns::gfx::GraphicsFramework</a>* pGfxFramework, <span class="keywordtype">void</span>* pUserData) NN_NOEXCEPT</div>
<div class="line">{</div>
<div class="line">    <a name="a73"></a><a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(pUserData);</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice = pGfxFramework-&gt;<a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a6dbabc4b1fab1df227e879443468b749">GetDevice</a>();</div>
<div class="line"></div>
<div class="line">    g3ddemo::Pad&amp; pad = g3ddemo::GetPad();</div>
<div class="line">    g_EditMenu.CalculateCPU(&amp;g_EditViewer, pad);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ビューアーの更新</span></div>
<div class="line">    g_EditViewer.Update();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// モデルの更新</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html">nns::g3d::ModelAnimObj</a>* pModelAnimObj : g_Holder.modelAnimObjs)</div>
<div class="line">        {</div>
<div class="line">            pModelAnimObj-&gt;<a name="a74"></a><a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a82b107da95e7e3d784c583231239312c">CalculateAnimations</a>();</div>
<div class="line"></div>
<div class="line">            <span class="comment">// 3DEditor でスケルタルア二メーションが再生されていた場合には、</span></div>
<div class="line">            <span class="comment">// CalculateAnimations() で更新されたアニメーションを上書きします。</span></div>
<div class="line">            <span class="comment">// また、キャッシュを活用するためにスケルタルアニメーションの計算から</span></div>
<div class="line">            <span class="comment">// ワールド行列計算までを連続して行います。</span></div>
<div class="line">            <a name="a75"></a><a class="code" href="classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#a47e4dee10fee77c93daece0d2f6ccd83">nn::g3d::viewer::ViewerServer::GetInstance</a>().<a name="a76"></a><a class="code" href="classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#af3db15d17f92c36d93953eab0413163a">CalculateSkeletalAnimations</a>(pModelAnimObj-&gt;<a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a75f2e005c7b06d62f33d69508db503e9">GetModelObj</a>());</div>
<div class="line"></div>
<div class="line">            pModelAnimObj-&gt;<a name="a77"></a><a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a02e5ba16654e2ac74bcb2caaed0900ec">CalculateWorld</a>();</div>
<div class="line">            pModelAnimObj-&gt;<a name="a78"></a><a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#acefaadd93924a74297cad50f9b37ec5f">CalculateBounding</a>();</div>
<div class="line">            pModelAnimObj-&gt;<a name="a79"></a><a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a138bf661637dd7746f7eb3f22a810553">CalculateView</a>(0, 0, g_RenderView.<a name="a80"></a><a class="code" href="classnns_1_1g3d_1_1_render_view.html#aff24f2ebd999e9d9f423945fa9d4e8e0">GetViewMtx</a>(0));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#a47e4dee10fee77c93daece0d2f6ccd83">nn::g3d::viewer::ViewerServer::GetInstance</a>().<a name="a81"></a><a class="code" href="classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#a59245dea48b7f205905c636c40db9806">CalculateAnimations</a>();</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html">nns::g3d::ModelAnimObj</a>* pModelAnimObj : g_Holder.modelAnimObjs)</div>
<div class="line">        {</div>
<div class="line">            pModelAnimObj-&gt;<a name="a82"></a><a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a42dadacf320552419e3c79da07846ad4">CalculateUniformBlock</a>(0);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj : g_Holder.renderModelObjs)</div>
<div class="line">        {</div>
<div class="line">            RegisterEnvUniformBlock(pRenderModelObj);</div>
<div class="line">            pRenderModelObj-&gt;<a name="a83"></a><a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#a2abf914afb4d7489f87c6ea7a3fe5ac1">UpdateShader</a>(pDevice);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// カメラの更新</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> selectedModelIndex = g_EditMenu.GetSelectedItemIndex(EditMenu::ItemModel);</div>
<div class="line">        <span class="keywordflow">if</span> (selectedModelIndex &lt; g_Holder.modelAnimObjs.GetCount())</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// アニメーションしたときにも選択モデルの動きを追従できるよう毎フレーム</span></div>
<div class="line">            <span class="comment">// カメラの位置を更新する</span></div>
<div class="line">            <a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html">nns::g3d::ModelAnimObj</a>* pModelAnimObj = g_Holder.modelAnimObjs[selectedModelIndex];</div>
<div class="line">            g3ddemo::LookAtModel(&amp;g_CameraPosition, &amp;g_CameraTarget, pModelAnimObj-&gt;<a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a75f2e005c7b06d62f33d69508db503e9">GetModelObj</a>());</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <a name="_a84"></a><a class="code" href="structnn_1_1util_1_1_matrix_row_major4x3f_type.html">nn::util::Matrix4x3fType</a> matrix;</div>
<div class="line">            MatrixLookAtRightHanded(</div>
<div class="line">                &amp;matrix, g_CameraPosition, g_CameraTarget, g_CameraUp);</div>
<div class="line">            g_RenderView.<a name="a85"></a><a class="code" href="classnns_1_1g3d_1_1_render_view.html#a5b633742724f63bffdb11389a06b974b">SetViewMtx</a>(0, matrix);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">float</span> aspect = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(g_ViewportWidth) / static_cast&lt;float&gt;(g_ViewportHeight);</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// 投影行列</span></div>
<div class="line">            <a name="_a86"></a><a class="code" href="structnn_1_1util_1_1_matrix_row_major4x4f_type.html">nn::util::Matrix4x4fType</a> matrix;</div>
<div class="line">            MatrixPerspectiveFieldOfViewRightHanded(</div>
<div class="line">                &amp;matrix, <a name="a87"></a><a class="code" href="namespacenn_1_1util.html#a342713848fbb4ce6750da90d297bc824">nn::util::DegreeToRadian</a>(45.0f), aspect, 10.0f, 40000.0f);</div>
<div class="line">            g_RenderView.<a name="a88"></a><a class="code" href="classnns_1_1g3d_1_1_render_view.html#ab2d9de5f49ec96d7672389badb1acf46">SetProjectionMtx</a>(0, matrix);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        g_RenderView.<a name="a89"></a><a class="code" href="classnns_1_1g3d_1_1_render_view.html#aea54457661666de292743fe0cb6c75a0">Calculate</a>(0);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Edit デモの描画処理</span></div>
<div class="line"><span class="keywordtype">void</span> MakeCommand(<a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html">nns::gfx::GraphicsFramework</a>* pGfxFramework, <span class="keywordtype">int</span> bufferIndex, <span class="keywordtype">void</span>* pUserData) NN_NOEXCEPT</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(pUserData);</div>
<div class="line"></div>
<div class="line">    pGfxFramework-&gt;<a name="a90"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a1682d81714db542ef9bb6aae8908b19f">BeginFrame</a>(bufferIndex);</div>
<div class="line">    {</div>
<div class="line">        <a name="_a91"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html">nn::gfx::CommandBuffer</a>* pGfxCommandBuffer = pGfxFramework-&gt;<a name="a92"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a80b4defad13752d673db840e439d1a7f">GetRootCommandBuffer</a>(bufferIndex);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// カラーターゲットをクリア</span></div>
<div class="line">        <a name="_a93"></a><a class="code" href="classnn_1_1gfx_1_1_t_color_target_view.html">nn::gfx::ColorTargetView</a>* pColor = pGfxFramework-&gt;<a name="a94"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#ab825acf6f1e23e4946e8915d087a94a1">GetColorTargetView</a>();</div>
<div class="line">        pGfxCommandBuffer-&gt;<a name="a95"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a3da2d3c95fe888adb5a3f84dcc013d45">ClearColor</a>(pColor, nn::util::VectorGetX(g_ClearColor), nn::util::VectorGetY(g_ClearColor), nn::util::VectorGetZ(g_ClearColor), 1.0f, <span class="keyword">nullptr</span>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// 深度ステンシルをクリア</span></div>
<div class="line">        <a name="_a96"></a><a class="code" href="classnn_1_1gfx_1_1_t_depth_stencil_view.html">nn::gfx::DepthStencilView</a>* pDepth = pGfxFramework-&gt;<a name="a97"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#ae375791c8ef66431a6910dafd0156bb2">GetDepthStencilView</a>();</div>
<div class="line">        pGfxCommandBuffer-&gt;<a name="a98"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ae51f685157847b92ffb0c05362a4a6ef">ClearDepthStencil</a>(pDepth, 1.0f, 0, <a name="a99"></a><a class="code" href="namespacenn_1_1gfx.html#a733cd65018ead22dd2cd0a62a8bd2ec9a93c09969027b90e4794060197dedb5fb">nn::gfx::DepthStencilClearMode_DepthStencil</a>, <span class="keyword">nullptr</span>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// レンダーターゲットをセット</span></div>
<div class="line">        pGfxCommandBuffer-&gt;<a name="a100"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#a3698a1cbd3b59b649c048f709ddd766c">SetRenderTargets</a>(1, &amp;pColor, pDepth);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// 通常パスの描画</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// ビューポートをセットする</span></div>
<div class="line">            pGfxCommandBuffer-&gt;<a name="a101"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab1c541475f015777b8ce4bdfffe7c1c3">SetViewportScissorState</a>(&amp;g_ViewportScissorStateForNormal);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj : g_Holder.renderModelObjs)</div>
<div class="line">            {</div>
<div class="line">                pRenderModelObj-&gt;<a name="a102"></a><a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#aa4061058dfcb32e29b89c6f50cb23738">Draw</a>(pGfxCommandBuffer, DrawPassType_Default, 0, 0);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// デバッグパスの描画</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// ビューポートをセットする</span></div>
<div class="line">            pGfxCommandBuffer-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab1c541475f015777b8ce4bdfffe7c1c3">SetViewportScissorState</a>(&amp;g_ViewportScissorStateForDebug);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj : g_Holder.renderModelObjs)</div>
<div class="line">            {</div>
<div class="line">                pRenderModelObj-&gt;<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#aa4061058dfcb32e29b89c6f50cb23738">Draw</a>(pGfxCommandBuffer, DrawPassType_Debug, 0, 0);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// テキスト描画 コマンド生成</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// ビューポートを全画面に戻します。</span></div>
<div class="line">            pGfxCommandBuffer-&gt;<a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html#ab1c541475f015777b8ce4bdfffe7c1c3">SetViewportScissorState</a>(&amp;g_ViewportScissorState);</div>
<div class="line"></div>
<div class="line">            g_EditMenu.CalculateGPU(g_ScreenInfo);</div>
<div class="line">            g_ScreenInfo.Draw(pGfxCommandBuffer);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    pGfxFramework-&gt;<a name="a103"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#ae8a95943cd296bb2ad8ab6e6532b7b0e">EndFrame</a>(bufferIndex);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">} <span class="comment">// anonymous namespace</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// nns::g3d::RenderModelObj を生成し、ResourceHolder に登録します。</span></div>
<div class="line"><span class="keywordtype">void</span> CreateRenderModelObjs(<a class="code" href="classnn_1_1g3d_1_1_res_model.html">nn::g3d::ResModel</a>* pResModel, <span class="keywordtype">int</span> instanceCount, CreateModelInstanceCallback pFunction) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice = g3ddemo::GetGfxFramework()-&gt;GetDevice();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// モデルの頂点ステート、デプスステンシルステート、ブレンドステート、ラスタライザーステートを管理する RenderModel を作成</span></div>
<div class="line">    <a name="_a104"></a><a class="code" href="classnns_1_1g3d_1_1_render_model.html">nns::g3d::RenderModel</a>* pRenderModel = <a name="a105"></a><a class="code" href="namespacenns_1_1g3d.html#aa1c714afc7a0cf4a993dcbc6774f1643">nns::g3d::CreateRenderModel</a>(pDevice, pResModel, DrawPassType_Count);</div>
<div class="line">    pRenderModel-&gt;<a name="a106"></a><a class="code" href="classnns_1_1g3d_1_1_render_model.html#aa157d2168a767b3333c62aa5cc120973">CreateDrawPass</a>(pDevice, DrawPassType_Default, g_pDemoShaderArchive);</div>
<div class="line">    pRenderModel-&gt;<a class="code" href="classnns_1_1g3d_1_1_render_model.html#aa157d2168a767b3333c62aa5cc120973">CreateDrawPass</a>(pDevice, DrawPassType_Debug, g_pDebugShader);</div>
<div class="line">    g_Holder.renderModels.PushBack(pRenderModel);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// モデルインスタンスの情報を設定</span></div>
<div class="line">    <a name="_a107"></a><a class="code" href="classnn_1_1g3d_1_1_model_obj_1_1_builder.html">nn::g3d::ModelObj::Builder</a> builder(pResModel);</div>
<div class="line">    {</div>
<div class="line">        builder.SetBoundingEnabled();</div>
<div class="line">        builder.ShapeBufferingCount(g_BufferingCount);</div>
<div class="line">        builder.SkeletonBufferingCount(g_BufferingCount);</div>
<div class="line">        builder.MaterialBufferingCount(g_BufferingCount);</div>
<div class="line">        builder.ViewCount(ViewCount);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> instanceIndex = 0; instanceIndex &lt; instanceCount; ++instanceIndex)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// モデルの計算処理を簡略化する ModelAnimObj を作成</span></div>
<div class="line">        <a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html">nns::g3d::ModelAnimObj</a>* pModelAnimObj;</div>
<div class="line">        pModelAnimObj = <a name="a108"></a><a class="code" href="namespacenns_1_1g3d.html#a72152fa94a41e3511738bf0a9bc7c255">nns::g3d::CreateModelAnimObj</a>(pDevice, builder);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a>* pModelObj = pModelAnimObj-&gt;<a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a75f2e005c7b06d62f33d69508db503e9">GetModelObj</a>();</div>
<div class="line">        pModelObj-&gt;<a name="a109"></a><a class="code" href="classnn_1_1g3d_1_1_model_obj.html#a8dc5f1d928333a3ad9db4ddcbef79364">SetUserPtr</a>(pModelAnimObj);</div>
<div class="line">        g_Holder.modelAnimObjs.PushBack(pModelAnimObj);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// RenderModel と ModelObj を組み合わせ、描画を行う RenderModelObj を作成</span></div>
<div class="line">        <a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj = <a name="a110"></a><a class="code" href="namespacenns_1_1g3d.html#a4d8d828fb260a742ceca742312144c68">nns::g3d::CreateRenderModelObj</a>(pModelObj, pRenderModel);</div>
<div class="line">        g_Holder.renderModelObjs.PushBack(pRenderModelObj);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// モデルインスタンス単位で必要な処理が設定されていた場合、実行します。</span></div>
<div class="line">        <span class="keywordflow">if</span> (pFunction)</div>
<div class="line">        {</div>
<div class="line">            pFunction(pModelObj);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// RenderModelObj を描画するために必要なユニフォームブロックを割り当てます。</span></div>
<div class="line"><span class="keywordtype">void</span> RegisterUniformBlock(<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    RegisterEnvUniformBlock(pRenderModelObj);</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1gfx_1_1_t_buffer.html">nn::gfx::Buffer</a>* buffer;</div>
<div class="line">    buffer = g_RenderView.<a name="a111"></a><a class="code" href="classnns_1_1g3d_1_1_render_view.html#ac12827c0d0788017a196ef5b80304304">GetViewUniformBlock</a>(0, 0);</div>
<div class="line">    pRenderModelObj-&gt;<a name="a112"></a><a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#a51705d6e0cbec14deae05e0dc0724835">BindUniformBlock</a>(<span class="stringliteral">&quot;view&quot;</span>, &amp;buffer, g_BufferingCount);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> SetViewProjectionMatrix(<span class="keywordtype">int</span> index, <span class="keyword">const</span> <a class="code" href="structnn_1_1util_1_1_matrix_row_major4x3f_type.html">nn::util::Matrix4x3fType</a>&amp; viewMtx, <span class="keyword">const</span> <a class="code" href="structnn_1_1util_1_1_matrix_row_major4x4f_type.html">nn::util::Matrix4x4fType</a>&amp; projMtx) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    g_RenderView.<a class="code" href="classnns_1_1g3d_1_1_render_view.html#a5b633742724f63bffdb11389a06b974b">SetViewMtx</a>(index, viewMtx);</div>
<div class="line">    g_RenderView.<a class="code" href="classnns_1_1g3d_1_1_render_view.html#ab2d9de5f49ec96d7672389badb1acf46">SetProjectionMtx</a>(index, projMtx);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> SetClearColorFromEnvModel() <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <a name="a113"></a><a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(g_pEnvModelObj-&gt;GetMaterialCount() &gt; 0);</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a name="_a114"></a><a class="code" href="classnn_1_1g3d_1_1_res_material.html">ResMaterial</a>* pResMaterial = g_pEnvModelObj-&gt;GetMaterial(0)-&gt;GetResource();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> renderInfoIndex = 0, renderInfoCount = pResMaterial-&gt;GetRenderInfoCount();</div>
<div class="line">        renderInfoIndex &lt; renderInfoCount; ++renderInfoIndex)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a name="_a115"></a><a class="code" href="classnn_1_1g3d_1_1_res_render_info.html">ResRenderInfo</a>* pResRenderInfo = pResMaterial-&gt;GetRenderInfo(renderInfoIndex);</div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(RenderInfoClearColorName, pResRenderInfo-&gt;<a name="a116"></a><a class="code" href="classnn_1_1g3d_1_1_res_render_info.html#ae1a644cbd2af4f642504b7a1005f7dec">GetName</a>()) == 0)</div>
<div class="line">        {</div>
<div class="line">            SetClearColor(pResRenderInfo);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> SetClearColor(<span class="keyword">const</span> <a class="code" href="classnn_1_1g3d_1_1_res_render_info.html">nn::g3d::ResRenderInfo</a>* pResRenderInfo) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> length = pResRenderInfo-&gt;<a name="a117"></a><a class="code" href="classnn_1_1g3d_1_1_res_render_info.html#a7325e489c6d8d37b2a6af77a54f5b090">GetArrayLength</a>();</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(pResRenderInfo-&gt;<a name="a118"></a><a class="code" href="classnn_1_1g3d_1_1_res_render_info.html#ae17a982c86f4a06742b31a30322daaef">GetType</a>() == <a name="a119"></a><a class="code" href="classnn_1_1g3d_1_1_res_render_info.html#a4b250bb6076be7303f38f281cdc79521a5c2e7b7bd9bd875b8dbb02446a4d2209">nn::g3d::ResRenderInfo::Type_Float</a>);</div>
<div class="line">    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0 &lt;= length &amp;&amp; length &lt;= 3);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (length &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        nn::util::VectorSetX(&amp;g_ClearColor, pResRenderInfo-&gt;<a name="a120"></a><a class="code" href="classnn_1_1g3d_1_1_res_render_info.html#a0b1c06324291989264f7d9fe48cea558">GetFloat</a>()[0]);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (length &gt; 1)</div>
<div class="line">    {</div>
<div class="line">        nn::util::VectorSetY(&amp;g_ClearColor, pResRenderInfo-&gt;<a class="code" href="classnn_1_1g3d_1_1_res_render_info.html#a0b1c06324291989264f7d9fe48cea558">GetFloat</a>()[1]);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (length &gt; 2)</div>
<div class="line">    {</div>
<div class="line">        nn::util::VectorSetZ(&amp;g_ClearColor, pResRenderInfo-&gt;<a class="code" href="classnn_1_1g3d_1_1_res_render_info.html#a0b1c06324291989264f7d9fe48cea558">GetFloat</a>()[2]);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> WriteDynamicKey() <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj : g_Holder.renderModelObjs)</div>
<div class="line">    {</div>
<div class="line">        WriteDynamicKey(pRenderModelObj);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> WriteDynamicKey(<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    g3ddemo::WriteSkinningOption(pRenderModelObj);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> shapeIndex = 0, shapeCount = pRenderModelObj-&gt;<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#aa0a852cc2943033071f80f6660185518">GetModelObj</a>()-&gt;<a class="code" href="classnn_1_1g3d_1_1_model_obj.html#a54e1cf48111ecb56b8dde5824d13a1fd">GetShapeCount</a>(); shapeIndex &lt; shapeCount; ++shapeIndex)</div>
<div class="line">    {</div>
<div class="line">        pRenderModelObj-&gt;<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#a7c323f2e5100196cc55a5d778de6630a">GetRenderUnitObj</a>(shapeIndex)-&gt;<a name="a121"></a><a class="code" href="classnns_1_1g3d_1_1_render_unit_obj.html#ac3f3d5d30665ffbeb4b004dc45aadf23">GetShaderSelector</a>(DrawPassType_Debug)-&gt;<a name="a122"></a><a class="code" href="classnn_1_1g3d_1_1_shader_selector.html#a3afe10975f2f1896503ceedda3e04773">WriteDynamicKey</a>(g_OutputOptionIndex, g_EditMenu.GetSelectedItemIndex(EditMenu::ItemShader));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> ResetModelPosition(<span class="keyword">const</span> <a class="code" href="classnn_1_1g3d_1_1_model_obj.html">ModelObj</a>* pTargetModelObj) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <a name="_a123"></a><a class="code" href="classnn_1_1util_1_1_vector3f.html">nn::util::Vector3f</a> position(0.0f, 0.0f, 0.0f);</div>
<div class="line">    <span class="keywordflow">for</span>(<a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html">nns::g3d::ModelAnimObj</a>* pModelAnimObj : g_Holder.modelAnimObjs)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classnn_1_1g3d_1_1_model_obj.html">ModelObj</a>* pModelObj = pModelAnimObj-&gt;<a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a75f2e005c7b06d62f33d69508db503e9">GetModelObj</a>();</div>
<div class="line">        pModelAnimObj-&gt;<a name="a124"></a><a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#a7617f902f6a526edb87b9857e8b6d106">Calculate</a>();</div>
<div class="line">        <a name="_a125"></a><a class="code" href="structnn_1_1g3d_1_1_sphere.html">nn::g3d::Sphere</a>* pBoundingSphere = pModelObj-&gt;<a name="a126"></a><a class="code" href="classnn_1_1g3d_1_1_model_obj.html#a27842ce94493d5891b1cffd92233a73a">GetBounding</a>();</div>
<div class="line">        nn::util::VectorSetX(&amp;position, nn::util::VectorGetX(position) + pBoundingSphere-&gt;<a name="a127"></a><a class="code" href="structnn_1_1g3d_1_1_sphere.html#a6a3b0a90d98a62e136cf04663c001f6a">radius</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (pModelObj == pTargetModelObj)</div>
<div class="line">        {</div>
<div class="line">            pModelAnimObj-&gt;<a name="a128"></a><a class="code" href="classnns_1_1g3d_1_1_model_anim_obj.html#ab1d22a1e60ac9dd1fb7693064364f02d">SetTranslate</a>(position);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        nn::util::VectorSetX(&amp;position, nn::util::VectorGetX(position) + pBoundingSphere-&gt;<a class="code" href="structnn_1_1g3d_1_1_sphere.html#a6a3b0a90d98a62e136cf04663c001f6a">radius</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> SetSelectedModelIndex(<span class="keywordtype">int</span> index) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    g_EditMenu.SetSelectedItemIndex(EditMenu::ItemModel, index);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> GetSelectedModelIndex() <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> g_EditMenu.GetSelectedItemIndex(EditMenu::ItemModel);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> SetupRenderModelObjForEdit(<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html">nns::g3d::RenderModelObj</a>* pRenderModelObj) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ダミーサンプラーを割り当てます。</span></div>
<div class="line">    <a name="_a129"></a><a class="code" href="classnn_1_1g3d_1_1_texture_ref.html">nn::g3d::TextureRef</a> dummyTextureRef = g3ddemo::GetDummyTextureRef();</div>
<div class="line">    pRenderModelObj-&gt;<a class="code" href="classnns_1_1g3d_1_1_render_model_obj.html#a683d1f2d656a642018e98a96025c4e1b">BindDummySampler</a>(dummyTextureRef.<a name="a130"></a><a class="code" href="classnn_1_1g3d_1_1_texture_ref.html#a6371d19f32919f27e2e52155c097cf98">GetDescriptorSlot</a>(), g3ddemo::GetDummySamplerDescriptorSlot());</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ユニフォームブロックを割り当てます。</span></div>
<div class="line">    RegisterUniformBlock(pRenderModelObj);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// シェーダーキーの更新</span></div>
<div class="line">    WriteDynamicKey(pRenderModelObj);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> EditMain() <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html">nns::gfx::GraphicsFramework</a>* pGfxFramework = g3ddemo::GetGfxFramework();</div>
<div class="line">    pGfxFramework-&gt;<a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a4d3c1d1a8351f709865afed46452f793">SetFrameworkMode</a>(<a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a4987555fae0e257658ffef4beb51a674a8891c59de90c4791c12cbdd0ae4839aa">nns::gfx::GraphicsFramework::FrameworkMode_Immediate</a>);</div>
<div class="line">    <a class="code" href="classnn_1_1gfx_1_1_t_device.html">nn::gfx::Device</a>* pDevice = pGfxFramework-&gt;<a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a6dbabc4b1fab1df227e879443468b749">GetDevice</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 初期化</span></div>
<div class="line">    InitializeEdit(pGfxFramework);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> restart = <span class="keyword">false</span>;</div>
<div class="line">    g3ddemo::Pad&amp; pad = g3ddemo::GetPad();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// メインループ</span></div>
<div class="line">    <span class="keywordflow">while</span> (<a name="a131"></a><a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(1))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// タッチ長押しで終了</span></div>
<div class="line">        g3ddemo::GetControllerManager()-&gt;Update();</div>
<div class="line">        <span class="keywordflow">if</span> (g3ddemo::isExitDemo())</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!pad.Read() || pad.IsTriggered(g3ddemo::Pad::BUTTON_START))</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (pad.IsHold(g3ddemo::Pad::TRIGGER_R))</div>
<div class="line">            {</div>
<div class="line">                restart = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        pGfxFramework-&gt;<a name="a132"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#ae892743d09dd228c56ac17c99fa7789f">ProcessFrame</a>();</div>
<div class="line">    }</div>
<div class="line">    pGfxFramework-&gt;<a name="a133"></a><a class="code" href="classnns_1_1gfx_1_1_graphics_framework.html#a8123c6c4c936915e693da89b566f7d34">QueueFinish</a>();</div>
<div class="line"></div>
<div class="line">    FinalizeEdit(pDevice);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> restart ? -1 : EXIT_SUCCESS;</div>
<div class="line">} <span class="comment">// NOLINT</span></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</body>
</html>
