<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NintendoSDK API Reference: HidControllerSequence_Game.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 構築: Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'検索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>総合概要</span></a></li>
      <li><a href="pages.html"><span>諸情報</span></a></li>
      <li><a href="modules.html"><span>モジュール</span></a></li>
      <li><a href="namespaces.html"><span>名前空間</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li><a href="files.html"><span>ファイル</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="検索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">HidControllerSequence_Game.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>ソースコードの説明は、<a class="el" href="_page_sample_hid_controller_sequence__game.html">ゲーム画面でのコントローラーサポートアプレットの呼び出し方</a> および <a class="el" href="_hid_controller_sequence___game_8cpp.html" title="サンプルアプリケーションのゲーム画面でのコントローラーサポートアプレットの呼び出し方 ...">HidControllerSequence_Game.cpp</a> を参照してください。</p>
<div class="fragment"><div class="line"><span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><span class="comment">  Copyright (C)Nintendo All rights reserved.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;./HidControllerSequence_Game.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> nns::hid::ButtonSet <a name="a0"></a><a class="code" href="class_player.html#ad986a8a63e7f104ca5bba2680b009eca">Player::MoveButtonSet</a> = nns::hid::Button::Left::Mask | nns::hid::Button::Right::Mask;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">float</span> <a name="a1"></a><a class="code" href="class_player.html#a85c105a967e0e834c650017572a0aeb5">Player::MaxSpeed</a> = 16.f;</div>
<div class="line"><span class="keyword">const</span> <a name="_a2"></a><a class="code" href="structnn_1_1util_1_1_float4.html">nn::util::Float4</a> <a name="a3"></a><a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">Player::MoveArea</a> = <a name="a4"></a><a class="code" href="structnn_1_1util_1_1_float4.html#a02f002a9ac1ba695b33166697f735ac6">NN_UTIL_FLOAT_4_INITIALIZER</a>(0.f, 0.f, 1280.f, 656.f);</div>
<div class="line"></div>
<div class="line">Player::Player(<span class="keyword">const</span> <a name="_a5"></a><a class="code" href="struct_player_state.html">PlayerState</a>&amp; state) :</div>
<div class="line">    m_FrameCount(0),</div>
<div class="line">    m_State(state),</div>
<div class="line">    m_isShowInfo(false)</div>
<div class="line">{</div>
<div class="line">    m_Accel = <a name="a6"></a><a class="code" href="structnn_1_1util_1_1_float2.html#a2ae1f80ff52f5a776b3fee148d4401e7">NN_UTIL_FLOAT_2_INITIALIZER</a>(0.f, 0.f);</div>
<div class="line">    m_Scale = <a class="code" href="structnn_1_1util_1_1_float2.html#a2ae1f80ff52f5a776b3fee148d4401e7">NN_UTIL_FLOAT_2_INITIALIZER</a>(1.f, 1.f);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> Player::Update()</div>
<div class="line">{</div>
<div class="line">    m_isShowInfo = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    m_State.<a name="a7"></a><a class="code" href="struct_player_state.html#ad4da7f1820f6d773fc9699e6db751167">Style</a> = <a name="a8"></a><a class="code" href="namespacenn_1_1hid.html#a50e56789aa106765d43935bb1838c797">nn::hid::GetNpadStyleSet</a>(m_State.<a name="a9"></a><a class="code" href="struct_player_state.html#a6883b8b096b9442f18ed60f8ce6688b2">Id</a>);</div>
<div class="line"></div>
<div class="line">    m_State.<a name="a10"></a><a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.<a name="a11"></a>x += m_Accel.x;</div>
<div class="line">    m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.<a name="a12"></a>y += m_Accel.y;</div>
<div class="line">    m_Accel.x *= 0.88f;             <span class="comment">// 摩擦</span></div>
<div class="line">    m_Accel.y *= 0.98f;             <span class="comment">// 空気抵抗</span></div>
<div class="line">    m_Accel.y += 0.98f;             <span class="comment">// 重力</span></div>
<div class="line"></div>
<div class="line">    m_AnimeCounter.<a name="a13"></a><a class="code" href="struct_animation_counter.html#ab89ab0a2fe2133ac7ca0aa4fea8122d7">CurFrameCount</a> = m_FrameCount - m_AnimeCounter.<a name="a14"></a><a class="code" href="struct_animation_counter.html#afcd71eb52fa6ee8348739fecd99639a6">StartFrameCount</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.y &lt; <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.<a name="a15"></a>w - m_State.<a name="a16"></a><a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y - 0.5f)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// 着地</span></div>
<div class="line">        m_AnimeCounter.<a name="a17"></a><a class="code" href="struct_animation_counter.html#a67f69d591b0f56e897b767c172c77181">IsStart</a> = <span class="keyword">false</span>;</div>
<div class="line">        m_Scale = nn::util::MakeFloat2(1.f, 1.f);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (m_AnimeCounter.<a class="code" href="struct_animation_counter.html#a67f69d591b0f56e897b767c172c77181">IsStart</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (m_AnimeCounter.<a class="code" href="struct_animation_counter.html#ab89ab0a2fe2133ac7ca0aa4fea8122d7">CurFrameCount</a> &lt; 30)</div>
<div class="line">            {</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">float</span> baseScale = 1.f - (<span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(m_AnimeCounter.<a class="code" href="struct_animation_counter.html#ab89ab0a2fe2133ac7ca0aa4fea8122d7">CurFrameCount</a>) / 30.f);</div>
<div class="line">                <span class="keywordtype">float</span> scale = ((<a name="a18"></a><a class="code" href="namespacenn_1_1util.html#a115590ce3ee8638bc4a1c7e561b58209">nn::util::SinEst</a>(<a name="a19"></a><a class="code" href="namespacenn_1_1util.html#a342713848fbb4ce6750da90d297bc824">nn::util::DegreeToRadian</a>(static_cast&lt;float&gt;(m_AnimeCounter.<a class="code" href="struct_animation_counter.html#ab89ab0a2fe2133ac7ca0aa4fea8122d7">CurFrameCount</a> * 36.0)))) / 5.f) * baseScale;</div>
<div class="line">                m_Scale = nn::util::MakeFloat2( scale + 1.f, -scale + 1.f);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                m_Scale = nn::util::MakeFloat2(1.f, 1.f);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            m_AnimeCounter.<a class="code" href="struct_animation_counter.html#a67f69d591b0f56e897b767c172c77181">IsStart</a> = <span class="keyword">true</span>;</div>
<div class="line">            m_AnimeCounter.<a class="code" href="struct_animation_counter.html#afcd71eb52fa6ee8348739fecd99639a6">StartFrameCount</a> = m_FrameCount;</div>
<div class="line">            m_Scale = nn::util::MakeFloat2(1.f, 1.f);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.x &lt; <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.<a name="a20"></a>x || m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.x + m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.x &gt;= <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.<a name="a21"></a>z)</div>
<div class="line">    {</div>
<div class="line">        m_Accel.x = 0.f;</div>
<div class="line">        <span class="keywordflow">if</span> (m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.x &lt; <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.x) { m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.x = <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.x; }</div>
<div class="line">        <span class="keywordflow">if</span> (m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.x + m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.x &gt;= <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.z) { m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.x = <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.z - m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.x; }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.y &lt; <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.<a name="a22"></a>y) { m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.y = <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.y; }</div>
<div class="line">    <span class="keywordflow">if</span> (m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.y + m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y &gt;= <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.w) { m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.y = <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.w - m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y; }</div>
<div class="line"></div>
<div class="line">    ++m_FrameCount;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> Player::Draw(<a name="_a23"></a><a class="code" href="classnn_1_1gfx_1_1_t_command_buffer.html">nn::gfx::CommandBuffer</a>* command, <a name="_a24"></a><a class="code" href="classnns_1_1gfx_1_1_primitive_renderer_1_1_renderer.html">nns::gfx::PrimitiveRenderer::Renderer</a>* renderer)</div>
<div class="line">{</div>
<div class="line">    renderer-&gt;<a name="a25"></a><a class="code" href="classnns_1_1gfx_1_1_primitive_renderer_1_1_renderer.html#a4fe8aaa462b278cb529dfe57058b47e2">SetColor</a>(m_State.<a name="a26"></a><a class="code" href="struct_player_state.html#af986cfe2b19902c13fa58ecfd0b8a650">Color</a>);</div>
<div class="line">    renderer-&gt;<a name="a27"></a><a class="code" href="classnns_1_1gfx_1_1_primitive_renderer_1_1_renderer.html#a7143af16ef93ea11b07a92de43f558cb">Draw2DRect</a>(command,</div>
<div class="line">        m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.x + (m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.x - m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.x * m_Scale.x) / 2.f,</div>
<div class="line">        m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.y + (m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y - m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y * m_Scale.y),</div>
<div class="line">        m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.x * m_Scale.x,</div>
<div class="line">        m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y * m_Scale.y);</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> uint8_t invWeight =</div>
<div class="line">        <span class="keyword">static_cast&lt;</span>uint8_t<span class="keyword">&gt;</span>(0.298912f * m_State.<a class="code" href="struct_player_state.html#af986cfe2b19902c13fa58ecfd0b8a650">Color</a>.<a name="a28"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html#a09d73d41fdcb22d35e14d6bd7dc101f2">GetR</a>()) +</div>
<div class="line">        static_cast&lt;uint8_t&gt;(0.586611f * m_State.<a class="code" href="struct_player_state.html#af986cfe2b19902c13fa58ecfd0b8a650">Color</a>.<a name="a29"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html#a279be00973e14d71d4637e5f2b590350">GetG</a>()) +</div>
<div class="line">        static_cast&lt;uint8_t&gt;(0.114478f * m_State.<a class="code" href="struct_player_state.html#af986cfe2b19902c13fa58ecfd0b8a650">Color</a>.<a name="a30"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html#aa60235eb63cc53323d5d22b5877e11e3">GetB</a>());</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a name="_a31"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html">nn::util::Color4u8</a> color = invWeight &lt; 128 ? <a name="a32"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html#a07833fdd4841fb2351cf085f336834c8">nn::util::Color4u8::White</a>() : <a class="code" href="namespacenn.html">nn</a>::util::Color4u8::Black();</div>
<div class="line"></div>
<div class="line">    renderer-&gt;<a class="code" href="classnns_1_1gfx_1_1_primitive_renderer_1_1_renderer.html#a4fe8aaa462b278cb529dfe57058b47e2">SetColor</a>(color);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (int32_t styleIndex = 0; styleIndex &lt; m_State.<a class="code" href="struct_player_state.html#ad4da7f1820f6d773fc9699e6db751167">Style</a>.<a name="a33"></a><a class="code" href="structnn_1_1util_1_1_bit_flag_set.html#a5d69fd62ed95c5d90d1c6ba53f22830a">GetCount</a>(); ++styleIndex)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (m_State.<a class="code" href="struct_player_state.html#ad4da7f1820f6d773fc9699e6db751167">Style</a>.<a name="a34"></a><a class="code" href="structnn_1_1util_1_1_bit_flag_set.html#a16d7fcb5bf4461b82f497a58d0fc2e1c">Test</a>(styleIndex))</div>
<div class="line">        {</div>
<div class="line">            <a name="_a35"></a><a class="code" href="structnn_1_1util_1_1_float2.html">nn::util::Float2</a> pos = NN_UTIL_FLOAT_2_INITIALIZER(m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.x + (m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.x - m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.x * m_Scale.x) / 2.f, m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.y + (m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y - m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y * m_Scale.y));</div>
<div class="line">            <a class="code" href="structnn_1_1util_1_1_float2.html">nn::util::Float2</a> size = NN_UTIL_FLOAT_2_INITIALIZER(m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.x * m_Scale.x, m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y * m_Scale.y);</div>
<div class="line"></div>
<div class="line">            DrawStyleIcon(pos, size, styleIndex);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> Player::DrawInfo()</div>
<div class="line">{</div>
<div class="line">    m_isShowInfo = <span class="keyword">true</span>;</div>
<div class="line">    <a class="code" href="structnn_1_1util_1_1_float2.html">nn::util::Float2</a> drawPos = NN_UTIL_FLOAT_2_INITIALIZER(0.f, <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.w + 24.f);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a name="a36"></a><a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(ApplicationState::NpadIds); ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (ApplicationState::NpadIds[i] == m_State.<a class="code" href="struct_player_state.html#a6883b8b096b9442f18ed60f8ce6688b2">Id</a>)</div>
<div class="line">        {</div>
<div class="line">            int32_t npadIndex = (ApplicationState::NpadIds[i] == <a name="a37"></a><a class="code" href="structnn_1_1hid_1_1_npad_id.html#afc19a9a80ac740645b567fc7e1dc36cf">nn::hid::NpadId::Handheld</a>) ? 0 : static_cast&lt;int32_t&gt;(i);</div>
<div class="line">            drawPos.x = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(npadIndex) * 210.f + 300.f;</div>
<div class="line">            g_pGraphicsSystem-&gt;GetDebugFont().SetCursor(drawPos.x, drawPos.y);</div>
<div class="line">            g_pGraphicsSystem-&gt;GetDebugFont().SetTextColor(m_State.<a class="code" href="struct_player_state.html#af986cfe2b19902c13fa58ecfd0b8a650">Color</a>);</div>
<div class="line">            g_pGraphicsSystem-&gt;GetDebugFont().Print(<span class="stringliteral">&quot;■ Player %d&quot;</span>, npadIndex + 1);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="struct_player_state.html">PlayerState</a> Player::GetState()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> m_State;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> Player::SetNpadId(<a class="code" href="namespacenn_1_1hid.html#a5923008962b52bf501f91b30013aedd6">nn::hid::NpadIdType</a> <span class="keywordtype">id</span>)</div>
<div class="line">{</div>
<div class="line">    m_State.<a class="code" href="struct_player_state.html#a6883b8b096b9442f18ed60f8ce6688b2">Id</a> = id;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> Player::Move(<span class="keyword">const</span> nns::hid::Controller&amp; controller)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> nns::hid::ButtonSet&amp; button = controller.GetButtons();</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structnn_1_1util_1_1_float2.html">nn::util::Float2</a>&amp; stick = controller.GetLeftStick();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">float</span> speed             = 1.f;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Bボタンで加速</span></div>
<div class="line">    <span class="keywordflow">if</span> (button.Test&lt;nns::hid::Button::B&gt;())</div>
<div class="line">    {</div>
<div class="line">        speed = (m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.y &lt; <a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.w - m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y) ? 1.25f : 2.f;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 移動</span></div>
<div class="line">    <span class="keywordflow">if</span> ((button &amp; <a class="code" href="class_player.html#ad986a8a63e7f104ca5bba2680b009eca">MoveButtonSet</a>).IsAnyOn() &amp;&amp;</div>
<div class="line">        !(m_State.<a class="code" href="struct_player_state.html#ad4da7f1820f6d773fc9699e6db751167">Style</a>.<a class="code" href="structnn_1_1util_1_1_bit_flag_set.html#a16d7fcb5bf4461b82f497a58d0fc2e1c">Test</a>&lt;<a name="_a38"></a><a class="code" href="structnn_1_1util_1_1_bit_flag_set_1_1_flag.html">nn::hid::NpadStyleJoyLeft</a>&gt;() || m_State.<a class="code" href="struct_player_state.html#ad4da7f1820f6d773fc9699e6db751167">Style</a>.<a class="code" href="structnn_1_1util_1_1_bit_flag_set.html#a16d7fcb5bf4461b82f497a58d0fc2e1c">Test</a>&lt;<a class="code" href="structnn_1_1util_1_1_bit_flag_set_1_1_flag.html">nn::hid::NpadStyleJoyRight</a>&gt;()))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// ボタン入力時の処理</span></div>
<div class="line">        speed *= button.Test&lt;nns::hid::Button::Right&gt;() ? <a class="code" href="class_player.html#a85c105a967e0e834c650017572a0aeb5">MaxSpeed</a> / 10.f : -<a class="code" href="class_player.html#a85c105a967e0e834c650017572a0aeb5">MaxSpeed</a> / 10.f;</div>
<div class="line">        m_Accel.x += speed;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// スティック入力時の処理</span></div>
<div class="line">        speed *= (stick.x * stick.x * stick.x * <a class="code" href="class_player.html#a85c105a967e0e834c650017572a0aeb5">MaxSpeed</a>) / 10.f;</div>
<div class="line">        m_Accel.x += speed;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ジャンプ処理</span></div>
<div class="line">    <span class="keywordflow">if</span> (m_State.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a>.y &gt; (<a class="code" href="class_player.html#acdf0770c62f0238a39fdd0d955180535">MoveArea</a>.w - m_State.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a>.y - 0.5f))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// 接地中</span></div>
<div class="line">        <span class="keywordflow">if</span> (controller.GetButtonsDown().Test&lt;nns::hid::Button::A&gt;())</div>
<div class="line">        {</div>
<div class="line">            m_Accel.y = -<a class="code" href="class_player.html#a85c105a967e0e834c650017572a0aeb5">MaxSpeed</a> * 2.f;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// 空中</span></div>
<div class="line">        <span class="keywordflow">if</span> (controller.GetButtons().Test&lt;nns::hid::Button::A&gt;())</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> ((m_Accel.y &lt; 0))</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// 上昇中にAを押している場合</span></div>
<div class="line">                m_Accel.y -= 0.49f;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">GameSceneThread::GameSceneThread() : ThreadState()</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">GameSceneThread::GameSceneThread(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <a name="a39"></a><a class="code" href="namespacenn_1_1os.html#abec974a5d224f7c62cfa9af4af3c954a">nn::os::ThreadFunction</a> func) : ThreadState(name, func)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a name="a40"></a><a class="code" href="namespacenn_1_1htcs.html#a7eab72b8843a2a9ff763f52b78da680e">GameSceneThread::Initialize</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//==============================================</span></div>
<div class="line">    <span class="comment">// 前処理</span></div>
<div class="line">    <span class="comment">//==============================================</span></div>
<div class="line">    <span class="comment">// グラフィックス 関連の機能</span></div>
<div class="line">    m_pRenderer     = &amp;g_pGraphicsSystem-&gt;GetPrimitiveRenderer();</div>
<div class="line">    m_pTextWriter   = &amp;g_pGraphicsSystem-&gt;GetDebugFont();</div>
<div class="line">    m_pCommand      = &amp;g_pGraphicsSystem-&gt;GetCommandBuffer();</div>
<div class="line"></div>
<div class="line">    m_IsExit        = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ダイアログの初期化</span></div>
<div class="line">    InitializeDialog();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// プレイ人数が一人の場合と複数の場合で処理が変化します</span></div>
<div class="line">    m_IsSingleMode = (ApplicationState::GetPlayerCount() == 1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// 接続状態のNpadIdを記憶します</span></div>
<div class="line">    std::vector&lt;nns::hid::Controller*&gt;list = g_pControllerManager-&gt;GetControllerList();</div>
<div class="line">    <span class="keywordflow">for</span> (std::vector&lt;nns::hid::Controller*&gt;::iterator it = list.begin(); it != list.end(); ++it)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> controllerIndex = (it - list.begin());</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="namespacenn_1_1hid.html#a5923008962b52bf501f91b30013aedd6">nn::hid::NpadIdType</a> <span class="keywordtype">id</span> = ApplicationState::NpadIds[controllerIndex];</div>
<div class="line">        ApplicationState::InitialConnectedController[controllerIndex].Reset();</div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != <a class="code" href="structnn_1_1hid_1_1_npad_id.html#afc19a9a80ac740645b567fc7e1dc36cf">nn::hid::NpadId::Handheld</a>)</div>
<div class="line">        {</div>
<div class="line">            ApplicationState::InitialConnectedController[controllerIndex].Set&lt;<a class="code" href="structnn_1_1util_1_1_bit_flag_set_1_1_flag.html">nn::hid::NpadJoyAttribute::IsLeftConnected</a>&gt;(</div>
<div class="line">                (*it)-&gt;IsConnected() || <span class="keyword">static_cast&lt;</span>nns::hid::GamePadNx*<span class="keyword">&gt;</span>((*it))-&gt;GetAttributesSet().Test&lt;nns::hid::Attribute::IsLeftConnected&gt;());</div>
<div class="line">            ApplicationState::InitialConnectedController[controllerIndex].Set&lt;<a class="code" href="structnn_1_1util_1_1_bit_flag_set_1_1_flag.html">nn::hid::NpadJoyAttribute::IsRightConnected</a>&gt;(</div>
<div class="line">                (*it)-&gt;IsConnected() || <span class="keyword">static_cast&lt;</span>nns::hid::GamePadNx*<span class="keyword">&gt;</span>((*it))-&gt;GetAttributesSet().Test&lt;nns::hid::Attribute::IsRightConnected&gt;());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classnn_1_1util_1_1_color4u8.html">nn::util::Color4u8</a> colorList[] =</div>
<div class="line">    {</div>
<div class="line">        <a name="a41"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html#a74cab22bd85f0940aec269c535ee5b54">nn::util::Color4u8::Red</a>(),</div>
<div class="line">        <a name="a42"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html#a60d33066a521b0728f8660d12e010d8c">nn::util::Color4u8::Green</a>(),</div>
<div class="line">        <a name="a43"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html#a5ad1502b37a61d84307433906727813c">nn::util::Color4u8::Blue</a>(),</div>
<div class="line">        <a name="a44"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html#a9d134cd2f801f8f6045e48c8af2eab3d">nn::util::Color4u8::Yellow</a>()</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    m_PlayerList.clear();</div>
<div class="line">    m_PlayerList.resize(0);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; ApplicationState::GetPlayerCount(); ++i)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="struct_player_state.html">PlayerState</a> state;</div>
<div class="line">        state.<a class="code" href="struct_player_state.html#af986cfe2b19902c13fa58ecfd0b8a650">Color</a> = colorList[i % <a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(colorList)];</div>
<div class="line">        state.<a class="code" href="struct_player_state.html#ad4da7f1820f6d773fc9699e6db751167">Style</a> = <a class="code" href="namespacenn_1_1hid.html#a50e56789aa106765d43935bb1838c797">nn::hid::GetNpadStyleSet</a>(ApplicationState::IsHandheldMode() ? <a class="code" href="structnn_1_1hid_1_1_npad_id.html#afc19a9a80ac740645b567fc7e1dc36cf">nn::hid::NpadId::Handheld</a> : ApplicationState::NpadIds[i]);</div>
<div class="line">        state.<a class="code" href="struct_player_state.html#a6883b8b096b9442f18ed60f8ce6688b2">Id</a> = ApplicationState::IsHandheldMode() ? <a class="code" href="structnn_1_1hid_1_1_npad_id.html#afc19a9a80ac740645b567fc7e1dc36cf">nn::hid::NpadId::Handheld</a> : ApplicationState::NpadIds[i];</div>
<div class="line">        state.<a class="code" href="struct_player_state.html#a07645dfeb28bc117d515e77e8d61b701">Size</a> = <a class="code" href="structnn_1_1util_1_1_float2.html#a2ae1f80ff52f5a776b3fee148d4401e7">NN_UTIL_FLOAT_2_INITIALIZER</a>(48, 48);</div>
<div class="line">        state.<a class="code" href="struct_player_state.html#a5b263475ab339ba32f6384a1a53f7950">Pos</a> = <a class="code" href="structnn_1_1util_1_1_float2.html#a2ae1f80ff52f5a776b3fee148d4401e7">NN_UTIL_FLOAT_2_INITIALIZER</a>(300.f + i * 210.f, 360);</div>
<div class="line">        m_PlayerList.push_back(<span class="keyword">new</span> <a name="_a45"></a><a class="code" href="class_player.html">Player</a>(state));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    g_pGraphicsSystem-&gt;StartScanScreen();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> GameSceneThread::Update()</div>
<div class="line">{</div>
<div class="line">    <a name="a46"></a><a class="code" href="namespacenn_1_1os.html#a8d4678856d87c3faea21f47ced342bb6">nn::os::LockMutex</a>(&amp;g_Mutex);</div>
<div class="line">    {</div>
<div class="line">        g_pControllerManager-&gt;Update();</div>
<div class="line">    }</div>
<div class="line">    <a name="a47"></a><a class="code" href="namespacenn_1_1os.html#aa661a7036a18c378a694ad67941cd75e">nn::os::UnlockMutex</a>(&amp;g_Mutex);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// コントローラーの接続確認</span></div>
<div class="line">    <a name="_a48"></a><a class="code" href="classnn_1_1_result.html">nn::Result</a> appletResult;</div>
<div class="line">    <a name="_a49"></a><a class="code" href="structnn_1_1hid_1_1_controller_support_result_info.html">nn::hid::ControllerSupportResultInfo</a> controllerResultInfo;</div>
<div class="line"></div>
<div class="line">    CheckPatternSet check;</div>
<div class="line">    check.Reset();</div>
<div class="line">    m_IsSingleMode ? check.Set&lt;CheckPattern::Single&gt;() : check.Set&lt;CheckPattern::PlayerCountShort&gt;();</div>
<div class="line">    check.Set&lt;CheckPattern::ChangeMasterController&gt;();</div>
<div class="line">    check.Set&lt;CheckPattern::CallInterval&gt;();</div>
<div class="line">    check.Set&lt;CheckPattern::Resume&gt;();</div>
<div class="line">    <span class="keywordflow">if</span> (CheckConnectController(check))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> playerCount = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::min(ApplicationState::GetPlayerCount(), ApplicationState::GetPlayerCount()));</div>
<div class="line">        <span class="comment">// コントローラーの接続の追加が必要な場合、コントローラーサポートアプレットを呼び出す</span></div>
<div class="line">        int32_t dialogResult = 0;</div>
<div class="line"></div>
<div class="line">        appletResult = CallControllerSupportApplet(&amp;controllerResultInfo, playerCount);</div>
<div class="line">        <span class="keywordflow">if</span> (!m_IsSingleMode)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">bool</span> IsSuccess = (appletResult.<a name="a50"></a><a class="code" href="classnn_1_1_result.html#a80792d8ec8b6b9e9b34025100baa67ec">IsSuccess</a>() &amp;&amp; controllerResultInfo.<a name="a51"></a><a class="code" href="structnn_1_1hid_1_1_controller_support_result_info.html#a093a27ac5e1c17fd30221753cde61c8a">playerCount</a> != 0);</div>
<div class="line">            <span class="keywordflow">if</span> (IsSuccess == <span class="keyword">false</span>) { BlurScreen(); }</div>
<div class="line">            <span class="keywordflow">while</span> (IsSuccess == <span class="keyword">false</span>)</div>
<div class="line">            {</div>
<div class="line">                dialogResult = ShowDialog(m_ControllerLostDialog);</div>
<div class="line">                <span class="keywordflow">if</span> (dialogResult != m_ControllerLostDialog.CancelNum)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// 終了を選択した場合</span></div>
<div class="line">                    m_IsExit = <span class="keyword">true</span>;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// キャンセルを選択した場合、コントローラーを追加接続するまで無限ループさせる</span></div>
<div class="line">                    appletResult = CallControllerSupportApplet(&amp;controllerResultInfo, playerCount);</div>
<div class="line">                }</div>
<div class="line">                IsSuccess = (appletResult.<a class="code" href="classnn_1_1_result.html#a80792d8ec8b6b9e9b34025100baa67ec">IsSuccess</a>() &amp;&amp; controllerResultInfo.<a class="code" href="structnn_1_1hid_1_1_controller_support_result_info.html#a093a27ac5e1c17fd30221753cde61c8a">playerCount</a> != 0);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">bool</span>                isCalledDialog      = <span class="keyword">false</span>;</div>
<div class="line">        <a class="code" href="namespacenn_1_1hid.html#a5923008962b52bf501f91b30013aedd6">nn::hid::NpadIdType</a> dialogCalledNpadId;</div>
<div class="line"></div>
<div class="line">        <span class="comment">//==============================================</span></div>
<div class="line">        <span class="comment">// コントローラー の処理</span></div>
<div class="line">        <span class="comment">//==============================================</span></div>
<div class="line">        <span class="comment">// シングルプレイ時のマスターコントローラーを指定</span></div>
<div class="line">        <span class="keywordflow">if</span> (m_IsSingleMode)</div>
<div class="line">        {</div>
<div class="line">            m_PlayerList.at(0)-&gt;SetNpadId(ApplicationState::IsHandheldMode() ? <a class="code" href="structnn_1_1hid_1_1_npad_id.html#afc19a9a80ac740645b567fc7e1dc36cf">nn::hid::NpadId::Handheld</a> : <a name="a52"></a><a class="code" href="structnn_1_1hid_1_1_npad_id.html#aa0b93745c1c6de72c1fd2174f35c8ed9">nn::hid::NpadId::No1</a>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// 接続中のコントローラーの入力処理</span></div>
<div class="line">        <span class="keywordflow">for</span> (</div>
<div class="line">            std::vector&lt;nns::hid::Controller*&gt;::iterator it = g_pControllerManager-&gt;GetControllerList().begin();</div>
<div class="line">            !m_IsExit &amp;&amp; it != g_pControllerManager-&gt;GetControllerList().end();</div>
<div class="line">            ++it</div>
<div class="line">            )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">bool</span>    isConnectedPlayerController = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordtype">size_t</span>  playerIndex                 = 0;</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="namespacenn_1_1hid.html#a5923008962b52bf501f91b30013aedd6">nn::hid::NpadIdType</a> npadId    = ApplicationState::NpadIds[it - g_pControllerManager-&gt;GetControllerList().begin()];</div>
<div class="line"></div>
<div class="line">            <span class="comment">// 操作権をもつ接続中のコントローラーか否か確認する</span></div>
<div class="line">            <span class="keywordflow">if</span> ((*it)-&gt;IsConnected())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_PlayerList.size(); ++i)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">if</span> (m_PlayerList.at(i)-&gt;GetState().Id == npadId)</div>
<div class="line">                    {</div>
<div class="line">                        isConnectedPlayerController = <span class="keyword">true</span>;</div>
<div class="line">                        playerIndex = i;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (</div>
<div class="line">                !isCalledDialog &amp;&amp;</div>
<div class="line">                ((*it)-&gt;GetButtonsDown().Test&lt;nns::hid::Button::Plus&gt;() || (*it)-&gt;GetButtonsDown().Test&lt;nns::hid::Button::Minus&gt;())</div>
<div class="line">                )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> ((!m_IsSingleMode &amp;&amp; npadId == <a class="code" href="structnn_1_1hid_1_1_npad_id.html#afc19a9a80ac740645b567fc7e1dc36cf">nn::hid::NpadId::Handheld</a>) ||</div>
<div class="line">                    isConnectedPlayerController)</div>
<div class="line">                {</div>
<div class="line">                    isCalledDialog = <span class="keyword">true</span>;</div>
<div class="line">                    dialogCalledNpadId = npadId;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// 操作権を持たないコントローラー</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// 操作できないコントローラーの場合処理を中断します</span></div>
<div class="line">            <span class="keywordflow">if</span> (!isConnectedPlayerController)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// プレイヤーの操作</span></div>
<div class="line">            m_PlayerList.at(playerIndex)-&gt;Move((**it));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">//==============================================</span></div>
<div class="line">        <span class="comment">// プレイヤーの更新</span></div>
<div class="line">        <span class="comment">//==============================================</span></div>
<div class="line">        <span class="keywordflow">for</span> (</div>
<div class="line">            std::vector&lt;Player*&gt;::iterator it = m_PlayerList.begin();</div>
<div class="line">            !m_IsExit &amp;&amp; it != m_PlayerList.end();</div>
<div class="line">            ++it</div>
<div class="line">            )</div>
<div class="line">        {</div>
<div class="line">            (*it)-&gt;Update();</div>
<div class="line">            (*it)-&gt;DrawInfo();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">//==============================================</span></div>
<div class="line">        <span class="comment">// ポーズ画面の呼び出し処理</span></div>
<div class="line">        <span class="comment">//==============================================</span></div>
<div class="line">        <span class="keywordflow">if</span> (isCalledDialog)</div>
<div class="line">        {</div>
<div class="line">            CallDialog(dialogCalledNpadId);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (m_IsExit)</div>
<div class="line">    {</div>
<div class="line">        g_pGraphicsSystem-&gt;StopScanScreen();</div>
<div class="line">        <a class="code" href="namespacenn_1_1os.html#a8d4678856d87c3faea21f47ced342bb6">nn::os::LockMutex</a>(&amp;g_Mutex);</div>
<div class="line">        {</div>
<div class="line">            ThreadState* pThreadState = <span class="keyword">nullptr</span>;</div>
<div class="line">            <a name="a53"></a><a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(g_ThreadManager.GetThreadStateFromIndex(ThreadManager::ThreadList_SceneGame, &amp;pThreadState));</div>
<div class="line">            g_ThreadManager.SetEndThread(pThreadState-&gt;GetThreadType());</div>
<div class="line">            <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(g_ThreadManager.GetThreadStateFromIndex(ThreadManager::ThreadList_SceneTitle, &amp;pThreadState));</div>
<div class="line">            g_ThreadManager.SetNextThread(pThreadState-&gt;GetThreadType());</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="namespacenn_1_1os.html#aa661a7036a18c378a694ad67941cd75e">nn::os::UnlockMutex</a>(&amp;g_Mutex);</div>
<div class="line">    }</div>
<div class="line">} <span class="comment">// NOLINT(impl/function_size)</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> GameSceneThread::Draw()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="namespacenn_1_1os.html#a8d4678856d87c3faea21f47ced342bb6">nn::os::LockMutex</a>(&amp;g_Mutex);</div>
<div class="line">    {</div>
<div class="line">        g_pGraphicsSystem-&gt;BeginDraw();</div>
<div class="line">        {</div>
<div class="line">            m_pRenderer-&gt;Draw2DLine(m_pCommand, 0, 720.f - 64.f, 1280, 720.f - 64.f);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (</div>
<div class="line">                std::vector&lt;Player*&gt;::iterator it = m_PlayerList.begin();</div>
<div class="line">                !m_IsExit &amp;&amp; it != m_PlayerList.end();</div>
<div class="line">                ++it</div>
<div class="line">                )</div>
<div class="line">            {</div>
<div class="line">                (*it)-&gt;Draw(m_pCommand, m_pRenderer);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">            m_pRenderer-&gt;SetColor(<a name="a54"></a><a class="code" href="classnn_1_1util_1_1_color4u8.html#afb626f4418fbccc382b9c0285f7817ba">nn::util::Color4u8::Gray</a>());</div>
<div class="line">            m_pRenderer-&gt;Draw2DRect(</div>
<div class="line">                m_pCommand, 0, 0,</div>
<div class="line">                640.f / 3.5f, 64.f / 3.5f, g_TextureDescriptor[ResourceType_Title], g_SamplerDescriptor);</div>
<div class="line"></div>
<div class="line">            m_pTextWriter-&gt;Draw(m_pCommand);</div>
<div class="line">        }</div>
<div class="line">        g_pGraphicsSystem-&gt;EndDraw();</div>
<div class="line">        g_pGraphicsSystem-&gt;Synchronize(</div>
<div class="line">            <a name="a55"></a><a class="code" href="classnn_1_1_time_span.html#a52a2856f56e7b046cbb28056e235cc34">nn::TimeSpan::FromNanoSeconds</a>(1000 * 1000 * 1000 / <a name="a56"></a><a class="code" href="_hid_controller_sequence___main_8cpp.html#acfd5f73bca574789d17edbcc565538d7">g_FrameRate</a>));</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="namespacenn_1_1os.html#aa661a7036a18c378a694ad67941cd75e">nn::os::UnlockMutex</a>(&amp;g_Mutex);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a name="a57"></a><a class="code" href="namespacenn_1_1htcs.html#abf5eb36f3563222450920fad56fdaf61">GameSceneThread::Finalize</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (std::vector&lt;Player*&gt;::iterator it = m_PlayerList.begin(); it != m_PlayerList.end(); ++it)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">delete</span> (*it);</div>
<div class="line">        (*it) = <span class="keyword">nullptr</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> GameSceneThread::InitializeDialog()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ポーズ画面</span></div>
<div class="line">    {</div>
<div class="line">        m_PauseDialog.SetDefault();</div>
<div class="line">        m_PauseDialog.Size.y = 0.f;</div>
<div class="line">        m_PauseDialog.Title = <span class="stringliteral">&quot;\nPAUSE\n&quot;</span>;</div>
<div class="line">        m_PauseDialog.Message = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">        m_PauseDialog.Answer.clear();</div>
<div class="line">        m_PauseDialog.Answer.push_back(<span class="stringliteral">&quot;Resume&quot;</span>);</div>
<div class="line">        m_PauseDialog.Answer.push_back(<span class="stringliteral">&quot;Go to App title&quot;</span>);</div>
<div class="line">        m_PauseDialog.CancelNum = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// 継続確認画面</span></div>
<div class="line">    DialogInfo insControllerDialogInfo;</div>
<div class="line">    {</div>
<div class="line">        m_ControllerLostDialog.SetDefault();</div>
<div class="line">        m_ControllerLostDialog.Size.y = 0.f;</div>
<div class="line">        m_ControllerLostDialog.Title = <span class="stringliteral">&quot;\nStop playing and\n\nreturn to App title?\n&quot;</span>;</div>
<div class="line">        m_ControllerLostDialog.Message = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">        m_ControllerLostDialog.Answer.clear();</div>
<div class="line">        m_ControllerLostDialog.Answer.push_back(<span class="stringliteral">&quot;Cancel&quot;</span>);</div>
<div class="line">        m_ControllerLostDialog.Answer.push_back(<span class="stringliteral">&quot;Return to App title&quot;</span>);</div>
<div class="line">        m_ControllerLostDialog.CancelNum = 0;</div>
<div class="line">        m_ControllerLostDialog.ControllerCheck.Reset();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> GameSceneThread::CallDialog(<span class="keyword">const</span> <a class="code" href="namespacenn_1_1hid.html#a5923008962b52bf501f91b30013aedd6">nn::hid::NpadIdType</a>&amp; npadId)</div>
<div class="line">{</div>
<div class="line">    BlurScreen();</div>
<div class="line">    <a class="code" href="structnn_1_1hid_1_1_controller_support_result_info.html">nn::hid::ControllerSupportResultInfo</a> appletResultInfo;</div>
<div class="line">    <span class="keywordflow">while</span> (!m_IsExit)</div>
<div class="line">    {</div>
<div class="line">        int32_t dialogResult = ShowDialog(m_PauseDialog, npadId);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (dialogResult == -1)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">while</span> (!m_IsExit)</div>
<div class="line">            {</div>
<div class="line">                dialogResult = ShowDialog(m_ControllerLostDialog);</div>
<div class="line">                <span class="keywordflow">if</span> (dialogResult == -1)</div>
<div class="line">                {</div>
<div class="line"></div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dialogResult == m_ControllerLostDialog.CancelNum)</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordtype">int</span> playerCount = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(std::min(ApplicationState::GetPlayerCount(), ApplicationState::MaxPlayerCount));</div>
<div class="line">                    <span class="keywordflow">if</span> (CallControllerSupportApplet(&amp;appletResultInfo, playerCount).IsSuccess())</div>
<div class="line">                    {</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// 終了を選択した場合</span></div>
<div class="line">                    m_IsExit = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dialogResult == m_PauseDialog.CancelNum)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            m_IsExit = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> GameSceneThread::BlurScreen()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="namespacenn_1_1os.html#a8d4678856d87c3faea21f47ced342bb6">nn::os::LockMutex</a>(&amp;g_Mutex);</div>
<div class="line">    {</div>
<div class="line">        g_pGraphicsSystem-&gt;StartScanScreen();</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; 4; ++i)</div>
<div class="line">        {</div>
<div class="line">            g_pGraphicsSystem-&gt;BeginDraw();</div>
<div class="line">            {</div>
<div class="line">                m_pRenderer-&gt;SetUserPixelShader(g_pGraphicsSystem-&gt;GetBlurShader());</div>
<div class="line">                m_pRenderer-&gt;Draw2DRect(m_pCommand,</div>
<div class="line">                    0, 720, 1280, -720, g_ScanScreenDescriptor, g_SamplerDescriptor);</div>
<div class="line">                m_pRenderer-&gt;SetUserPixelShader(NULL);</div>
<div class="line">            }</div>
<div class="line">            g_pGraphicsSystem-&gt;EndDraw();</div>
<div class="line">            g_pGraphicsSystem-&gt;Synchronize(</div>
<div class="line">                <a class="code" href="classnn_1_1_time_span.html#a52a2856f56e7b046cbb28056e235cc34">nn::TimeSpan::FromNanoSeconds</a>(1000 * 1000 * 1000 / <a class="code" href="_hid_controller_sequence___main_8cpp.html#acfd5f73bca574789d17edbcc565538d7">g_FrameRate</a>));</div>
<div class="line">        }</div>
<div class="line">        g_pGraphicsSystem-&gt;StopScanScreen();</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="namespacenn_1_1os.html#aa661a7036a18c378a694ad67941cd75e">nn::os::UnlockMutex</a>(&amp;g_Mutex);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</body>
</html>
