<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>インデックス付きキャッシュストレージ</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- インデックス付きキャッシュストレージ -->
<div class="pagetitle" id="PageId_276903214">インデックス付きキャッシュストレージ</div>
<div class="text_separate">
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <p>インデックス付きキャッシュストレージ機能を利用するには事前の申請が必要です。任天堂の窓口までご相談ください。</p>
    <p>ご相談の際には次の情報をお知らせください。</p>
    <ul>
      <li>使用したいキャッシュストレージの最大数</li>
      <li>1 つのキャッシュストレージのデータ保存領域サイズとジャーナリング領域サイズの合計の最大サイズ</li>
      <li>1 つのキャッシュストレージのデータ保存領域サイズの内訳<span style="color: rgb(51,51,51);">（各要素の内容、サイズ、要素数）</span></li>
      <li>一時ストレージ機能を使用すべきデータが含まれていないか</li>
      <li>巻き戻りや先送りされた状態になると支障があるデータが含まれていないか</li>
      <li>ゲーム性を損なわない範囲で圧縮やデータ形式変更などによるサイズの最適化を行ったか</li>
      <li>どのようなタイミングで個々のキャッシュストレージの作成と削除を行うか</li>
    </ul>
  </div>
</div>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <p>インデックス付きキャッシュストレージ機能<span style="color: rgb(51,51,51);">は&nbsp;NX Addon 5.0.0 以降で利用できます。</span></p>
  </div>
</div>
<h1 id="Anchor_276903214_h1_1">機能概要</h1>
<p>1 つのアプリケーションが、インデックスで管理された複数のキャッシュストレージを使用することができます。<br />各キャッシュストレージの持つ機能は、<a href="../Pages/Page_224957652.html">キャッシュストレージ</a>&nbsp;で定義されたものと同等です。</p>
<p>インデックス付きキャッシュストレージを使用すると、以下のことが可能になります。</p>
<ul>
  <li>指定したインデックスのキャッシュストレージの作成</li>
  <li>指定したインデックスのキャッシュストレージの削除</li>
  <li>指定したインデックスのキャッシュストレージのマウント</li>
  <li>アプリケーションの持つキャッシュストレージのリスト取得</li>
</ul>
<p>
  <br />
</p>
<div class="warn_new">
  <div class="warn_new_left">警告：</div>
  <div class="warn_new_right">
    <p>
      <strong>アプリケーションは必要なタイミングでリストを取得して、キャッシュストレージの存在を確認する必要があります。<br /></strong>
    </p>
    <p>インデックス付きキャッシュストレージを使用するとアプリケーション起動時にキャッシュストレージは作成されません。</p>
  </div>
</div>
<h1 id="Anchor_276903214_h1_2">インデックス付きキャッシュストレージの設定</h1>
<p>nmeta ファイルに以下の要素を記述した状態でアプリケーションを起動することで、アプリケーションからキャッシュストレージを作成可能になります。</p>
<p>
  <strong>アプリケーション起動時点では、キャッシュストレージは作成されません。</strong>
</p>
<table class="wrapped" style="margin-left: 1.5em;">
  <colgroup>
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>項目名</th>
      <th>概要</th>
      <th>補足</th>
    </tr>
    <tr>
      <td>NintendoSdkMeta/Application/CacheStorageDataAndJournalSizeMax</td>
      <td>各キャッシュストレージのデータ保存領域サイズとジャーナリング領域サイズの合計の最大値</td>
      <td>16KB 単位、96 KB 以上、4000 MB 以下である必要があります。</td>
    </tr>
    <tr>
      <td>NintendoSdkMeta/Application/CacheStorageIndexMax</td>
      <td>キャッシュストレージのインデックスの最大値</td>
      <td>作りたいキャッシュストレージの数から 1 を引いた値です。</td>
    </tr>
  </tbody>
</table>
<p>上記の項目は、NintendoSdkMeta/Application/CacheStorageSize,&nbsp;NintendoSdkMeta/Application/CacheStorageJournalSize と同時に設定できません。</p>
<h2 id="Anchor_276903214_h2_1">
  <span style="color: rgb(117,117,117);">設定例</span>
</h2>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>?&gt;
&lt;NintendoSdkMeta&gt;
&nbsp;&nbsp;&lt;Core&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Name&gt;Application&lt;/Name&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ApplicationId&gt;0x0005000C10000000&lt;/ApplicationId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Is64BitInstruction&gt;True&lt;/Is64BitInstruction&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ProcessAddressSpace&gt;AddressSpace64Bit&lt;/ProcessAddressSpace&gt;
&nbsp;&nbsp;&lt;/Core&gt;
&nbsp;&nbsp;&lt;Application&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;CacheStorageDataAndJournalSizeMax&gt;0x0000000003F00000&lt;/CacheStorageDataAndJournalSizeMax&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;CacheStorageIndexMax&gt;0x100&lt;/CacheStorageIndexMax&gt;
&nbsp;&nbsp;&lt;/Application&gt;
&lt;/NintendoSdkMeta&gt;</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_276903214_h1_3">インデックス付きキャッシュストレージの配置場所</h1>
<p>インデックス付きキャッシュストレージは、全て同じ場所に配置されます。</p>
<p>インデックス付きキャッシュストレージが 1 つも存在しない状態で <span class="ApiLink_nn__fs__CreateCacheStorage">nn::fs::CreateCacheStorage</span>() を実行すると、基本的に&nbsp;SD カードに配置されます。<br />ただし、SD カードが未挿入、または SD カードが容量不足の時には本体保存メモリーに配置されます。</p>
<p>1 つ以上存在する場合は、それらと同じ場所に配置されます。</p>
<p>本体起動時にあるアプリケーションのインデックス付きキャッシュストレージが SD カードと本体保存メモリー両方に存在する場合、本体保存メモリーのインデックス付きキャッシュストレージは全て削除されます。</p>
<p>
  <a href="../Pages/Page_224957652.html#Anchor_224957652_h1_6">キャッシュストレージ</a>&nbsp;の「配置場所」も参照してください。</p>
<h1 id="Anchor_276903214_h1_4">インデックス付きキャッシュストレージのエラーハンドリング</h1>
<p>
  <span class="ApiLink_nn__fs__CreateCacheStorage">nn::fs::CreateCacheStorage</span>() を実行してインデックス付きキャッシュストレージを作成する場合はエラーハンドリングが必要になります。<br />キャッシュストレージを作成またはサイズ拡張するための空き容量が足りない場合、システムが自動で以下のメッセージを表示します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>容量がいっぱいです。
このソフトをあそぶには、●●ＧＢの空き容量が必要です。
ソフトのデータを整理してください。</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>このメッセージ表示後ユーザに空き容量不足の解消を促しますが、解消されなかった場合は、API の返り値として <span class="ApiLink_nn__fs__ResultUsableSpaceNotEnough">nn::fs::ResultUsableSpaceNotEnough</span> が返ります。<br />この場合、キャッシュストレージが意図通りに作成されていません。キャッシュストレージ操作を中断し、適切なハンドリングを行うようにしてください。</p>
<ul>
  <li>例：インデックス付きキャッシュストレージを作成するシーンにおいて <span class="ApiLink_nn__fs__CreateCacheStorage">nn::fs::CreateCacheStorage</span>()&nbsp;を実行した際に <span class="ApiLink_nn__fs__ResultUsableSpaceNotEnough">nn::fs::ResultUsableSpaceNotEnough</span> が返った場合、データ作成操作をキャンセルして削除シーケンスに入る。</li>
</ul>
<p>
  <a href="../Pages/Page_310879077.html">DevMenu</a>&nbsp;または&nbsp;<a href="../Pages/Page_107328760.html">DevMenuCommand</a>&nbsp;で NAND の空き容量を埋めることができます。空き容量不足状態にした上で、 <span class="ApiLink_nn__fs__ResultUsableSpaceNotEnough">nn::fs::ResultUsableSpaceNotEnough</span> が正しくハンドリングできていることを確認してください。</p>
<p>上記以外のセーブデータ操作のエラーハンドリングは、その他のファイルシステム操作と同様です。<a href="../Pages/Page_174247773.html">エラーハンドリング</a>&nbsp;も参照してください。</p>
<h1 id="Anchor_276903214_h1_5">注意事項</h1>
<p>注意事項のまとめです。</p>
<ul>
  <li>
    <span style="color: rgb(51,51,51);">インデックス付きキャッシュストレージ機能を使用する場合、</span>アプリケーションは必要なタイミングでリストを取得して、キャッシュストレージの存在を確認する必要があります。</li>
  <li>
    <span class="ApiLink_nn__fs__DeleteCacheStorage">nn::fs::DeleteCacheStorage</span>() を利用し、適切に記録メディアの使用容量を空けられるようにしてください。</li>
</ul>
<p>
  <a href="../Pages/Page_224957652.html#Anchor_224957652_h1_9">キャッシュストレージ</a>&nbsp;の「注意事項」も参照してください。</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
<!--AddLink-->
<script>
var NintendoSdkApiRefernce = {
    idMap: {},
    linkRewrite: function ()
    {
        var idMap = NintendoSdkApiRefernce.idMap;
        function rewrite(el)
        {
            var e = idMap[el.className];
            if (e === undefined)
            {
                return;
            }
            var html = '';
            html += '<a href=';
            html += e.url;
            html += ' target="_blank">';
            html += el.innerHTML;
            html += '</a>';
            el.innerHTML = html;
        }
        var apiLinkElems = document.querySelectorAll('span[class*="ApiLink_"]');
        for (var i = 0, n = apiLinkElems.length; i< n; ++i) {
            rewrite(apiLinkElems[i]);
        }
    }
};
function SetUrl( id, url )
{
    NintendoSdkApiRefernce.idMap[id] = { url: url };
}
SetUrl( 'ApiLink_nn__fs__CreateCacheStorage', '../../../Api/HtmlNX/namespacenn_1_1fs.html#af3735c46a459dbf4ba3d6de862b611d4' )
SetUrl( 'ApiLink_nn__fs__ResultUsableSpaceNotEnough', '../../../Api/HtmlNX/classnn_1_1fs_1_1_result_usable_space_not_enough.html' )
SetUrl( 'ApiLink_nn__fs__DeleteCacheStorage', '../../../Api/HtmlNX/namespacenn_1_1fs.html#adf2bd15a53fcc2a6c8895de9c264ab86' )

NintendoSdkApiRefernce.linkRewrite();
</script>
<!--AddLink-->
</body>
</html>
