<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>制限と注意</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- 制限と注意 -->
<div class="pagetitle" id="PageId_198953467">制限と注意</div>
<div class="text_separate">
<h1 id="Anchor_198953467_h1_1">仕様</h1>
<h2 id="Anchor_198953467_h2_1">サイズと数の制限</h2>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th style="text-align: center;">対象</th>
      <th style="text-align: center;">最大値</th>
      <th style="text-align: center;">備考</th>
    </tr>
    <tr>
      <td>データ配信キャッシュストレージの数</td>
      <td>1 個まで</td>
      <td>アプリケーションはただ一つのデータ配信キャッシュストレージを持ちます。</td>
    </tr>
    <tr>
      <td>データ配信キャッシュストレージのサイズ</td>
      <td>64 MiBまで</td>
      <td>このうち <strong>4 MiBが管理領域に割り当てられます</strong>。実際の管理領域のサイズは配信するファイルの数に応じて変化しますが、将来のシステムの仕様変更の可能性を考慮して 4 MiB を固定で余分に確保してください。</td>
    </tr>
    <tr>
      <td>ディレクトリの数</td>
      <td>100 ディレクトリまで</td>
      <td>ディレクトリは一階層のみ作成できます。</td>
    </tr>
    <tr>
      <td>ディレクトリのサイズ (1 ディレクトリあたりのファイルのサイズの合計値)</td>
      <td>60 MiBまで</td>
      <td>
        <p>ディレクトリ内のファイルごとに 16 KiB(ファイルシステムのブロックサイズ)に切り上げた値を合計して算出します。</p>
        <p>
          <br />
        </p>
        <p>なるべく小さいサイズを推奨します。このサイズが大きければ大きい分だけファイルの書き込み時間が長くなるため、それに応じてデータ配信キャッシュストレージをマウントできない期間が長くなります。</p>
      </td>
    </tr>
    <tr>
      <td>1 ディレクトリあたりのファイルの数</td>
      <td>
        <p>100 ファイルまで</p>
      </td>
      <td>
        <p>ファイルが一つも配信されていない空のディレクトリの作成は可能です。</p>
        <p>また、空のディレクトリであっても本体からは存在が認識され、列挙されます。</p>
      </td>
    </tr>
    <tr>
      <td>すべてのディレクトリを合わせたファイルの数</td>
      <td>2000 ファイルまで</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>1 ファイルのサイズ</td>
      <td>
        <p>60 MiBまで</p>
      </td>
      <td>
        <p>ディレクトリのサイズの最大値と同じです。</p>
        <p>
          <br />
        </p>
        <p>空のファイル(サイズが 0 のファイル)はサーバーに登録できません。</p>
      </td>
    </tr>
  </tbody>
</table>
<p>例えば、サイズが 1 MiBのファイルを20個格納したディレクトリを 3 個まで作成できます。</p>
<h2 id="Anchor_198953467_h2_2">アクセス権</h2>
<p>アプリケーションは、自分自身が作成したデータ配信キャッシュストレージからのみデータを読み込むことができます。</p>
<p>他のアプリケーション(自分自身とは異なるアプリケーションIDを持つアプリケーション)が作成したデータ配信キャッシュストレージからデータを読み込むことはできません。</p>
<h2 id="Anchor_198953467_h2_3">コミットの粒度</h2>
<p>データはディレクトリ単位で本体にコミット(反映)されます。</p>
<p>ディレクトリが更新されたとき、ディレクトリの中には配信中のすべてのファイルが揃っています。また、最新の状態に更新されています。</p>
<p>一方で、以下のことに注意してください。</p>
<h3 id="Anchor_198953467_h3_1">ディレクトリの一部欠落</h3>
<p>ディレクトリAが最新の状態に更新されていたとしても、「ディレクトリBが最新の状態に更新されていること」や「ディレクトリBが存在すること」は保証されません。</p>
<p>
  <br />
</p>
<p>以下のいずれかの対応を検討してください。</p>
<ul>
  <li>特定のディレクトリが本体に存在していなくても問題のないようにアプリケーションを設計する。</li>
  <li>アプリケーションの起動後に即時同期を完了するまでは、ディレクトリの列挙やデータの読み込みを行わない。</li>
</ul>
<p>
  <br />
</p>
<p>デバッグにおいてディレクトリが一部欠落している状態をエミュレーションする方法は、以下のとおりです。</p>
<ul>
  <li>後述の「テスト配信」機能を使い、特定の本体に対して特定のディレクトリやファイルを配信しない。</li>
  <li>サーバーの配信スケジュールを変更し、全ての本体に対して特定のディレクトリやファイルを配信しない。</li>
</ul>
<h3 id="Anchor_198953467_h3_2">ファイルの重複</h3>
<p>何らかの理由によりディレクトリAの配下で配信済みのファイルXの配信を停止し、ディレクトリBの配下で改めて配信し直したとします。</p>
<p>このときディレクトリBは更新されているが、ディレクトリAは更新されていない本体が存在する可能性があります。そのような本体の中には2つの同じファイルXが重複して存在します。</p>
<p>
  <br />
</p>
<p>以下のいずれかの対応を検討してください。</p>
<ul>
  <li>2つの同じファイルが異なるディレクトリ間に重複して存在しても問題のないようにアプリケーションを設計する。</li>
  <li>（例えば、アプリケーションをパッチで更新するとき）あるファイルの存在を期待するディレクトリを変更しないようにする。</li>
</ul>
<h2 id="Anchor_198953467_h2_4">永続性</h2>
<h3 id="Anchor_198953467_h3_3">永続性の無保証</h3>
<p>一度は受信したデータであっても、以下の場合には本体から削除されます。</p>
<ul>
  <li>HOMEメニューにおいてユーザーが特殊な操作を行い、データ配信キャッシュストレージを削除したとき。</li>
  <li>ディレクトリの場合: サーバーからディレクトリを削除したあと、サーバーと次回通信したとき。</li>
  <li>ファイルの場合: サーバーでのファイルの配信期間が終了したあと、サーバーと次回通信したとき。</li>
</ul>
<p>
  <br />
</p>
<p>アプリケーションは次回アプリケーションが起動されたときに「これまで存在したデータが存在しない可能性」、および「データ配信キャッシュストレージが空になっている可能性(アプリケーションを初めて起動したときと同じ状態に巻き戻る可能性)」を考慮してください。</p>
<p>
  <br />
</p>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <p>データ配信キャッシュストレージが削除されるようなユーザーの特殊な操作とは、以下の操作を指します。</p>
    <ul>
      <li>HOMEメニューの「設定」の「データ管理」以下にある「データの整理」</li>
      <li>HOMEメニューの「設定」の「データ管理」以下にある「ソフトの消去」</li>
      <li>HOMEメニューの「設定」の「本体」以下にある「本体の初期化」</li>
      <li>メンテナンスモードで実行できる、「セーブデータを残して初期化」</li>
    </ul>
    <p>なお、ユーザーアカウントセーブデータを削除しても、データ配信キャッシュストレージは削除されません。</p>
  </div>
</div>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <p>本体をDevMenuで起動しているときは、Save DataタブからTypeがBcatである項目を選択して、アプリケーションごとにデータ配信キャッシュストレージを削除することができます。</p>
  </div>
</div>
<h3 id="Anchor_198953467_h3_4">永続性の確保</h3>
<p>永続性を確保したいデータ(例えば、期間限定で配信するデータ)は、ユーザーアカウントセーブデータにコピーして保存してください。</p>
<p>このときファイルのダイジェスト値をセットで保存することにより、将来的にファイルが更新されたことを検知しやすくなります。</p>
<p>ファイルのダイジェスト値は <span class="ApiLink_nn__bcat__DeliveryCacheFile__GetDigest">nn::bcat::DeliveryCacheFile::GetDigest</span>() で取得できます。</p>
<p>
  <br />
</p>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <p>期間限定で配信するデータが存在しないときは、即時同期を完了するまではデータの読み込みを行わないことにより、アプリケーションをシンプルに実装できます。</p>
  </div>
</div>
<h3 id="Anchor_198953467_h3_5">
  <span style="color: rgb(117,117,117);">永続性を確保したときのリスク</span>
</h3>
<p>配信されたデータをユーザーアカウントセーブデータにコピーするときは、以下のリスクに注意してください。</p>
<ul>
  <li>誤って不正な形式のデータを配信したとき、アプリケーションのシーケンス次第ではアプリケーションが実行不能状態になる可能性がある。</li>
  <li>誤って不正な形式のデータを配信したあとに正しい形式のデータを配信し直しても、アプリケーションのシーケンス次第では上書きできず、実行不能状態から復旧できない可能性がある。</li>
</ul>
<p>
  <br />
</p>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <p>あるデータを以下の条件で配信したときを考えます。</p>
    <ul>
      <li>データは期間限定で配信される。</li>
      <li>データはユーザーアカウントセーブデータにコピーされる。</li>
      <li>データは不正な形式だった。</li>
    </ul>
    <p>このときすべてのユーザーのセーブデータに正しい形式のデータを届けるには、期間限定での配信を中止して、ずっと配信し続ける必要があることに注意してください。</p>
  </div>
</div>
<h2 id="Anchor_198953467_h2_5">
  <span style="color: rgb(117,117,117);">利用可能なディレクトリ名、およびファイル名</span>
</h2>
<p>ディレクトリ名、およびファイル名の設定方法には制限があります。以下に例示します。</p>
<ul>
  <li>31 文字以内(終端文字を含めて 32 文字以内)である必要があります<strong>。</strong></li>
  <li>ファイル名の末尾にドット（.）を利用できません。</li>
</ul>
<p>詳細は <span class="ApiLink_nn__bcat__FileName">nn::bcat::FileName</span> 構造体 と <span class="ApiLink_nn__bcat__DirectoryName">nn::bcat::DirectoryName</span> 構造体の関数リファレンスを参照してください。</p>
<!--Remove-->
<h2 id="Anchor_198953467_h2_6">パッチで変更可能な設定</h2>
<p>パッチによるデータ配信キャッシュストレージの値の変更には、注意と禁止事項があります。</p>
<table class="wrapped" style="margin-left: 1.5em;">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>サイズの拡張</th>
      <td>
        <div class="content-wrapper">
          <p>可能です。</p>
          <p>
            <br />
          </p>
          <p>ただし、最新のパッチが適用された本体ではデータを受信できても、パッチを未適用の本体では容量不足によりデータを受信できない可能性があります。</p>
          <p>また、受信できなくなるデータ(更新できなくなるディレクトリ)は不定です。</p>
          <p>
            <br />
          </p>
          <div class="info_new">
            <div class="info_new_left">参考：</div>
            <div class="info_new_right">
              <p>データ配信キャッシュストレージのサイズの拡張には、セーブデータと同じ回数制限があります。</p>
              <p>詳細は<a href="../Pages/Page_107782148.html">パッチによるセーブデータのサイズ拡張</a>を参照してください。</p>
            </div>
          </div>
        </div>
      </td>
    </tr>
    <tr>
      <th>
        <p>サイズの縮小</p>
      </th>
      <td>
        <p>禁止します。</p>
      </td>
    </tr>
    <tr>
      <th>パッチで初めて値を設定する</th>
      <td>
        <p>パッチにより、データ配信キャッシュストレージの値を「未設定の状態(サイズが0の状態)」から「設定済みの状態(サイズが0ではない状態)」に変更することは可能です。</p>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_198953467_h2_7">パッチによる仕様変更を考慮した設計</h2>
<p>パッチによってアプリケーションの機能を拡張することにより、最初のバージョンのアプリケーションでは想定していなかった新規のディレクトリ、もしくはファイルが追加される可能性があります。</p>
<p>
  <br />
</p>
<p>あらかじめ以下のように対応してください。</p>
<ul>
  <li>データ配信キャッシュストレージにアクセスしたときに、現在のバージョンのアプリケーションにとって未知のディレクトリ、もしくはファイルが存在しても問題のないようにアプリケーションを設計する。</li>
  <li>データ配信キャッシュストレージのサイズを本来必要であると見積もった量よりも少し大きめに設定する。</li>
</ul>
<p>
  <br />
</p>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <p>パッチにおいて互換性のない変更を行うときは、以下の機能の説明もあわせて参照してください。</p>
    <ul>
      <li>パッチのドキュメントの「<a href="../Pages/Page_185137959.html">必須バージョン</a>」の説明</li>
      <li>「BCAT管理ツール取扱説明書」の「要求アプリケーションバージョン」の説明</li>
    </ul>
  </div>
</div>
<h2 id="Anchor_198953467_h2_8">ロールバックを考慮した設計</h2>
<p>ユーザーが「ユーザーとセーブデータの引っ越し」を行ったとき、ユーザーアカウントセーブデータの視点では、データ配信キャッシュストレージがロールバックしたように見える可能性があります。</p>
<p>アプリケーションは次回アプリケーションが起動されたときに、データがロールバックしている可能性（若返っている可能性）を考慮してください。</p>
<h1 id="Anchor_198953467_h1_2">運用</h1>
<h2 id="Anchor_198953467_h2_9">配信サイズの制限</h2>
<p>アプリケーションごとに、30日の間に配信するファイルのサイズの合計が100 MiBを超えないようにしてください。</p>
<p>例えば、サイズが3 MiBのファイルを1個格納したディレクトリを1個作成すると仮定したとき、同ファイルを24時間ごとに更新するようなスケジュールをサーバーに登録できます。<br />制限を超える見込みがあるときは、あらかじめ任天堂の窓口に相談してください。</p>
<div class="warn_new">
  <div class="warn_new_left">警告：</div>
  <div class="warn_new_right">
    <p>
      <span style="color: rgb(45,45,45);">製品環境において任天堂への相談なく制限を超えていることが判明したときは、データの配信停止を相談する可能性があります。</span>
    </p>
  </div>
</div>
<h2 id="Anchor_198953467_h2_10">
  <span style="color: rgb(117,117,117);">配信が禁止されている可能性のあるデータ</span>
</h2>
<p>以下に該当するデータを配信することは、「ガイライン」やその他のルールにより禁止されている可能性があります。注意してください。</p>
<ul>
  <li style="list-style-type: none; background-image: none;">
    <ul>
      <li>広告に該当するデータ</li>
      <li>アプリケーション本編のレーティングを超えるデータ</li>
    </ul>
  </li>
</ul>
<h2 id="Anchor_198953467_h2_11">ロットチェックをするためのデータの登録</h2>
<p>任天堂にアプリケーションのマスターROMを提出してロットチェックを行う際は、ロットチェック環境(sd1、およびsp1環境)のBCAT管理ツールにテスト用のデータを登録してください。</p>
<p>詳細は、「BCATデータ配信ガイド」を参照してください。</p>
<h2 id="Anchor_198953467_h2_12">製品機のためのデータの登録</h2>
<p>アプリケーションの発売前であっても、製品環境(lp1環境)のBCAT管理ツールにデータを登録できます。</p>
<p>ただし、製品機を使って実際にデータを受信して、データの登録に誤りがないことを確認できるのは、製品機で動作するアプリケーションを入手してから以降になります。注意してください。</p>
<div class="warn_new">
  <div class="warn_new_left">警告：</div>
  <div class="warn_new_right">
    <p>アプリケーションの特定のシーケンスに必要なデータは、アプリケーションの発売日までに製品環境で配信することを推奨します。</p>
    <p>また、上記のデータを配信し損ねたとしても、アプリケーションの動作は停止しないように設計することを推奨します。</p>
  </div>
</div>
<p>
  <br />
</p>
<h1 id="Anchor_198953467_h1_3">実装</h1>
<h2 id="Anchor_198953467_h2_13">Windows 環境での利用</h2>
<p>Windows 環境にはサーバーのデータを同期する機能を提供していませんが、代わりにデータアクセスエミュレーション機能を提供しています。</p>
<h3 id="Anchor_198953467_h3_6">データアクセスエミュレーション</h3>
<p>カレントディレクトリに bcat-dc という名前のディレクトリを配置すると、<span class="ApiLink_nn__bcat__MountDeliveryCacheStorage">nn::bcat::MountDeliveryCacheStorage</span>() はそのディレクトリをマウントします。</p>
<p>bcat-dc 以下にデイレクトリとファイルを配置することで、<span class="ApiLink_nn__bcat__">nn::bcat::</span>DeliveryCacheDirectory や <span class="ApiLink_nn__bcat__DeliveryCacheFile">nn::bcat::DeliveryCacheFile</span> からアクセスできるようになります。</p>
<p>
  <br />
</p>
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <p>ファイルのダイジェスト値の計算は行わないため、 <span class="ApiLink_nn__bcat__DeliveryCacheDirectoryEntry__digest">nn::bcat::DeliveryCacheDirectoryEntry::digest</span> や <span class="ApiLink_nn__bcat__DeliveryCacheFile">nn::bcat::DeliveryCacheFile</span>::GetDigest() で取得できるダイジェスト値は 0 クリアされた値になります。</p>
  </div>
</div>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
<!--AddLink-->
<script>
var NintendoSdkApiRefernce = {
    idMap: {},
    linkRewrite: function ()
    {
        var idMap = NintendoSdkApiRefernce.idMap;
        function rewrite(el)
        {
            var e = idMap[el.className];
            if (e === undefined)
            {
                return;
            }
            var html = '';
            html += '<a href=';
            html += e.url;
            html += ' target="_blank">';
            html += el.innerHTML;
            html += '</a>';
            el.innerHTML = html;
        }
        var apiLinkElems = document.querySelectorAll('span[class*="ApiLink_"]');
        for (var i = 0, n = apiLinkElems.length; i< n; ++i) {
            rewrite(apiLinkElems[i]);
        }
    }
};
function SetUrl( id, url )
{
    NintendoSdkApiRefernce.idMap[id] = { url: url };
}
SetUrl( 'ApiLink_nn__bcat__DeliveryCacheFile__GetDigest', '../../../Api/HtmlNX/classnn_1_1bcat_1_1_delivery_cache_file.html#a2deae736a085a6e8def365b330e13267' )
SetUrl( 'ApiLink_nn__bcat__FileName', '../../../Api/HtmlNX/structnn_1_1bcat_1_1_file_name.html' )
SetUrl( 'ApiLink_nn__bcat__DirectoryName', '../../../Api/HtmlNX/structnn_1_1bcat_1_1_directory_name.html' )
SetUrl( 'ApiLink_nn__bcat__MountDeliveryCacheStorage', '../../../Api/HtmlNX/namespacenn_1_1bcat.html#a85d0404aec6ba31824bd7c40f8e856cf' )
SetUrl( 'ApiLink_nn__bcat__', '../../../Api/HtmlNX/namespacenn_1_1bcat.html' )
SetUrl( 'ApiLink_nn__bcat__DeliveryCacheFile', '../../../Api/HtmlNX/classnn_1_1bcat_1_1_delivery_cache_file.html' )
SetUrl( 'ApiLink_nn__bcat__DeliveryCacheDirectoryEntry__digest', '../../../Api/HtmlNX/structnn_1_1bcat_1_1_delivery_cache_directory_entry.html#a454d93a93be2bb52b01c9fa88dda791f' )

NintendoSdkApiRefernce.linkRewrite();
</script>
<!--AddLink-->
</body>
</html>
