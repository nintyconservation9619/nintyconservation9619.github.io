<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'],['\\(','\\)']],
    ignoreClass: ".*",
    processClass: "math-(display|inline)",
    processEscapes: false,
    processRefs: false
  },
  "HTML-CSS": {
    imageFont: null
  }
});
</script>
<script type="text/javascript" src="../template/js/MathJax/MathJax.js?config=TeX-AMS-MML_SVG"></script>
<title>IRSENSOR ライブラリ</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- IRSENSOR ライブラリ -->
<div class="pagetitle" id="PageId_112902247">IRSENSOR ライブラリ</div>
<div class="text_separate">
<h1 id="Anchor_112902247_h1_1">はじめに</h1>
<p>IRSENSOR ライブラリは、&nbsp;Joy-Con&nbsp;(R) に搭載される モーションIRカメラの機能を使うためのライブラリです。</p>
<p>ここでは、IRSENSOR ライブラリが提供する各機能を、API の使用方法と合わせて説明します。</p>
<p>なお、モーションIRカメラに関する概要については、別ドキュメント（「モーションIRカメラガイド」）を参照してください。<br />( 「モーションIRカメラガイド」は、Nintendo Developer Portal の Developer Support -&gt; NX -&gt; ダウンロード から入手することができます。 )</p>
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <p>本ライブラリを使用するためには、必ず「<a href="../Pages/Page_163415475.html">コントローラーの準備</a>」の手順に従って環境のセットアップ（ Joy-Con のファームウェア更新）を行ってください。</p>
    <p>古い Joy-Con FW の組み合わせ等でも動作することがありますが、動作保証対象外ですので必ず SDK のバージョンにあった Joy-Con ファームウェアへ更新を行うようにしてください。</p>
  </div>
</div>
<h1 id="Anchor_112902247_h1_2">ライブラリの提供形態と利用方法</h1>
<h2 id="Anchor_112902247_h2_1">Windows環境</h2>
<p>IRSENSOR ライブラリは静的ライブラリファイル libnn_irsensor.lib&nbsp; として提供されます。<br />ライブラリを利用するためには、明示的に指定されたライブラリファイルをリンクする必要があります。</p>
<h2 id="Anchor_112902247_h2_2">実機環境</h2>
<p>IRSENSOR ライブラリは動的ライブラリである nnSdk.nso に含まれた形で提供されます。<br />このため、デフォルトで特に意識することなく使用することができます。</p>
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <p>NXAddon 3.1.0 より前までのSDKでは、IRSENSOR ライブラリは静的ライブラリファイル libnn_irsensor.a として提供されていました。</p>
  </div>
</div>
<h1 id="Anchor_112902247_h1_3">提供機能</h1>
<p>IRSENSOR ライブラリが提供する機能（モード）は以下の通りです。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>機能（モード）</th>
      <th>概要</th>
      <th>補足</th>
    </tr>
    <tr>
      <td>
        <a href="../Pages/Page_112902609.html">共通機能</a>
      </td>
      <td>各モードを使用するために必要な共通機能です。</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>
        <a href="../Pages/Page_112902345.html">クラスタリングモード</a>
      </td>
      <td>IRカメラで撮影した物体を含むクラスタを検出するモードです。</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>
        <a href="../Pages/Page_112902376.html">モーメントモード</a>
      </td>
      <td>IRカメラで取得した画像に対して、画像処理におけるモーメント計算を行った結果を出力するモードです。</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>
        <a href="../Pages/Page_112902380.html">画像転送モード</a>
      </td>
      <td>IRカメラで撮影した画像を低フレームレートで出力するモードです。</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>
        <a href="../Pages/Page_112902387.html">ハンドアナリシスモード</a>
      </td>
      <td>IRカメラで撮影した手の外観形状や輪郭、面積など、手に関する情報を出力するモードです。</td>
      <td>0.8.0 から対応。 4.0.0 以降で性能が改善されています。</td>
    </tr>
    <tr>
      <td>
        <a href="../Pages/Page_165050999.html">ポインティングモード</a>
      </td>
      <td>IRカメラで撮影した再帰性反射材バーの情報を元に、画面をポインティングするモードです。</td>
      <td>4.2.0 から対応、特殊なハードウェアが必要で、事前に任天堂に確認が必要</td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_112902247_h1_4">注意点</h1>
<h2 id="Anchor_112902247_h2_3">データの更新周期について</h2>
<p>モーションIRカメラで扱うデータはボタンデータなどに比べてデータサイズが大きいため、モーションIRカメラを利用する際は、ボタンや加速度やジャイロといったモーションセンサーデータのみを利用する場合に比べて、コントローラ（Joy-Con）側から受け取るデータの更新周期が遅くなります。(無線環境にもよりますが、15ms に 1 回はデータが更新される仕様となっています。)<br />ボタンやモーションセンサーデータもモーションIRカメラのデータ更新周期に合わせて遅くなるため、注意が必要です。</p>
<h2 id="Anchor_112902247_h2_4">同期関数の扱いについて</h2>
<p>システムの一貫性を保つため、またアプリ開発者のエラーハンドリングを軽減するため、IRSENSOR ライブラリのいくつかの関数は呼び出し元のスレッドを長時間ブロックすることがあります。<br />コントローラの接続や、電池切れなどのユーザ操作をトリガーに発生するエラー表示や、コントローラ更新などのブロック処理も存在するため、アプリ側のメインスレッドで呼び出すと音や絵を止めてしまう可能性があります。</p>
<p>このような、ユーザ操作や、システム挙動によってブロックが発生する可能性のある同期関数については、メインスレッドとは別のスレッドから呼び出すことを推奨します。<br />各関数の詳細な仕様については、API リファレンスをご覧ください。</p>
<h2 id="Anchor_112902247_h2_5">コントローラの接続変化や、アプリのフォーカス、スリープのハンドリングについて</h2>
<p>コントローラの切断、再接続や、アプリのフォーカス遷移、またスリープ復帰などのユーザ操作によるイベントに対しては、システムがハンドリングを行うため、アプリ側は特に意識する必要はありません。</p>
<p>システムの挙動としては、アプリからの各プロセッサの Run / Stop 要求を元に、アプレット、コントローラの状態を見つつできる限り要求された状態に戻す仕様となっています。<br />したがって、<span class="ApiLink_nn__irsensor__Run">nn::irsensor::Run</span>~Processor 関数を発行した状態で、コントローラ接続したり、メニューからアプリへの遷移をしたり、スリープ復帰したりした後にはそれぞれ自動的に元の状態に復帰します。<br />一方、こういったシステム側での処理を含む、プロセッサ、コントローラの状態については、 <span class="ApiLink_nn__irsensor__Get">nn::irsensor::Get</span>**ProcessorState のリザルトや、<span class="ApiLink_nn__irsensor__GetIrCameraStatus">nn::irsensor::GetIrCameraStatus</span>, <span class="ApiLink_nn__irsensor__GetImageProcessorStatus">nn::irsensor::GetImageProcessorStatus</span> などで取得できるため、<br />これをハンドリングしてユーザにコントローラの接続状況を案内したり、再接続が確認できるまでアプリ側で待つといったことができます。</p>
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <p>NXAddon 4.x 系では、特定のユーザ操作により <span class="ApiLink_nn__irsensor__GetImageProcessorStatus">nn::irsensor::GetImageProcessorStatus</span> の状態が不正になる不具合があるため、ご注意ください。 詳しくは既知の不具合をご覧ください。</p>
  </div>
</div>
<h2 id="Anchor_112902247_h2_6">コントローラのファームウェア更新について</h2>
<p>NXAddon 4.0.0 以降で提供される機能となります。</p>
<p>モーションIRカメラの提供する機能はコントローラのファームウェアと関係するため、新しい機能を利用するためにはファームウェア更新が要求されます。<br />実際にモーションIRカメラを使用する際に更新が必要ということが分かると、ライブラリ内部でコントローラサポートアプレットのファームウェア更新機能を呼び出し、<br />アプリが意識することなく、ユーザにコントローラのファームウェア更新を要求することができます。<br /><br />アプリのユーザ体験の観点で、実際にモーションIRカメラを使用するタイミングで更新が走るのが好ましくないという場合は、事前にファームウェア更新の必要性を確認するための <span class="ApiLink_nn__irsensor__CheckFirmwareUpdateNecessity">nn::irsensor::CheckFirmwareUpdateNecessity</span> 関数を呼び出し、<br />必要であれば <span class="ApiLink_nn__hid__ShowControllerFirmwareUpdate">nn::hid::ShowControllerFirmwareUpdate</span> 関数を呼び出し、コントローラサポートアプレットのファームウェア更新をあらかじめ実行しておくことができます。</p>
<h2 id="Anchor_112902247_h2_7">システム側でのエラービューアの呼び出し</h2>
<p>以下のようなケースでは モーションIRカメラライブラリがエラービューアを起動してエラーメッセージを表示することがあります。</p>
<ul>
  <li>HW に異常があるケース</li>
  <li>Joy-Con の電池残量が少ないために モーションIRカメラ機能が使用できないケース<ul><li>電池残量が少ない Joy-Con を本体に接続して動作させようとしたケースでのみ発生することがあります</li></ul></li>
</ul>
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <div class="confluence-information-macro-body">
      <p>モーションIRカメラライブラリがエラービューアを表示した場合は、処理がアプリケーションに返ってくるのに時間を要することがありますのでご注意ください。</p>
    </div>
  </div>
</div>
<p>
  <br />
</p>
<p>なお、システム側でエラービューアを呼ぶ可能性があるのはデータ取得を行う以下の Get 関数となります。</p>
<ul>
  <li>
    <span class="ApiLink_nn__irsensor__GetMomentProcessorState">nn::irsensor::GetMomentProcessorState</span> / <span class="ApiLink_nn__irsensor__GetMomentProcessorStates">nn::irsensor::GetMomentProcessorStates</span></li>
  <li>
    <span class="ApiLink_nn__irsensor__GetClusteringProcessorState">nn::irsensor::GetClusteringProcessorState</span> / <span class="ApiLink_nn__irsensor__GetClusteringProcessorStates">nn::irsensor::GetClusteringProcessorStates</span></li>
  <li>
    <span class="ApiLink_nn__irsensor__GetImageTransferProcessorState">nn::irsensor::GetImageTransferProcessorState</span>
  </li>
  <li>
    <span class="ApiLink_nn__irsensor__Get">nn::irsensor::Get</span>
    <span style="color: rgb(51,51,51);">HandAnalysis</span>SilhouetteState</li>
  <li>
    <span class="ApiLink_nn__irsensor__Get">nn::irsensor::Get</span>
    <span style="color: rgb(51,51,51);">HandAnalysis</span>ImageState</li>
  <li>
    <span class="ApiLink_nn__irsensor__GetPointingProcessorStates">nn::irsensor::GetPointingProcessorStates</span>
  </li>
</ul>
<h2 id="Anchor_112902247_h2_8">無線接続時の モーションIRカメラの同時使用台数の制限</h2>
<p>複数のコントローラが本体に無線接続されている状態でモーションIRカメラの機能を使用しようとした場合、以下のような使用台数の制限があります。</p>
<ul>
  <li>モーションIRカメラを使用する無線コントローラが 1 台のみの場合<ul><li>他の無線コントローラは 7 台まで接続可能</li></ul></li>
  <li>モーションIRカメラを使用する無線コントローラが 2 台以上の場合<ul><li>本体に接続できる無線コントローラの総接続台数は最大 4 台まで<ul><li>モーションIRカメラの同時使用台数の最大は 4 台（この場合、他のコントローラの接続は不可）</li></ul></li></ul></li>
</ul>
<p>1 つの Npad に対してモーションIRカメラが搭載された無線コントローラは多くとも 1 台となりますが、JoyDual/ FullKey スタイルの場合は 1 つの Npad に対して、複数の無線コントローラが接続される可能性があります。<br />特に、モーションIRカメラを複数台利用する場合は、ゲームでのユースケースに合わせて <span class="ApiLink_nn__hid__SetSupportedNpadIdType">nn::hid::SetSupportedNpadIdType</span> 関数で台数制限を適切に行い、<br /><span class="ApiLink_nn__hid__SetSupportedNpadStyleSet">nn::hid::SetSupportedNpadStyleSet</span> 関数で使用する Npad のスタイルを適切に設定した上で、各 Npad に対してモーションIRカメラの設定を行う必要があります。<br />適切にコントローラ設定が行われない場合は、ユーザによって不用意に接続された無線コントローラによって、モーションIRカメラの使用が制限されてしまう可能性があるため、注意が必要です。<br />なお、利用状態とは <span class="ApiLink_nn__irsensor__Run">nn::irsensor::Run</span>~Processor 関数を呼び出した状態で、利用状態で <span class="ApiLink_nn__irsensor__StopImageProcessor">nn::irsensor::StopImageProcessor</span> 関数を呼び出すことで停止状態となります。<br /><br /></p>
<p>以下に、モーションIRカメラを複数台利用する場合に許容される、具体的な設定例を示します。 (複数台利用のケースなので NpadIdType 数が 1 の場合は省略しています。)<br />ゲームプレイ途中で <span class="ApiLink_nn__hid__SetNpadJoyAssignmentModeDual">nn::hid::SetNpadJoyAssignmentModeDual</span> 関数などを呼び出して、Style を切り替えるような場合はこの限りではありませんので、注意が必要です。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th colspan="2" rowspan="2">モーションIRカメラ<span style="color: rgb(255,0,0);">複数台利用時</span>の Npad 設定<br /><br /><br /></th>
      <th colspan="4" style="text-align: center;">
        <p>許容する NpadIdType 数</p>
        <p>(Handheld を除く)</p>
      </th>
      <th rowspan="2" style="text-align: center;">備考</th>
    </tr>
    <tr>
      <td class="highlight-grey">2</td>
      <td class="highlight-grey">3</td>
      <td class="highlight-grey">4</td>
      <td class="highlight-grey">5 以上</td>
    </tr>
    <tr>
      <td class="highlight-grey" rowspan="5">
        <p>
          <strong>許可する NpadStyleSet </strong>
        </p>
        <p>
          <strong>の組み合わせ</strong>
        </p>
        <p>
          <strong>(Handheld を除く)<br /></strong>
        </p>
      </td>
      <td class="highlight-grey">
        <div class="content-wrapper">
          <p>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909304.png" class="embedded-image" />
            </span>
          </p>
          <p>JoyRight</p>
        </div>
      </td>
      <td>○</td>
      <td>○</td>
      <td>○</td>
      <td>&times;</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td class="highlight-grey">
        <div class="content-wrapper">
          <p>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909304.png" class="embedded-image" />
            </span>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909288.png" class="embedded-image" />
            </span>
          </p>
          <p>
            <br />
          </p>
          <p>JoyRight/JoyLeft</p>
        </div>
      </td>
      <td>○</td>
      <td>○</td>
      <td>○</td>
      <td>
        <p>&times;</p>
      </td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td class="highlight-grey">
        <div class="content-wrapper">
          <span class="embedded-file-wrapper ">
            <img src="../Attachments/Attach_112902247/205909304.png" class="embedded-image" />
          </span>
          <span class="embedded-file-wrapper ">
            <img src="../Attachments/Attach_112902247/205909317.png" class="embedded-image" />
          </span>
          <span class="embedded-file-wrapper ">
            <img src="../Attachments/Attach_112902247/205909324.png" class="embedded-image" />
          </span>
          <span class="embedded-file-wrapper ">
            <img src="../Attachments/Attach_112902247/205909360.png" class="embedded-image" />
          </span>
          <p>
            <br />
          </p>
          <p>JoyRight/JoyDual/FullKey</p>
        </div>
      </td>
      <td>○</td>
      <td>△(※)</td>
      <td>&times;</td>
      <td>&times;</td>
      <td>(※ モーションIRカメラを使用する JoyDual/FullKey が 1 台のみに限定できる場合は使用可能)</td>
    </tr>
    <tr>
      <td class="highlight-grey">
        <div class="content-wrapper">
          <p>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909304.png" class="embedded-image" />
            </span>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909288.png" class="embedded-image" />
            </span>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909317.png" class="embedded-image" />
            </span>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909324.png" class="embedded-image" />
            </span>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909360.png" class="embedded-image" />
            </span>
          </p>
          <p>JoyRight/JoyLeft/JoyDual/FullKey</p>
        </div>
      </td>
      <td>
        <p>○</p>
      </td>
      <td>△(※)</td>
      <td>&times;</td>
      <td>&times;</td>
      <td>
        <p>(※ モーションIRカメラを使用する JoyDual/FullKey が 1 台のみに限定できる場合は使用可能)</p>
      </td>
    </tr>
    <tr>
      <td class="highlight-grey">
        <div class="content-wrapper">
          <p>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909317.png" class="embedded-image" />
            </span>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909324.png" class="embedded-image" />
            </span>
            <span class="embedded-file-wrapper ">
              <img src="../Attachments/Attach_112902247/205909360.png" class="embedded-image" />
            </span>
          </p>
          <p>JoyDual/FullKey</p>
        </div>
      </td>
      <td>○</td>
      <td>&times;</td>
      <td>&times;</td>
      <td>&times;</td>
      <td>
        <br />
      </td>
    </tr>
  </tbody>
</table>
<p>なお、上記の条件を満たさない状態で モーションIRカメラのデータ取得用の Get 関数を呼ぶと <span class="ApiLink_nn__irsensor__ResultIrsensorNotReady">nn::irsensor::ResultIrsensorNotReady</span> が返ります。</p>
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <p>NXAddon 1.0.x 以前では、条件を満たさない状態で Get 関数を呼ぶとアボートする仕様となっていました。</p>
  </div>
</div>
<h2 id="Anchor_112902247_h2_9">NFC 機能との排他仕様</h2>
<p>モーションIRカメラの機能と NFC 機能はハードウェアの制約上同時に使用できない仕様となっています。<br />したがって、同一アプリ内で モーションIRカメラと NFC 機能の両方を使用する場合、必ず一方の機能を終了してからもう一方の機能を使用してください。<br />なお、具体的には排他の判定が行われるのは、モーションIRカメラの <span class="ApiLink_nn__irsensor__Run">nn::irsensor::Run</span>~Processor 関数を発行した後となりますので、<br />対象となるハンドルに対して <span class="ApiLink_nn__irsensor__StopImageProcessor">nn::irsensor::StopImageProcessor</span> でプロセッサを停止状態にすることで、他の機能が利用できるようになります。</p>
<h2 id="Anchor_112902247_h2_10">モーションIRカメラのデータを使用した入力・無入力の判定</h2>
<p>モーションIRカメラは、対象物のカメラとの距離によって得られるデータの変化量の幅が大きく異なり、ノイズなのか正しい入力なのかの判定が難しいため、データを使用した入力・無入力の判定を行いません。<br />したがって、他のデバイスの入力がない状態の場合では、モーションIRカメラを起動し、モーションIRカメラのデータに変化がある状態でも、しばらく時間が経つと Dimming や sleep 状態になってしまいます。</p>
<p>アプリのシーンによって、スリープに入られると困るような場合は、<span class="ApiLink_nn__oe__ReportUserIsActive">nn::oe::ReportUserIsActive</span>() 関数を呼び出して、入力状態を通知することができますが、使用には制限があるため、<br />必ず「<a href="../Pages/Page_198946139.html">無操作状態の制御</a>」を参照してください。</p>
<h2 id="Anchor_112902247_h2_11">アプリがインフォーカス状態ではない場合のモーションIRカメラの挙動</h2>
<p>アプリからライブラリアプレットを呼び出したり、 ネットワーク機能をBGで使用するため、HOME メニューでもアプリが裏で動作するように設定した場合など、<br />アプリがインフォーカス状態でない時にモーションIRカメラのデータ取得用の Get 関数を呼ぶと <span class="ApiLink_nn__irsensor__ResultIrsensorNotReady">nn::irsensor::ResultIrsensorNotReady</span> が返ります。</p>
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <p>NXAddon 1.0.x 以前では、フォーカス状態の別のアプレットがモーションIRカメラを使用した状態で、アプリがインフォーカス状態ではない時に Get 関数を呼ぶと、<br />不定のデータが返ったり、場合によってはアボートするリスクがありました。</p>
  </div>
</div>
<h2 id="Anchor_112902247_h2_12">クイック設定起動時のモーションIRカメラのデータ</h2>
<p>モーションIRカメラのデータは HOME ボタン長押しで起動するクイック設定起動中にも通常通り使用可能です。<br />一方で、ボタン入力やモーションセンサーのデータはクイック設定起動中は使用できません。</p>
<h2 id="Anchor_112902247_h2_13">モーションIRカメラの設定値と電池持ち時間</h2>
<p>モーションIRカメラは消費電力の大きなデバイスですので、パラメータ設定値による電池持ち時間の変動にも注意する必要があります。<br />特に、IR LED の点灯数と、露光時間の設定が支配的となっていますので、明るさを確保しつつ電池持ち時間も守りたい場合は、<br />ノイズは多くなりますがディジタルゲイン設定を優先的に上げるといった対応をとることを推奨します。<br />また、ポインティングモードや、ハンドアナリシスモードでは、ユーザの環境や操作に合わせて IR LEDや露光時間を自動で制御します。<br />そのため、使い方によって電池持ち時間が大きく変動するため、注意が必要です。<br />以下に代表的な設定例と電池持ち時間の関係を示します。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>設定例</th>
      <th>IR LED</th>
      <th>露光時間 (Exposure) [us]</th>
      <th>電池持ち時間</th>
    </tr>
    <tr>
      <td>
        <p>低消費電力設定<br />(近い距離のオブジェクトのみ検出したいケースなど)</p>
      </td>
      <td>2灯点灯 (IrCameraLightTarget_NearObjects or FarObjects)</td>
      <td>10</td>
      <td>約 12 時間</td>
    </tr>
    <tr>
      <td>SDK デモのデフォルト設定<br />(認識距離と消費電力のバランスをとりたいケースなど)</td>
      <td>4灯点灯 (IrCameraLightTarget_AllObjects)</td>
      <td>300</td>
      <td>約 7.8 時間</td>
    </tr>
    <tr>
      <td>
        <p>フルパワー設定</p>
        <p>(できる限り遠い距離のオブジェクトを検出したいケースなど)</p>
      </td>
      <td>4灯点灯 (IrCameraLightTarget_AllObjects)</td>
      <td>600</td>
      <td>約 5.8 時間</td>
    </tr>
    <tr>
      <td>
        <p>ポインティングモード設定</p>
        <p>
          <br />
        </p>
      </td>
      <td>4灯点灯の固定設定</td>
      <td>自動制御</td>
      <td>
        <p>約 4.7 時間</p>
        <p>(再帰性反射材バーから 4m 離れて利用し続けたワーストケース)</p>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_112902247_h2_14">センサー値の個体バラつき</h2>
<p>モーションIRカメラは、個体によるばらつきがあるためセンサーから得られる輝度値や座標値の絶対値を利用する場合には注意が必要です。<br />特に モーションIRカメラ（ Joy-Con ）を固定して座標値の絶対値を利用するような使い方をする場合、ある程度のズレを考慮して値を取り扱う必要があります。</p>
<p>例えば、輝度値については概ね &plusmn;10% 程度は個体によってバラつきが発生する可能性があります。<br />従って、オブジェクト判定のための明るさの閾値を 255 付近に設定した場合、個体によっては検出されないことがありますので注意が必要です。</p>
<h2 id="Anchor_112902247_h2_15">ハードウェア起因のノイズ</h2>
<p>露光時間およびゲインが強い状態で、下記のように一部の領域が極端に明るい状態となると、レンズの円形型ノイズが見える場合がありますが、これはハードウェアのレンズの仕様となります。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_112902247/161444415.bmp" width="300" class="embedded-image" />
  </span>
</p>
<h2 id="Anchor_112902247_h2_16">レンズによる歪み</h2>
<p>モーションIRカメラでは、採用しているレンズによって樽型の歪みが発生します。<br />画像処理を行うなど、より正確な情報を取得したい場合は、アプリ側で補正を行うことができます。</p>
<p>歪みの模式図を示します。(図の歪み量は正確ではなく、あくまでも概要を説明するためのものですのでご注意ください)<br />直線で構成される黒線の外枠を撮影した場合、レンズにより歪み、青線のように写ります。<br />R'、R&nbsp;はそれぞれ、歪み前後の対応する点のレンズ中心からの距離を表します。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_112902247/205889718.png" height="250" class="embedded-image" />
  </span>
</p>
<p>
  <br />
</p>
<p>歪み前後の関係を表すため、歪曲率を次のように定義します。</p>
<div class="math-display">\[ 歪曲率 = (R - R') / R' \times 100   \]</div>
<p>歪みの程度はレンズ中心からの距離によって変化するため、歪曲率は距離の関数として表すことができます。<br />上図のように、レンズ中心を 0.0, 歪曲後の画角の角を 1.0 とした時に、中心からの距離を x とすると、歪曲率 f(x) は以下の式に従います。</p>
<div class="math-display">\[ f(x) = 234.726x^6 - 532.274x^5 + 479.245x^4 - 280.277x^3 + 96.4481x^2 + 0.902929x + 0.019044 \]</div>
<p>
  <br />画像処理を行うなど、より正確な情報を取得、もしくは表示したい場合は、上記の式を参考に歪曲率を計算し、<br />該当するピクセル位置を変換することで歪曲補正を行ってください。</p>
<h1 id="Anchor_112902247_h1_5">サンプルプログラム</h1>
<p>Samples/Sources/Applications/IrSensorMomentBasic に配置されているサンプルを参照してください。</p>
<p>簡単に各モードの挙動を確認したい場合は、 Samples/Sources/Applications/IrSensorViewer に配置されているサンプルを参照してください。</p>
<p>なお、モーションIRカメラを使用する際には、コントローラのスタイル等も関連しますので HID のサンプルや仕様も合わせて参照してください。</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
<!--AddLink-->
<script>
var NintendoSdkApiRefernce = {
    idMap: {},
    linkRewrite: function ()
    {
        var idMap = NintendoSdkApiRefernce.idMap;
        function rewrite(el)
        {
            var e = idMap[el.className];
            if (e === undefined)
            {
                return;
            }
            var html = '';
            html += '<a href=';
            html += e.url;
            html += ' target="_blank">';
            html += el.innerHTML;
            html += '</a>';
            el.innerHTML = html;
        }
        var apiLinkElems = document.querySelectorAll('span[class*="ApiLink_"]');
        for (var i = 0, n = apiLinkElems.length; i< n; ++i) {
            rewrite(apiLinkElems[i]);
        }
    }
};
function SetUrl( id, url )
{
    NintendoSdkApiRefernce.idMap[id] = { url: url };
}
// ApiLink_nn__irsensor__Run
// ApiLink_nn__irsensor__Get
SetUrl( 'ApiLink_nn__irsensor__GetIrCameraStatus', '../../../Api/HtmlNX/namespacenn_1_1irsensor.html#acf66c625dc12cd1fb0d06e79eb1d32a5' )
SetUrl( 'ApiLink_nn__irsensor__GetImageProcessorStatus', '../../../Api/HtmlNX/namespacenn_1_1irsensor.html#a07eb18481070f89065809a60a5928bcb' )
SetUrl( 'ApiLink_nn__irsensor__CheckFirmwareUpdateNecessity', '../../../Api/HtmlNX/namespacenn_1_1irsensor.html#ae2d917a320b39f4bc1f29f87d2418819' )
SetUrl( 'ApiLink_nn__hid__ShowControllerFirmwareUpdate', '../../../Api/HtmlNX/namespacenn_1_1hid.html#a7533399b957c748b818b5a2114541ca8' )
SetUrl( 'ApiLink_nn__irsensor__GetMomentProcessorState', '../../../Api/HtmlNX/namespacenn_1_1irsensor.html#a505a4e54e2b1931bd78c4a85f5b67276' )
SetUrl( 'ApiLink_nn__irsensor__GetMomentProcessorStates', '../../../Api/HtmlNX/namespacenn_1_1irsensor.html#a54d616f420145c9b7ac415d3c3d93523' )
SetUrl( 'ApiLink_nn__irsensor__GetClusteringProcessorState', '../../../Api/HtmlNX/namespacenn_1_1irsensor.html#a6572060a5c7f41d2c19edde462fb5136' )
SetUrl( 'ApiLink_nn__irsensor__GetClusteringProcessorStates', '../../../Api/HtmlNX/namespacenn_1_1irsensor.html#af83d851b9b53c14d5e661f240ac482c2' )
SetUrl( 'ApiLink_nn__irsensor__GetImageTransferProcessorState', '../../../Api/HtmlNX/namespacenn_1_1irsensor.html#aa8e5d943258b76d2e90837bd319fa023' )
// ApiLink_nn__irsensor__GetPointingProcessorStates
SetUrl( 'ApiLink_nn__hid__SetSupportedNpadIdType', '../../../Api/HtmlNX/namespacenn_1_1hid.html#a82326d8c0d5f888fce443798bb829e97' )
SetUrl( 'ApiLink_nn__hid__SetSupportedNpadStyleSet', '../../../Api/HtmlNX/namespacenn_1_1hid.html#ac04a55a989058f9d69c5c3e4e29c4480' )
SetUrl( 'ApiLink_nn__irsensor__StopImageProcessor', '../../../Api/HtmlNX/namespacenn_1_1irsensor.html#a3052171f2c63aafc0e4a164366ae22d7' )
SetUrl( 'ApiLink_nn__hid__SetNpadJoyAssignmentModeDual', '../../../Api/HtmlNX/namespacenn_1_1hid.html#ae113078fec2203ef85f1c92bc9119183' )
SetUrl( 'ApiLink_nn__irsensor__ResultIrsensorNotReady', '../../../Api/HtmlNX/classnn_1_1irsensor_1_1_result_irsensor_not_ready.html' )
SetUrl( 'ApiLink_nn__oe__ReportUserIsActive', '../../../Api/HtmlNX/namespacenn_1_1oe.html#a42c00e7bc82aa57851ad3ac1af529c69' )

NintendoSdkApiRefernce.linkRewrite();
</script>
<!--AddLink-->
</body>
</html>
