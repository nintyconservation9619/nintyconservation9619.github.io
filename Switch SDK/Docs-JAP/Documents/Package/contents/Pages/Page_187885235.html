<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>モデル</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- モデル -->
<div class="pagetitle" id="PageId_187885235">モデル</div>
<div class="text_separate">
<h1 id="Anchor_187885235_h1_1">概要</h1>
<p>NintendoWare 3D のモデルの機能について説明します。</p>
<h1 id="Anchor_187885235_h1_2">モデルの構成要素</h1>
<p>g3d ではモデルを構成する 3 つの大きな要素があります。シェイプ、マテリアル、スケルトンの３つです。</p>
<h2 id="Anchor_187885235_h2_1">シェイプ</h2>
<p>モデルの形状を表す要素です。１つのモデルに複数持つことが可能です。シェイプには１つのマテリアルが適用されます。</p>
<h2 id="Anchor_187885235_h2_2">マテリアル</h2>
<p>モデルの質感を表す要素です。１つのモデルに複数持つことが可能です。</p>
<h2 id="Anchor_187885235_h2_3">スケルトン</h2>
<p>モデルの骨格を表す要素です。１つのモデルに１つだけです。</p>
<h1 id="Anchor_187885235_h1_3">モデルバイナリーリソース</h1>
<p>モデルバイナリーリソースは fmda もしくは fmdb 中間ファイルを入力とし、<a href="../Pages/Page_83955997.html">3D バイナリコンバーター</a>によって出力された bfres ファイルに格納されています。bfres ファイルには複数のモデルバイナリーリソースを格納することが可能です。１つのモデルバイナリーリソースは <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_model.html">nn::g3d::ResModel</a> クラスに対応しています。</p>
<h2 id="Anchor_187885235_h2_4">モデルバイナリーリソースの構成</h2>
<p>モデルバイナリーリソース (<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_model.html">nn::g3d::ResModel</a>) は大まかに以下のような構成となっています。下記に各構成要素の概要を記述します。詳細については API リファレンスを参照してください。</p>
<p style="text-align: center;">&nbsp;<div class="flowchart-svg-inline"><img src="../Attachments/Attach_187885235/flowchart_1.svg" /></div></p>
<h3 id="Anchor_187885235_h3_1">モデルのジオメトリデータ構成</h3>
<p>モデルバイナリーリソースのジオメトリデータは以下の要素で構成されています。</p>
<table class="table">
  <tbody>
    <tr>
      <th>名前</th>
      <th>データ型</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>シェイプ</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_shape.html">nn::g3d::ResShape</a>
      </td>
      <td>１つの形状を表すデータです。</td>
    </tr>
    <tr>
      <td>メッシュ</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_mesh.html">nn::g3d::ResMesh</a>
      </td>
      <td>
        <a href="../Pages/Page_106333688.html">LOD</a> を扱うためのデータです。シェイプは LOD レベル数分のメッシュを持ちます。</td>
    </tr>
    <tr>
      <td>サブメッシュ</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_sub_mesh.html">nn::g3d::ResSubMesh</a>
      </td>
      <td>
        <p>メッシュよりもさらに細かな単位に分割された描画の最小単位です。主に <a href="../Pages/Page_106333662.html#Anchor_106333662_view_frustum_culling">ビューフラスタムカリング</a> を行うために使用します。</p>
        <p>中間ファイルオプティマイザの <a href="../Pages/Page_83955705.html#Anchor_83955705_divide_submesh">サブメッシュ分割</a> を行った場合のみ、メッシュは分割数分のサブメッシュを持ちます。サブメッシュ分割を行わない場合は、ひとつのメッシュに対してサブメッシュをひとつだけ持ちます。</p>
      </td>
    </tr>
    <tr>
      <td>頂点データ</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_vertex.html">nn::g3d::ResVertex</a>
      </td>
      <td>頂点データを扱うデータです。</td>
    </tr>
    <tr>
      <td>頂点属性情報</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_vertex_attr.html">nn::g3d::ResVertexAttr</a>
      </td>
      <td>頂点属性の情報を扱うデータです。頂点属性名、対象の頂点バッファのインデックス、頂点属性のフォーマット、頂点属性のオフセットなどの情報を持ちます。</td>
    </tr>
  </tbody>
</table>
<p>下図に示すようにモデルは複数のシェイプ、シェイプは複数のメッシュ、メッシュは複数のサブメッシュを持つような構造になっています。</p>
<p>&nbsp;<div class="flowchart-svg-inline"><img src="../Attachments/Attach_187885235/flowchart_2.svg" /></div></p>
<h3 id="Anchor_187885235_h3_2">モデルのマテリアルデータ構成</h3>
<p>モデルバイナリーリソースのマテリアルデータは以下の要素で構成されます。</p>
<table class="table">
  <tbody>
    <tr>
      <th>名前</th>
      <th>データ型</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>マテリアル</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_material.html">nn::g3d::ResMaterial</a>
      </td>
      <td>マテリアルの情報を扱うデータです。マテリアルはモデル内に複数持つことが可能です。</td>
    </tr>
    <tr>
      <td>シェーダー割り当て情報</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_shader_assign.html">nn::g3d::ResShaderAssign</a>
      </td>
      <td>
        <p>シェーダーとモデルの関連付けの情報を扱うデータです。以下の情報を持ちます。</p>
        <ul>
          <li>マテリアルに設定されたシェーダーアーカイブおよびシェーディングモデルの名前</li>
          <li>シェーダーの頂点属性およびサンプラーがモデルデータ内のどの頂点属性とサンプラーに対応するか</li>
          <li>シェーダーのオプション変数の値の文字列</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td>シェーダーパラメーター情報</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_shader_param.html">nn::g3d::ResShaderParam</a>
      </td>
      <td>
        <a href="../Pages/Page_106332818.html">シェーダーパラメーター</a>の情報を扱うデータです。各シェーダーパラメーターのサイズおよびオフセットなどの情報を持ちます。</td>
    </tr>
    <tr>
      <td>サンプラー</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_sampler.html">nn::gfx::Sampler</a>
      </td>
      <td>サンプラーオブジェクトです。</td>
    </tr>
    <tr>
      <td>サンプラー情報</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_sampler_info.html">nn::gfx::SamperInfo</a>
      </td>
      <td>サンプラー情報です。</td>
    </tr>
    <tr>
      <td>描画情報</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_render_info.html">nn::g3d::ResRenderInfo</a>
      </td>
      <td>描画に関する情報を扱うデータです。どのような情報を持つかはユーザーの定義次第です。レンダーステートなどの情報を持つことを想定しています。</td>
    </tr>
  </tbody>
</table>
<h3 id="Anchor_187885235_h3_3">モデルのスケルトンデータ構成</h3>
<p>モデルバイナリーリソースのスケルトンデータは以下の要素で構成されます。</p>
<table class="table">
  <tbody>
    <tr>
      <th>名前</th>
      <th>データ型</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>スケルトン</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_skeleton.html">nn::g3d::ResSkeleton</a>
      </td>
      <td>スケルトンの情報を扱うデータです。スキニングのための情報などを持ちます。スケルトンはモデル内に１つだけです。</td>
    </tr>
    <tr>
      <td>ボーン</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_bone.html">nn::g3d::ResBone</a>
      </td>
      <td>ボーンの情報を扱うデータです。</td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h1 id="Anchor_187885235_h1_4">モデルインスタンス</h1>
<p>モデルを扱うためには <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_model.html">nn::g3d::ResModel</a> からモデルインスタンスである <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a> を作成する必要があります。g3d ではシステムが定義するシェイプ用のユニフォームブロック、マテリアル用のユニフォームブロック、スケルトン用のユニフォームブロックがあります。これらをシェイプユニフォームブロック、マテリアルユニフォームブロック、スケルトンユニフォームブロックと呼びます。<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a> は主にこれらのユニフォームブロックの更新処理を担うクラスです。シェイプユニフォームブロック、スケルトンユニフォームブロックは型がシステムで定められています。詳しくは<a href="../Pages/Page_172900704.html#Anchor_172900704_spec_uniformblock">ユニフォームブロックの仕様</a>を参照してください。マテリアルユニフォームブロックは自由に定義可能です。詳しくは<a href="../Pages/Page_106332818.html">シェーダーパラメーター</a>を参照してください。</p>
<h2 id="Anchor_187885235_h2_5">モデルインスタンスの構成</h2>
<p>モデルインスタンス (<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a>) は以下のような構成となっています。下記に各構成要素の概要を記述します。詳細については API リファレンスを参照してください。</p>
<p style="text-align: center;">&nbsp;<div class="flowchart-svg-inline"><img src="../Attachments/Attach_187885235/flowchart_3.svg" /></div></p>
<h3 id="Anchor_187885235_h3_4">モデルインスタンスの構成要素</h3>
<table class="table">
  <tbody>
    <tr>
      <th>名前</th>
      <th>型</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>モデルオブジェクト</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a>
      </td>
      <td>モデルインスタンスです。各オブジェクトの更新処理を行います。</td>
    </tr>
    <tr>
      <td>シェイプオブジェクト</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_shape_obj.html">nn::g3d::ShapeObj</a>
      </td>
      <td>シェイプインスタンスです。シェイプユニフォームブロックの更新、バウンディング球の計算などを行います。</td>
    </tr>
    <tr>
      <td>マテリアルオブジェクト</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_material_obj.html">nn::g3d::MaterialObj</a>
      </td>
      <td>マテリアルインスタンスです。シェーダーパラメーターの編集、マテリアルユニフォームブロックの更新などを行います。</td>
    </tr>
    <tr>
      <td>スケルトンオブジェクト</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_skeleton_obj.html">nn::g3d::SkeletonObj</a>
      </td>
      <td>スケルトンインスタンスです。スキニング用行列パレットの計算、スケルトンユニフォームブロックの更新などを行います。</td>
    </tr>
  </tbody>
</table>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
