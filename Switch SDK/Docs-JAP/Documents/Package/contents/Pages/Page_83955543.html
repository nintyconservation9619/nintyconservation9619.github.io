<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>プリプロセッサ命令</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- プリプロセッサ命令 -->
<div class="pagetitle" id="PageId_83955543">プリプロセッサ命令</div>
<div class="text_separate">
<h1 id="Anchor_83955543_h1_1">プリプロセッサ命令</h1>
<h2 id="Anchor_83955543_h2_1">概要</h2>
<p>プリプロセッサ命令とは、全てのテキストシーケンスで使用できる命令で、テキストの記述をサポートするものです。</p>
<p>例として、プリプロセッサ命令の 1 つに #define というものがあります。これは、次のように使います。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define LENGTH 24 </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;このように書いておくと、それ以降の行では、数字 24 を書くところの代わりに、LENGTH と書くことができるようになります。例えば、そのような箇所が複数あった場合、#define の行の 24 と書いてある値を変更するだけで、すべての値を一度に変更できるようになります。これは、値を試行錯誤して決めているときなどに、非常に有効です。</p>
<h2 id="Anchor_83955543_h2_2">プリプロセッサ命令</h2>
<p>以下に、プリプロセッサ命令の一覧を示します。</p>
<p>表 16 プリプロセッサ命令一覧</p>
<table class="table">
  <thead>
    <tr>
      <th>
        <p>プリプロセッサ命令</p>
      </th>
      <th>
        <p>説明</p>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <p>#define</p>
      </td>
      <td>
        <p>置換マクロを定義します</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>#undef</p>
      </td>
      <td>
        <p>置換マクロの定義を無効にします</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>#include</p>
      </td>
      <td>
        <p>別のファイルを組み込みます</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>#if</p>
      </td>
      <td>
        <p>真偽の条件評価を行います</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>#ifdef</p>
      </td>
      <td>
        <p>定義済みマクロについて条件評価を行います</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>#ifndef</p>
      </td>
      <td>
        <p>未定義マクロについて条件評価を行います</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>#else</p>
      </td>
      <td>
        <p>#if, #ifdef, #ifndef, #elifの偽部の評価区分の始まりを示します</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>#endif</p>
      </td>
      <td>
        <p>#if, #ifdef, #ifndef, #elifで始まる評価区分の終わりを示します</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>#elif</p>
      </td>
      <td>
        <p>#if, #ifdef, #ifndefの偽部での条件評価を行います</p>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>以下、順番に詳しく説明します。</p>
<h2 id="Anchor_83955543_h2_3">#define</h2>
<p>置換マクロを定義します。書式は次の通りです。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define マクロ名 置換の並び </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>これ以降の行で、マクロ名と同じ文字列が存在すると、それは置換の並びで指定したものに置換されて処理されます。マクロ名は、単語の一部ではなく全体が一致したときのみ置換が行われます。また、アルファベットの大文字・小文字は区別されます。</p>
<p>マクロ名は、ラベル名と同じように、アルファベットで始まり、アルファベット・数字・アンダースコア (_) が続く文字列を指定できます。通常は、小文字のアルファベットは使いません。</p>
<p>置換の並びは、自由な記述が可能ですが、当然、マクロを使用する箇所の書式にあわせる必要があります。例えば、数値を記入するところで使うマクロを定義するなら、置換の並びは数値を表していなければなりません。また、置換の並びは、省略することもできます。#ifdef で使うためだけのマクロを定義する場合などには省略して定義します。</p>
<p>同じマクロ名を 2 回定義するとエラーになりますが、#undef を使って一度無効化すると再定義することができます。</p>
<h3 id="Anchor_83955543_h3_1">#define の使用例</h3>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define LENGTH 24
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, LENGTH
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, LENGTH
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, LENGTH
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>は、以下の記述と同じです。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>置換の並びは、自由に記述できますので、次の記述も同じ意味です。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define VEL_LEN 127, 24
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;cn4 VEL_LEN
&nbsp;&nbsp;&nbsp;&nbsp;dn4 VEL_LEN
&nbsp;&nbsp;&nbsp;&nbsp;en4 VEL_LEN
fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>次は、#ifdef と組み合わせた例です。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define ENABLE_FLAG
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
#ifdef ENABLE_FLAG
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
#endif
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>#ifdef と #endif で囲まれた行は、ENABLE_FLAG が定義されているときのみ有効になります。#define ENABLE_FLAG の行を削除すると、en4 127, 24 の行は無効になります。</p>
<h2 id="Anchor_83955543_h2_4">#undef</h2>
<p>置換マクロの定義を無効にします。書式は次の通りです。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#undef マクロ名 </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>#define で定義されたマクロを無効化して、未定義の状態にします。定義されていないマクロを指定しても、何もしません。</p>
<p>マクロを再定義したい場合や、#ifdef / #ifndef と組み合わせて使います。</p>
<h3 id="Anchor_83955543_h3_2">#undef の使用例</h3>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define LENGTH 24
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, LENGTH
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, LENGTH
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, LENGTH
&nbsp;
#undef LENGTH
#define LENGTH 12
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, LENGTH
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, LENGTH
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, LENGTH
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>このように、#undef を使えば、同じマクロ名でも 2 回定義できるようになります。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define ENABLE_FLAG
#undef ENABLE_FLAG
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
#ifdef ENABLE_FLAG
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
#endif
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>#ifdef と #endif で囲まれた行は、ENABLE_FLAG が定義されているときのみ有効になりますが、#undef で無効にしているため、en4 127, 24 の行は無効になります。</p>
<h2 id="Anchor_83955543_h2_5">#include</h2>
<p>別のファイルを組み込みます。書式は次の通りです。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#include &quot;ファイル名&quot;
&nbsp;
#include &lt;ファイル名&gt; </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>ファイル名で指定したファイルを、現在の位置に組み込みます。#include を使うことで、幾つかのファイルの共通部分を 1 つのファイルにまとめたり、 1 つのファイルを複数の人で編集するときに、別々のファイルにわけたりすることができるようになります。</p>
<p>ファイル名には、絶対パス、相対パスのいずれも使用できます。相対パスで指定した場合、起点となるディレクトリが、2 種類の書式によって異なります。#include &quot;ファイル名&quot; 形式の書式では、現在のファイルからの相対パスになります。#include&lt; ファイル名&gt; 形式の書式では、コンバートを行うサウンドプロジェクトファイルのあるパスからの相対パスとなります。</p>
<h3 id="Anchor_83955543_h3_3">#include の使用例<a name="Anchor_83955543_INCLUDE_Example"></a></h3>
<p>バンクファイルのコンバートを行うと、拡張子 *.finl のプログラムナンバリストファイルに次のような内容が出力されます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define PRG_PIANO 0
#define PRG_ORGAN 1
#define PRG_GUITAR 2 </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>このファイルをテキストシーケンスの先頭でインクルードすることにより、プログラムチェンジでラベルを使って記述できるようになります。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#include &quot;../bnk/se.finl&quot;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;prg PRG_ORGAN
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h2 id="Anchor_83955543_h2_6">#if</h2>
<p>真偽の条件評価を行います。基本式は次の通りです。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#if 評価式
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(真の時有効)
&nbsp;
#endif </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>評価式を評価して、結果が正しければ、以降の行は有効になりますが、結果が間違っていれば以降の行は無効になります。有効または無効の区間は、#endif までになります。</p>
<p>評価式には、数値を指定することもできます。数値を指定した場合、0 なら無効、0 以外なら有効となります。</p>
<h3 id="Anchor_83955543_h3_4">#if の使用例</h3>
<p>次のようにして、ある区間を無効にして、コメントの代わりに使えます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#if 0
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;fin
#endif </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>このようにしておけば、後で有効にするのも簡単です。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#if 1
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;fin
#endif </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>以下のような表現もできます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define VERSION 2
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
#if VERSION &gt;= 2
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
#endif
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>このように、式を評価することで、有効／無効を切り替えることができます。この例では、結果が正しいので、en4 127, 24 の行は有効になります。</p>
<h2 id="Anchor_83955543_h2_7">#ifdef / #ifndef</h2>
<p>マクロの定義または未定義の状態を評価します。書式は次の通りです。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#ifdef マクロ名
&nbsp;
#ifndef マクロ名 </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>評価式の代わりに、マクロ名を指定して定義されているかどうかを評価します。#ifdef は、マクロが定義されている時に真となり、#ifndef はマクロが未定義の時に真となります。それ以外の動作は、#if と同じです。</p>
<h3 id="Anchor_83955543_h3_5">#ifdef / #ifndef の使用例</h3>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define ENABLE_FLAG
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
#ifdef ENABLE_FLAG
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
#endif
#ifndef ENABLE_FLAG
&nbsp;&nbsp;&nbsp;&nbsp;fn4 127, 24
#endif
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>上の例では、ENABLE_FLAG が定義されているので、en4 127, 24 の行が有効になり、fn4 127, 24 の行が無効になります。一方、</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define ENABLE_FLAG
#undef ENABLE_FLAG
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
#ifdef ENABLE_FLAG
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
#endif
#ifndef ENABLE_FLAG
&nbsp;&nbsp;&nbsp;&nbsp;fn4 127, 24
#endif
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>このように、#undef を行うと、ENABLE_FLAG が未定義状態になりますので、逆に fn4 127, 24 の行が有効になります。</p>
<h2 id="Anchor_83955543_h2_8">#else</h2>
<p>#if, #ifdef, #ifndef, #elif の偽部の評価区分の始まりを示します。基本式は次の通りです。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#if ...
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;(真の時有効)
&nbsp;
#else
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;(偽の時有効)
&nbsp;
#endif </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>#if, #ifdef の評価結果が偽の時、#else ～ #endif までの区間が有効になります。逆に結果が真の場合は、#else ～ #endif の区間は無効になります。</p>
<h3 id="Anchor_83955543_h3_6">#else の使用例</h3>
<p>次のようにすると、2つのバージョンを簡単に切り替えることができます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#if 1
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;fin
#else
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;gn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;fin
#endif </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>この例では、#if ～ #else までの区間が有効になりますが、#if 1 を #if 0 に変えるだけで、#else ～ #endif の方を有効にすることができます。</p>
<h2 id="Anchor_83955543_h2_9">#endif</h2>
<p>#if, #ifdef, #ifndef, #elif で始まる評価区分の終わりを示します。基本式は次の通りです。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#if 評価式
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;(真の時有効)
&nbsp;
#endif </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>詳しくは、#if, #ifdef, #ifndef, #elif の説明をご覧ください。</p>
<h2 id="Anchor_83955543_h2_10">#elif</h2>
<p>#if, #ifdef, #ifndef の偽部での条件評価を行います。基本式は次の通りです。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#if 評価式１
&nbsp;
#elif 評価式２
&nbsp;
#endif </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>言葉で説明するより、例を見た方がわかりやすいので、下記の例をご覧ください。</p>
<h3 id="Anchor_83955543_h3_7">#elif の使用例</h3>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define VERSION 2
&nbsp;
#if VERSION == 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
#else
&nbsp;&nbsp;&nbsp;&nbsp;#if VERSION == 2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;#else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
&nbsp;&nbsp;&nbsp;&nbsp;#endif
#endif
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>といったものを、#elif を使うと、</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#define VERSION 2
&nbsp;
#if VERSION == 1
&nbsp;&nbsp;&nbsp;&nbsp;cn4 127, 24
#elif VERSION == 2
&nbsp;&nbsp;&nbsp;&nbsp;dn4 127, 24
#else
&nbsp;&nbsp;&nbsp;&nbsp;en4 127, 24
#endif
&nbsp;&nbsp;&nbsp;&nbsp;fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>のように、簡潔に書くことができます。</p>
<p>&nbsp;</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
