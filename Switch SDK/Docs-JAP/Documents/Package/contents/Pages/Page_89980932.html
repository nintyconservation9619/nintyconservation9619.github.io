<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>Xpad</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- Xpad -->
<div class="pagetitle" id="PageId_89980932">Xpad</div>
<div class="text_separate">
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_89980932_h1_1">はじめに</a>
    </li>
    <li>
      <a href="#Anchor_89980932_h1_2">BasicXpad</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_89980932_h2_1">概要</a>
      </li>
      <li>
        <a href="#Anchor_89980932_h2_2">Windows 環境における構成</a>
      </li>
      <ul>
        <li>
          <a href="#Anchor_89980932_h3_1">XInput 互換コントローラ</a>
        </li>
        <li>
          <a href="#Anchor_89980932_h3_2">その他の HID 準拠ゲームコントローラ</a>
        </li>
      </ul>
    </ul>
    <li>
      <a href="#Anchor_89980932_h1_3">Xpad の使用方法</a>
    </li>
  </ul>
</p>
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <p>Xpad は、現在の SDK では非サポートです。<br />SDK 0.10.0 以降で提供された <a href="../Pages/Page_124018876.html">Npad</a>&nbsp;に早めの移行をお願いします。</p>
  </div>
</div>
<h1 id="Anchor_89980932_h1_1">はじめに</h1>
<p>Xpad は、種々のゲームパッドをプラットフォーム毎のコントローラモデルに則ってジェネリックに操作するために用意された機構です。</p>
<p>以下の仕様に対してオーバーロードされます。</p>
<ul style="list-style-type: square;">
  <li>BasicXpad</li>
</ul>
<p>
  <br />
</p>
<p>Xpad を利用する際は、まず&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#a702d5fff61fc85c57a8d35888992d49e">GetXpadIds()</a> で Xpad ID を取得し、対象とするものについて&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#af0dfadf68851d2aba39a15256c1900e6">InitializeXpad()</a> を呼び出して初期化を行います。</p>
<p>入力状態を取得する API として <a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#aefd4e287bd4ffbe73a4236944562b3ae">GetXpadState()</a> と <a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#a88495bd2695b8d5bfa327e212d963f43">GetXpadStates()</a> が用意されています。</p>
<p>
  <a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#aefd4e287bd4ffbe73a4236944562b3ae">GetXpadState()</a> は最新の入力状態を取得する際に使用します。</p>
<p>
  <a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#a88495bd2695b8d5bfa327e212d963f43">GetXpadStates()</a> は、最新の入力状態から遡って、複数の入力状態を取得する際に使用します。 最大で <a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#afc8d1ef4f69334a367474826853897cf">XpadStateCountMax</a>&nbsp;個まで遡ることができます。</p>
<p>入力状態の取得が Xpad の状態を変えることはないため、同じ API を繰り返し呼び出した際に、入力状態の更新が挟まれなければ、取得される値は同じとなります。</p>
<p>入力状態には、更新を行うたびに 1 ずつ増えていく番号が、サンプリング番号として割り当てられます。 取得した入力状態はこの番号から判別することが可能です。</p>
<p>
  <br />
</p>
<p>ゲームパッドの接続状況に依らず、 Xpad の入力状態は常に取得することが可能です。</p>
<p>ゲームパッドが、&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#af0dfadf68851d2aba39a15256c1900e6">InitializeXpad()</a> の呼び出し後に切断や再接続されたとしても、Xpad は再初期化を行うことなく継続して利用できます。</p>
<p>
  <br />
</p>
<p>1 P、2 P のような明示的なプレイヤー番号が必要な場合は、<a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#af13be07c528ba06e79eb600eea3c2678">GetXpadPlayerNumber()</a> の返す値を利用することが可能です。 0 オリジンである点に注意してください。</p>
<h1 id="Anchor_89980932_h1_2">BasicXpad</h1>
<h2 id="Anchor_89980932_h2_1">概要</h2>
<p>BasicXpad からは下記の入力状態を取得することができます。</p>
<ul>
  <li>16 個のデジタルボタン<ul><li>十字ボタンの上下左右</li><li>A, B, X, Y,&nbsp;L, R, ZL, ZR, Start, Select</li><li>左右 1 つずつのアナログスティックの押し込み</li></ul></li>
  <li>左右 1 つずつのアナログスティック</li>
</ul>
<p>デジタルボタンやアナログスティックの配置やコントローラの形状は Wii U PRO コントローラ と同等と見なすことができます。</p>
<p>入力状態の更新は、5 ms 以上の間隔を開けて、その時点における最新のサンプリング値に基いて行われます。</p>
<p>アナログスティックからの入力座標は (0, 0) をゼロ点とする半径 <a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#aae5f082196ed0f5db69b1862e8b64b4d">AnalogStickMax</a> の円の内側（境界を含む）に位置します。&nbsp;軸方向は右と上が正となります。</p>
<p>アナログスティックからの入力の分解能はプラットフォームごとに定義されます。</p>
<p>
  <br />
</p>
<p>ゲームパッドの切断などが原因でサンプリングに失敗した場合、 BasicXpad は、何も入力が無かったものとして、全てのボタンが押されておらず、全てのアナログスティックの座標が (0, 0) にある状態を自身の入力状態とします。</p>
<p>
  <br />
</p>
<p>Xpad ID と入力状態は、それぞれ <a href="../../../Api/HtmlNX/structnn_1_1hid_1_1_basic_xpad_id.html">BasicXpadId</a>&nbsp;構造体と <a href="../../../Api/HtmlNX/structnn_1_1hid_1_1_basic_xpad_state.html">BasicXpadState</a>&nbsp;構造体で表現されます。</p>
<p>ゲームパッドの接続状況を判定する必要がある場合は、&nbsp;<a href="../../../Api/HtmlNX/structnn_1_1hid_1_1_basic_xpad_state.html">BasicXpadState</a>&nbsp;構造体の <a href="../../../Api/HtmlNX/structnn_1_1hid_1_1_basic_xpad_state.html#ad783be0cbc2efd3659a476b08864a3b3">attributes</a> メンバ変数の&nbsp;<a href="../../../Api/HtmlNX/structnn_1_1hid_1_1_basic_xpad_attribute.html#a21b0e85e4150fe57e41d44e917ff6e61">IsConnected</a> フラグを参照してください。</p>
<h2 id="Anchor_89980932_h2_2">Windows 環境における構成</h2>
<p>汎用コントローラやキーボード入力の割り当ては <a href="../Pages/Page_89983199.html">HID エミュレーション設定</a>に従って行われます。</p>
<p>キャリブレーションは Windows 側で行われていることを前提とます。 Xpad 内では何も行いません。</p>
<p>汎用コントローラを使用する場合、デバイスの仕様に応じて下記のように入力状態が決定します。</p>
<h3 id="Anchor_89980932_h3_1">XInput 互換コントローラ</h3>
<p>入力状態の更新は&nbsp;XInputGetState() から得られた値に基づいて行われます。 この時、 Windows 7 との互換性を取るため&nbsp;xinput9_1_0.dll の実装を使用します。</p>
<p>ボタンの対応は下記の通りです。</p>
<table class="wrapped">
  <thead>
    <tr>
      <th>
        <div class="tablesorter-header-inner" style="text-align: center;">BasicXpad</div>
      </th>
      <th>
        <div class="tablesorter-header-inner" style="text-align: center;">XInput 互換コントローラ</div>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a ボタン</td>
      <td>A ボタン</td>
    </tr>
    <tr>
      <td>b ボタン</td>
      <td>B ボタン</td>
    </tr>
    <tr>
      <td>x ボタン</td>
      <td>Y ボタン</td>
    </tr>
    <tr>
      <td>y ボタン</td>
      <td>X ボタン</td>
    </tr>
    <tr>
      <td>L スティックボタン</td>
      <td>左スティックボタン</td>
    </tr>
    <tr>
      <td>R スティックボタン</td>
      <td>右スティックボタン</td>
    </tr>
    <tr>
      <td>L ボタン</td>
      <td>LB ボタン</td>
    </tr>
    <tr>
      <td>R ボタン</td>
      <td>RB ボタン</td>
    </tr>
    <tr>
      <td>ZL ボタン</td>
      <td>左 トリガー</td>
    </tr>
    <tr>
      <td>ZR ボタン</td>
      <td>右 トリガー</td>
    </tr>
    <tr>
      <td>Start ボタン</td>
      <td>START ボタン</td>
    </tr>
    <tr>
      <td>Select ボタン</td>
      <td>BACK ボタン</td>
    </tr>
    <tr>
      <td>十字ボタン 左</td>
      <td>方向パッド 左</td>
    </tr>
    <tr>
      <td>十字ボタン 上</td>
      <td>方向パッド&nbsp;上</td>
    </tr>
    <tr>
      <td>十字ボタン 右</td>
      <td>方向パッド&nbsp;右</td>
    </tr>
    <tr>
      <td>十字ボタン 下</td>
      <td>方向パッド&nbsp;下</td>
    </tr>
  </tbody>
</table>
<p>アナログスティックからの入力は、<span style="color: rgb(69,69,69);">XINPUT_GAMEPAD_LEFT_THUMB_DEADZONE と XINPUT_GAMEPAD_RIGHT_THUMB_DEADZONE に基づき十字にデッドゾーン処理を行った上で、 (0, 0) をゼロ点とする半径&nbsp;<a class="external-link" href="../../../Api/HtmlNX/namespacenn_1_1hid.html#aae5f082196ed0f5db69b1862e8b64b4d" rel="nofollow">AnalogStickMax</a>&nbsp;の円内に収められます。</span></p>
<h3 id="Anchor_89980932_h3_2">その他の HID 準拠ゲームコントローラ</h3>
<p>入力状態の更新は、joyGetPosEx() と&nbsp;joyGetDevCaps() から得られた値に基づいて行われます。</p>
<p>ボタンと座標軸の割り当ては&nbsp;<a href="../Pages/Page_89983199.html">HID エミュレーション設定</a>に従います。</p>
<p>アナログスティックからの入力は、下記の<span style="color: rgb(69,69,69);">デッドゾーン処理を行った上で、</span>(0, 0) をゼロ点とする半径&nbsp;<a class="external-link" href="../../../Api/HtmlNX/namespacenn_1_1hid.html#aae5f082196ed0f5db69b1862e8b64b4d" rel="nofollow">AnalogStickMax</a>&nbsp;の円内に収められます。</p>
<ol>
  <li>
    <span style="color: rgb(51,51,51);">JOY_USEDEADZONE フラグで<span style="color: rgb(51,51,51);">デッドゾーン処理を</span>抑止した上で座標値を取得します。</span>
  </li>
  <li>
    <span style="color: rgb(51,51,51);">左のアナログスティックについて、<span style="color: rgb(69,69,69);">XINPUT_GAMEPAD_LEFT_THUMB_DEADZONE&nbsp;<span style="color: rgb(69,69,69);">に基づき十字にデッドゾーン処理を行います</span></span>。</span>
  </li>
  <li>
    <span style="color: rgb(51,51,51);">右のアナログスティックについて、<span style="color: rgb(69,69,69);">XINPUT_GAMEPAD_RIGHT_THUMB_DEADZONE&nbsp;に基づき十字にデッドゾーン処理を行います</span>。</span>
  </li>
</ol>
<h1 id="Anchor_89980932_h1_3">Xpad の使用方法</h1>
<p>
  <br />
</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="cp">#include &lt;nn/hid.h&gt;
</span> 
<span class="c1">// ジェネリックプログラミングフレンドリに型を再定義
</span><span class="k">struct</span> <span class="n">Xpad</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">typedef</span> <span class="nn">nn::hid::</span><span class="n">BasicXpadId</span> <span class="n">Id</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">typedef</span> <span class="nn">nn::hid::</span><span class="n">BasicXpadState</span> <span class="n">State</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">typedef</span> <span class="nn">nn::hid::</span><span class="n">BasicXpadAttribute</span> <span class="n">Attribute</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">typedef</span> <span class="nn">nn::hid::</span><span class="n">BasicXpadButton</span> <span class="n">Button</span><span class="p">;</span>
<span class="p">};</span>
 
<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">void</span> <span class="n">nnMain</span><span class="p">()</span>
<span class="p">{</span>
<span class="c1">// 1. 取得した Xpad ID を使って Xpad を初期化します。
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">Xpad::</span><span class="n">Id</span> <span class="n">xpadIds</span><span class="p">[</span><span class="nn">nn::hid::</span><span class="n">XpadIdCountMax</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span> <span class="n">xpadIdCount</span> <span class="o">=</span> <span class="nn">nn::hid::</span><span class="n">GetXpadIds</span><span class="p">(</span><span class="n">xpadIds</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">xpadIds</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">xpadIds</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// 使いたい分だけ初期化
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">xpadIdCount</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::hid::</span><span class="n">InitializeXpad</span><span class="p">(</span><span class="n">xpadIds</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
 
<span class="c1">// 2. 必要に応じて入力状態を取得します。
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="n">xpadIdCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">Xpad::</span><span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="p">{};</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::hid::</span><span class="n">GetXpadState</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="p">,</span> <span class="n">xpadIds</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">buttons</span><span class="p">.</span><span class="n">Test</span><span class="o">&lt;</span><span class="nn">Xpad::Button::</span><span class="n">A</span><span class="o">&gt;</span><span class="p">())</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// A ボタンが押されていた場合の処理
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
&nbsp;
<span class="c1">// 入力状態を取得する際に、過去の入力状態も合わせて取得したい場合は、GetXpadStates() を使用します。
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="n">xpadIdCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">Xpad::</span><span class="n">State</span> <span class="n">states</span><span class="p">[</span><span class="nn">nn::hid::</span><span class="n">XpadStateCountMax</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// 最低でも 1 つの入力状態を取得
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span> <span class="n">stateCount</span> <span class="o">=</span> <span class="nn">nn::hid::</span><span class="n">GetXpadStates</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">states</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">xpadIds</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// 過去の入力状態（最大で 16 サンプル）における右アナログスティックの平均座標を算出
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">stateCount</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">x</span> <span class="o">+=</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">analogStickR</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">y</span> <span class="o">+=</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">analogStickR</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">x</span> <span class="o">/=</span> <span class="n">stateCount</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">y</span> <span class="o">/=</span> <span class="n">stateCount</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
