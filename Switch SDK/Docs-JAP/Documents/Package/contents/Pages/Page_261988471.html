<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>文字コードへの変換</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- 文字コードへの変換 -->
<div class="pagetitle" id="PageId_261988471">文字コードへの変換</div>
<div class="text_separate">
<h1 id="Anchor_261988471_h1_1">機能概要</h1>
<p>キーボードのキーコード (USB HID Keyboard/Keypad Page Usage ID) を文字コード (UTF-16) へ変換する機能を提供します。</p>
<p>
  <br />
</p>
<p>文字コードへの変換は文字コード変換表 (<a href="../../../Api/HtmlNX/structnn_1_1kpr_1_1_key_code_map.html">KeyCodeMap</a>) に基いて行われます。</p>
<p>
  <a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a60927e605375ab1d97c40e639dd05138">GetKeyCodeMap()</a> を呼び出すことで、本体設定において指定されたキーボード配列と対応する <a href="../../../Api/HtmlNX/structnn_1_1kpr_1_1_key_code_map.html">KeyCodeMap</a> が得られます。</p>
<p>本体設定の変更に追従するためには <a href="../../../Api/HtmlNX/structnn_1_1kpr_1_1_key_code_map.html">KeyCodeMap</a> を取得し直す必要があります。</p>
<p>
  <br />
</p>
<p>文字コードへの変換は&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a4b9bf988e73e64e3c928420b1127d83e">GetKeyCode()</a> を、キーコード、修飾キーの状態 (<a href="../../../Api/HtmlNX/namespacenn_1_1hid.html#a93f953afa0aacfb8081e7d7d028bb96c">nn::hid::KeyboardModifierSet</a>)、文字コード変換表、文字コード変換表の変換モード (<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a5bf2ba4864b5e6da1ac9b325dac6ed4b">KeyCodeMapMode</a>) を指定して呼び出すことで行います。</p>
<p>
  <a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a4b9bf988e73e64e3c928420b1127d83e">GetKeyCode()</a> は内部状態を持たないため、同じ引数に対しては常に同じ結果を返します。</p>
<p>文字コードの値は&nbsp;<a href="../../../Api/HtmlNX/structnn_1_1kpr_1_1_key_code.html#a507df9e53b31a341f6de451f33b3f49e">KeyCode::code</a> から参照できます。指定された引数に対応する文字コードが存在しない場合は <a href="../../../Api/HtmlNX/structnn_1_1kpr_1_1_key_code.html#a507df9e53b31a341f6de451f33b3f49e">KeyCode::code</a> の値は 0 となります。</p>
<p>
  <a href="../../../Api/HtmlNX/structnn_1_1kpr_1_1_key_code.html#aca4b8ca675b69785868bc9968585bbe7">KeyCode::attributes</a> には得られた文字コードの属性情報が含まれます。</p>
<p>
  <a href="../../../Api/HtmlNX/structnn_1_1kpr_1_1_key_code_attribute.html#aa3b984738a58e1864edbbdf21fe8bcfd">KeyCodeAttribute::IsPrintable</a> を参照することで、印字可能な文字とデッドキーのような制御文字とを区別することができます。</p>
<p>
  <a href="../../../Api/HtmlNX/structnn_1_1kpr_1_1_key_code_attribute.html#ab5d29959ca8458c490dfe6acf49dcd7b">KeyCodeAttribute::IsAsciiConvertible</a> を参照することで、対応する ASCII コードが存在する文字とそうではない文字とを区別することができます。</p>
<p>
  <br />
</p>
<p>文字コード変換表が複数の変換モードを持つ場合、変換モード (<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a5bf2ba4864b5e6da1ac9b325dac6ed4b">KeyCodeMapMode</a>) を指定することでこれを切り替えることができます。</p>
<p>文字コード変換表が変換モードに対応しているか否かは&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#af07698fcaa7633939b3c64bb1a653034">IsKeyCodeMapModeSupported()</a> を呼び出すことで確認できます。</p>
<p>文字コード変換表が有効であれば、<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a5bf2ba4864b5e6da1ac9b325dac6ed4b">KeyCodeMapMode_Default</a> は常にサポートされます。</p>
<p>非サポートの変換モードが指定された場合は&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a5bf2ba4864b5e6da1ac9b325dac6ed4b">KeyCodeMapMode_Default</a> を指定した場合と同じ結果が返ります。</p>
<p>
  <br />
</p>
<p>かな入力をサポートする場合は、<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a5bf2ba4864b5e6da1ac9b325dac6ed4b">KeyCodeMapMode_Hiragana</a> や&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a5bf2ba4864b5e6da1ac9b325dac6ed4b">KeyCodeMapMode_Katakana</a> を適宜指定します。</p>
<p>かな入力が当該プラットフォーム上で選択されている場合、かな入力に対応した文字コードが返ります。選択されていない場合は&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a5bf2ba4864b5e6da1ac9b325dac6ed4b">KeyCodeMapMode_Default</a> を指定した場合と同じ結果が返ります。</p>
<p>
  <br />
</p>
<p>
  <span style="color: rgb(51,51,51);">キリル文字入力をサポートする場合は、<a href="../../../Api/HtmlNX/namespacenn_1_1kpr.html#a5bf2ba4864b5e6da1ac9b325dac6ed4b">KeyCodeMapMode_Cyrillic</a>&nbsp;を適宜指定します。</span>
</p>
<h1 id="Anchor_261988471_h1_2">
  <span style="color: rgb(51,51,51);">キーボード配列の決定</span>
</h1>
<p>
  <span style="color: rgb(51,51,51);">本体設定がキーボード配列の指定に対応していない環境においては、代わりに言語設定の値を参照して下記のように<span style="color: rgb(51,51,51);">キーボード配列を</span>決定します。</span>
</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>言語設定</th>
      <th>キーボード配列</th>
    </tr>
    <tr>
      <td>日本語</td>
      <td>
        <span style="color: rgb(51,51,51);">日本語</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">英語（US リージョン）</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">英語（US）</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">英語（EU リージョン）</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">英語（UK）</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">フランス語（US リージョン）</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">フランス語（カナダ）</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">フランス語（EU リージョン）</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">フランス語</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">スペイン語（US リージョン）</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">スペイン語（ラテンアメリカ）</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">スペイン語（EU リージョン）</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">スペイン語</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">ドイツ語</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">ドイツ語</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">イタリア語</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">イタリア語</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">オランダ語</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">英語（US-International）</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">ポルトガル語</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">ポルトガル語</span>
      </td>
    </tr>
    <tr>
      <td>
        <span style="color: rgb(51,51,51);">ロシア語</span>
      </td>
      <td>
        <span style="color: rgb(51,51,51);">ロシア語</span>
      </td>
    </tr>
    <tr>
      <td>その他</td>
      <td>
        <span style="color: rgb(51,51,51);">英語（US）</span>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_261988471_h1_3">
  <span style="color: rgb(51,51,51);">使用方法</span>
</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="cp">#include &lt;nn/nn_Log.h&gt;
#include &lt;nn/nn_TimeSpan.h&gt;
#include &lt;nn/hid/hid_Keyboard.h&gt;
#include &lt;nn/kpr/kpr_KeyCode.h&gt;
#include &lt;nn/os/os_Thread.h&gt;
#include &lt;nn/util/util_CharacterEncoding.h&gt;
</span>
<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">void</span> <span class="n">nnMain</span><span class="p">()</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::hid::</span><span class="n">InitializeKeyboard</span><span class="p">();</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;Waiting for keyboard input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::os::</span><span class="n">SleepThread</span><span class="p">(</span><span class="nn">nn::TimeSpan::</span><span class="n">FromSeconds</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::hid::</span><span class="n">KeyboardState</span> <span class="n">state</span> <span class="o">=</span> <span class="p">{};</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::hid::</span><span class="n">GetKeyboardState</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">state</span><span class="p">.</span><span class="n">modifiers</span><span class="p">.</span><span class="n">Set</span><span class="o">&lt;</span><span class="nn">nn::hid::KeyboardModifier::</span><span class="n">NumLock</span><span class="o">&gt;</span><span class="p">();</span>

<span class="c1">// 1. 文字コード変換表を取得します。
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::kpr::</span><span class="n">KeyCodeMap</span><span class="o">*</span> <span class="n">pMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nn">nn::kpr::</span><span class="n">KeyCodeMap</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::kpr::</span><span class="n">GetKeyCodeMap</span><span class="p">(</span><span class="n">pMap</span><span class="p">);</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="nn">nn::hid::KeyboardKey::A::</span><span class="n">Index</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nn">nn::hid::KeyboardKey::ZenkakuHankaku::</span><span class="n">Index</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="n">Test</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
<span class="c1">// 2. キーコードを文字コードに変換します。
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::kpr::</span><span class="n">KeyCode</span> <span class="n">code</span> <span class="o">=</span> <span class="p">{};</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::kpr::</span><span class="n">GetKeyCode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">code</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">state</span><span class="p">.</span><span class="n">modifiers</span><span class="p">,</span> <span class="o">*</span><span class="n">pMap</span><span class="p">,</span> <span class="nn">nn::kpr::</span><span class="n">KeyCodeMapMode_Default</span><span class="p">);</span>

<span class="c1">// 3. 印字可能な文字コードであればログ出力します。
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="n">code</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="n">Test</span><span class="o">&lt;</span><span class="nn">nn::kpr::KeyCodeAttribute::</span><span class="n">IsPrintable</span><span class="o">&gt;</span><span class="p">())</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">char</span> <span class="n">achar</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::util::</span><span class="n">ConvertStringUtf16NativeToUtf8</span><span class="p">(</span><span class="n">achar</span><span class="p">,</span> <span class="n">NN_ARRAY_SIZE</span><span class="p">(</span><span class="n">achar</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">code</span><span class="p">.</span><span class="n">code</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;Code %02X was converted to %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">achar</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="n">pMap</span><span class="p">;</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>
  <span style="color: rgb(51,51,51);">
    <br />
  </span>
</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
