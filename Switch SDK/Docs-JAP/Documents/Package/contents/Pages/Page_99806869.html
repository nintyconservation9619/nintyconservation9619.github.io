<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>ビューアーライブラリ</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- ビューアーライブラリ -->
<div class="pagetitle" id="PageId_99806869">ビューアーライブラリ</div>
<div class="text_separate">
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_99806869_h1_1">概要</a>
    </li>
    <li>
      <a href="#Anchor_99806869_h1_2">サンプル</a>
    </li>
    <li>
      <a href="#Anchor_99806869_h1_3">組み込み</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_99806869_h2_1">初期化</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_2">サーバーのオープン</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_3">アニメーション計算</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_4">3DEditor との通信</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_5">コマンドの実行</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_6">サーバーのクローズ</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_7">終了</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_99806869_h1_4">モデル編集対象の登録と解除</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_99806869_h2_8">モデル編集対象の登録</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_9">モデル編集対象の登録解除</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_99806869_h1_5">シェーダーアーカイブ編集対象の登録と解除</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_99806869_h2_10">シェーダーアーカイブ編集対象の登録</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_11">シェーダーアーカイブ編集対象の登録解除</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_99806869_h1_6">その他の処理</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_99806869_h2_12">指定したモデルのスケルタルアニメーションのみを計算</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_13">3DEditor に読み込み済みモデルのマテリアルを選択</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_14">3DEditorのマテリアル選択状態をクリア</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_15">3DEditor にモデルのプレビュースケール、回転、移動情報を送信する</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_16">描画情報を組み込む</a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_17">3DEditor から特定のモデルに対して任意の処理を実行する</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_99806869_h1_7">コールバック</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_99806869_h2_18"> ModelFileLoaded </a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_19"> ModelFileUnloaded </a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_20">  TextureFileLoaded  </a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_21">  TextureFileUnloaded  </a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_22">  ShaderAssignUpdated  </a>
      </li>
      <li>
        <a href="#Anchor_99806869_h2_23">   MaterialUpdated   </a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_99806869_h1_8">注意事項</a>
    </li>
    <li>
      <a href="#Anchor_99806869_h1_9">FAQ</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_99806869_h2_24">3DEditor でマテリアルを編集後にコールバックで取得できるリソースが更新されていません</a>
      </li>
    </ul>
  </ul>
</p>
<h1 id="Anchor_99806869_h1_1">概要</h1>
<p>ビューアーライブラリは 3DEditor と連携し、モデル、シェーダーアーカイブをリアルタイム編集するためのライブラリです。モデル、シェーダーアーカイブの管理や描画は行わないため、ゲームアプリケーションがモデル、シェーダーアーカイブの管理や描画を行う必要があります。ビューアーライブラリは、ゲームアプリケーションに実装されているモデルか、3DEditor から転送されてきたモデルかによらず、登録されたモデルをリアルタイム編集することができます。また、ゲームアプリケーションに実装されているシェーダーアーカイブをリアルタイム編集することができます。編集対象として登録するためには特別なクラスなどを用意する必要はなく、ゲーム中と同じ方法で登録したモデルインスタンス、シェーダーアーカイブを利用することができます。</p>
<h1 id="Anchor_99806869_h1_2">サンプル</h1>
<p>ビューアーライブラリの組み込みサンプルは以下にあります。</p>
<p>%NINTENDO_SDK_ROOT%\Samples\Sources\Applications\G3dDemo</p>
<p>G3dDemo の <a href="../../../Api/HtmlNX/_page_sample_g3d_edit.html">Edit</a>、<a href="../../../Api/HtmlNX/_page_sample_g3d_town.html">Town</a> サンプルにビューアーライブラリが組み込まれており、サンプルアプリケーションと 3DEditor を接続することが可能です。</p>
<p>詳しくは各サンプルの解説書を参照してください。</p>
<h1 id="Anchor_99806869_h1_3">組み込み</h1>
<p>
  <span style="color: rgb(255,0,0);"> <strong> ビューアーライブラリの機能を有効にするためには、アプリケーションビルド時のプリプロセッサの定義に <span class="ApiLink_NN_ENABLE_HTC">NN_ENABLE_HTC</span> を加える必要があります。 </strong> </span>
</p>
<p>定義しない場合、ビューアーライブラリの API はすべて空実装となります。</p>
<p>ゲームアプリケーション内でビューアーライブラリを動作させるためには、次の 5 か所に呼び出しを追加する必要があります。</p>
<h2 id="Anchor_99806869_h2_1">初期化</h2>
<p> ビューアーライブラリの初期化を行います。ビューアーライブラリからモデル生成要求などを受け取るためのコールバックを登録します。 </p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">InitializeArg</span> <span class="n">arg</span><span class="p">(</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">pDevice</span><span class="p">,</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">AllocateWithUserData</span><span class="p">,</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">FreeWithUserData</span><span class="p">);</span>
 
<span class="c1">// 任意で g3d::viewer のコールバックを設定します。
</span><span class="n">arg</span><span class="p">.</span><span class="n">SetCallbacks</span><span class="p">(</span><span class="o">&amp;</span><span class="n">callbacks</span><span class="p">);</span>
 
<span class="c1">// テクスチャーのバインドをカスタマイズしたい場合、テクスチャーバインドのコールバックを設定します。
</span><span class="n">arg</span><span class="p">.</span><span class="n">SetTextureBindCallback</span><span class="p">(</span><span class="n">SampleViewerTextureBindCallback</span><span class="p">);</span>

<span class="nn">nn::g3d::viewer::</span><span class="n">ViewerResult</span> <span class="n">initResult</span> <span class="o">=</span> <span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">Initialize</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
<span class="n">NN_ASSERT</span><span class="p">(</span><span class="n">initResult</span> <span class="o">==</span> <span class="nn">nn::g3d::viewer::</span><span class="n">ViewerResult_Success</span><span class="p">);</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>ビューアーライブラリを初期化する前に以下の処理を完了しておく必要があります。 </p>
<ul>
  <li> <a href="../../../Api/HtmlNX/namespacenn_1_1htcs.html#a7eab72b8843a2a9ff763f52b78da680e">nn::htcs::Initialize()</a> の実行  <br /> </li>
  <li> <a href="../../../Api/HtmlNX/namespacenn_1_1fs.html#a2ea39d2487ac28bc767cd699eeeebe11">nn::fs::MountHostRoot()</a> の実行</li>
</ul>
<h2 id="Anchor_99806869_h2_2">サーバーのオープン</h2>
<p>サーバーと 3DEditor を接続可能な状態にします。3DEditor と接続するには、この関数を呼んだ後に、<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#aa4c8c0a15ff2905ecf43ab3955d49b53">nn::g3d::viewer::ViewerServer::Poll()</a> を呼ぶ必要があります。&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::viewer::</span><span class="n">ViewerResult</span> <span class="n">openResult</span> <span class="o">=</span> <span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Open</span><span class="p">();</span>
<span class="n">NN_ASSERT</span><span class="p">(</span><span class="n">openResult</span> <span class="o">==</span> <span class="nn">nn::g3d::viewer::</span><span class="n">ViewerResult_Success</span><span class="p">);</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_3">アニメーション計算</h2>
<p>ビューアーライブラリの実行するアニメーションがゲームアプリケーションで実行されているアニメーションを上書きするためには、ゲームアプリケーションよりも後に次の処理を実行する必要があります。</p>
<p>さらに、アニメーション結果を描画に反映させるためには、<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a> の各種 Calculate 関数よりも前に呼び出す必要があります。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">CalculateAnimations</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_4">3DEditor との通信</h2>
<p>ビューアーライブラリと 3DEditor の通信処理を行います。ビューアーライブラリは内部でスレッドを生成しないため、必要であれば別スレッドでポーリングを行ってください。</p>
<p>3DEditor と通信が必要なコマンドはこの関数をコールしないと処理が進みません。</p>
<p>この関数のコールによって、接続状態など通信に関わる内部状態が変化します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Poll</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_5">コマンドの実行</h2>
<p>3DEditor から受信したコマンド、もしくはゲームアプリケーションが <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html">nn::g3d::viewer::ViewerServer</a> にエンキューしたコマンドを実行します。</p>
<p>初期化時に登録したコールバックは、この関数の内部で呼び出されます。</p>
<p>3DEditor と未接続の場合(<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#a750751eca533891860da15d34fc2e7bd">nn::g3d::viewer::ViewerServer::IsConnected()</a> が false を返す場合)にも、切断時の破棄処理やユーザーが 3DEditor でのリアルタイム編集用に初期化したリソースを破棄するためのコールバックの実行などが呼ばれるため、この関数を呼ぶようにして下さい。</p>
<p>ビューアーライブラリがリソースの構築や破棄を行うため、OpenGL のコンテキストを有効にしてから呼び出す必要があります。</p>
<p> 内部で GPU が参照するメモリの書き換えなどを行っています。GPU がメモリを参照しないタイミングで実行する必要があります。 </p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">ExecuteCommands</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_6">サーバーのクローズ</h2>
<p>サーバーと 3DEditor の接続を切断します。</p>
<p>切断時に、ビューアーライブラリが保有している編集用リソースの破棄を行うため、OpenGL のコンテキストを有効にしてから呼び出す必要があります。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Close</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>サーバーとのクローズ後、3DEditor との接続をすぐに切断するには、さらに <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#aa4c8c0a15ff2905ecf43ab3955d49b53">nn::g3d::viewer::ViewerServer::GetInstance().Poll()</a> を呼ぶ必要があります。</p>
<p>3DEditor との接続が切断されたかどうかは、<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#a94ad1907b9356575f6b41b36d4abaf83">nn::g3d::viewer::ViewerServer::GetInstance().IsOpened()</a> で判定することができるので、以下のようなコードで 3DEditor と切断されるまで&nbsp;<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#aa4c8c0a15ff2905ecf43ab3955d49b53">nn::g3d::viewer::ViewerServer::GetInstance().Poll()</a>&nbsp;を実行することができます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>while (nn::g3d::viewer::ViewerServer::GetInstance().IsOpened())
{
&nbsp;&nbsp;&nbsp;&nbsp;nn::g3d::viewer::ViewerServer::GetInstance().Poll();
} </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>通信処理を別スレッド化している場合は、このような処理をクローズ後に記述する必要はありません。</p>
<h2 id="Anchor_99806869_h2_7">終了</h2>
<p>ビューアーライブラリの終了処理を行います。サーバーのクローズが行われていない場合、この中でクローズが実行されますので、OpenGL のコンテキストを有効にしてから呼び出す必要があります。<span class="ApiLink_nn__htcs">nn::htcs</span> の終了については、別に行う必要があります。</p>
<p>サーバーの終了処理を行うと、数秒後に 3DEditor との接続は切断されます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">Finalize</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_99806869_h1_4">モデル編集対象の登録と解除</h1>
<p>ゲームアプリケーション内に実装されたモデルか、3DEditor から転送されてきたモデルかに関わらず、任意のモデルを編集対象として登録することができます。</p>
<h2 id="Anchor_99806869_h2_8">モデル編集対象の登録</h2>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a> &nbsp;をゲームアプリケーションから 3DEditor の編集対象として登録することができます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::</span><span class="n">ModelObj</span><span class="o">*</span> <span class="n">pModelObj</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">IsModelAttached</span><span class="p">(</span><span class="n">pModelObj</span><span class="p">))</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">QueueAttachModelCommand</span><span class="p">(</span><span class="n">pModelObj</span><span class="p">);</span>
<span class="p">}</span>
<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">ExecuteCommands</span><span class="p">();</span>
<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Poll</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_9">モデル編集対象の登録解除</h2>
<p>3DEditor の編集対象として登録中の <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a>&nbsp;をゲームアプリケーションから登録解除することができます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::</span><span class="n">ModelObj</span><span class="o">*</span> <span class="n">pModelObj</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">if</span> <span class="p">(</span><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">IsModelAttached</span><span class="p">(</span><span class="n">pModelObj</span><span class="p">))</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">QueueDetachModelCommand</span><span class="p">(</span><span class="n">pModelObj</span><span class="p">);</span>
<span class="p">}</span>
<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">ExecuteCommands</span><span class="p">();</span>
<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Poll</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_99806869_h1_5">シェーダーアーカイブ編集対象の登録と解除</h1>
<p>ゲームアプリケーション内に実装されたシェーダーアーカイブを編集対象として登録することができます。</p>
<h2 id="Anchor_99806869_h2_10">シェーダーアーカイブ編集対象の登録</h2>
<p>  <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_shader_archive.html">nn::g3d::ResShaderArchive</a> をゲームアプリケーションから 3DEditor の編集対象として登録することができます。3DEditor と接続済みの場合、この処理を行った後に、fsdb / fsda を指定するファイルダイアログが開きます。シェーダーアーカイブと対応する fsd ファイルを指定してください。 </p>
<p> &nbsp; </p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::</span><span class="n">ResShaderArchive</span><span class="o">*</span> <span class="n">pArchive</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">IsShaderArchiveAttached</span><span class="p">(</span><span class="n">pArchive</span><span class="p">))</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">QueueAttachShaderArchiveCommand</span><span class="p">(</span><span class="n">pArchive</span><span class="p">);</span>
<span class="p">}</span>
<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">ExecuteCommands</span><span class="p">();</span>
<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Poll</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_11">シェーダーアーカイブ編集対象の登録解除</h2>
<p> 3DEditor の編集対象として登録中の <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_model_obj.html">nn::g3d::ModelObj</a> &nbsp;をゲームアプリケーションから登録解除することができます。 </p>
<p> &nbsp; </p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::</span><span class="n">ResShaderArchive</span><span class="o">*</span> <span class="n">pArchive</span> <span class="o">=</span> <span class="p">...;</span>
<span class="k">if</span> <span class="p">(</span><span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">IsShaderArchiveAttached</span><span class="p">(</span><span class="n">pArchive</span><span class="p">))</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">QueueDetachShaderArchiveCommand</span><span class="p">(</span><span class="n">pArchive</span><span class="p">);</span>
<span class="p">}</span>
<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">ExecuteCommands</span><span class="p">();</span>
<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Poll</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_99806869_h1_6">その他の処理</h1>
<h2 id="Anchor_99806869_h2_12">指定したモデルのスケルタルアニメーションのみを計算</h2>
<p> 指定したモデルにバインドされているスケルタルアニメーションの計算のみを実行します。 この処理を実行した後に、<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#a59245dea48b7f205905c636c40db9806">nn::g3d::viewer::ViewerServer::CalculateAnimations()</a> を実行した場合は、指定モデルにバインドされたスケルタルアニメーションの計算のみスキップされます。 スキップされる場合の状態は、<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#a0a9eae2cafa879e6fccc1d929699805f">nn::g3d::viewer::ViewerServer::ExecuteCommands()</a> を実行したタイミングでクリアされます。 </p>
<p> &nbsp; </p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::</span><span class="n">ModelObj</span><span class="o">*</span> <span class="n">pModelObj</span> <span class="o">=</span> <span class="p">...;</span>
<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">CalculateSkeletalAnimations</span><span class="p">(</span><span class="n">pModelObj</span><span class="p">);</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_13">3DEditor に読み込み済みモデルのマテリアルを選択</h2>
<p>3DEditor で読み込まれているモデルの指定したマテリアルを選択状態にします。マテリアルはインデックスで指定します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>nn::g3d::ModelObj* pModelObj = ...;
int materialIndex = ...;
nn::g3d::viewer::ViewerServer::GetInstance().QueueSelectMaterialCommand (pModelObj, materialIndex);</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_14">3DEditorのマテリアル選択状態をクリア</h2>
<p>3DEditor で選択されているすべてのマテリアルの選択状態を解除します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>nn::g3d::viewer::ViewerServer::GetInstance().QueueClearMaterialSelectionCommand();</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_15">3DEditor にモデルのプレビュースケール、回転、移動情報を送信する</h2>
<p>モデルのプレビュー用のスケール、回転、移動情報を3DEditor に送信して、3DEditor に読み込まれているモデルに反映させます。</p>
<p>プレビュー用の情報は 3DEditor のモデルプロパティウィンドウのプレビューページで確認できます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>ModelObj* pModelObj = ...;
nn::util::Vector3f scale = nn::util::Vector3f(1.0f, 1.0f, 1.0f);
nn::util::Vector3f rotate = nn::util::Vector3f(0.0f, 0.0f, 0.0f);
nn::util::Vector3f translate = nn::util::Vector3f(0.0f, 0.0f, 0.0f);
LayoutModelArg arg(pModelObj, scale, rotate, translate);
nn::g3d::viewer::ViewerServer::GetInstance().QueueLayoutModelCommand(arg);</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_16">
  <a name="Anchor_99806869_RenderInfo"></a>描画情報を組み込む</h2>
<p>描画情報を使用する例として、描画優先度の値を描画情報に組み込みます。</p>
<p> 下記描画情報のコードがシェーダーファイルに組み込まれている前提になります。 </p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="c1">// @@ renderinfo=&quot;render_priority&quot; type=&quot;int&quot; label=&quot;描画優先度&quot;
</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p> choice を記述しない場合、3DEditor はアプリケーションに定義情報の送信を要求します。ビューアーライブラリは 3DEditor から定義情報の送信要求を受けると、SendRenderInfoRequested コールバックを呼び出します。  </p>
<p>  &nbsp;   描画情報の定義を 3DEditor に送信するためには、 SendRenderInfoRequested コールバックの処理を実装する必要があります。</p>
<p>&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="c1">// 3DEditor に描画優先度の定義情報を送信します。
</span><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">SendRenderInfoRequested</span><span class="p">(</span><span class="k">const</span> <span class="nn">nn::g3d::viewer::</span><span class="n">SendRenderInfoRequestedArg</span><span class="o">&amp;</span> <span class="n">arg</span><span class="p">)</span> <span class="n">NN_OVERRIDE</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// 0 から 255 段階の描画優先度を設定する。
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">QueueSetRenderInfoIntRangeCommand</span><span class="p">(</span><span class="s">&quot;render_priority&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="p">;</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// 255 をデフォルト値として設定する。
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::g3d::viewer::ViewerServer::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">QueuePushRenderInfoIntDefaultCommand</span><span class="p">(</span><span class="s">&quot;render_priority&quot;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p> 3DEditor で描画情報の編集が行われると RenderInfoUpdated コールバックが呼び出されます。 </p>
<p> ここで、描画情報をアプリケーションに反映させる処理を記述します。 </p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="c1">// 3DEditorから描画情報の編集が行われた時に実行されます。
</span><span class="k">virtual</span> <span class="kt">void</span> <span class="n">RenderInfoUpdated</span><span class="p">(</span><span class="k">const</span> <span class="nn">nn::g3d::viewer::</span><span class="n">RenderInfoUpdatedArg</span><span class="o">&amp;</span> <span class="n">arg</span><span class="p">)</span> <span class="n">NN_OVERRIDE</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">const</span> <span class="nn">nn::g3d::</span><span class="n">ModelObj</span><span class="o">*</span> <span class="n">pModel</span> <span class="o">=</span> <span class="n">arg</span><span class="p">.</span><span class="n">pModelObj</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">const</span> <span class="nn">nn::g3d::</span><span class="n">MaterialObj</span><span class="o">*</span> <span class="n">pMaterial</span> <span class="o">=</span> <span class="n">pModel</span><span class="o">-&gt;</span><span class="n">GetMaterial</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">materialIndex</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">const</span> <span class="nn">nn::g3d::</span><span class="n">ResMaterial</span><span class="o">*</span> <span class="n">pResMaterial</span> <span class="o">=</span> <span class="n">pMaterial</span><span class="o">-&gt;</span><span class="n">GetResource</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">const</span> <span class="nn">nn::g3d::</span><span class="n">ResRenderInfo</span><span class="o">*</span> <span class="n">pResRenderInfo</span> <span class="o">=</span> <span class="n">pResMaterial</span><span class="o">-&gt;</span><span class="n">FindRenderInfo</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="n">pResRenderInfo</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;render_priority&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">pResRenderInfo</span><span class="o">-&gt;</span><span class="n">GetType</span><span class="p">()</span> <span class="o">==</span> <span class="nn">nn::g3d::ResRenderInfo::</span><span class="n">Type_Int</span> <span class="o">&amp;&amp;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">pResRenderInfo</span><span class="o">-&gt;</span><span class="n">GetArrayLength</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// 描画優先度の設定　この値をアプリケーションのユーザモデルなどに格納して使用してください。
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span> <span class="n">renderPriorityValue</span> <span class="o">=</span> <span class="n">pResRenderInfo</span><span class="o">-&gt;</span><span class="n">GetInt</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_99806869_h2_17">
  <a name="Anchor_99806869_ExecuteUserScript"></a>
  <span style="color: rgb(117,117,117);">3DEditor から特定のモデルに対して任意の処理を実行する</span>
</h2>
<p>3DEditor の&nbsp;<a href="../Pages/Page_87923816.html#Anchor_87923816_RuntimeUserScript">RuntimeUserScript</a>&nbsp;を用いることにより、3DEditor から特定のモデルに対して任意の処理を実行することができます。RuntimeUserScript で指定したコマンドが 3DEditor で実行されると、ビューアーライブラリ は&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1g3d_1_1viewer.html#ab3cb189e5183fd7656a6f56cff7cc0e0ad6e214d6b3ea77044d633e3b614185ea">nn::g3d::viewer::CallbackType_ModelUserScriptExecuted</a> コールバックを呼び出します。このコールバックで引数として渡される <a href="../../../Api/HtmlNX/structnn_1_1g3d_1_1viewer_1_1_model_user_script_executed_arg.html">nn::g3d::viewer::ModelUserScriptExecutedArg</a>&nbsp;からは処理対象モデル、スクリプトのテキストデータ、選択中のボーン、シェイプ、マテリアルの情報が取得できるので、このコールバック内でスクリプトの解析と実行を行います。</p>
<p>以下は 3DEditor から送信された情報をログ出力するだけのコールバックの実装例です。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">ModelUserScriptExecuted</span><span class="p">(</span><span class="k">const</span> <span class="nn">nn::g3d::viewer::</span><span class="n">ModelUserScriptExecutedArg</span><span class="o">&amp;</span> <span class="n">arg</span><span class="p">)</span> <span class="n">NN_OVERRIDE</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;ScriptText: </span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">arg</span><span class="p">.</span><span class="n">scriptText</span><span class="p">)</span><span class="p">;</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">const</span> <span class="nn">nn::g3d::</span><span class="n">ResModel</span><span class="o">*</span> <span class="n">pResModel</span> <span class="o">=</span> <span class="n">arg</span><span class="p">.</span><span class="n">pTargetModelObj</span><span class="o">-&gt;</span><span class="n">GetResource</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;Target Model Name: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pResModel</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">());</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;selectedBoneCount = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">arg</span><span class="p">.</span><span class="n">selectedBoneCount</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">arg</span><span class="p">.</span><span class="n">selectedBoneCount</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span> <span class="n">boneIndex</span> <span class="o">=</span> <span class="n">arg</span><span class="p">.</span><span class="n">pSelectedBoneIndices</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;pSelectedBoneIndices[%d] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">boneIndex</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;selectedShapeCount = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">arg</span><span class="p">.</span><span class="n">selectedShapeCount</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">arg</span><span class="p">.</span><span class="n">selectedShapeCount</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span> <span class="n">shapeIndex</span> <span class="o">=</span> <span class="n">arg</span><span class="p">.</span><span class="n">pSelectedShapeIndices</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;pSelectedShapeIndices[%d] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">shapeIndex</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;selectedMaterialCount = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">arg</span><span class="p">.</span><span class="n">selectedMaterialCount</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">arg</span><span class="p">.</span><span class="n">selectedMaterialCount</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span> <span class="n">materialIndex</span> <span class="o">=</span> <span class="n">arg</span><span class="p">.</span><span class="n">pSelectedMaterialIndices</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;pSelectedMaterialIndices[%d] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">materialIndex</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_99806869_h1_7">
  <br />コールバック</h1>
<p> ビューアーライブラリの初期化時にコールバック関数 <a href="../../../Api/HtmlNX/namespacenn_1_1g3d_1_1viewer.html#af03b6d4d7be6709d166cea476c042f1e">nn::g3d::viewer::ViewerCallback</a>、もしくは <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_callbacks.html">nn::g3d::viewer::ViewerCallbacks</a> クラスを登録することで、3DEditor で行った編集結果をモデルに対してリアルタイムに反映することができます。 </p>
<p>いずれのコールバックも&nbsp;<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#a0a9eae2cafa879e6fccc1d929699805f">nn::g3d::viewer::ViewerServer::ExecuteCommands()</a> を実行した際に関数内部でコールされます。</p>
<p>ここではビューアーライブラリを組み込む上で最低限実装が必要になるコールバックのみ掲載します。全てのコールバック一覧は&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1g3d_1_1viewer.html#ab3cb189e5183fd7656a6f56cff7cc0e0">nn::g3d::viewer::CallbackType</a> を参照してください。</p>
<h2 id="Anchor_99806869_h2_18"> ModelFileLoaded </h2>
<p>  3DEditor でモデルファイルを開いた際に呼び出されます。  ゲームアプリケーションはリソースファイルをコピーして受け取り、管理及び描画する必要があります。</p>
<p>   <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1viewer_1_1_viewer_server.html#a31c76e9c3a2be9c8c1ee5178cb0e00ba">nn::g3d::viewer::ViewerServer::QueueAttachModelCommand()</a> を呼び出すことで、編集対象として登録することができます。  コールバック外で遅延させて編集対象を登録することもできます。</p>
<h2 id="Anchor_99806869_h2_19"> ModelFileUnloaded </h2>
<p>  3DEditor でモデルファイルを閉じた際に呼び出されます。ゲームアプリケーションからそのリソースファイルが不要になった段階で破棄することができます。  </p>
<h2 id="Anchor_99806869_h2_20">  TextureFileLoaded  </h2>
<p>3DEditor でテクスチャーファイルを開いた際に呼び出されます。受け取ったリソースファイルの初期化を行います。このコールバックで受け取ったリソースはゲームアプリケーションが管理するモデルなどのリソースにバインドすることは出来ません。ビューアーライブラリが管理するリソース、アタッチされたリソースにのみ利用されます。バインドはビューアーライブラリ内で自動で行われますので、ゲームアプリケーション側で行う必要はありません。</p>
<h2 id="Anchor_99806869_h2_21">  TextureFileUnloaded  </h2>
<p>  3DEditor でテクスチャーファイルを閉じた際に呼び出されます。受け取ったリソースファイルの終了処理を行います。このコールバックはビューアーライブラリが管理するリソースから参照されなくなってから数フレーム遅延してコールされるため、コマンドバッファをダブルバッファリングしている場合でも、ゲームアプリケーション側で遅延させて終了処理を行う必要はありません。</p>
<h2 id="Anchor_99806869_h2_22">  ShaderAssignUpdated  </h2>
<p>   3DEditor でシェーダーの関連付け変更やサンプラーの追加・削除など、モデルリソースの構造変更を伴う編集を行った場合に呼び出されます。   ビューアーライブラリが動的にモデルリソースを変更するため、モデルリソースに関連付けてデータを持たせる必要がある場合はここで構築や破棄を行うことができます。</p>
<h2 id="Anchor_99806869_h2_23">   MaterialUpdated   </h2>
<p>     ShaderAssignUpdated&nbsp;が呼び出された後、ビューアーライブラリがモデルインスタンスを 3DEditor から送信された新しいモデルリソースによって更新した際に呼び出されます。    ShaderAssignUpdated に伴うモデルインスタンスの変更が必要であれば、ここで行うことができます。</p>
<h1 id="Anchor_99806869_h1_8">注意事項</h1>
<p> ビューアーライブラリはモデルリソースの破棄やコールバックの呼び出しの遅延を行いません。そのため、ゲームのフレームワークによっては既に破棄されたメモリ領域を GPU が参照してしまう可能性があります。その場合、リソースやインスタンスの破棄を伴うコールバックが呼ばれた際には、必要に応じて描画の完了待ちや、直後の描画処理のスキップを行って、既に破棄されたメモリ領域を参照しないように注意する必要があります。</p>
<p>ビューアーライブラリが内部で管理しているリソース、インスタンスの破棄を伴うコールバックは以下です。</p>
<ul style="list-style-type: square;">
  <li>TextureFileUnloaded</li>
  <li>MaterialUpdated</li>
  <li>ShapeUpdated</li>
  <li>ShaderProgramUpdated</li>
  <li>ShaderAttached</li>
  <li>ShaderDetached</li>
</ul>
<p> モデルプレビュー機能について、ゲームアプリケーションで実装されているモデルに対しては編集を行いません。3DEditor から転送したモデルに対してのみ有効な機能になります。 </p>
<p>ビューアーライブラリ使用中におけるディスプレイリストの使用は非推奨です。ディスプレイリストを使用している場合、正しくモデルが表示されないことがあります。</p>
<h1 id="Anchor_99806869_h1_9">FAQ</h1>
<h2 id="Anchor_99806869_h2_24">3DEditor でマテリアルを編集後にコールバックで取得できるリソースが更新されていません</h2>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_material.html">nn::g3d::ResMaterial</a> や <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_shape.html">nn::g3d::ResShape</a> 等は下記のように <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_model.html">nn::g3d::ResModel</a> から取得すると 3DEditor での編集により更新されたリソースを取得することができません。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::</span><span class="n">ModelObj</span><span class="o">*</span> <span class="n">pModelObj</span> <span class="o">=</span> <span class="n">pArg</span><span class="o">-&gt;</span><span class="n">pModelObj</span><span class="p">;</span>
<span class="k">const</span> <span class="nn">nn::g3d::</span><span class="n">ResModel</span><span class="o">*</span> <span class="n">pResModel</span> <span class="o">=</span> <span class="n">pModelObj</span><span class="o">-&gt;</span><span class="n">GetResource</span><span class="p">();</span>
<span class="k">const</span> <span class="nn">nn::g3d::</span><span class="n">ResMaterial</span><span class="o">*</span> <span class="n">pResMaterial</span> <span class="o">=</span> <span class="n">pResModel</span><span class="o">-&gt;</span><span class="n">GetMaterial</span><span class="p">(</span><span class="n">materialIndex</span><span class="p">);</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>下記のように取得したいリソースのオブジェクトから直接取得して下さい。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="nn">nn::g3d::</span><span class="n">ModelObj</span><span class="o">*</span> <span class="n">pModelObj</span> <span class="o">=</span> <span class="n">pArg</span><span class="o">-&gt;</span><span class="n">pModelObj</span><span class="p">;</span>
<span class="nn">nn::g3d::</span><span class="n">MaterialObj</span><span class="o">*</span> <span class="n">pMaterialObj</span> <span class="o">=</span> <span class="n">pModelObj</span><span class="o">-&gt;</span><span class="n">GetMaterial</span><span class="p">(</span><span class="n">materialIndex</span><span class="p">);</span>
<span class="k">const</span> <span class="nn">nn::g3d::</span><span class="n">ResMaterial</span><span class="o">*</span> <span class="n">pResMaterial</span> <span class="o">=</span> <span class="n">pMaterialObj</span><span class="o">-&gt;</span><span class="n">GetResource</span><span class="p">();</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
<!--AddLink-->
<script>
var NintendoSdkApiRefernce = {
    idMap: {},
    linkRewrite: function ()
    {
        var idMap = NintendoSdkApiRefernce.idMap;
        function rewrite(el)
        {
            var e = idMap[el.className];
            if (e === undefined)
            {
                return;
            }
            var html = '';
            html += '<a href=';
            html += e.url;
            html += ' target="_blank">';
            html += el.innerHTML;
            html += '</a>';
            el.innerHTML = html;
        }
        var apiLinkElems = document.querySelectorAll('span[class*="ApiLink_"]');
        for (var i = 0, n = apiLinkElems.length; i< n; ++i) {
            rewrite(apiLinkElems[i]);
        }
    }
};
function SetUrl( id, url )
{
    NintendoSdkApiRefernce.idMap[id] = { url: url };
}
// ApiLink_NN_ENABLE_HTC
SetUrl( 'ApiLink_nn__htcs', '../../../Api/HtmlNX/namespacenn_1_1htcs.html' )

NintendoSdkApiRefernce.linkRewrite();
</script>
<!--AddLink-->
</body>
</html>
