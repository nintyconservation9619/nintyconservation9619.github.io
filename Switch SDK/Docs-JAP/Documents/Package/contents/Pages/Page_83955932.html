<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>レイアウトアーカイバ</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- レイアウトアーカイバ -->
<div class="pagetitle" id="PageId_83955932">レイアウトアーカイバ</div>
<div class="text_separate">
<h1 id="Anchor_83955932_h1_1">レイアウトアーカイバ</h1>
<h2 id="Anchor_83955932_h2_1">はじめに</h2>
<h3 id="Anchor_83955932_h3_1">レイアウトアーカイバとは</h3>
<p>レイアウトアーカイバ(LayoutArchiver)は、レイアウトコンバータが出力したペインの配置情報、アニメーション、テクスチャなど、ライブラリで使用する様々なデータを1つのファイルにまとめて、レイアウトライブラリで使うことができるようにするためのツールです。</p>
<h3 id="Anchor_83955932_h3_2">レイアウトアーカイバの特徴</h3>
<h4 id="Anchor_83955932_h4_1">アーカイブ内のアラインメントの自動設定</h4>
<p>アーカイブ内にテクスチャ(bflim)を含めるとき、レイアウトアーカイバはbflim内のテクスチャが必要とするアラインメントの情報を読み出して、自動的に適切なアラインメントで配置します。<br />また、フォントを含めるときも、同様にアラインメントを行います。<br />このため、レイアウトアーカイバを使用するときは、ユーザ側でアーカイブ内のファイルのアラインメントを指定する必要はありません。</p>
<h4 id="Anchor_83955932_h4_2">高速な動作</h4>
<p>レイアウトアーカイバは、ファイルパスをハッシュ化してアーカイブ内に保持し、ランタイムでファイルを探す際に使用します。このため、ファイル数が多くても高速に動作します。</p>
<h4 id="Anchor_83955932_h4_3">プラットフォーム毎に適切な形式にリソースを統合</h4>
<p>複数のテクスチャ中間ファイル(ftxb)を、一つの テクスチャリソースバイナリ(bntx)に統合します。この際、プラットフォーム向けのタイリング処理も施されます。<br />また、シェーダーについても、同様のリソース統合処理が行われます。</p>
<h2 id="Anchor_83955932_h2_2">アーカイバの使い方</h2>
<h3 id="Anchor_83955932_h3_3">実行ファイルの位置</h3>
<p>レイアウトアーカイバは以下のパスにあります。</p>
<ul class="simple">
  <li>Tools\Graphics\LayoutTools\LayoutArchiver.exe</li>
</ul>
<h3 id="Anchor_83955932_h3_4">コマンドライン形式</h3>
<p>レイアウトアーカイバは以下のような形式で使用します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>LayoutArchiver.exe [モード][オプション] アーカイブパス [ファイル名またはディレクトリ名 ... ]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>モードとオプションは、どのような順番で指定しても構いません。<br />コマンド名、モードやオプション、及びオプションのパラメータを除いて、コマンドラインの最初に指定されている名前がアーカイブパスとなります。</p>
<p>LayoutArchiverは、ファイル名やディレクトリ名に使用されているアルファベットの大文字と小文字を区別します。ファイル名やディレクトリ名のパスの区切り記号には、スラッシュとバックスラッシ<br />（日本では￥マーク）の両方を使用することができます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>data/scene1/picture.dat パスの区切りにスラッシュを使用。 
data\scene1\picture.dat パスの区切りにバックスラッシュ（\マーク）を使用。</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>また、ディレクトリ名の後ろには、スラッシュまたはバックスラッシュを記述する事が可能です。<br />この場合、その名前がファイルであるか、ディレクトリであるかのチェックが省略され、ディレクトリ名として処理されます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>data/screen1 ファイルまたはディレクトリを示す。
data/screen1/ ディレクトリを示す。（ディレクトリでなかった場合はエラー）</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>アーカイブ対象にフォルダを指定した場合は、そのフォルダ以下に含まれるファイルが全てアーカイブに含まれます。</p>
<h3 id="Anchor_83955932_h3_5">モード</h3>
<p>LayoutArchiverには、3種類のモードがあります。モードは以下のオプションで指定します。<br />複数のモードが同時に指定された場合には、最後に指定されたモードが有効となります。</p>
<h4 id="Anchor_83955932_h4_4">-c</h4>
<p>アーカイブを新規作成します。モードの指定を省略すると <strong>-c</strong> が指定されたことになります。</p>
<h4 id="Anchor_83955932_h4_5">-l</h4>
<p>アーカイブに格納されているファイルのパス、サイズ、アラインメント及びエンディアンタイプを標準出力に表示します。<br />また、<strong>-M</strong> オプションを指定すると、2つのアーカイブファイルが一致するかどうかを表示します。</p>
<h4 id="Anchor_83955932_h4_6">-r</h4>
<p>アーカイブに格納されている全ファイルを解凍します。<br />解凍されたファイルは、アーカイブ名の先頭にアンダーバーが付加されたフォルダ内に展開されます。<br />例えば、以下のように記述します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>LayoutArchiver.exe -r layout.arc</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>この場合、<strong>_layout.arc</strong>フォルダが作成され、その中に解凍されます。</p>
<h3 id="Anchor_83955932_h3_6">オプション</h3>
<p>LayoutArchiverには、以下のオプションがあります。</p>
<h4 id="Anchor_83955932_h4_7">-h, --help</h4>
<p>アーカイブのヘルプを標準出力に出力します。</p>
<h4 id="Anchor_83955932_h4_8">-s, --silent</h4>
<p>ログ（標準出力）を抑止します。</p>
<h4 id="Anchor_83955932_h4_9">-v, --verbose</h4>
<p>アーカイブを新規作成する際の処理過程を表示します。 アーカイブされるファイル毎のアライメント指定も表示されます。</p>
<h4 id="Anchor_83955932_h4_10">-p name, --platform name</h4>
<p>対象とするプラットフォーム名を指定します。将来廃止予定のオプションです。代わりに、--tile-mode を利用してください。</p>
<h4 id="Anchor_83955932_h4_11">-t name, --tile-mode name</h4>
<p>対象とする、テクスチャのタイリングモードを指定します。(例：--tile-mode linear)</p>
<p>Windows / OpenGL 向けバイナリを出力する際は、<strong>linear</strong>　を指定します。</p>
<p>Windows / OpenGL 向け以外のバイナリを出力する際は、<a href="../Pages/Page_95696747.html">プラットフォーム固有の情報</a> を参照してください。</p>
<p>必須オプションです。</p>
<h4 id="Anchor_83955932_h4_12">-a name, --api-type name</h4>
<p>対象とする描画 APIの種類を指定します。(例：--api-type Gl)</p>
<p>Windows / OpenGL 向けバイナリを出力する際は、<strong>Gl</strong> を指定します。<br />Windows / OpenGL 向け以外のバイナリを出力する際は、<a href="../Pages/Page_95696747.html">プラットフォーム固有の情報</a> を参照してください。</p>
<p>必須オプションです。</p>
<h4 id="Anchor_83955932_h4_13">-C name, --code-type name</h4>
<p>対象とするシェーダーコードの種類を指定します。(例：--code-type Source)<br />Windows / OpenGL 向けバイナリを出力する際は、<strong>Source</strong> を指定します。<br />Windows / OpenGL 向け以外のバイナリを出力する際は、<a href="../Pages/Page_95696747.html">プラットフォーム固有の情報</a> を参照してください。</p>
<p>必須オプションです。</p>
<h4 id="Anchor_83955932_h4_14">-k, --keep-ftxb</h4>
<p>入力データ中のテクスチャ ftxb を 一つの bntx に統合する際、元の ftxb を削除せずに残します。</p>
<h4 id="Anchor_83955932_h4_15">-x, --keep-shader-variation-xml</h4>
<p>シェーダバリエーションテーブル xml を一つの bushvt に統合する際、元の xml を削除せずに残します。</p>
<h4 id="Anchor_83955932_h4_16">--shader-cache-path dir<br /></h4>
<p>シェーダー変換を行う際の、キャッシュディレクトリ <strong>dir</strong> を指定します。シェーダーの内容に変更が無い場合、2回目以降の変換が高速に行われるようになります。</p>
<h4 id="Anchor_83955932_h4_17">-n</h4>
<p>アーカイブ作成時に、ハッシュ値の衝突が無い限りファイルパスをアーカイブに書き込みません。<br />アーカイブからファイルを取得するときに誤ったパス名を使ってしまった場合に、本来とは異なるファイルを取得してしまう可能性があります。<br />(-nを指定しない場合は、必ず「誤ったファイル名である」と判定されます。)</p>
<p>また、ArcExtractorのReadEntryでファイルパスを取得できません。</p>
<p>そのかわり、アーカイブからファイルを取得する処理が高速化され、アーカイブサイズの容量も削減できる場合があります。<br />ArcResourceAccessorのGetResourceメソッドで時間がかかる場合は、このオプションの適用をご検討ください。</p>
<h4 id="Anchor_83955932_h4_18">-E type</h4>
<p>アーカイブファイル内部のエンディアン（little か big）を指定します。規定値は big です。通常指定する必要はありません。</p>
<h4 id="Anchor_83955932_h4_19">-K key</h4>
<p>ファイルのエントリ毎のハッシュ値計算に使用される、ハッシュキー値を「符号な し 32-bit 整数」で指定します。<br />省略すれば、内部で自動的に設定されます。通常指定する必要はありません。</p>
<h4 id="Anchor_83955932_h4_20">-A align</h4>
<p>アーカイブ全体に指定するデフォルトアライメントを設定します。</p>
<ul>
  <li>スクリプトファイルで個別にアライメントを指定した場合は、そちらのアライメントが優先されます.</li>
  <li>不正なアライメントが指定されたときは 自動的に 4 が設定されたことになります.</li>
</ul>
<h4 id="Anchor_83955932_h4_21">-D dir</h4>
<p>アーカイブする際のワーキングディレクトリを <strong>dir</strong> に変更します。<br />引数のアーカイブパスやアーカイブ対象ファイル・ディレクトリの指定を相対パスで行う場合、このオプションを使用すると、カレントディレクトリではなく <strong>dir</strong> からの相対パスで指定する必要がありますので、ご注意ください。<br />アーカイブ対象ファイル・ディレクトリで指定したパスがそのままアーカイブ内のパスになりますので、このオプションを使用すると、アーカイブ内のパスの基準位置を変えることができます。</p>
<h4 id="Anchor_83955932_h4_22">-X dir</h4>
<p>アーカイブされるファイルに含めないディレクトリ名を指定できます。<br />例えば、 <strong>-X font</strong> と指定すると、フォントフォルダ以下のファイルは全てアーカイブに含まれません。16種類まで指定可能です。</p>
<h4 id="Anchor_83955932_h4_23">-M arc</h4>
<p>2つのアーカイブファイルが一致するかどうかを比較します。このオプションは、必ず<strong>-l</strong> と一緒に指定します。<br />例えば、以下のように記述します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre> LayoutArchiver.exe -l -M a.arc b.arc</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>
  <br />一致した場合は<strong>matched</strong>、不一致の場合は<strong>failed</strong>が表示されます。</p>
<h3 id="Anchor_83955932_h3_7">使用例</h3>
<p>レイアウトコンバータで、カレントフォルダ以下のbrsrcというフォルダ内にレイアウトのバイナリリソースを出力したとします。このとき、brsrc内の構成は例えば以下のようになっています。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>brsrc/blyt/layout.bflyt 
brsrc/anim/layout_show.bflan 
brsrc/anim/layout_hide.bflan 
brsrc/timg/texture1^h.ftxb
brsrc/timg/texture2^h.ftxb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>これをレイアウトライブラリで使用できるアーカイバにするには、以下のコマンドを実行します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>LayoutArchiver.exe -D brsrc ../layout.arc . --tile-mode linear --api-type Gl --code-type Source</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>このコマンドを実行すると、カレントディレクトリにlayout.arcというファイルが作られ、内容は以下のようになります。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>./blyt/layout.bflyt 
./anim/layout_show.bflan 
./anim/layout_hide.bflan 
./timg/__Combined.bntx</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>このアーカイブをランタイム側で読み出し、ArcResourceAccessorに</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>accessor-&gt;Attach(binary, &quot;.&quot;);</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>のようにアタッチすれば、このリソースアクセサを使用してレイアウトを構築できるようになります。</p>
<p>
  <strong>-D</strong> でワーキングディレクトリをbrsrcに変更しているのは、そのフォルダ基準でアーカイブを作成すれば、アーカイブ内をblytフォルダ等がトップに来る構成にすることができるからです。</p>
<p>ArcResourceAccessorにアタッチする際のルートフォルダを <strong>&quot;.&quot;</strong> ではないパスにすることで、それ以外の構成にすることもできるのですが、余計なパスが含まれることにもなりますので、基本的にはアーカイブ内はblytフォルダ等がトップに来る構成にすることをお勧めします。</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
