<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>ReaderWriterLock クラス</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- ReaderWriterLock クラス -->
<div class="pagetitle" id="PageId_100894332">ReaderWriterLock クラス</div>
<div class="text_separate">
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_100894332_h1_1">ReaderWriterLock クラス</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_100894332_h2_1">機能概要</a>
      </li>
      <li>
        <a href="#Anchor_100894332_h2_2">ReaderWriterLock クラスの使用例</a>
      </li>
      <li>
        <a href="#Anchor_100894332_h2_3">ReaderWriterLock クラス使用上の注意事項</a>
      </li>
    </ul>
  </ul>
</p>
<h1 id="Anchor_100894332_h1_1">ReaderWriterLock クラス</h1>
<h2 id="Anchor_100894332_h2_1">機能概要</h2>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html">ReaderWriterLock</a> クラスは、複数<a href="../Pages/Page_83955697.html">スレッド</a>間で使用する共有リソースを 読み込み目的 もしくは 書き込み目的 ごとに排他制御を行なうための同期機能です。</p>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html">ReaderWriterLock</a> クラスは、<a href="../../../Api/HtmlNX/structnn_1_1os_1_1_reader_writer_lock_type.html">nn::os::ReaderWriterLockType</a> オブジェクトを利用した <a href="../Pages/Page_100737284.html">Readers-Writer ロック機能</a> をラッピングしたもので以下のメンバ関数を持ちます。API リファレンスはリンク先を参照して下さい。</p>
<table class="table">
  <tbody>
    <tr>
      <th>関数名</th>
      <th>説明</th>
      <th>備考</th>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a752c19d519cfc15dc20988d4aa1a653b">ReaderWriterLock()</a>
      </td>
      <td>コンストラクタ</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a659d0526afb3df351ed0a95ddc0776fa">InitializeReaderWriterLock()</a> 同等の初期化を実行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a890e0cf5dba1fd999a1575b5dd149b64">~ReaderWriterLock()</a>
      </td>
      <td>デストラクタ</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a6b179b4351145d32ec583bc5a52452bb">FinalizeReaderWriterLock()</a> 同等の破棄を実行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a5768b8071028d176d0cb98fae7cdc93b">AcquireReadLock()</a>
      </td>
      <td>読み込みロックを取得する</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a6fa888b2694902212ebc056ccaa4354b">AcquireReadLock()</a>&nbsp;同等の読み込みロックを実行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a5819b627eaa4a6c3fb8254a91f6f30e3">TryAcquireReadLock()</a>
      </td>
      <td>読み込みロックの取得を試みる</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ac0ce54963ebf2636dd1c78a0d16125a8">TryAcquireReadLock()</a>&nbsp;同等の読み込みロックを試行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a310ace188cec5ae195c07e888dce4e6e">ReleaseReadLock()</a>
      </td>
      <td>読み込みロックを開放する</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a4d8f51bbfa3341c9678758b191896a05">ReleaseReadLock()</a>&nbsp;同等の読み込みロックを開放</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a5743ee52315c02fbd0688fe153bb4a6f">AcquireWriteLock()</a>
      </td>
      <td>書き込みロックを取得する</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a97d3e3f946b214bcbf85e4aebb61699f">AcquireWriteLock()</a>&nbsp;同等の書き込みロックを実行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#ab127eb40106e94be26537c11e5ce5b67">TryAcquireWriteLock()</a>
      </td>
      <td>書き込みロックの取得を試みる</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ad042341aecc3ba00473ab85466fa76a8">TryAcquireWriteLock()</a>&nbsp;同等の書き込みロックを試行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a0724638df48d73a17286ca5dd5f8d177">ReleaseWriteLock()</a>
      </td>
      <td>書き込みロックを開放する</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ae30220320ff7ba5af52183fd5fbe1312">ReleaseWriteLock()</a>&nbsp;同等の書き込みロックを開放</td>
    </tr>
    <tr>
      <td>
        <p>
          <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a736a1058e8563b7bdd0d497aef22333b">IsReadLockHeld()</a>
        </p>
      </td>
      <td>読み込みロック中か否かを返す</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a434e0c862bf65234e1eee8756edbabf4">IsReadLockHeld()</a> と同等</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a80af135a1c96a368f415ca11c3eb154e">IsWriteLockHeldByCurrentThread()</a>
      </td>
      <td>自スレッドによって<br />書き込みロック中か否かを返す</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a6658b045d8ca185b5108ddb802f2440e">IsWriteLockHeldByCurrentThread()</a> と同等</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a8d6ada4e2bb31984ca265144cd5e1d63">lock()</a>
      </td>
      <td>書き込みロックを取得する</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a5743ee52315c02fbd0688fe153bb4a6f">AcquireWriteLock()</a> メソッドと同等</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a4ba3b4cf00e6143fadc87c48dcc44974">unlock()</a>
      </td>
      <td>書き込みロックを開放する</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a0724638df48d73a17286ca5dd5f8d177">ReleaseWriteLock()</a> メソッドと同等</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#ab1cab82ee51907ba98ea26d76f60c336">lock_shared()</a>
      </td>
      <td>読み込みロックを取得する</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a5768b8071028d176d0cb98fae7cdc93b">AcquireReadLock()</a> メソッドと同等</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a0a15aed97a4f1030582aaeb0595da61c">unlock_shared()</a>
      </td>
      <td>読み込みロックを開放する</td>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html#a310ace188cec5ae195c07e888dce4e6e">ReleaseReadLock()</a> メソッドと同等</td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html">ReaderWriterLock</a> クラスは C++ 標準の BasicLockable 要件と Lockable 要件を満たしているため、std::lock_guard や std::unique_lock などのクラステンプレートの型引数とすることができます。この場合、書き込みロックの取得と開放を行ないます。一方、std::shared_lock のクラステンプレートの型引数とした場合は、読み込みロックの取得と開放を行ないます。</p>
<p>&nbsp;</p>
<h2 id="Anchor_100894332_h2_2">ReaderWriterLock クラスの使用例</h2>
<p>多くのケースでは、以下のように何かしらのクラスのメンバ変数として <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html">ReaderWriterLock</a> クラスを利用します。下記の ValueSetting クラスでは、２つの int 型の数値を設定する関数と、設定した数値を取得する関数を提供します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="cp">#include &lt;nn/os.h&gt;
</span>
<span class="k">class</span> <span class="nc">ValueSetting</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ValueSetting</span><span class="p">()</span> <span class="o">:</span> <span class="n">m_Value1</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">m_Value2</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">void</span> <span class="n">Set</span><span class="p">(</span><span class="kt">int</span> <span class="n">v1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v2</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">m_Rwlock</span><span class="p">.</span><span class="n">AcquireWriteLock</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">m_Value1</span> <span class="o">=</span> <span class="n">v1</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">m_Value2</span> <span class="o">=</span> <span class="n">v2</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">m_Rwlock</span><span class="p">.</span><span class="n">ReleaseWriteLock</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">void</span> <span class="n">Get</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">p1</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p2</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">m_Rwlock</span><span class="p">.</span><span class="n">AcquireReadLock</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">*</span><span class="n">p1</span> <span class="o">=</span> <span class="n">m_Value1</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="n">m_Value2</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">m_Rwlock</span><span class="p">.</span><span class="n">ReleaseReadLock</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span>  <span class="n">m_Value1</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">int</span>  <span class="n">m_Value2</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">nn::os::</span><span class="n">ReaderWriterLock</span>   <span class="n">m_Rwlock</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>まず、ValueSetting クラスのコンストラクタで private メンバの初期化を行なっています。<a href="../../../Api/HtmlNX/classnn_1_1os_1_1_reader_writer_lock.html">ReaderWriterLock</a> クラスのインスタンスも初期化されます。</p>
<p>Set() 関数では、書き込みロックを取得した上で m_Value1 と m_Value2 への書き込みを行なっています。Set() 関数実行中は他のスレッドからの Set() 関数も Get() 関数もブロッキングされます。<br />Get() 関数では、読み込みロックを取得した上で m_Value1 と m_Value2 の変数の値を返しています。Get() 関数実行中は他のスレッドから呼ばれた Get() 関数は並行して処理を行なうことができますが、Set() 関数を呼んだスレッドはブロッキングされます。</p>
<p>このように、読み込み目的 と 書き込み目的 でロック関数を使い分けることにより、読み込み処理同士を排他せずに同時実行することが可能となり、書き込み処理だけを安全に排他処理することができます。</p>
<p>&nbsp;</p>
<h2 id="Anchor_100894332_h2_3">ReaderWriterLock クラス使用上の注意事項</h2>
<p>
  <a href="../Pages/Page_100737284.html">Readers-Writer ロック</a> の章に記載の「Readers-Writer ロック使用上の注意」も確認して下さい。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
