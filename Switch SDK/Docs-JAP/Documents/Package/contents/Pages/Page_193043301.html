<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>マテリアル参照</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- マテリアル参照 -->
<div class="pagetitle" id="PageId_193043301">マテリアル参照</div>
<div class="text_separate">
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <p>マテリアル参照機能は試験運用中の機能です。今後、予告なく動作や仕様が変更される場合がありますので、ご利用の際はご注意ください。</p>
  </div>
</div>
<p>
  <br />
</p>
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_193043301_h1_1">概要</a>
    </li>
    <li>
      <a href="#Anchor_193043301_h1_2">ワークフロー</a>
    </li>
    <li>
      <a href="#Anchor_193043301_h1_3">親マテリアルの作成</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_193043301_h2_1">設定を共通化したい各シェーダーパラメーターの値の設定</a>
      </li>
      <li>
        <a href="#Anchor_193043301_h2_2">子マテリアルの制限の設定</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_193043301_h1_4">マテリアル参照の設定(親マテリアルの割り当て)</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_193043301_h2_3">アサインユーティリティーによる親マテリアルの割り当て</a>
      </li>
      <li>
        <a href="#Anchor_193043301_h2_4">3DEditor 上での親マテリアルの手動割り当て</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_193043301_h1_5">子マテリアルの編集</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_193043301_h2_5">シェーダーパラメーターの値の編集</a>
      </li>
      <li>
        <a href="#Anchor_193043301_h2_6">親マテリアルの編集</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_193043301_h1_6">バイナリーリソースへの変換</a>
    </li>
    <li>
      <a href="#Anchor_193043301_h1_7">親マテリアルの適用仕様とマテリアルの多重参照</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_193043301_h2_7">「子マテリアルの制限」の解決</a>
      </li>
      <li>
        <a href="#Anchor_193043301_h2_8">「値」の解決</a>
      </li>
    </ul>
  </ul>
</p>
<h1 id="Anchor_193043301_h1_1">概要</h1>
<p>このページでは 3DEditor のマテリアル参照機能やその組み込み方について説明します。このページでは以下の用語を使って説明します。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <th>用語</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>
        <p>マテリアル参照</p>
      </td>
      <td>この機能の呼称です。</td>
    </tr>
    <tr>
      <td>親マテリアル</td>
      <td>別のマテリアルから参照されるマテリアルの呼称です。</td>
    </tr>
    <tr>
      <td>子マテリアル</td>
      <td>別のマテリアルを参照しているマテリアルの呼称です。</td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_193043301_h1_2">ワークフロー</h1>
<p>下図にマテリアル参照を組み込んだワークフローの例を示します。赤枠で囲んだ各フローの詳細についてはこの後の項目で説明しています。</p>
<p>
  <br />
</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_193043301/flowchart_1.svg" />
</div>
<h1 id="Anchor_193043301_h1_3">親マテリアルの作成</h1>
<p>複数のマテリアル間で共有するための設定を持つ親マテリアルを用意します。通常のフローで作成したモデル中間ファイルを 3DEditor で編集して親マテリアルの設定を行います。</p>
<h2 id="Anchor_193043301_h2_1">設定を共通化したい各シェーダーパラメーターの値の設定</h2>
<p>設定を共通化したい各シェーダーパラメーターの値を設定します。通常のマテリアル編集をする際と同様の手順でマテリアルプロパティウィンドウのシェーダーページで各パラメーターの値を設定します。</p>
<h2 id="Anchor_193043301_h2_2">子マテリアルの制限の設定</h2>
<p>子マテリアルに対する各シェーダーパラメーターの制限を設定します。この設定により、親マテリアルの値を強制的に参照させたり、子マテリアルで必ず値を設定させたりすることができます。各シェーダーパラメーターのラベルを右クリックすると表示されるコンテキストメニューから設定することができます。</p>
<p>詳しくは&nbsp;<a href="../Pages/Page_83955594.html#Anchor_83955594_MaterialReferenceMenu">マテリアル参照に関する設定</a> を参照してください。</p>
<h1 id="Anchor_193043301_h1_4">マテリアル参照の設定(親マテリアルの割り当て)</h1>
<p>マテリアル参照を利用するためには、DCC ツールエクスポートプラグインのポストエクスポートスクリプトなどで、対象のモデルに対してマテリアル参照を利用するための準備をしておく必要があります。具体的には下記の処理を行う必要があります。</p>
<ol>
  <li>モデル中間ファイルへのシェーダーの割り当て</li>
  <li>モデル中間ファイルへの親マテリアルの割り当て</li>
</ol>
<p>親マテリアルと割り当て対象のマテリアルは同じシェーディングモデルが割り当てられている必要があるため、親マテリアルを割り当てる前に対象モデルにシェーダーの割り当てを行う必要があります。</p>
<p>これらの処理は 3DEditor 上で手動で行うか、<a href="../Pages/Page_83956043.html">アサインユーティリティー</a>&nbsp;を使用してコマンドラインから実行することができます。</p>
<h2 id="Anchor_193043301_h2_3">アサインユーティリティーによる親マテリアルの割り当て</h2>
<p>各処理のアサインユーティリティーでの実行例については、アサインユーティリティーの&nbsp;<a href="../Pages/Page_83956043.html#Anchor_83956043_AssignModelShaderExample">モデルの新規シェーダー割り当て</a>、<a href="../Pages/Page_83956043.html#Anchor_83956043_AssignParentMaterialExample">親マテリアルの割り当て</a> を参照してください。</p>
<h2 id="Anchor_193043301_h2_4">3DEditor 上での親マテリアルの手動割り当て</h2>
<p>以下の手順で 3DEditor 上で親マテリアルを割り当てることができます。</p>
<ol>
  <li>子マテリアルを持つモデル中間ファイルを 3DEditor に読み込みます</li>
  <li>親マテリアルを持つモデル中間ファイルを 3DEditor に読み込みます</li>
  <li>子マテリアルの&nbsp;<a href="../Pages/Page_83955594.html">マテリアルプロパティウィンドウ シェーダーページ</a>&nbsp;でシェーダー定義、シェーディングモデルに親マテリアルと同じものを設定します(事前に設定されている場合はこの手順は不要です)</li>
  <li>子マテリアルの <a href="../Pages/Page_193048085.html">マテリアルプロパティウィンドウ 親マテリアルページ</a>&nbsp;を開きます</li>
  <li>追加ボタンから親マテリアルを追加します</li>
</ol>
<h1 id="Anchor_193043301_h1_5">子マテリアルの編集</h1>
<h2 id="Anchor_193043301_h2_5">シェーダーパラメーターの値の編集</h2>
<p>3DEditor でマテリアル参照を設定したマテリアルを編集します。</p>
<p>子マテリアルのマテリアルプロパティウィンドウのシェーダーページでは、各シェーダーパラメーターのラベルを右クリックすると表示されるコンテキストメニューから、親マテリアルの値を使用するか、値を上書きするか、デフォルト値を使用するかを切り替えることができます。</p>
<p>詳しくは&nbsp;<a href="../Pages/Page_83955594.html#Anchor_83955594_MaterialReferenceMenu">マテリアル参照に関する設定</a> を参照してください。</p>
<h2 id="Anchor_193043301_h2_6">親マテリアルの編集</h2>
<p>マテリアルプロパティウィンドウの「親マテリアル」ページから親マテリアルの追加、削除、編集することが可能です。ここでマテリアル参照の設定を手動で行うこともできます。</p>
<p>詳しくは&nbsp;<a href="../Pages/Page_193048085.html">マテリアルプロパティウィンドウ 親マテリアルページ</a>&nbsp;を参照してください。</p>
<h1 id="Anchor_193043301_h1_6">バイナリーリソースへの変換</h1>
<p>バイナリーリソースにはマテリアル参照の情報は残らないため、バイナリーリソースに変換する前に、親マテリアルの設定を子マテリアルに反映させておく必要があります。<a href="../Pages/Page_83956043.html">アサインユーティリティー</a>&nbsp;の親マテリアルの適用機能を使用して、この処理を行うことができます。</p>
<p>親マテリアルの設定を反映させたモデル中間ファイルは、バイナリーリソースに変換するための一時ファイルとなるため、一時フォルダに書き出します。親マテリアルの設定を反映させたモデル中間ファイルは、マテリアル参照を利用していない場合と同様に扱うことができるため、<a href="../Pages/Page_83955997.html">3D バイナリーコンバーター</a>&nbsp;で通常通りバイナリーリソースに変換して、ゲームアプリケーションで参照することができます。</p>
<p>親マテリアルの適用を行った場合の具体的な参照解決の仕様は<a href="#Anchor_193043301_ApplyParent">親マテリアルの適用仕様とマテリアルの多重参照</a>の項目を参照してください。アサインユーティリティーの親マテリアル適用の具体例については、<a href="../Pages/Page_83956043.html#Anchor_83956043_ApplyParentMaterialExample">親マテリアルの適用</a> を参照してください。</p>
<p>
  <a name="Anchor_193043301_ApplyParentMaterial"></a>
</p>
<h1 id="Anchor_193043301_h1_7">親マテリアルの適用仕様とマテリアルの多重参照</h1>
<p>
  <a href="../Pages/Page_83956043.html">アサインユーティリティー</a>&nbsp;で親マテリアルの適用を行った際の参照解決の仕様についてこの項目で説明します。また、マテリアルを多重参照(ひとつのマテリアルに対して複数の親マテリアルを設定)している場合、参照している親マテリアルに重複するパラメーターの設定があった場合の動作についても併せて説明します。</p>
<h2 id="Anchor_193043301_h2_7">「子マテリアルの制限」の解決</h2>
<p>設定された親マテリアルの順番と逆方向(3DEditor マテリアルプロパティウィンドウの親マテリアルページで表示されている順番の下から上に向かう方向)で親マテリアルを探索し、「子マテリアルの制限」について、最初に見つかった「なし」以外の設定を持つ親マテリアルの設定を採用します。「親マテリアルの値で固定する」を採用した場合は、その設定を持つ親マテリアルのパラメーター値を子マテリアルは使用します。「必ず子マテリアルで値を設定させる」を採用した場合は、子マテリアル自身の値を使用します。すべての親マテリアルについて「なし」が設定されていた場合は、「値」の解決の項目にあるような方法で「値」を解決して採用するパラメーター値を決定します。</p>
<p>
  <br />
</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_193043301/flowchart_2.svg" />
</div>
<p>
  <br />
</p>
<p>
  <span style="color: rgb(51,51,51);">以下に探索順序の例を示します。EnemyMatA に親マテリアルが割り当てられていた場合、[] で囲んだ数字の順番で探索します。</span>
</p>
<ul>
  <li>
    <span style="color: rgb(51,51,51);">EnemyMatA&nbsp;[9]</span>
    <ul>
      <li>EnemyBaseMatA&nbsp;[8]<ul><li>BaseMatA&nbsp;[7]</li><li>BaseMatB&nbsp;[6]</li><li>BaseMatX&nbsp;[5]</li></ul></li>
      <li>EnemyBaseMatB&nbsp;[4]<br /><ul><li>BaseMatC&nbsp;[3]</li><li>BaseMatD&nbsp;[2]</li><li>BaseMatX&nbsp;[1]</li></ul></li>
    </ul>
  </li>
</ul>
<p>
  <br />
</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_193043301/flowchart_3.svg" />
</div>
<h2 id="Anchor_193043301_h2_8">「値」の解決</h2>
<p>設定された親マテリアルの順番と逆方向(3DEditor マテリアルプロパティウィンドウの親マテリアルページで表示されている順番の下から上に向かう方向)で親マテリアルを探索し、最初に見つかった「上書きする」、もしくは「デフォルト値を使用する」が設定されている親マテリアルの値を採用します。探索した結果、すべてのマテリアルで「親マテリアルの値を参照する」が設定されていた場合は、最後に探索したマテリアルのシェーダーパラメーターの値を採用します。</p>
<p>
  <span style="color: rgb(51,51,51);">例えば、以下の順番で EnemyMatA に親マテリアルが割り当てられていた場合、[] で囲んだ数字の順番で探索します。</span>
</p>
<ul>
  <li>
    <span style="color: rgb(51,51,51);">
      <span style="color: rgb(51,51,51);">EnemyMatA&nbsp;[1]</span>
    </span>
    <ul>
      <li>EnemyBaseMatA&nbsp;[6]<ul><li>BaseMatA&nbsp;[9]</li><li>BaseMatB&nbsp;[8]</li><li>BaseMatX&nbsp;[7]</li></ul></li>
      <li>EnemyBaseMatB&nbsp;[2]<br /><ul><li>BaseMatC&nbsp;[5]</li><li>BaseMatD&nbsp;[4]</li><li>BaseMatX&nbsp;[3]</li></ul></li>
    </ul>
  </li>
</ul>
<p>
  <br />
</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_193043301/flowchart_4.svg" />
</div>
<p>
  <br />
  <br />
</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
