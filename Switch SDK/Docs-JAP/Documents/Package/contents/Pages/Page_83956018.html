<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>シェーダー</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- シェーダー -->
<div class="pagetitle" id="PageId_83956018">シェーダー</div>
<div class="text_separate">
<h1 id="Anchor_83956018_h1_1">シェーダー</h1>
<p>シェーダーは、GPU のパイプラインにおけるプログラマブルステージのプログラムを管理、セットするための機能を提供します。</p>
<p>シェーダーを初期化するためのプログラムコードとして、ソースコード・中間言語・バイナリのいずれかを指定できます。ただし、プラットフォームや低レベルグラフィックス API によって、どの種類のコードに対応しているかは異なります。</p>
<p>GFX のシェーダは、パイプラインにおけるプログラマブルステージのうちの任意のステージを含んでいます。以下の含められるステージのリストを示します。</p>
<table class="table">
  <tbody>
    <tr>
      <th>シェーダーステージ名</th>
    </tr>
    <tr>
      <td>頂点シェーダー</td>
    </tr>
    <tr>
      <td>ハルシェーダー</td>
    </tr>
    <tr>
      <td>ドメインシェーダー</td>
    </tr>
    <tr>
      <td>ジオメトリシェーダー</td>
    </tr>
    <tr>
      <td>ピクセルシェーダー</td>
    </tr>
    <tr>
      <td>演算シェーダー</td>
    </tr>
  </tbody>
</table>
<p>グラフィックスパイプラインを動かすには頂点シェーダーが、演算パイプラインを動かすには演算シェーダーが要求されます。</p>
<p>構築するシェーダーはセパレートまたは非セパレートに設定できます。セパレートシェーダーの場合は、他のシェーダーオブジェクトと協同させることができます。たとえば頂点シェーダーを含んでいるセパレートシェーダーをセットし、次にピクセルシェーダーを含んでいるセパレートシェーダーをセットした場合、頂点シェーダーとピクセルシェーダーそれぞれが有効なパイプラインが形成されます。非セパレートシェーダーの場合は他のシェーダーと協同することができないため、ひとつのシェーダーが必要なステージをすべて含んでいる必要があります。</p>
<p>GFX において、シェーダーは<a href="../Pages/Page_83955991.html">パイプライン</a>にセットする方法と、直接コマンドバッファーにセットする方法があります。それぞれ、<a href="../Pages/Page_83955534.html">実行モデル</a>におけるパイプラインを使う実行モデルとパイプラインを使わない実行モデルに相当します。</p>
<h2 id="Anchor_83956018_h2_1">情報<a name="Anchor_83956018_Info"></a></h2>
<p>シェーダーの情報は <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_shader_info.html">nn::gfx::ShaderInfo</a>&nbsp;として定義されています。</p>
<h3 id="Anchor_83956018_h3_1">セパレートの有効化・無効化</h3>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_shader_info.html#a281495fe6c18ea882544a90391dba39b">SetSeparationEnabled</a>&nbsp;により、セパレートシェーダーとするか非セパレートシェーダーとするかを選択します。</p>
<h3 id="Anchor_83956018_h3_2">コードタイプ</h3>
<p>コードタイプは、プログラムコードの種類を表します。<br /><a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_shader_info.html#a5a7f2d2188ba15eab1f50b3ba51138e6">SetCodeType</a>&nbsp;により、どのコードタイプでシェーダーを初期化するつもりなのかを設定します。</p>
<h4 id="Anchor_83956018_h4_1">ソースフォーマットの利用における注意事項</h4>
<p>コードタイプに <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455a3cf271292131cceee9c228c73f9f788e">nn::gfx::ShaderCodeType_Source</a>&nbsp;を指定しランタイム上でコンパイルすることは、速度やメモリー効率の面から不利となります。これは GL などのバイナリーに互換のない低レベルグラフィックス API をのぞいて非推奨です。&nbsp;また、<a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#ad67937775401e7564a312a54dedf6455a3cf271292131cceee9c228c73f9f788e" style="text-decoration: underline;">nn::gfx::ShaderCodeType_Source</a>&nbsp;を指定した場合、gfx ライブラリーが内部で動的なメモリーの確保を行うことがあります。</p>
<p>
  <span style="color: rgb(51,51,51);">しかし、製品環境においても、実機上でソースフォーマットを利用することは可能です。この場合は、前述の注意点に留意ください。</span>
</p>
<h3 id="Anchor_83956018_h3_3">ソースフォーマット</h3>
<p>コードタイプがソースコードである場合は、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_shader_info.html#aceae85ff5dd6c249f4bc0a004194802e">SetSourceFormat</a>&nbsp;によりソースフォーマットを指定します。<br />利用可能なソースフォーマットは低レベルグラフィックス API のバリエーションによって制限されます。<br />GLSL ソースコードを使う場合には制限があります。詳細については<a href="../Pages/Page_83955873.html">制限</a>を参照してください。&nbsp;</p>
<h3 id="Anchor_83956018_h3_4">バイナリーフォーマット</h3>
<p>コードタイプがバイナリーフォーマットである場合は、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_shader_info.html#a4f235d3e40dd749944c913b0dd46b5fa">SetBinaryFormat</a>&nbsp;によりバイナリーフォーマットを指定します。<br />OpenGL においてこれは、プログラムバイナリー取得時に得られる binaryFormat の値です。<br />利用可能なバイナリーフォーマットは実行環境や低レベルグラフィックス API のバリエーションによって制限されます。<br />OpenGL のバイナリーを使う場合には制限があります。詳細については<a href="../Pages/Page_83955873.html">制限</a>を参照してください。</p>
<h3 id="Anchor_83956018_h3_5">コードポインター</h3>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_shader_info.html#a76d3b906c15eebfb00589b5969d242bc">SetShaderCodePtr</a>&nbsp;により、対象のステージのシェーダコードを設定します。<br />設定するコードのタイプやフォーマットは、他のパラメーターで指定するものと適合している必要があります。<br />ポインター先は、コードタイプがソースであれば <a href="../../../Api/HtmlNX/structnn_1_1gfx_1_1_shader_code.html">nn::gfx::ShaderCode</a>、ソースの配列であれば <a href="../../../Api/HtmlNX/structnn_1_1gfx_1_1_source_array_code.html">nn::gfx::SourceArrayCode</a>、その他の場合は <a href="../../../Api/HtmlNX/structnn_1_1gfx_1_1_shader_code.html">nn::gfx::ShaderCode</a>&nbsp;または低レベルグラフィックス API における専用のシェーダー構造です。</p>
<h2 id="Anchor_83956018_h2_2">オブジェクト<a name="Anchor_83956018_Object"></a></h2>
<p>&nbsp;シェーダーのオブジェクトは <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a134193f9c28fadc8dfd08e80f55677b1">nn::gfx::Shader</a>&nbsp;として定義されています。</p>
<h3 id="Anchor_83956018_h3_6">初期化と破棄</h3>
<p>シェーダーの初期化と破棄は<a href="../Pages/Page_83955654.html">オブジェクト</a>の規則に従いますが、他のほとんどのオブジェクトと異なり、シェーダーの初期化関数はその初期化結果を返します。<br />シェーダーの初期化に失敗してもエラーとはならず、そのエラーコードを返すのみです。以下に結果コードとその意味のリストを示します。</p>
<table class="table">
  <tbody>
    <tr>
      <th>結果コード</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a52eb9f5e1bec94e73a2bb152af8e3d91ad542c72930fffff3ee80a71bef4e3c07">nn::gfx::ShaderInitializeResult_Success</a>
      </td>
      <td>シェーダーの初期化に成功しました</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a52eb9f5e1bec94e73a2bb152af8e3d91a9a1453a4872e1d39245212c36f35ad54">nn::gfx::ShaderInitializeResult_InvalidType</a>
      </td>
      <td>シェーダーコードのタイプが無効です</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a52eb9f5e1bec94e73a2bb152af8e3d91ad189d49b6c3429b7e9ca8ea797953d30">nn::gfx::ShaderInitializeResult_InvalidFormat</a>
      </td>
      <td>シェーダーコードのフォーマットが無効です</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a52eb9f5e1bec94e73a2bb152af8e3d91a6b288c6d220d0b962c3e8ea6b1208411">nn::gfx::ShaderInitializeResult_SetupFailed</a>
      </td>
      <td>シェーダーのセットアップに失敗しました</td>
    </tr>
  </tbody>
</table>
<p>
  <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a52eb9f5e1bec94e73a2bb152af8e3d91a6b288c6d220d0b962c3e8ea6b1208411">ShaderInitializeResult_SetupFailed</a>&nbsp;は、コードタイプもフォーマットも無効でないものの初期化に失敗した場合に返ります。</p>
<p>アプリケーションは、これらの結果を確認して、次にどうするかを選択することができます。たとえばまずバイナリーを使ってシェーダーを初期化し、成功しなかった場合に次にソースを使ってシェーダーを初期化することなどができます。</p>
<h3 id="Anchor_83956018_h3_7">リフレクション情報の取得</h3>
<p>シェーダーのいくつかのリフレクション情報を問い合わせることをサポートしています。</p>
<h4 id="Anchor_83956018_h4_2">インターフェイススロットの取得</h4>
<p>シェーダーが利用するリソースを適切な場所にセットするために、シェーダーから対象のリソースのスロット番号を取得することができます。これは、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_shader.html#a40f2b7445a7507aa747549259ce13a86">GetInterfaceSlot</a>&nbsp;に、対象のリソースの名前とその種類を指定することにより行われます。後に対象のリソースをセットする際に、ここで取得されたスロット番号を指定します。</p>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_res_shader_file.html">nn::gfx::ResShaderFile</a>&nbsp;におけるシェーダーを利用している場合、シェーダーのコンバート時に --reflection オプションが付加されている必要があります。</p>
<p>OpenGL において、アンオーダードアクセスバッファー、定数バッファー、サンプラーに、シェーダー内でスロット番号をした場合でも、セパレートシェーダーの場合はシェーダーの初期化時に GFX がそれを変更するため、必ず実行時にインターフェイススロットの取得を行う必要があります。詳細については<a href="../Pages/Page_83955873.html">制限</a>を参照してください。</p>
<h4 id="Anchor_83956018_h4_3">演算シェーダーのワークグループサイズの取得</h4>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_shader.html#afc8c9ebc71e345e052797b205d34a7e3">GetWorkGroupSize</a> により、演算シェーダのワークグループサイズを取得することができます。演算シェーダーをディスパッチするのに適切なワークグループの数を決定するためなどに利用できます。</p>
<h2 id="Anchor_83956018_h2_3">シェーダーのセット</h2>
<p>パイプラインを使う実行モデルを利用する場合は、パイプラインの情報にシェーダーをセットします。</p>
<p>パイプラインを使わない実行モデルを利用する場合は、<a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#af719859a76c249a182d878f0cffd47c5">nn::gfx::CommandBuffer</a> クラスの <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_command_buffer.html#affa101add0b7e50e308ef467bb3a574c">SetShader</a>&nbsp;を呼ぶことによってシェーダーをセットします。第一引数に対象のシェーダーを、第二引数に対象のステージを指定します。対象のシェーダーが含んでいる全ステージをセットしたい場合は <span class="ApiLink_nn__gfx__ShaderStageBit_All">nn::gfx::ShaderStageBit_All</span> を指定します。指定されたステージを対象のシェーダーが含んでいない場合、またはシェーダーに NULL が指定されている場合は、そのステージを無効化します。</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
<!--AddLink-->
<script>
var NintendoSdkApiRefernce = {
    idMap: {},
    linkRewrite: function ()
    {
        var idMap = NintendoSdkApiRefernce.idMap;
        function rewrite(el)
        {
            var e = idMap[el.className];
            if (e === undefined)
            {
                return;
            }
            var html = '';
            html += '<a href=';
            html += e.url;
            html += ' target="_blank">';
            html += el.innerHTML;
            html += '</a>';
            el.innerHTML = html;
        }
        var apiLinkElems = document.querySelectorAll('span[class*="ApiLink_"]');
        for (var i = 0, n = apiLinkElems.length; i< n; ++i) {
            rewrite(apiLinkElems[i]);
        }
    }
};
function SetUrl( id, url )
{
    NintendoSdkApiRefernce.idMap[id] = { url: url };
}
SetUrl( 'ApiLink_nn__gfx__ShaderStageBit_All', '../../../Api/HtmlNX/namespacenn_1_1gfx.html#a1e02bfe3380ee94c02ac4f0c762c4196a8e27619452b69059d788f7a91c54a40c' )

NintendoSdkApiRefernce.linkRewrite();
</script>
<!--AddLink-->
</body>
</html>
