<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>レイヤ</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- レイヤ -->
<div class="pagetitle" id="PageId_109317072">レイヤ</div>
<div class="text_separate">
<h1 id="Anchor_109317072_h1_1">概要</h1>
<p>アプリケーションは、レイヤオブジェクトを指定してコンテンツをディスプレイプロセスに送り出します。グラフィックスの初期化シーケンスでは、ディスプレイへの表示を目的とした最終的なレンダリングターゲットとしてアプリケーションが使用するテクスチャにレイヤがリンクされます。レイヤは、特定のディスプレイに関連付けられている必要があります。</p>
<p>レイヤのパラメータの一部は、グラフィック API を使用してネイティブウィンドウを設定するときに定義されます。（このドキュメントでは、「ネイティブウィンドウ」と「レイヤ」を同じ意味で使用しています。）ネイティブウィンドウに割り当てられるテクスチャの寸法は、ディスプレイでのコンテンツのスケーリング方法に関連します。</p>
<h2 id="Anchor_109317072_h2_1">スケーリング</h2>
<p>レイヤに関連付けられたテクスチャがディスプレイの解像度と一致しない場合は、コンテンツがスケーリングされます。アプリケーションでは、スケーリングモードを使用して、コンテンツのスケーリング方法を制御できます。使用可能なスケーリングモードは、プラットフォームによって異なることがあります。</p>
<p>デフォルトでは、最終的な出力が現在のディスプレイの解像度に合わせてアップスケーリングまたはダウンスケーリングされます。プラットフォームによっては、最小／最大スケーリング比率が制限されることがあります。NX では、スケーリングに関する制限は特にありません。1080p（サポートされる最大解像度）で作成されたコンテンツは、他のいずれかのサポートされる解像度までダウンスケールされる場合があります。また、アップスケーリングに関する制限はありません。</p>
<div class="warn_new">
  <div class="warn_new_left">警告：</div>
  <div class="warn_new_right">
    <p>コンテンツをスケーリングできない場合、そのコンテンツはディスプレイに表示されません。</p>
  </div>
</div>
<p>デフォルトのスケーリングモードの制限は、アスペクト比が維持されないことです。例えば、アプリケーションがアスペクト比 4:3 のフレームバッファを送信し、ディスプレイでアスペクト比 16:9 の解像度が使用されている場合、コンテンツは伸びて表示されます。</p>
<p>
  <img src="../Attachments/Attach_109317072/174243558.png"></img>
</p>
<p>アプリケーションでは、別のスケーリングモードを指定してアスペクト比を維持することができます。必要に応じて、ピラーボックスまたはレターボックスが追加されます。4:3 から 16:9 に変更される同様の例では、ピラーボックスが追加されます。</p>
<p>
  <img src="../Attachments/Attach_109317072/174243607.png"></img>
</p>
<p />
<h1 id="Anchor_109317072_h1_2">ライフサイクル</h1>
<h2 id="Anchor_109317072_h2_2">フレームのレンダリング</h2>
<p>レイヤでは、アプリケーションで使用する可能性のあるフレームバッファをすべて所有しています。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_109317072/109445517.png" class="embedded-image" />
  </span>
</p>
<!--Remove-->
<p>ディスプレイプロセスでは、アプリケーションで用意したバッファのうち、次に使用可能なものを要求に応じて取得します。</p>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <p>ダブルバッファリングなどのバッファリングモードは、グラフィックス API を使用してアプリケーションで設定します。使用可能なバッファリングモードの詳細については、それぞれのモードのドキュメントを参照してください。</p>
  </div>
</div>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_109317072/109445525.png" class="embedded-image" />
  </span>
</p>
<!--Remove-->
<p>アプリケーションでは、取得したフレームをフレームバッファにレンダリングできます。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_109317072/109445527.png" class="embedded-image" />
  </span>
</p>
<!--Remove-->
<p>アプリケーションでは、最終的にフレームバッファを解放してディスプレイプロセスに戻す必要があります。続いて、フレームバッファはディスプレイで使用できるようにキューに格納されます。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_109317072/109445529.png" class="embedded-image" />
  </span>
</p>
<!--Remove-->
<p />
<h2 id="Anchor_109317072_h2_3">ディスプレイとの同期</h2>
<p>バッファリングモードに関係なく、フレームをレンダリングするプロセスは同一です。一方、細かい点で重要なこととして、ディスプレイのリフレッシュレートとの同期があります。</p>
<p>ディスプレイプロセスでは、物理ディスプレイで発生した VSYNC イベントでのみバッファを管理しています。VSYNC では、最も最近に完成したテクスチャをディスプレイプロセスで使用します。</p>
<p>グラフィックス API では、テクスチャを取得して提示する手段を用意しています。わかりやすいように、次に使用可能なテクスチャをディスプレイプロセスから <code>acquire</code> 関数で取得し、そのテクスチャがディスプレイで使用可能になったことを <code>present</code> 関数で示すものとします。また、ディスプレイパイプラインの中でテクスチャ <strong>A</strong> と <strong>B</strong> を同じレイヤに関連付けているとします。基本的なレンダリングループは次のようになります。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="n">Texture</span><span class="o">*</span> <span class="n">t</span><span class="p">;</span> <span class="c1">// A または B を指します。
</span><span class="n">acquire</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
<span class="c1">// ...
</span><span class="n">present</span><span class="p">(</span><span class="n">t</span><span class="p">);</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>最初のフレームでは、<code>acquire</code> を呼び出してディスプレイプロセスから <strong>A</strong> を取得します。<strong>A</strong> に対して実行する GPU コマンドがある場合はロックが登録されます。これにより、ディスプレイプロセスでは、レンダリングが完了するまでテクスチャの取得処理は実行されません。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_109317072/109446514.png" class="embedded-image" />
  </span>
</p>
<!--Remove-->
<p>この時点で、アプリケーションでは次の <code>acquire</code> の呼び出しで <strong>B</strong> のレンダリングを開始できます。VSYNC イベントの発生を明示的に待機する必要はありません。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_109317072/109446522.png" class="embedded-image" />
  </span>
</p>
<!--Remove-->
<p>VSYNC の際に、ディスプレイプロセスでは <strong>A</strong> のレンダリングが完了していることを認識します。ここで、完了しているテクスチャをディスプレイに渡します。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_109317072/109446526.png" class="embedded-image" />
  </span>
</p>
<!--Remove-->
<p>アプリケーションでは、テクスチャに <strong>B</strong> を指定して <code>present</code> を呼び出し、<code>acquire</code> の呼び出しに進みます。この時点で <code>acquire</code> はブロックされます。次のテクスチャである <strong>A</strong> はディスプレイでまだ使用中であり、ディスプレイプロセスでロックされています。次の VSYNC で <strong>B</strong> がディスプレイに表示され、<strong>A</strong> のロックは解放されます。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_109317072/109446530.png" class="embedded-image" />
  </span>
</p>
<!--Remove-->
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
