<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>中間ファイルオプティマイザー</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- 中間ファイルオプティマイザー -->
<div class="pagetitle" id="PageId_83955705">中間ファイルオプティマイザー</div>
<div class="text_separate">
<p>中間ファイルオプティマイザー(%NINTENDO_SDK_ROOT%\Tools\Graphics\3dTools\3dIntermediateFileOptimizer.exe)の使用方法と注意事項を説明します。</p>
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_83955705_h1_1">概要</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_2">コマンドラインオプション</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_3">ファイル種別の適用可能な最適化一覧</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_4">利用例</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_5">サンプルの説明</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_6">制限事項</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_7">マテリアル圧縮</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_8">リジッドボディーのリジッドスキニング変換</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_9">ボーン圧縮</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_10">シェイプ圧縮</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_11">マージ</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_12">統合</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_13">近似頂点削除</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_14">サブメッシュ分割</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_15">ポリゴンリダクション</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_16">LOD モデル結合</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_17">プリミティブ最適化</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_18">量子化分析</a>
    </li>
  </ul>
</p>
<h1 id="Anchor_83955705_h1_1">概要</h1>
<p>中間ファイルに各種最適化を施します。</p>
<h1 id="Anchor_83955705_h1_2">コマンドラインオプション</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe [--args-file] [--version] [-h] [-s] [-j &quot;&quot;] [--disable-xsd-check]
[--disable-file-info] [--compress-material] [--rigid-body-to-rigid-skinning] [--compress-bone-cull] [--compress-bone-merge]
[--compress-bone-unite-child] [--compress-bone-unite] [--compress-bone-unite-all] [--compress-shape] [--compress-shape-options]
[-m] [--merge-options &quot;&quot;] [--delete-near-vertex] [--delete-near-vertex-options &quot;&quot;] [--unite-submesh]
[--divide-submesh] [--divide-submesh-options &quot;&quot;] [--trim-lod-model] [--polygon-reduction] [--polygon-reduction-options &quot;&quot;]
[--unite-lod-model] [--unite-lod-model-options &quot;&quot;] [--optimize-primitive][--optimize-primitive-options &quot;&quot;]
[--quantization-analysis] [--combine] [--combine-options &quot;&quot;] [-o &quot;&quot;] [中間ファイル]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>中間ファイルを最適化します。</p>
<p>各最適化オプションの処理は、オプションの指定順序に関わらず、下記のオプション説明に記載された順序で処理します。</p>
<p>
  <strong>--args-file &quot;&quot;</strong>
</p>
<p>引数ファイルを指定します。<br />引数ファイルに記述した内容を、引数として指定できます。&nbsp;<br />引数ファイルは複数行に渡って各オプションを記述できます。&nbsp;<br />行頭に # がある行はコメントとして扱います。&nbsp;<br />オプション値指定の &quot;&quot; によるエスケープに改行を含めることはできません。</p>
<p>
  <strong>--version</strong>
</p>
<p>バージョン情報を表示します。</p>
<p>
  <strong>-h --help</strong>
</p>
<p>ヘルプを表示します。</p>
<p>
  <strong>-s --silent</strong>
</p>
<p>処理中のメッセージ表示を抑制します。</p>
<p>
  <strong>-j &quot;&quot; --jobs &quot;&quot;</strong>
</p>
<p>実行ジョブ数を指定します。</p>
<p>
  <strong>--disable-xsd-check</strong>
</p>
<p>スキーマ (.xsd) による中間ファイルのフォーマットチェックを無効化します。<br />本オプション有効時は、最新版の中間ファイルしか処理できなくなります。</p>
<p>
  <strong>--disable-file-info</strong>
</p>
<p>中間ファイルを保存する際に &lt;file_info&gt; を更新しません。</p>
<p>
  <strong>中間ファイル</strong>
</p>
<p>処理する中間ファイルを指定します。</p>
<p>
  <strong>--compress-material</strong>
</p>
<p>同じ設定のマテリアルをマージしてマテリアルを圧縮をします。<br />主に DCC ツールからの出力時に適用する最適化です。<br />対応する中間ファイル: fmd</p>
<p>
  <strong>--rigid-body-to-rigid-skinning</strong>
</p>
<p>リジッドボディーのシェイプをリジッドスキニングに変換します。<br />対応する中間ファイル: fmd</p>
<p>
  <strong>--compress-bone-cull</strong>
</p>
<p>描画に使用していない末端のボーンを削除してボーンを圧縮をします。<br />主に DCC ツールからの出力時に適用する最適化です。<br />現在圧縮後のソートに対応していません。<br />対応する中間ファイル: fmd、fsk、fvb</p>
<p>
  <strong>--compress-bone-merge</strong>
</p>
<p>描画に使用していないボーンを削除してボーンを圧縮をします。<br />主に DCC ツールからの出力時に適用する最適化です。<br />現在圧縮後のソートに対応していません。<br />対応する中間ファイル: fmd、fsk、fvb</p>
<p>
  <strong>--compress-bone-unite-child</strong>
</p>
<p>リジッドボディーでのみ描画に使用している末端のボーンを削除してボーンを圧縮します。<br />主に DCC ツールからの出力時に適用する最適化です。 <br />対応する中間ファイル: fmd、fsk、fvb</p>
<p>
  <strong>--compress-bone-unite</strong>
</p>
<p>圧縮可能なボーンを単一のボーンに圧縮します。 <br />主に DCC ツールからの出力時に適用する最適化です。 <br />対応する中間ファイル: fmd、fsk、fvb</p>
<p>
  <strong>--compress-bone-unite-all</strong>
</p>
<p>全てのボーンを単一のボーンに圧縮します。 <br />主に DCC ツールからの出力時に適用する最適化です。 <br />対応する中間ファイル: fmd、fsk、fvb</p>
<p>
  <strong>--compress-shape</strong>
</p>
<p>同じ設定のシェイプをマージしてシェイプを圧縮します。 <br />主に DCC ツールからの出力時に適用する最適化です。<br />圧縮されたシェイプでは量子化分析の結果が無効になりますので、再度量子化分析を行ってください。<br /> <a href="#Anchor_83955705_quantization_analysis">--quantization-analysis オプション</a>を同時に指定すると、この処理の後に量子化分析が実行されます。 <br />対応する中間ファイル: fmd</p>
<p>
  <strong>--compress-shape-options</strong>
</p>
<p>--compress-shape&nbsp;オプションのサブオプションを指定します。<br />サブオプションについては<a href="#Anchor_83955705_compress_shape">シェイプ圧縮のドキュメント</a>を参照してください。&nbsp;<br />対応する中間ファイル: fmd&nbsp;</p>
<p>
  <strong>-m --merge</strong>
</p>
<p>3DEditor 等で編集済みの、マージする中間ファイルを指定します。 <br />主に DCC ツールからの出力時に適用する最適化です。<br />対応する中間ファイル: fmd、fsk、fma、fsp、fcl、fts、ftp、fvb、fvm, fsh, fsn</p>
<p>
  <strong>--merge-options &quot;&quot;</strong>
</p>
<p>--merge オプションのサブオプションを指定します。<br />サブオプションについては<a href="#Anchor_83955705_merge">マージのドキュメント</a>を参照してください。</p>
<p>
  <strong> <a name="Anchor_83955705_delete_near_vertex"></a>--delete-near-vertex</strong>
</p>
<p>近似頂点の削除を行います。<br />削除によって頂点数が変更されます。<br />削除後はプリミティブ最適化 の結果が無効になりますので、再度 最適化 を行ってください。<br /> <a href="#Anchor_83955705_optimize_primitive">--optimize-primitive オプション</a>を同時に指定すると、この処理の後に プリミティブ最適化 が実行されます。 <br />対応する中間ファイル: fmd</p>
<p>
  <strong>--combine</strong>
</p>
<p>複数のマテリアルアニメーションを統合します。シェーダーアニメーション、テクスチャーパターンアニメーション、マテリアルビジビリティアニメーションをマテリアルアニメーションに変換することも出来ます。<br />複数のファイルを統合する場合は --combine-options も指定する必要があります。<br />対応する中間ファイル: fsp、fcl、fts、ftp、fvm、fma</p>
<p>
  <strong>--combine-options &quot;&quot;</strong>
</p>
<p>--combine<strong>&nbsp;</strong>オプションのサブオプションを指定します。<br />サブオプションについては<a href="#Anchor_83955705_combine">統合のドキュメント</a>を参照してください。</p>
<p>
  <strong>--delete-near-vertex-options &quot;&quot;</strong>
</p>
<p>--delete-near-vertex オプションのサブオプションを指定します。<br />サブオプションについては<a href="#Anchor_83955705_delete_near_vertex_detail">近似頂点削除のドキュメント</a>を参照してください。&nbsp;<br />対応する中間ファイル: fmd&nbsp;</p>
<p>
  <strong>--unite-submesh</strong>
</p>
<p>サブメッシュを結合します。<br />結合後はプリミティブ最適化 の結果が無効になりますので、再度 最適化 を行ってください。<br /> <a href="#Anchor_83955705_optimize_primitive">--optimize-primitive オプション</a>を同時に指定すると、この処理の後に プリミティブ最適化 が実行されます。<br /> <span style="color: rgb(51,51,51);">対応する中間ファイル: fmd</span> <br /> </p>
<p>
  <strong>--divide-submesh</strong>
</p>
<p>サブメッシュを分割します。<br />分割後はプリミティブ最適化 の結果が無効になりますので、再度 最適化 を行ってください。<br /> <a href="#Anchor_83955705_optimize_primitive">--optimize-primitive オプション</a>を同時に指定すると、この処理の後に プリミティブ最適化 が実行されます。 <br />対応する中間ファイル: fmd</p>
<p>
  <strong>--divide-submesh-options &quot;&quot;</strong>
</p>
<p>--divide-submesh オプションのサブオプションを指定します。<br />サブオプションについては<a href="#Anchor_83955705_divide_submesh">サブメッシュ分割のドキュメント</a>を参照してください。&nbsp;<br />対応する中間ファイル: fmd&nbsp;</p>
<p>
  <strong>--trim-lod-model</strong>
</p>
<p>--unite-lod-model で結合された LOD モデルを削除します。<br />対応する中間ファイル: fmd</p>
<p>
  <strong>--polygon-reduction</strong>
</p>
<p>ベースモデルから LOD モデルを自動生成します。<br />対応する中間ファイル: fmd</p>
<p>
  <strong>--polygon-reduction-options &quot;&quot;</strong>
</p>
<p>--polygon-reduction オプションのサブオプションを指定します。<br />サブオプションについては<a href="#Anchor_83955705_polygon_reduction">ポリゴンリダクションのドキュメント</a>を参照してください。<br />対応する中間ファイル: fmd</p>
<p>
  <strong>--unite-lod-model</strong>
</p>
<p>LOD モデルを結合します。<br />結合後は量子化分析の結果が無効になりますので、再度量子化分析を行ってください。<br /> <a href="#Anchor_83955705_quantization_analysis">--quantization-analysis オプション</a>を同時に指定すると、この処理の後に量子化分析が実行されます。 <br />対応する中間ファイル: fmd</p>
<p>
  <strong>--unite-lod-model-options &quot;&quot;</strong>
</p>
<p>--unite-lod-model オプションのサブオプションを指定します。<br />サブオプションについては<a href="#Anchor_83955705_unite_lod_model">LODモデル結合のドキュメント</a>を参照してください。<br />対応する中間ファイル: fmd</p>
<p>
  <a name="Anchor_83955705_optimize_primitive"></a> <strong>--optimize-primitive</strong></p>
<p>プリミティブを最適化します。<br />対応する中間ファイル: fmd</p>
<p>
  <strong>--optimize-primitive-options &quot;&quot;</strong>
</p>
<p>--optimize-primitive オプションのサブオプションを指定します。<br />サブオプションについては<a href="#Anchor_83955705_optimize_primitive_detail">プリミティブ最適化のドキュメント</a>を参照してください。<br />対応する中間ファイル: fmd</p>
<p>
  <a name="Anchor_83955705_quantization_analysis"></a> <strong>--quantization-analysis</strong></p>
<p>量子化精度を設定します。<br />主に DCC ツールからの出力時に適用する最適化です。<br />対応する中間ファイル: fmd、fsk、fma、fsp、fcl、fts、ftp、fvb、fvm、fsh、fsn</p>
<p>
  <strong>-o &quot;&quot; --output &quot;&quot;</strong>
</p>
<p>出力ファイルを指定します。<br />本オプションを指定しない場合、処理するファイルを上書きします。<br />対応する中間ファイル: fmd、fsk、fma、fsp、fcl、fts、ftp、fvb、fvm、fsh、fsn</p>
<h1 id="Anchor_83955705_h1_3">ファイル種別の適用可能な最適化一覧</h1>
<p>中間ファイルの種類ごとに適用可能な各種最適化処理を以下に記します。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>
        <br />
      </th>
      <th>マテリアル圧縮</th>
      <th>リジッドボディーのリジッドスキニング変換</th>
      <th>ボーン圧縮</th>
      <th>シェイプ圧縮</th>
      <th>マージ</th>
      <th>統合</th>
      <th>近似頂点削除</th>
      <th>サブメッシュ削除</th>
      <th>サブメッシュ分割</th>
      <th>LOD モデル削除</th>
      <th>ポリゴンリダクション</th>
      <th>LOD モデル結合</th>
      <th>プリミティブ最適化</th>
      <th>量子化分析</th>
    </tr>
    <tr>
      <th>モデル</th>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
    </tr>
    <tr>
      <th>スケルタルアニメーション</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
    </tr>
    <tr>
      <th>マテリアルアニメーション</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
    </tr>
    <tr>
      <th>ボーンビジビリティアニメーション</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
    </tr>
    <tr>
      <th>シェイプアニメーション</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
    </tr>
    <tr>
      <th>シーンアニメーション</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">有効</span>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83955705_h1_4">
  <br />利用例</h1>
<p>中間ファイルオプティマイザーの利用例になります。</p>
<h2 id="Anchor_83955705_h2_1">中間ファイルのマージ</h2>
<p>dcc.fmdb に edited.fmdb をマージします。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe dcc.fmdb --merge --merge-options &quot;--merge-file edited.fmdb&quot;</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_2">中間ファイルの多重最適化</h2>
<p>optimize.fmdb にマテリアル圧縮、Merge ボーン圧縮、Unite Child ボーン圧縮、シェイプ圧縮、edited.fmdb とのマージ、プリミティブ最適化、量子化分析を施して、output.fmdb に保存します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe optimize.fmdb --compress-material --compress-bone-merge --compress-bone-unite-child --compress-shape --merge --merge-options &quot;--merge-file edited.fmdb&quot; --optimize-primitive --quantization-analysis -o=output.fmdb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83955705_h1_5">サンプルの説明</h1>
<p>中間ファイルオプティマイザーのサンプルは Samples/Sources/Tools/3dTools/3dIntermediateFileOptimizer/ 以下にあります。</p>
<h2 id="Anchor_83955705_h2_3">プリミティブ最適化の再帰的な適用 (RecursiveOptimizePrimitive)</h2>
<p>RecursiveOptimizePrimitive.bat にモデル中間ファイルやフォルダをドラッグ＆ドロップすると、force オプションでプリミティブ最適化を施して上書き保存します。</p>
<h1 id="Anchor_83955705_h1_6">制限事項</h1>
<p>面積のないシェイプや座標値が無限遠に近いシェイプなど、特異な入力に対しては、いくつか最適化においてエラーとなる可能性があります。</p>
<h1 id="Anchor_83955705_h1_7">マテリアル圧縮</h1>
<p>名前以外のすべてのステータスが一致するマテリアルが複数存在する場合、それらのマテリアルをひとつにまとめてマテリアル数を減らします。 マテリアル (&lt;material&gt;) と同時に対応する &lt;original_material&gt; も一緖に圧縮します。</p>
<p class="note">マテリアル圧縮は、マテリアル数を減らして描画効率を向上したいモデルに使用します。</p>
<h2 id="Anchor_83955705_h2_4">アルファベット順</h2>
<p>NintendoWare 3D 開発環境ではアルファベット順と定義する場合、数字、大文字英字、小文字英字を以下の規則に従って先か後かを判断します。</p>
<p>(先) 0, 1 ... 9, A, B ... Z, a, b ... z (後)</p>
<h2 id="Anchor_83955705_h2_5">アルゴリズム</h2>
<p>fmd ファイル内に以下の条件に該当する二つのマテリアルが存在する場合、マテリアル名をアルファベット順にみて、先にくるマテリアルを残し、後になるマテリアルを削除します。</p>
<ul>
  <li>名前以外のすべてのパラメーターが完全に一致する。</li>
  <li>マテリアルに対応する &lt;original_material&gt; の名前以外のすべてのパラメーターが完全に一致する。</li>
  <li>どちらのマテリアルも削除可能である （compress_enable=&quot;true&quot;）。</li>
</ul>
<p>DCC ツール上でマテリアルに何らかのアニメーションを設定するか、もしくは特定のマテリアルを常に残しておきたい場合、マテリアル圧縮でそのマテリアルが削除されないように compress_enable を false にしてください。</p>
<p>マテリアル圧縮を行うには fmd ファイルに対して、 --compress-material オプションを指定してください。</p>
<h1 id="Anchor_83955705_h1_8">リジッドボディーのリジッドスキニング変換</h1>
<!--Remove-->
<p>
  <br />
</p>
<p>リジッドボディーのシェイプをリジッドスキニングに変換します。</p>
<p>シェイプ圧縮と組み合わせるとシェイプ数を減らすことが出来ます。</p>
<h3 id="Anchor_83955705_h3_1">アルゴリズム</h3>
<p>リジッドボディーのシェイプから 単一のボーン（シェイプの&nbsp;bone_name に設定されているボーン）のみを参照するリジッドスキニングに変換します。</p>
<p>参照しているボーンが削減可能(compress_enable=&quot;true&quot;)の場合は、そのボーンの親を辿り、最初に見つかった削除不可(compress_enable=&quot;false&quot;)のボーンがシェイプの&nbsp;bone_name に設定され、シェイプ圧縮が可能になります。削除不可のボーンが見つからない場合は bone_name はルートボーンに設定されます。ボーンビジビリティーアニメーションを反映させたい場合は対象のボーンを削除不可に設定してください。</p>
<p>リジッドボディーをリジッドスキニングに変換するには&nbsp;fmd ファイルに対して、--rigid-body-to-rigid-skinning&nbsp;オプションを指定してください。</p>
<h1 id="Anchor_83955705_h1_9">
  <a name="Anchor_83955705_compress_bone"></a>ボーン圧縮</h1>
<p>描画に不必要なボーンを圧縮して、データサイズや描画コストを削減する最適化です。具体的なアルゴリズムや注意点については&nbsp;<a href="../Pages/Page_291410825.html">ボーン圧縮 </a>を参照してください。</p>
<h1 id="Anchor_83955705_h1_10">
  <a name="Anchor_83955705_compress_shape"></a>シェイプ圧縮</h1>
<p>同じボーンに属して、同じマテリアルを使って描画するシェイプ同士をひとつにまとめます。</p>
<p>このオプションはボーン圧縮と併用して使います。DCC ツール上では別々のボーンに属していた、同じマテリアルを使って表示するシェイプ群同士がボーン圧縮によって同じボーンに属した場合に、可能であればひとつにまとめます。</p>
<p class="note">シェイプ圧縮は、シェイプ数を減らして描画効率を向上したいモデルに使用します。</p>
<p>圧縮されたシェイプでは量子化分析の結果が無効になりますので、 --quantization-analysis オプションも同時に指定してください。</p>
<h2 id="Anchor_83955705_h2_6">サブオプション</h2>
<p>
  <strong>--ignore-skinning-count</strong>
</p>
<p>一つの頂点に影響を与えるボーン数が異なるシェイプを圧縮します。一つの頂点に影響を与えるボーン数が大きいシェイプに合わせて頂点データ等を拡張します。シェイプ圧縮により一つの頂点に影響を与えるボーン数が変化した場合、そのシェイプと連続するシェイプとの間に隙間ができないように、連続する他のシェイプ(original_bone_name が同じシェイプ)もすべて同様に拡張されます。</p>
<p>
  <span style="color: rgb(51,51,51);">このサブオプションが未指定の場合より<span style="color: rgb(51,51,51);">シェイプ数が</span>減ることで、</span>
  <span style="color: rgb(51,51,51);">描画回数が減って処理効率が上がる場合があります。</span>
  <br />ただし、影響を受けるボーン数の多いシェイプに合わせて頂点属性の要素数が増えるため、ファイルサイズや<span style="color: rgb(51,51,51);">頂点バッファサイズが増えるデメリットがあります。<br /></span></p>
<h2 id="Anchor_83955705_h2_7">シェイプの統合条件</h2>
<p>以下の条件が満たされる場合に、シェイプの統合が可能です。</p>
<ul>
  <li>描画に使うマテリアルが同じ（&lt;shape_info&gt; の mat_name 属性）。</li>
  <li>&lt;shape_info&gt; の bone_name 属性の値が同じ。<br /> この属性が異なるリジッドボディー同士を統合するにはスキニングモデル化が必要なため、統合しません。<br /> （スキニングモデル化はディスプレイリストのサイズを増加させます。）</li>
  <li>頂点インデックスのプリミティブタイプが同じ（&lt;mesh&gt; の mode 属性）。</li>
  <li>&lt;key_shape_array&gt; が存在していない。</li>
  <li>サブオプションで&nbsp;--ignore-skinning-count が指定されている場合<ul><li>一つの頂点に影響を与えるボーン数が 1 以上（&lt;shape_info&gt; の vertex_skinning_count 属性）。</li><li>&lt;shape_info&gt; が vertex_index 属性で参照する &lt;vertex&gt; の構成がスキニングに関するものを除き同じ。<br />スキニングに関する&nbsp;&lt;vtx_attrib&gt; とは Hint が blendindex0 ～ blendindex31、blendweight0 ～ blendweight31&nbsp;のものを指します。<br />&lt;vertex&gt; に含まれるスキニングに関するものを除いた &lt;vtx_attrib&gt; の数と、それぞれの &lt;vtx_attrib&gt; で stream_index, count, quantize_type&nbsp;を除く全ての属性が同じである必要があります。<br />例えば DCC ツールでの頂点カラーの設定の有無などで &lt;vtx_attrib&gt; の構成がシェイプ間で異なると結合されません。</li></ul></li>
  <li>サブオプションで&nbsp;--ignore-skinning-count が指定されていない場合<br /><ul><li>一つの頂点に影響を与えるボーン数が同じ（&lt;shape_info&gt; の vertex_skinning_count 属性）。</li><li>&lt;shape_info&gt; が vertex_index 属性で参照する &lt;vertex&gt; の構成が同じ。<br /> &lt;vertex&gt; に含まれる &lt;vtx_attrib&gt; の数と、それぞれの &lt;vtx_attrib&gt; で stream_index, count, quantize_type&nbsp;を除く全ての属性が同じである必要があります。<br /> 例えば DCC ツールでの頂点カラーの設定の有無などで &lt;vtx_attrib&gt; の構成がシェイプ間で異なると結合されません。</li></ul></li>
</ul>
<p>シェイプ圧縮 を行うには fmd ファイルに対して、--compress-shape オプションを指定してください。</p>
<h1 id="Anchor_83955705_h1_11">
  <a name="Anchor_83955705_merge"></a>マージ</h1>
<p>モデルファイル(fmd)、スケルタルアニメーションファイル(fsk)、シェーダーパラメーターアニメーションファイル(fsp,fcl,fts)、テクスチャーパターンアニメーションファイル(ftp)、ボーンビジビリティアニメーションファイル(fvb)、マテリアルビジビリティアニメーションファイル(fvm)、シェイプアニメーション(fsh)、シーンアニメーション(fsn)のマージに対応しています。</p>
<h2 id="Anchor_83955705_h2_8">サブオプション</h2>
<p>
  <strong>--merge-file &quot;&quot;</strong>
</p>
<p>マージするファイルを指定します。<br />対応する中間ファイル: fmd、fsk、fma、fsp、fcl、fts、ftp、fvb、fvm, fsh, fsn</p>
<p>
  <strong>--sampler-merge-priority</strong>
</p>
<p>モデルファイルのマージにおいて、引数ファイルのサンプラーを優先して残します。<br />DCC ツールで編集したサンプラーを残す場合に指定します。<br />モデルファイル以外のマージでは無視されます。</p>
<p>
  <strong>--texture-srt-merge-priority</strong>
</p>
<p>モデルファイルのマージにおいて、引数ファイルのテクスチャー SRT を優先して残します。<br />DCC ツールで編集したテクスチャー SRT を残す場合に指定します。<br />モデルファイル以外のマージでは無視されます。</p>
<p>
  <strong>--bone-visibility-merge-priority</strong>
</p>
<p>モデルファイルのマージにおいて、引数ファイルのボーンビジビリティを優先して残します。</p>
<p>DCC ツールで編集したボーンビジビリティを残す場合に指定します。</p>
<p>モデルファイル以外のマージでは無視されます。</p>
<div class="note_new">
  <div class="note_new_left">注意：</div>
  <div class="note_new_right">
    <p>--bone-visibility-merge-priority は NintendoSDK 1.0.0 以降のバージョンに含まれます。</p>
  </div>
</div>
<h2 id="Anchor_83955705_h2_9">共通のマージ仕様</h2>
<p>以下の説明では 3dIntermediateFileOptimizer.exe の引数に指定したファイルを &quot;引数ファイル&quot;、--merge-file サブオプションに指定したファイルを &quot;マージファイル&quot; と呼びます。</p>
<p>全てのファイルタイプで以下の要素をマージします。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>要素名</th>
      <td>マージ動作</td>
    </tr>
    <tr>
      <td>&lt;user_data_array&gt;</td>
      <td>引数ファイルにない name を持つ &lt;user_data&gt; をマージファイルから引数ファイルにコピー</td>
    </tr>
    <tr>
      <td>&lt;comment&gt;</td>
      <td>引数ファイルの省略している要素をマージファイルから引数ファイルにコピー</td>
    </tr>
    <tr>
      <td>&lt;tool_data&gt;</td>
      <td>全要素をマージファイルから引数ファイルにコピー</td>
    </tr>
    <tr>
      <td>&lt;user_tool_data&gt;</td>
      <td>全要素をマージファイルから引数ファイルにコピー</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_10">モデルファイルのマージ</h2>
<p>引数ファイルとマージファイルで同じ名前を持つ &lt;material&gt; 間、&lt;bone&gt; 間で、一部のパラメーターをマージファイルから引数ファイルにコピーします。</p>
<p>また、以下の条件に当てはまる場合には同じ名前を持つ &lt;shape&gt; と、その &lt;shape_info&gt; の vertex_index が参照する &lt;vertex&gt; の一部パラメーターをマージファイルから引数ファイルにコピーします。</p>
<ul>
  <li>&lt;shape_info&gt; の mat_name と bone_name が一致する &lt;shape&gt; の数が同じ</li>
</ul>
<p>この条件について以下の構成のモデルファイルを用いて具体的に説明します。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <td>shapeA ('bone1', &quot;mat1&quot;)<br />shapeB ('bone1', &quot;mat1&quot;)<br />shapeC ('bone2', &quot;mat2&quot;)<br />shapeD ('bone2', &quot;mat2&quot;)<br />shapeE ('bone2', &quot;mat2&quot;)</td>
      <td>shapeA ('bone1', &quot;mat1&quot;)<br />shapeB ('bone1', &quot;mat1&quot;)<br />shapeC ('bone2', &quot;mat2&quot;)<br />shapeD ('bone2', &quot;mat2&quot;)</td>
    </tr>
  </tbody>
</table>
<p>一番左側はシェイプ名、() 内の '(シングルクォート) で囲まれた部分はシェイプが参照するボーン名、&quot;(ダブルクォート) で囲まれた部分はシェイプが参照するマテリアル名です。 この構成ではマージされるメッシュは shapeA、shapeB の２つだけです。 shapeC, shapeD は同じボーンとマテリアルを参照するシェイプの数が異なるためマージしません。</p>
<p>以下はモデルファイルのマージでコピーするパラメーターの一覧です。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th align="left" colspan="2">モデルのマージ</th>
    </tr>
    <tr>
      <td>&lt;model_info&gt;</td>
      <td>unite_pos_quantize</td>
    </tr>
    <tr>
      <th align="left" colspan="2">マテリアルのマージ</th>
    </tr>
    <tr>
      <td>&lt;material_info&gt;</td>
      <td>visibility<br />mesh_adjacency</td>
    </tr>
    <tr>
      <td>&lt;render_state&gt;</td>
      <td>全要素</td>
    </tr>
    <tr>
      <td>&lt;sampler_array&gt;</td>
      <td>全要素 <a href="#Anchor_83955705_anchor_01">※1</a></td>
    </tr>
    <tr>
      <td>&lt;shader_assign&gt;</td>
      <td>全要素 <a href="#Anchor_83955705_anchor_02">※2</a></td>
    </tr>
    <tr>
      <th align="left" colspan="2">ボーンのマージ</th>
    </tr>
    <tr>
      <td>&lt;skeleton_info&gt;</td>
      <td>
        <p>scale_enable</p>
        <p>motion_mirroring_enable</p>
      </td>
    </tr>
    <tr>
      <td>&lt;bone&gt;</td>
      <td>billboard<br />visibility</td>
    </tr>
    <tr>
      <th align="left" colspan="2">頂点データのマージ</th>
    </tr>
    <tr>
      <td>&lt;lod_offset&gt;</td>
      <td>全要素 <a href="#Anchor_83955705_anchor_03">※3</a></td>
    </tr>
    <tr>
      <td>&lt;vtx_attrib&gt;</td>
      <td>quantize_type <a href="#Anchor_83955705_anchor_04">※4</a><br />count <a href="#Anchor_83955705_anchor_03">※3</a></td>
    </tr>
    <tr>
      <td>&lt;vtx_buffer&gt;</td>
      <td>全要素 <a href="#Anchor_83955705_anchor_05">※5</a></td>
    </tr>
    <tr>
      <th align="left" colspan="2">シェイプのマージ</th>
    </tr>
    <tr>
      <td>&lt;shape_info&gt;</td>
      <td>
        <p>original_material_name <a href="#Anchor_83955705_anchor_04">※4</a></p>
        <p>original_bone_name <a href="#Anchor_83955705_anchor_04">※4</a></p>
        <p>optimize_primitive_mode <a href="#Anchor_83955705_anchor_04">※4</a> <br />original_shape_hash <a href="#Anchor_83955705_anchor_04">※4</a> <br />optimize_primitive_mode <a href="#Anchor_83955705_anchor_04">※4</a> <br />delete_near_vertex_mode <a href="#Anchor_83955705_anchor_04">※4</a> <br />divide_submesh_mode <a href="#Anchor_83955705_anchor_04">※4</a> <br />polygon_reduction_mode <a href="#Anchor_83955705_anchor_04">※4</a></p>
      </td>
    </tr>
    <tr>
      <td>&lt;mesh&gt;</td>
      <td>&lt;submesh_array&gt; を含めた全要素 <a href="#Anchor_83955705_anchor_03">※3</a>、<a href="#Anchor_83955705_anchor_04">※4</a></td>
    </tr>
    <tr>
      <th align="left" colspan="2">ストリームのマージ</th>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>&lt;vtx_attrib&gt;、&lt;mesh&gt; から参照しているデータ列 <a href="#Anchor_83955705_anchor_03">※3</a>、<a href="#Anchor_83955705_anchor_04">※4</a></td>
    </tr>
  </tbody>
</table>
<p>
  <br />
</p>
<p>
  <a name="Anchor_83955705_anchor_01"></a>※1 --sampler-merge-priority オプションが指定された場合は<a href="#Anchor_83955705_sampler_merge">サンプラーのマージ</a>を行います。<br /> オプションが指定されていないとマージファイルのサンプラーを残します。</p>
<p>
  <a name="Anchor_83955705_anchor_02"></a>※2 --sampler-merge-priority オプションが指定された場合は、マージファイルのシェーダーパラメーターを設定後、引数ファイルの &lt;original_texsrt&gt; の hint が type が texsrt または texsrt_ex の &lt;shader_param&gt; の original_hint に一致すれば、  &lt;original_texsrt&gt; の値を使用します。 </p>
<p>
  <a name="Anchor_83955705_anchor_03"></a>※3 ※4 の条件に加えて、マージファイルの &lt;shape&gt; が LOD を持ち、&lt;shape_info&gt; の polygon_reduction_mode が設定されている場合は、<a href="#Anchor_83955705_lod_merge">LOD のマージ</a>を行います。 polygon_reduction_mode が設定されていない場合は、&lt;mesh_array&gt; の先頭にある &lt;mesh&gt; のみマージし、LOD をマージしません。</p>
<p>
  <a name="Anchor_83955705_anchor_04"></a>※4 マージファイルの &lt;shape_info&gt; の original_shape_hash が設定されており、<br /> 引数ファイルとマージファイルの original_shape_hash が一致する場合にマージを行います。</p>
<p>
  <a name="Anchor_83955705_anchor_05"></a>※5 &lt;vtx_attrib&gt; の数と hint が一致している場合のみコピーします。 また、マージファイルの &lt;vtx_buffer_array&gt; が省略されている場合は、引数ファイルの内容を残します。</p>
<p>
  <a name="Anchor_83955705_lod_merge"></a>
</p>
<h3 id="Anchor_83955705_h3_2">LOD のマージ</h3>
<p>&lt;shape_info&gt; の polygon_reduction_mode が設定されている場合、LOD のマージを行います。 &lt;mesh_array&gt; の全要素と、&lt;vtx_attrib&gt;、&lt;mesh&gt; が参照している &lt;stream&gt; をマージします。</p>
<p>polygon_reduction_mode が設定されていない場合は、&lt;mesh_array&gt; の先頭にある &lt;mesh&gt; のみマージします。 &lt;vtx_attrib&gt; が参照している &lt;stream&gt; は LOD の頂点データを削除してからマージします。</p>
<p>
  <a name="Anchor_83955705_sampler_merge"></a>
</p>
<h3 id="Anchor_83955705_h3_3">サンプラーのマージ</h3>
<p>--sampler-merge-priority オプションが指定された場合は、サンプラーのマージを行います。 オプションが指定されていない場合は、マージファイルのサンプラーのみが残ります。</p>
<p>サンプラーのマージを行うルールとして、引数ファイルとマージファイルの間で同じ名前(name)とヒント(hint)を持つ &lt;sampler&gt; を同一のサンプラーとみなします。 同一のサンプラーが存在する場合、&lt;wrap&gt; の w、&lt;filter&gt;、&lt;lod&gt; をマージファイルから引数ファイルにコピーします。</p>
<p>マージファイルのサンプラーの名前が &quot;_&quot; から始まる予約名である場合、引数ファイルに同一のサンプラーが存在しない場合はマージしません。</p>
<p>マージファイルのサンプラーの名前が予約名でない場合、名前、ヒントのいずれも引数ファイルにあるサンプラーと重複しないサンプラー、 もしくは名前が重複せずヒントが空のサンプラーはサンプラーのテクスチャーデータを含めすべてのパラメーターをマージします。</p>
<p>正しくマージを行うためにはDCCツールから書き出されるサンプラーは &quot;_&quot; から始まる名前と空でないヒントを持つ必要があります。例えば、名前が &quot;_ao&quot;、ヒントが &quot;ambient_occlusion&quot; のようなサンプラーは正しくマージされますが、名前が &quot;ao&quot; であったり、ヒントが空文字である場合は DCCツールから書き出されたサンプラーとして認識されないため正しくマージされません。</p>
<h2 id="Anchor_83955705_h2_11">スケルタルアニメーションファイルのマージ</h2>
<p>&lt;skeletal_anim_info&gt; の間で、一部のパラメーターをマージファイルから引数ファイルにコピーします。</p>
<p>コピーするパラメーターの一覧です。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;skeletal_anim_info&gt;</td>
      <td>quantize_tolerance_frame<br />quantize_tolerance_scale<br />quantize_tolerance_rotate<br />quantize_tolerance_translate</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_12">マテリアルアニメーションのマージ</h2>
<p>マージファイルから引数ファイルへ &lt;material_anim_info&gt; の一部と &lt;per_material_anim_array&gt; をコピーします。 その後、引数ファイルの &lt;per_material_anim&gt;&nbsp;と &lt;original_per_material_anim&gt; の間で同じ mat_name を持つ要素同士でアニメーションのマージを行います。</p>
<p>コピーする &lt;material_anim_info&gt; のパラメーターです。</p>
<table class="wrapped" style="margin-left: 1.5em;">
  <tbody>
    <tr>
      <td>&lt;material_anim_info&gt;</td>
      <td>quantize_tolerance_tex_scale<br />quantize_tolerance_tex_rotate<br />quantize_tolerance_tex_translate</td>
    </tr>
  </tbody>
</table>
<p>&lt;per_material_anim&gt;内の各要素のマージ処理の内容は以下を参照してください。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;shader_param_anim_array&gt;</td>
      <td>
        <a href="#Anchor_83955705_merge_shader_param_anim">シェーダーパラメーターアニメーションのマージ</a>
      </td>
    </tr>
    <tr>
      <td>&lt;tex_pattern_anim_array&gt;</td>
      <td>
        <a href="#Anchor_83955705_merge_tex_pattern_anim">テクスチャーパターンアニメーションのマージ</a>
      </td>
    </tr>
    <tr>
      <td>&lt;material_visibility_anim&gt;</td>
      <td>
        <a href="#Anchor_83955705_merge_material_visibility_anim">マテリアルビジビリティアニメーションのマージ</a>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_13">
  <a name="Anchor_83955705_merge_shader_param_anim"></a>シェーダーパラメーターアニメーションのマージ</h2>
<p>マージファイルから引数ファイルへ &lt;shader_param_anim_info&gt; の一部と &lt;shader_param_mat_anim_array&gt; をコピーします。 その後、引数ファイルの &lt;shader_param_mat_anim&gt; と &lt;original_material_anim&gt; の間で同じ mat_name を持つ要素同士でアニメーションのマージを行います。</p>
<p>コピーする &lt;shader_param_anim_info&gt; のパラメーターです。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;shader_param_anim_info&gt;</td>
      <td>quantize_tolerance_tex_scale<br />quantize_tolerance_tex_rotate<br />quantize_tolerance_tex_translate</td>
    </tr>
  </tbody>
</table>
<p>マージ処理の内容は &lt;original_color_anim&gt; か &lt;original_texsrt_anim&gt; の hint と同じ original_hint を持つ &lt;param_anim&gt; を探し、見つかれば &lt;original_color_anim_target&gt; と &lt;original_texsrt_anim_target&gt; を &lt;param_anim_target&gt; にコピーします。</p>
<p>&lt;original_color_anim_target&gt; と &lt;original_texsrt_anim_target&gt; の target と &lt;param_anim_target&gt; の component_index は以下のように対応しており、対応した要素間でコピーを行います。</p>
<table class="wrapped">
  <tbody>
    <tr align="center">
      <th>&lt;original_color_anim_target&gt; の target</th>
      <th>&lt;param_anim_target&gt; の component_index</th>
    </tr>
    <tr align="center">
      <td>color_r</td>
      <td>0</td>
    </tr>
    <tr align="center">
      <td>color_g</td>
      <td>1</td>
    </tr>
    <tr align="center">
      <td>color_b</td>
      <td>2</td>
    </tr>
    <tr>
      <th>&lt;original_texsrt_anim_target&gt; の target</th>
      <th>&lt;param_anim_target&gt; の component_index</th>
    </tr>
    <tr align="center">
      <td>scale_x</td>
      <td>1</td>
    </tr>
    <tr align="center">
      <td>scale_y</td>
      <td>2</td>
    </tr>
    <tr align="center">
      <td>rotate</td>
      <td>3</td>
    </tr>
    <tr align="center">
      <td>translate_x</td>
      <td>4</td>
    </tr>
    <tr align="center">
      <td>translate_y</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>
  <br />
</p>
<p>&lt;original_color_anim_target&gt; 及び &lt;original_texsrt_anim_target&gt; と &lt;param_anim_target&gt; の有無によりコピーの動作が異なります。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <th>&lt;original_color_anim_target&gt;<br />&lt;original_texsrt_anim_target&gt;</th>
      <th>&lt;param_anim_target&gt;</th>
      <th>動作</th>
    </tr>
    <tr>
      <td align="center">有</td>
      <td align="center">有</td>
      <td>&lt;original_color_anim_target&gt; 及び &lt;original_texsrt_anim_target&gt; を &lt;param_anim_target&gt; にコピーする</td>
    </tr>
    <tr>
      <td align="center">有</td>
      <td align="center">無</td>
      <td>&lt;original_color_anim_target&gt; 及び &lt;original_texsrt_anim_target&gt; から &lt;param_anim_target&gt; を作成する</td>
    </tr>
    <tr>
      <td align="center">無</td>
      <td align="center">有</td>
      <td>&lt;param_anim_target&gt; を削除する</td>
    </tr>
  </tbody>
</table>
<p>
  <br />
</p>
<p>&lt;original_texsrt_anim_target&gt; の mode 属性からモード値を表すシェーダーパラメーターを作成します。 モード値のシェーダーパラメーターが既に存在している場合は &lt;original_texsrt_anim_target&gt; の mode 属性の値で置き換えます。 作成したモード値のパラメーターの component_index には 0 を設定します。</p>
<p>
  <br />
</p>
<p>&lt;original_color_anim_target&gt; 及び &lt;original_texsrt_anim_target&gt; から &lt;param_anim_target&gt; にコピーされる要素の一覧です。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <th colspan="2">コピー元</th>
      <th colspan="2">コピー先</th>
    </tr>
    <tr>
      <td>&lt;original_color_anim_target&gt;</td>
      <td>base_value</td>
      <td>&lt;param_anim_target&gt;</td>
      <td>base_value</td>
    </tr>
    <tr>
      <td>&lt;original_texsrt_anim_target&gt;</td>
      <td>mode</td>
      <td>&lt;param_anim_target&gt;</td>
      <td>base_value</td>
    </tr>
    <tr>
      <td>&lt;original_texsrt_anim_target&gt;</td>
      <td>base_value</td>
      <td>&lt;param_anim_target&gt;</td>
      <td>base_value</td>
    </tr>
    <tr>
      <td>&lt;original_hermite&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
      <td>&lt;hermite_curve&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;original_linear&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
      <td>&lt;linear_curve&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;original_step&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
      <td>&lt;step_curve&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
  </tbody>
</table>
<p>&lt;hermite_curve&gt;、&lt;linear_curve&gt;、&lt;step_curve&gt; の frame_type、key_type、scale、offset はコピー元にパラメーターが存在しないため、それぞれ none、none、1、0 を設定します。</p>
<p>&lt;original_hermite&gt;、&lt;original_linear&gt;、&lt;original_step&gt; をコピーする時は stream_index が参照している &lt;stream&gt; をマージファイルから引数ファイルにコピーし、&lt;hermite_curve&gt;、&lt;linear_curve&gt;、&lt;step_curve&gt; の stream_index にコピーした &lt;stream&gt; の stream_index を設定します。</p>
<h2 id="Anchor_83955705_h2_14">
  <a name="Anchor_83955705_merge_tex_pattern_anim"></a>テクスチャーパターンアニメーションのマージ</h2>
<p>マージファイルの &lt;tex_pattern_mat_anim&gt; と同じ mat_name を持つ &lt;tex_pattern_mat_anim&gt; が引数ファイルに存在している場合、&lt;tex_pattern_mat_anim&gt; をマージします。 存在していない場合は &lt;tex_pattern_mat_anim&gt; をマージファイルから引数ファイルにコピーします。</p>
<p>マージファイルの &lt;pattern_anim_target&gt; と同じ hint をもつ &lt;pattern_anim_target&gt; が引数ファイルに存在してれば、引数ファイルの &lt;pattern_anim_target&gt; を残します。</p>
<p>&lt;tex_pattern&gt; の pattern_index、&lt;tex_pattern_mat_anim&gt; の index、&lt;step_curve&gt; の stream_index、&lt;stream&gt; の stream_index は引数ファイルにコピーしたデータのインデックスに合わせて変更します。 &lt;pattern_anim_target&gt; の base_value は引数ファイルの &lt;tex_pattern&gt; の pattern_index を設定します。</p>
<p>マージファイルから引数ファイルへ &lt;pattern_anim_target&gt; をコピーしたときに、&lt;pattern_anim_target&gt; が持つ &lt;step_curve&gt; と、&lt;step_curve&gt; の stream_index が参照する &lt;stream&gt; もコピーします。 コピーした &lt;stream&gt; が参照する &lt;tex_pattern&gt; が引数ファイルに存在していなければ、マージファイルの &lt;tex_pattern&gt; を引数ファイルにコピーします。 引数ファイルにコピーした &lt;tex_pattern&gt; はマージファイル内の順番を保持します。</p>
<p>コピーした &lt;stream&gt; の内容は、引数ファイル内の &lt;tex_pattern&gt; の pattern_index に置き換えます。</p>
<p>コピーするデータの一覧です。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;tex_pattern_mat_anim&gt;</td>
      <td>mat_name</td>
    </tr>
    <tr>
      <td>&lt;pattern_anim_target&gt;</td>
      <td>sampler_name<br /> hint</td>
    </tr>
    <tr>
      <td>&lt;step_curve&gt;</td>
      <td>count<br /> frame_type<br /> key_type<br /> scale<br /> offset<br /> pre_wrap<br /> post_wrap<br /> baked</td>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>type<br /> count<br /> column</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_15">ボーンビジビリティアニメーションのマージ</h2>
<p>マージファイルの &lt;bone_vis_bone_anim&gt; と同じ bone_name を持つ &lt;bone_vis_bone_anim&gt; が引数ファイルに存在し、base_value が 1 の場合に &lt;bone_vis_bone_anim&gt; をマージします。 存在していない場合は &lt;bone_vis_bone_anim&gt; をコピーしません。</p>
<p>マージファイルから引数ファイルへ &lt;step_curve&gt; をコピーしたときに、&lt;step_curve&gt; の stream_index が参照する &lt;stream&gt; もコピーします。 &lt;step_curve&gt; の stream_index、&lt;stream&gt; の stream_index は引数ファイルにコピーした &lt;stream&gt; に合わせて変更します。</p>
<p>コピーするデータの一覧です。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;bone_vis_bone_anim&gt;</td>
      <td>binarize_visibility<br /> base_value</td>
    </tr>
    <tr>
      <td>&lt;step_curve&gt;</td>
      <td>count<br /> frame_type<br /> key_type<br /> scale<br /> offset<br /> pre_wrap<br /> post_wrap<br /> baked</td>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>type<br /> count<br /> column</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_16">
  <a name="Anchor_83955705_merge_material_visibility_anim"></a>マテリアルビジビリティアニメーションのマージ</h2>
<p>引数ファイルにない mat_name を持つ &lt;mat_vis_mat_anim&gt; をマージファイルから引数ファイルにコピーします。</p>
<p>マージファイルから引数ファイルへ &lt;step_curve&gt; をコピーしたときに、&lt;step_curve&gt; の stream_index が参照する &lt;stream&gt; もコピーします。 &lt;step_curve&gt; の stream_index、&lt;stream&gt; の stream_index は引数ファイルにコピーした &lt;stream&gt; のインデックスに合わせて変更します。</p>
<p>コピーするデータの一覧です。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;mat_vis_mat_anim&gt;</td>
      <td>mat_name<br /> base_value</td>
    </tr>
    <tr>
      <td>&lt;step_curve&gt;</td>
      <td>count<br /> frame_type<br /> key_type<br /> scale<br /> offset<br /> pre_wrap<br /> post_wrap<br /> baked</td>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>type<br /> count<br /> column</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_17">シェイプアニメーションのマージ</h2>
<p>&lt;vertex_shape_anim&gt; のマージは行いません。 &lt;user_data_array&gt;、&lt;tool_data&gt;、&lt;user_tool_data&gt;、&lt;comment&gt; のみマージします。</p>
<h2 id="Anchor_83955705_h2_18">シーンアニメーションのマージ</h2>
<p>&lt;scene_anim_info&gt; の一部と引数ファイルにない camera_name を持つ &lt;camera_anim&gt; と light_name を持つ &lt;light_anim&gt; と fog_name を持つ &lt;fog_anim&gt; をマージファイルから引数ファイルにコピーします。 camera_name、light_name、fog_name が一致するデータ間では &lt;comment&gt; のマージのみ行います。</p>
<p>マージファイルから引数ファイルへ &lt;hermite_curve&gt;、&lt;linear_curve&gt;、&lt;step_curve&gt; をコピーしたときに、カーブの stream_index が参照する &lt;stream&gt; もコピーします。 &lt;hermite_curve&gt;、&lt;linear_curve&gt;、&lt;step_curve&gt; の stream_index、&lt;stream&gt; の stream_index は引数ファイルにコピーした &lt;stream&gt; のインデックスに合わせて変更します。</p>
<p>コピーするデータの一覧です。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;scene_anim_info&gt;</td>
      <td>quantize_tolerance_rotate<br /> quantize_tolerance_translate</td>
    </tr>
    <tr>
      <td>&lt;camera_anim&gt;</td>
      <td>全要素</td>
    </tr>
    <tr>
      <td>&lt;light_anim&gt;</td>
      <td>全要素</td>
    </tr>
    <tr>
      <td>&lt;fog_anim&gt;</td>
      <td>全要素</td>
    </tr>
    <tr>
      <td>&lt;hermite_curve&gt;</td>
      <td>count<br /> frame_type<br /> key_type<br /> scale<br /> offset<br /> pre_wrap<br /> post_wrap<br /> baked</td>
    </tr>
    <tr>
      <td>&lt;linear_curve&gt;</td>
      <td>count<br /> frame_type<br /> key_type<br /> scale<br /> offset<br /> pre_wrap<br /> post_wrap<br /> baked</td>
    </tr>
    <tr>
      <td>&lt;step_curve&gt;</td>
      <td>count<br /> frame_type<br /> key_type<br /> scale<br /> offset<br /> pre_wrap<br /> post_wrap<br /> baked</td>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>type<br /> count<br /> column</td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83955705_h1_12">
  <a name="Anchor_83955705_combine"></a>統合</h1>
<p>マテリアルアニメーションファイル(fma)、シェーダーパラメーターアニメーションファイル(fsp,fcl,fts)、テクスチャーパターンアニメーションファイル(ftp)、マテリアルビジビリティアニメーションファイル(fvm) の統合に対応しています。</p>
<h2 id="Anchor_83955705_h2_19">サブオプション</h2>
<p>
  <strong>filepath1,&nbsp;filepath1...&nbsp;</strong>
</p>
<p>統合するファイルを指定します。<br />対応する中間ファイル: fma、fsp、fcl、fts、ftp、fvm</p>
<p>
  <strong>--ignore-frame-loop-unmatch</strong>
</p>
<p>統合するアニメーション同士でフレーム数やループが一致しない場合でも無視して統合します。</p>
<p>
  <strong>--ignore-animaton-conflict</strong>
</p>
<p>統合するアニメーション同士で同じマテリアルに同種のアニメーションが存在する場合でも無視して統合します。</p>
<h2 id="Anchor_83955705_h2_20">統合の共通仕様</h2>
<p>以下の説明では 3dIntermediateFileOptimizer.exe の引数に指定したファイルを &quot;引数ファイル&quot;、--combine-options&nbsp;オプションで指定したファイルを &quot;統合ファイル&quot; と呼びます。</p>
<p>引数ファイルがマテリアルアニメーション(fma)以外の場合は --output オプションが必須です。</p>
<p>&lt;user_data_array&gt;、&lt;comment&gt;、&lt;tool_data&gt;、&lt;user_tool_data&gt;、&lt;user_data_array&gt;、&lt;material_anim_info&gt; は引数ファイルの内容が出力されます。</p>
<p>引数ファイルが マテリアルアニメーション(fma)以外の場合はそれぞれの &lt;????_anim_Info&gt; から変換された&nbsp;&lt;material_anim_info&gt;&nbsp;が出力されます。<br />（量子化許容誤差などが無い場合は既定値が出力されます）</p>
<p>統合ファイルが複数指定された場合は、指定された順に引数ファイルに統合されます。</p>
<p>統合するアニメーションファイル同士で同じ mat_name を持つ &lt;per_material_anim&gt; が有る場合はひとつに統合されます。<br />また、&nbsp;&lt;per_material_anim&gt;内の&lt;shader_param_anim_array&gt;、&lt;tex_pattern_anim_array&gt; もひとつに統合されます。</p>
<p>統合するアニメーションファイル同士で同じ mat_name を持つ &lt;original_per_material_anim&gt; が有る場合はひとつに統合されます。<br />また、&nbsp;&lt;original_per_material_anim&gt;内の&lt;original_color_anim_array&gt;、&lt;original_texsrt_anim_array&gt; もひとつに統合されます。</p>
<p>統合するアニメーションファイル同士でフレーム数やループが一致しない場合はエラーになりますが、--ignore-frame-loop-unmatch<strong>&nbsp;</strong>オプションで不一致を無視することが出来ます。<br />(引数ファイルのフレーム数やループが出力されます)&nbsp;</p>
<p>また、統合するアニメーションファイル同士で同じマテリアルに同種のアニメーションが存在する場合はエラーになりますが、--ignore-animaton-conflict<strong>&nbsp;</strong>オプションで衝突を無視することが出来ます。<br />(引数ファイルまたはより最初に指定された統合ファイルのアニメーションが出力されます)&nbsp;</p>
<h2 id="Anchor_83955705_h2_21">テクスチャーパターンアニメーションの統合</h2>
<p>引数ファイルと統合ファイルにテクスチャーパターンアニメーションがそれぞれ存在する場合は、&lt;tex_pattern_array&gt;の統合が行われます。</p>
<p>統合される&lt;tex_pattern_array&gt;内に同名のファイルが指定されている場合は、一つだけ指定されるように統合されます。</p>
<p>テクスチャーパターンアニメーションは統合されたテクスチャーパターンのインデックスに合わせて修正されます。</p>
<h1 id="Anchor_83955705_h1_13">
  <a name="Anchor_83955705_delete_near_vertex_detail"></a>近似頂点削除</h1>
<p>近似頂点を削除します。 最適化後はプリミティブ最適化の結果が無効になりますので、再度 --optimize-primitive で最適化を行ってください。</p>
<h2 id="Anchor_83955705_h2_22">サブオプション</h2>
<p>
  <strong>--position &quot;&quot;</strong>
</p>
<p>位置の許容誤差を指定します。既定値は 1.0 / 4096.0 です。</p>
<p>
  <strong>--normal &quot;&quot;</strong>
</p>
<p>法線の許容誤差を角度で指定します。既定値は 0.1 です。</p>
<p>
  <strong>--tangent &quot;&quot;</strong>
</p>
<p>
  <span style="color: rgb(48,48,48);">接線</span>の許容誤差を角度で指定します。既定値は 0.1 です。</p>
<p>
  <strong>--binormal &quot;&quot;</strong>
</p>
<p>従法線の許容誤差を角度で指定します。既定値は 0.1 です。</p>
<p>
  <strong>--color &quot;&quot;</strong>
</p>
<p>頂点カラーの許容誤差を指定します。既定値は 1.0 / 255.0 です。</p>
<p>
  <strong>--uv &quot;&quot;</strong>
</p>
<p>UVの許容誤差を指定します。既定値は 1.0 / 256.0 です。</p>
<p>
  <strong>--blend-index &quot;&quot;</strong>
</p>
<p>ブレンドインデックスの許容誤差を指定します。既定値は 1.0e-7 です。</p>
<p>
  <strong>--blend-weight &quot;&quot;</strong>
</p>
<p>ブレンドウェイトの許容誤差を指定します。既定値は&nbsp;1.0e-7 です。</p>
<h2 id="Anchor_83955705_h2_23">アルゴリズム</h2>
<p>全ての頂点属性が基準より近い 2 頂点のうち 1 頂点を削除します。 削減された状態で問題がないようにインデクスの調整も行います。</p>
<p>LOD が結合された中間ファイルに対しては、ベースレベルにのみ最適化を適用します。</p>
<h1 id="Anchor_83955705_h1_14">
  <a name="Anchor_83955705_divide_submesh"></a>サブメッシュ分割</h1>
<p>サブメッシュの分割を行い、二分木を構築します。サブメッシュを分割することにより <a href="../Pages/Page_106333662.html#Anchor_106333662_view_frustum_culling">ビューフラスタムカリング</a> をより細かい単位で行うことができるようになります。最適化後はプリミティブ最適化の結果が無効になりますので、再度 --optimize-primitive で最適化を行ってください。LOD が結合された中間ファイルに対しては、LOD を削除してから最適化を行います。分割したサブメッシュはサブメッシュ結合最適化で結合できます。&nbsp;</p>
<h2 id="Anchor_83955705_h2_24">サブオプション</h2>
<p>
  <strong>--max-bounding-box-width &quot;&quot;</strong>
</p>
<p>分割されるサブメッシュのバウンディングボックスの最大サイズを指定します。<br />これより大きな三角形は除外ポリゴンとして扱われます。<br />既定値は 100.0 です。</p>
<p>
  <strong>--max-division-depth &quot;&quot;</strong>
</p>
<p>分割によって構築される二分木の最大の深さを指定します。<br />より多く分割したい場合など、--max-bounding-box-width だけでは調整できない場合に使用してください。<br />既定値は 5 です。</p>
<p>
  <strong>--min-triangle-count &quot;&quot;</strong>
</p>
<p>分割を実行する最小の三角形数を指定します。<br />細かく分割されすぎるのを防ぎたい場合など、--max-bounding-box-width だけでは調整できない場合に使用してください。<br />既定値は 1 です。</p>
<h2 id="Anchor_83955705_h2_25">アルゴリズム</h2>
<p>メッシュの種類によって複数の方法を組み合わせて空間分割を行います。 バウンディングボックスが --max-bounding-box-width&nbsp;以下になることは保証されません。</p>
<h2 id="Anchor_83955705_h2_26">結果の表示</h2>
<p>各分割ノードについて分割を試みた結果が、シェイプごとに次のように集計されます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>&nbsp;&nbsp;&nbsp;NotDivide: 0      Success: 10   LessTriangle: 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TooDeep: 2      ShortBox: 8       TooSmall: 0
NotReduction: 0   Discrepancy: 0      Exclusion: 0</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>左側に分割を試みた結果、右側にその回数を表示しています。 それぞれの用語の意味を以下に示します。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <th>用語</th>
      <th>説明</th>
    </tr>
    <tr>
      <td align="center">NotDivide</td>
      <td align="center">分割アルゴリズムに当てはまりません。</td>
    </tr>
    <tr>
      <td align="center">Success</td>
      <td align="center">分割を行いました。</td>
    </tr>
    <tr>
      <td align="center">LessTriangle</td>
      <td align="center">対象の三角形が少なすぎます。<br />--max-bounding-box-width がポリゴンに対して十分に小さい場合はこの結果のみになります。</td>
    </tr>
    <tr>
      <td align="center">TooDeep</td>
      <td align="center">分割ノードの階層が最大値を超えました。<br />この結果が多い場合は、--max-division-depth を増やすことでさらなる分割が見込めます。</td>
    </tr>
    <tr>
      <td align="center">ShortBox</td>
      <td align="center">分割ノードがすでに十分小さいです。<br />--max-bounding-box-width がポリゴンに対して十分に大きい場合はこの結果のみになります。</td>
    </tr>
    <tr>
      <td align="center">TooSmall</td>
      <td align="center">分割すると縮小しすぎてしまいます（線など）。</td>
    </tr>
    <tr>
      <td align="center">NotReduction</td>
      <td align="center">分割しても縮小しません（もとの 95% 以上の大きさ）。</td>
    </tr>
    <tr>
      <td align="center">Discrepancy</td>
      <td align="center">分割中に矛盾が生じました。</td>
    </tr>
    <tr>
      <td align="center">Exclusion</td>
      <td align="center">分割アルゴリズムが除外ポリゴンを扱えません。</td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83955705_h1_15">
  <a name="Anchor_83955705_polygon_reduction"></a>ポリゴンリダクション</h1>
<p>ベースモデルから LOD モデルを自動生成します。--polygon-reduction-options を指定する必要があります。</p>
<p>ポリゴンリダクションのアルゴリズム詳細については、3D 機能説明の<a href="../Pages/Page_162186377.html">ポリゴンリダクション</a>をご覧ください。</p>
<p>対応する中間ファイル: fmd</p>
<p>近似頂点削除・サブメッシュ分割最適化を行う場合は、先にそれらの最適化を行ってからポリゴンリダクションを行ってください。</p>
<h2 id="Anchor_83955705_h2_27">注意事項：簡略化しないケースについて</h2>
<p>Shape 内に非多様体メッシュが存在する場合、--disable-merge-shape を指定していない時に、fmd 内に重複したポリゴンが存在して非多様体が生成される場合など、簡略化は行わない場合があります。</p>
<p>その場合は、実行時出力メッセージに警告を出しています。</p>
<h2 id="Anchor_83955705_h2_28">指定方法:</h2>
<p>--polygon-reduction --polygon-reduction-options &quot;--target-rate-lod-level1 &lt;arg&gt; [--target-rate-lod-level2 &lt;arg&gt;] ... [--target-rate-lod-level9 &lt;arg&gt;]&nbsp;[--target-rate&nbsp;&lt;arg&gt;]&nbsp;[-q &lt;arg&gt;] [--property-flag &lt;arg&gt;] [--lock-open-edge-angle &lt;arg&gt;] [--feature-face-angle &lt;arg&gt;] [--lock-uv-hard-edge-angle &lt;arg&gt;] [--optimize-position-policy &lt;arg&gt;] [--smoothing] [&ndash;policy&nbsp;&lt;arg&gt;] [--distance-offset &lt;arg&gt;] [--uv-weight &lt;arg&gt;] [--anim-blend-weight &lt;arg&gt;] [--disable-merge-shape]&quot;</p>
<h2 id="Anchor_83955705_h2_29">サブオプション</h2>
<h3 id="Anchor_83955705_h3_4">引数ファイルの指定</h3>
<p>
  <strong>--args-file &quot;&quot;</strong>
</p>
<p>ポリゴンリダクションの引数を指定するための引数ファイルを指定します。<br />引数ファイルに記述した内容を、引数として指定できます。&nbsp;<br />引数ファイルは複数行に渡って各オプションを記述できます。&nbsp;<br />行頭に # がある行はコメントとして扱います。&nbsp;<br />オプション値指定の &quot;&quot; によるエスケープに改行を含めることはできません。</p>
<h4 id="Anchor_83955705_h4_1">オプションのプリセット</h4>
<p>--args-file オプションに以下のファイルを指定することで、既定のプリセットを利用することができます。</p>
<p>%NINTENDO_SDK_ROOT%\Tools\Graphics\3dTools\Presets\PolygonReduction</p>
<table class="wrapped">
  <tbody>
    <tr>
      <th>ファイル名</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>CommonSet.txt</td>
      <td>汎用的な設定のプリセットです。</td>
    </tr>
    <tr>
      <td>NatureMajorSet.txt</td>
      <td>滑らかな形状が多いモデルに特化した設定のプリセットです。</td>
    </tr>
    <tr>
      <td>BuildingsMajorSet.txt</td>
      <td>角ばった形状が多いモデルに特化した設定のプリセットです。</td>
    </tr>
  </tbody>
</table>
<p>利用例</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe Input.fmdb --polygon-reduction --polygon-reduction-options &quot;--target-rate-lod-level1 0.5 --args-file Presets/PolygonReduction/CommonSet.txt&quot;</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h3 id="Anchor_83955705_h3_5">形状簡略化率の設定</h3>
<p>
  <strong>--target-rate-lod-level1 &lt;arg&gt; ~ --target-rate-lod-level9 &lt;arg&gt;</strong>
</p>
<p>(# は レベルを表す 1 以上 9 以下の整数)<br />元のモデルに対する削減後のポリゴン数の割合を指定します。たとえば 10000 ポリゴンの元モデルに対して 0.2 を指定した場合、2000 ポリゴンのモデルを目標にリダクションを行います。<br />削減ポリゴン数はその他のパラメーターとの兼ね合いがあるため、必ずしも指定ポリゴン数に達するわけではありません。<br />最小値:0.0 最大値:1.0</p>
<p>
  <strong>--target-rate &lt;arg&gt;</strong>
</p>
<p>--target-rate-lod-level1 &lt;arg&gt; ~&nbsp;--target-rate-lod-level9 &lt;arg&gt; の省略記法です。</p>
<p>--target-rate &quot;0.75 0.5 0.25&quot; のようにレベル 1 からレベル 9 までの形状簡略化率を順番に指定することができます。</p>
<p>
  <strong>--target-rate-per-shapes &lt;arg&gt;</strong>
</p>
<p>元のモデルに対する削減後のポリゴン数の割合の下限をシェイプ毎に指定します。</p>
<p>--target-rate-per-shapes &quot;shapeA:0.8, shapeB:0.6, shapeC:0.5&quot; のように「シェイプ名:割合」の形式で指定します。カンマ区切りで複数のシェイプに対して指定することができます。</p>
<p>特定のシェイプの形状がリダクション後に崩れてしまう場合などに、このオプションで下限を設定することで形状破綻を防ぐことができます。</p>
<p>
  <strong>-q, --quality &lt;arg&gt;</strong>
</p>
<p>縮退可能なエッジのコストを設定します。初期コストの最大値に対する削除可能なエッジのコストの比率を指定します。<br />たとえば 0.1 を指定した場合、最大値の 10% までのコストのエッジを削除可能なエッジとして扱います。<br />最小値:0.0 最大値:1.0 既定値:0.99</p>
<h3 id="Anchor_83955705_h3_6">考慮するプロパティの設定</h3>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-property"></a>--property-flag &lt;arg&gt;</strong>
</p>
<p>リダクション時に考慮するプロパティを指定するパラメーターです。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <th>値</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>Position</td>
      <td>頂点位置を考慮する</td>
    </tr>
    <tr>
      <td>Normal</td>
      <td>頂点法線を考慮する</td>
    </tr>
    <tr>
      <td>UV</td>
      <td>UV 座標（テクスチャー座標）を考慮する</td>
    </tr>
    <tr>
      <td>BlendWeight</td>
      <td>モーションを考慮する</td>
    </tr>
    <tr>
      <td>All</td>
      <td>すべてを考慮する</td>
    </tr>
  </tbody>
</table>
<p>リダクション時に考慮するプロパティを指定します。上記の文字列を組み合わせるか、それぞれ別個に設定する事で追加します。</p>
<p>具体的には、</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>--property-flag Position|Normal</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>の様に、&quot;|&quot;記号で繋ぎ合わせるか、</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>--property-flag Position --property-flag Normal</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>の様に複数回記述することで設定します。</p>
<p>既定値:Position|UV</p>
<h3 id="Anchor_83955705_h3_7">境界エッジ、特徴的エッジの設定</h3>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-open-edge"></a>--lock-open-edge-angle &lt;arg&gt;</strong>
</p>
<p>オープンエッジ(エッジの片側にしか面が存在しない外側に接したエッジ)を削除する際に、オープンエッジ同士の連結をみて、エッジ間のなす角度によって、オープンエッジの縮退を抑制するパラメータです。指定された劣角以下のエッジを保護します。180度で全てのエッジが保護対象となります。</p>
<p>最小:0.0 最大:180.0 既定値:0.0</p>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-uv-hard-edge"></a>--lock-uv-hard-edge-angle &lt;arg&gt;</strong>
</p>
<p>UV ハードエッジが縮退可能な条件を、連続した UV ハードエッジ同士の最大角度で設定します。指定された劣角以下のエッジを保護します。180度で全てのエッジが保護対象となります。--property-flag に UV 座標を追加してご利用ください。</p>
<p>最小:0.0 最大:180.0 既定値:0.0</p>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-feature-angle"></a>--feature-face-angle &lt;arg&gt;</strong>
</p>
<p>エッジの両翼の面が為す角度によって、エッジが特徴的なエッジであるかどうかを指定します。指定された劣角以下の特徴的エッジを保護します。180度で全てのエッジが保護対象となります。</p>
<p>絶対的な保護ではないので、全ての頂点は重みがかかった状態で簡略化の対象となります。</p>
<p>最小:0.0 最大:180.0 既定値:0.0</p>
<h2 id="Anchor_83955705_h2_30">リダクションの計算方法に関する設定</h2>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-opt-policy"></a>--optimize-position-policy &lt;arg&gt;</strong>
</p>
<p>削減後の位置計算オプションです。エッジの縮退を行う際に、新しい位置座標をどのような方法で計算するかを指定します。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>値</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>SharedPosition</td>
      <td>いずれかの頂点を使用し、ベースモデルとの頂点共有を行います。<p>サブメッシュ境界も動かすことなく保護するため、ベースメッシュとの共有を容易にしますが、一方で簡略化のレベルが大きく下がります。</p></td>
    </tr>
    <tr>
      <td>OptimalOnEdge</td>
      <td>エッジ上で最も最適な位置を求めて使用します。縮退対象のエッジ上のどこかを新頂点位置とするため、形状崩壊が起こりにくく、形状によらず無難な設定です。<p>機械や建物のような角ばった形状に適しています。</p></td>
    </tr>
    <tr>
      <td>OptimalOnSpace</td>
      <td>縮退後の位置を計算し、空間中で最適な位置を求めます。<p>動物や人間など滑らかな形状に適しています。</p></td>
    </tr>
    <tr>
      <td>OptimalOnFace</td>
      <td>エッジを共有する 2 面上の任意の点のどこかを縮退後の位置にします。計算時間が最もかかります。</td>
    </tr>
  </tbody>
</table>
<pre>  ポリゴン削減率は、高い順に、OptimalOnSpace &gt;= OptimalOnEdge &gt;= OptimalOnFace &gt; SharedPosition です。<br />  処理時間は、早い順に OptimalOnSpace &gt;= OptimalOnEdge &gt; SharedPosition &nbsp;&gt; OptimalOnFace です。 <br />  SharedPosition時は、頂点共有処理に多くの処理時間を必要とします。</pre>
<p>既定値:OptimalOnEdge</p>
<p>
  <strong>--smoothing</strong>
</p>
<p>全体的に平滑化するような計算を行うかどうかを指定します。<br />建物など特徴がはっきりした形状でより効果的に機能します。動物や人間など滑らかな形状では、特徴的な形状が損なわれる場合があります。</p>
<p>
  <strong>--policy &lt;arg&gt;</strong>
</p>
<p>削減時の重み付けの戦略を指定するパラメーターです。細いポリゴンが作られるのを回避する等、特に必要がある場合にご利用ください。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>値</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>AreaBased</td>
      <td>面積を重視します。すべてのポリゴンが等面積になることを重視するように、面積による重み付けが行われます。</td>
    </tr>
    <tr>
      <td>AngleBased</td>
      <td>形状を重視します。すべてのポリゴンが正三角形になることがもっとも良い結果となるように重み付けが行われます。</td>
    </tr>
    <tr>
      <td>AreaAngleBased</td>
      <td>面積と形状の双方に重みが付きます。</td>
    </tr>
  </tbody>
</table>
<p>既定値:重みなし</p>
<p>
  <strong>--distance-offset &quot;&quot;</strong>
</p>
<p>距離のオフセットです。<br />縮退によって、新頂点位置と平面との距離が変動しない無限床のようなオブジェクトの場合に、オフセットを加える事で面積変動による評価を行えるようにします。<br />設定する値は、例えば 0.0001 などの小さな値で十分です。<br />型:Double 最小値:0 最大値:DoubleMax 既定値:0</p>
<h3 id="Anchor_83955705_h3_8">コスト計算時のウェイトの設定</h3>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-uv-weight"></a>--uv-weight &quot;&quot;</strong>
</p>
<p>UV に対する評価割合(%)です。0.0でUVを考慮せず、1.0でUVのみを100%考慮した簡略化を行います。UV をより強く考慮してリダクションする場合は、より大きな値を設定します。<br />UV の影響が大きい場合には小さな値を設定して影響を弱めます。--property-flag に UV 座標を追加してご利用ください。<br />最小:0, 最大:1.0, 既定値:0.05</p>
<p>
  <br />
</p>
<p>
  <strong>--normal-weight &quot;&quot;</strong>
</p>
<p>頂点法線に対する重みです。0.0を指定した場合、normalを考慮しない事と同義になります。0.0以上の値を設定して下さい。<br />頂点法線に対する重みが強い場合、より角が保護されるような効果がでます。<br />最小:0 最大：DoubleMax 既定値:1.0</p>
<p>
  <br />
</p>
<p>
  <strong>--anim-blend-weight &quot;&quot;</strong>
</p>
<p>Animation Blend Weight に応じた頂点重みを計算する場合の基数です。<br />pow(設定値, 計算値) で与えられる重みを計算します。</p>
<p>1 より大きな数では平均的にブレンドウェイトが割り当てられてる場合を重く、1 より小さな数ではブレンドウェイトが少ない場合を重く考慮します。</p>
<p>--property-flag に BlendWeight&nbsp;を追加してご利用下さい。<br />型:Double, 最小:0, 最大:e(ネイピア数), 既定値:1.0</p>
<h3 id="Anchor_83955705_h3_9">その他の設定</h3>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-merge-shape"></a>--disable-merge-shape</strong>
</p>
<p>ファイル内のシェイプを結合せずに、リダクションを行います。<br />指定しない場合は、シェイプを結合してからリダクションを行い、リダクション後にシェイプを分離します。<br />既定値:無効</p>
<p>
  <strong>--exclude-shapes &quot;&quot;</strong>
</p>
<p>指定したシェイプをリダクション処理の対象外とします。</p>
<p>ワイルドカードとクエスチョンを使って、それぞれ任意の文字列と、任意の 1 文字を指定する事が出来ます。複数のシェイプ名を指定する場合は、カンマ区切りか、オプションを複数回使って指定します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>--exclude-shapes *_Wall_?_*</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_31">パラメーター設定例</h2>
<p>
  <strong>--polygon-reduction --polygon-reduction-options &quot;--target-rate-lod-level1 0.5 --target-rate-lod-level2 0.25 --property-flag 7 --optimize-position-policy 2&nbsp;--open-edge-lock-angle 30&nbsp;--lock-uv-hard-edge 30 --uv-weight 0.0&quot;</strong>
</p>
<p>頂点、UV、法線を考慮 (--property-flag=7) し、レベル 1 で 50% (--target-rate-lod-level1=0.5)、レベル 2 で 25% (--target-rate-lod-level2=0.25) の LOD を作成しています。<br />ベースレベルとの頂点共有は行わず、メモリよりも品質を重視しています (--optimize-position-policy=2)。<br />オープンエッジの保護 (--open-edge-lock-angle=30) と UV ハードエッジの保護 (--lock-uv-hard-edge=30) を行っています。<br />形状が UV に引っ張られないよう、UV の重みを 0 にしてコスト計算から除外しています (--uv-weight=0.0)。</p>
<h1 id="Anchor_83955705_h1_16">
  <a name="Anchor_83955705_unite_lod_model"></a>LOD モデル結合</h1>
<p>LOD モデルをベースモデルに結合します。 すでに LOD レベルをもっている場合、指定したレベルを差し替えることもできます。 最適化後はプリミティブ最適化と量子化分析の結果が無効になりますので、再度 --optimize-primitive --quantization-analysis で最適化を行ってください。</p>
<p>近似頂点削除最適化を行う場合は、先に最適化を行ってから LOD モデルの結合を行ってください。</p>
<h2 id="Anchor_83955705_h2_32">サブオプション</h2>
<p>
  <strong>--lod-level# &quot;&quot;</strong>
</p>
<p>（# は LOD レベルを表す 1 以上 9 以下の整数）</p>
<p>結合する LOD モデルを指定します。<br />途中のレベルが空くように指定することはできません。<br />対応する中間ファイル: fmd</p>
<h2 id="Anchor_83955705_h2_33">
  <a name="Anchor_83955705_unite_lod_model_limitation"></a>制約</h2>
<p>結合する LOD モデルには以下の制約があります。</p>
<ul>
  <li>ベースモデルと LOD モデルの間で、以下のものが一致している必要があります。<ul><li>スケルトン構造</li><li>スキニングのバインドポーズ</li><li>メッシュの数</li><li>マテリアルの数</li><li>メッシュとマテリアルの対応</li></ul></li>
  <li>すべてのメッシュは 1 つ以上のプリミティブを持つ必要があります。</li>
  <li>ベースモデルでスキニングのウェイトが付けられていないボーンに対して LOD モデルでウェイトを付けることはできません。</li>
  <li>ベースモデルにおいてリジッドスキニングでしか使用していなかったボーンを LOD モデルにおいてスムーズスキニングで使用することはできません。</li>
</ul>
<h1 id="Anchor_83955705_h1_17">
  <a name="Anchor_83955705_optimize_primitive_detail"></a>プリミティブ最適化</h1>
<p>インデックスストリームや頂点ストリームの順序を入れ替えることで効率的な描画順にします。</p>
<h2 id="Anchor_83955705_h2_34">サブオプション</h2>
<p>
  <strong>--mode &quot;&quot;</strong>
</p>
<p>オプション値に &quot;Normal&quot; を指定すると、通常の最適化をします。<br />オプション値に &quot;Force&quot; を指定すると、時間を掛けて最適化します。<br />オプション値に &quot;BruteForce&quot; を指定すると、より長い時間を掛けて最適化します。<br />オプション値に &quot;Forsyth&quot; を指定すると、<a href="http://tomforsyth1000.github.io/papers/fast_vert_cache_opt.html"><u>http://tomforsyth1000.github.io/papers/fast_vert_cache_opt.html</u></a>&nbsp;で解説されるアルゴリズムで最適化します。<br />指定がない場合は Forsyth で最適化をします。&nbsp;<a href="../Pages/Page_95696747.html">プラットフォーム固有の情報</a>&nbsp;も合わせてご覧ください。</p>
<h2 id="Anchor_83955705_h2_35">アルゴリズム</h2>
<p>頂点キャッシュ率をできるだけ高くするようにインデックスストリームを並び替えます。<br />さらに、インデックスで参照される順に頂点ストリームの順序を並び替えます。</p>
<p>Normal Force BruteForce のアルゴリズムは包含関係にあり、以下の関係が成り立ちます。</p>
<p>Normal &lt; Force &lt; BruteForce</p>
<p>上位のアルゴリズムのほうがより時間をかけて最適化を行うことになります。これらのアルゴリズムで一度プリミティブ最適化をしたデータは、同等以下の最適化を再度実行しても最適化を行いません。例えば、Force で最適化されているデータに対して Normal で最適化を実行した場合などです。最適化をもう一度行いたい場合は、&nbsp;<a href="file:///D:/NDI/NXAddon1.3.0-0209/NintendoSDK/Documents/Package/contents/Pages/Page_83955970.html#Anchor_83955970_remove_cache"><u>プリミティブ最適化キャッシュの削除 (RemoveOptimizePrimitiveCache)</u></a>&nbsp;を利用してください。但し、 Forsyth はこの限りではありません。</p>
<p>また最適化を実行した場合でも最適化度合いが改善しなければ、データが更新されることはありません。最適化度合いは各アルゴリズム適用後のインデックスストリームを評価し、算出された処理頂点数によって決定されます。処理頂点数はインデックスストリームを以下のように評価し、求めています。</p>
<p>まず以下の条件に達するまでインデックスストリームを走査します。</p>
<ul>
  <li>ユニークなトライアングルプリミティブが 32 個現れる もしくは ユニークな頂点が 32 個現れる</li>
</ul>
<p>条件が満たされたときに現れているユニークな頂点数が処理頂点数として加算されます。加算した後、ユニークなトライアングルプリミティブ数およびユニークな頂点数をクリアし、繰り返しこの操作をインデックスストリームが空になるまで行い、処理頂点数を算出します。</p>
<h1 id="Anchor_83955705_h1_18">量子化分析</h1>
<p>頂点およびアニメーションの量子化を閾値を用いて判定します。</p>
<p>量子化設定を削除するには中間ファイルフィルタのサンプルにある&nbsp;<a href="../Pages/Page_83955970.html#Anchor_83955970_remove_quantize">量子化設定の削除 (RemoveQuantizeType) </a>を利用します。</p>
<h2 id="Anchor_83955705_h2_36">アルゴリズム</h2>
<p>各シェイプに対して、できるだけ頂点、アニメーションのサイズが小さくなるような量子化フォーマットで量子化を行います。DCC ツール上で元々同じシェイプだったシェイプ間では量子化精度は維持されます。</p>
<p>具体的なアルゴリズムについては&nbsp;<a href="../Pages/Page_106333848.html">量子化</a>&nbsp;を参照してください。</p>
<pre style="margin-top: 10.0px;">&nbsp;</pre>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
