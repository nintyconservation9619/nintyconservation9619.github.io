<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>TimerEvent クラス</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- TimerEvent クラス -->
<div class="pagetitle" id="PageId_83955563">TimerEvent クラス</div>
<div class="text_separate">
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_83955563_h1_1">TimerEvent クラス</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955563_h2_1">機能概要</a>
      </li>
      <li>
        <a href="#Anchor_83955563_h2_2">TimerEvent クラスの使用例</a>
      </li>
    </ul>
  </ul>
</p>
<h1 id="Anchor_83955563_h1_1">TimerEvent クラス</h1>
<h2 id="Anchor_83955563_h2_1">機能概要</h2>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html">TimerEvent</a> クラスは、1bit （二値）のシグナル状態／非シグナル状態によって<a href="../Pages/Page_83955697.html">スレッド</a>間で同期を行なうための機能です。通常の <a href="../Pages/Page_83955790.html">イベント</a> 機能に加え、指定した時間だけ遅延してシグナル化させることの出来るタイマー機能を備えています。ただし、タイムアウト付きの待機機能はありません。</p>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html">TimerEvent</a> クラスは、<a href="../../../Api/HtmlNX/structnn_1_1os_1_1_timer_event_type.html">nn::os::TimerEventType</a> オブジェクトを利用した <a href="../Pages/Page_83955551.html">タイマーイベント機能</a> をラッピングしたもので以下のメンバ関数を持ちます。API リファレンスはリンク先を参照して下さい。</p>
<table class="table">
  <tbody>
    <tr>
      <th>名前</th>
      <th>説明</th>
      <th>備考</th>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#ad5d6d8c4e3bef220c55441bfb842d198">TimerEvent</a>
      </td>
      <td>コンストラクタ</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a9fdcd9b26aa9e78c2c17f6b9c02c0314">InitializeTimerEvent()</a> 同等の初期化を実行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#aeaf9ce5eced3024b85365d4b280c67d9">~TimerEvent</a>
      </td>
      <td>デストラクタ</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a1752ba511e60ce027c4af0f6d5e3ebe9">FinalizeTimerEvent()</a> 同等の破棄を実行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#a90a8fc5db0ea071aa0fa831ecff9cc2a">StartOneShot</a>
      </td>
      <td>ワンショットタイマーの開始</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a9b3ec8d6c3a7f4410dc6f9c4dec0f88d">StartOneShotTimerEvent()</a> 同等のワンショットタイマー開始</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#a3e7e119cd429e560d5fe84414eecb2d2">StartPeriodic</a>
      </td>
      <td>周期タイマーの開始</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ac869e53e9d805c3a5781d6493fad6ccd">StartPeriodicTimerEvent()</a> 同等の周期タイマー開始</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#ace2fda7f4a66f89b0e4f70757d7df73e">Stop</a>
      </td>
      <td>タイマーの停止</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a6aa23680b72e19fd5cb974ef44325695">StopTimerEvent()</a> 同等のタイマー停止</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#a84d0c5f4269cad8e8e0852d75bd781d7">Wait</a>
      </td>
      <td>タイマーイベントの待機</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a3bdecafeed401cb6b8accdb15178ad66">WaitTimerEvent()</a> 同等のタイマーイベントの待機</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#a13a68b687460a2c9c82c166c7f5cda26">TryWait</a>
      </td>
      <td>タイマーイベントのポーリング</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#aa431fe82cc23064bbad8cacf102756fd">TryWaitTimerEvent()</a> 同等のタイマーイベントのポーリング</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#a8319b2626e9beef85db5eaaa8757740c">Signal</a>
      </td>
      <td>タイマーイベントのシグナル化</td>
      <td>
        <p>
          <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ad526c59d6481d5fcf0e130d71c7f1252">SignalTimerEvent()</a> 同等のタイマーイベントのシグナル化</p>
      </td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#a7d9f46823aebd9226e84f9bdd06232ab">Clear</a>
      </td>
      <td>タイマーイベントの非シグナル化</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a2612c1c11f55172e23bf13d0b8a4e5b2">ClearTimerEvent()</a> 同等のタイマーイベントの非シグナル化</td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h2 id="Anchor_83955563_h2_2">TimerEvent クラスの使用例</h2>
<p>ここでは例として、<a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html">TimerEvent</a> クラスを使った簡単なアラームハンドラの実装します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="cp">#include &lt;nn/os.h&gt;
</span>
<span class="nn">nn::os::</span><span class="n">TimerEvent</span> <span class="n">g_SimpleAlarm</span><span class="p">(</span><span class="nn">nn::os::</span><span class="n">EventClearMode_AutoClear</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">SimplAlarmThread</span><span class="p">()</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;;)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">g_SimpleAlarm</span><span class="p">.</span><span class="n">Wait</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">CallbackFunction</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">MainThread</span><span class="p">()</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">:</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// 必要なタイミングでアラームを起動する（500msec）
</span> &nbsp; &nbsp;<span class="n">g_SimpleAlarm</span><span class="p">.</span><span class="n">StartOneShot</span><span class="p">(</span><span class="nn">nn::TimeSpan::</span><span class="n">FromMilliSeconds</span><span class="p">(</span><span class="mi">500</span><span class="p">));</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">:</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// 必要なタイミングでアラームを停止する
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">g_SimpleAlarm</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">:</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>上記のサンプルは g_SimpleAlarm インスタンスのシグナル状態を待機してコールバック関数を呼び出すアラーム機能のサンプルです。コールバック関数を呼ぶための関数として SimpleAlarmThread() を用意していますので、ワーカースレッドを１つ用意し、そこから SimpleAlarmThread() 関数を呼び出す形で使用します。</p>
<p>一方、MainThread() 関数では上記 g_SimpleAlarm インスタンスに対してタイマーの動作開始と停止を行ないます。<a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#a90a8fc5db0ea071aa0fa831ecff9cc2a">StartOneShot()</a> 関数を呼び出すと指定した時間（上記の場合は 500msec）経過後に g_SimpleAlarm がシグナル状態に変化するため、それを待機している SimpleAlarmThread() 関数の Wait() が解除され、CallbackFunction() を呼出すことになります。</p>
<p>タイマー動作中は何度でも <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#a90a8fc5db0ea071aa0fa831ecff9cc2a">StartOneShot()</a> を呼出すことが出来ます。これにより、g_SimpleAlarm のシグナル化時間が更新されるため、ウォッチドッグのような使い方も出来ます。また、<a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#a3e7e119cd429e560d5fe84414eecb2d2">StartPeriodic()</a> 関数を使えば、周期ハンドラとして CallbackFunction() が呼び出されるような使い方も可能です。</p>
<p>タイマー動作を停止したい場合は、<a href="../../../Api/HtmlNX/classnn_1_1os_1_1_timer_event.html#ace2fda7f4a66f89b0e4f70757d7df73e">Stop()</a> 関数を呼び出して下さい。</p>
<p>&nbsp;</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
