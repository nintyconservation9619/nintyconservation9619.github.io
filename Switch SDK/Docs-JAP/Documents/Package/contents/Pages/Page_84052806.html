<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>シェーダーアノテーション</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- シェーダーアノテーション -->
<div class="pagetitle" id="PageId_84052806">シェーダーアノテーション</div>
<div class="text_separate">
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_84052806_h1_1">概要</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_2">全般</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_84052806_h2_1">記法</a>
      </li>
      <li>
        <a href="#Anchor_84052806_h2_2">id</a>
      </li>
      <li>
        <a href="#Anchor_84052806_h2_3">hint</a>
      </li>
      <li>
        <a href="#Anchor_84052806_h2_4">アノテーションの遠隔指定</a>
      </li>
      <li>
        <a href="#Anchor_84052806_h2_5">choice 記法</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_84052806_h1_3">オプション変数</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_4">頂点属性変数</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_5">サンプラー変数</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_6">ユニフォームブロック</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_7">ユニフォーム変数</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_84052806_h2_6">ユニフォーム変数のカスタマイズ</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_84052806_h1_8">シェーダーストレージブロック</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_9">バッファー変数</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_10">描画情報</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_11">テキストブロック</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_12">頂点インターリーブ</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_13">グループ</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_14">ページ</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_15">リビジョン</a>
    </li>
    <li>
      <a href="#Anchor_84052806_h1_16">ラベル属性</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_84052806_h2_7">ラベル色</a>
      </li>
      <li>
        <a href="#Anchor_84052806_h2_8">ラベル参照</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_84052806_h1_17">制限事項</a>
    </li>
  </ul>
</p>
<h1 id="Anchor_84052806_h1_1">概要</h1>
<p>g3d のシェーダーシステムでは、コメント形式のアノテーションによってツールやランタイムで使用する情報を制御します。そのため、アノテーションさえ付加すれば任意のシェーダーオーサリングツールでシェーダーを編集することができます。</p>
<p>3D シェーダーコンバータ (3dShaderConverter) は、シェーダーアノテーションを記述したシェーダーソースとシェーダー設定ファイル (*.fsca, *.fscb) からシェーダー定義ファイル (*.fsda, *fsdb) を生成します。</p>
<h1 id="Anchor_84052806_h1_2">全般</h1>
<p>以下に、アノテーションの種類ごとの詳細を説明します。個々の取り得る値については<a href="../IntermediateFileFormat/Html/3d/3dIntermediateFileFormat.html">中間ファイル仕様書</a>のシェーダー定義ファイル (fsd) における対応要素の説明を参照してください。また、デモで使用しているシェーダーのソースでもアノテーションを使用しているので、そちらも合わせて参照してください。</p>
<h2 id="Anchor_84052806_h2_1">記法</h2>
<p>シェーダーアノテーションは &quot;@@&quot; から始まる C スタイルコメントもしくは C++ スタイルコメントで記述します。</p>
<p>C スタイルコメントは id から次の id またはコメント終端までが 1 つのアノテーションとして識別されます。C スタイルコメントの先頭にグループ名とコロンを記述することで、C スタイルコメント全体にグループを指定することができます。変数の後のアノテーションでは C スタイルコメント形式は使用できません。</p>
<p>遠隔指定でアノテーションを記述する場合は行頭からコメントを始める必要があります。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="cp">#define OPTION </span><span class="c1">// @@ id=&quot;option&quot; choice=&quot;bool&quot;
</span>&nbsp;
<span class="n">in</span> <span class="n">vec3</span> <span class="n">pos</span><span class="p">;</span> <span class="c1">// @@ id=&quot;position&quot;
</span><span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">albedoTex</span><span class="p">;</span> <span class="c1">// @@ id=&quot;albedo&quot;
</span>&nbsp;
<span class="n">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">)</span> <span class="n">uniform</span> <span class="n">Material</span> <span class="c1">// @@ id=&quot;mat&quot; type=&quot;material&quot;
</span><span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">texsrt</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// @@ id=&quot;texsrt&quot; type=&quot;texsrt&quot;
</span><span class="p">};</span>
&nbsp;
<span class="c1">// @@ option_id=&quot;option&quot; label=&quot;Option&quot;
</span>&nbsp;
<span class="cm">/* @@ groupA:
&nbsp;&nbsp;&nbsp;&nbsp;attrib_id=&quot;position&quot; label=&quot;Position&quot;
&nbsp;&nbsp;&nbsp;&nbsp;sampler_id=&quot;albedoTex&quot; label=&quot;Albedo Texture&quot;
*/</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>
  <br />各アノテーションとアノテーション値の関係は「=」で記述します。「=」の前後にスペース等を入れることは出来ません。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="c1">// OK
</span><span class="cp">#define OPTION </span><span class="c1">// @@ id=&quot;option&quot; choice=&quot;bool&quot;
</span>

<span class="c1">// NG
</span><span class="cp">#define OPTION </span><span class="c1">// @@ id = &quot;option&quot; choice =&quot;bool&quot;
</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_84052806_h2_2">id</h2>
<p>g3d のシェーダーシステムでは、OpenGL のようにシェーダー内の変数名でシンボルにアクセスするのではなく、専用の識別子を用いてシンボルにアクセスします。この識別子となる文字列を id と呼んでいます。変数名はコーディング規約の影響を受けたり、シェーダープログラムの実装の都合によって変更されることも考えられますが、id を用いることで変更の影響を最小限に留めることができます。</p>
<p>id はプログラムからシェーダーのシンボルを取得するのに使用する他、モデルとシェーダーの関連付けにも使用されます。また、シェーダーソース内では、変数と別の行にアノテーションを書く際に、対象の変数を識別するために id を使用します。詳しくは後述の「アノテーションの遠隔指定」を参照してください。</p>
<h2 id="Anchor_84052806_h2_3">hint</h2>
<p>ヒント情報は、3DEditor などでモデルにシェーダーを割り当てる際、頂点属性やサンプラーの初回割り当てを自動化するために使用する事ができます。シェーダーに対してヒント情報を記述しておくと、モデルに対してシェーダーを割り当てた際に、モデル内でヒント情報の一致する頂点属性やサンプラーに対して、シェーダーの頂点属性やサンプラーが割り当てられます。自動割り当て後に手動で割り当てを変更することも可能です。</p>
<h2 id="Anchor_84052806_h2_4">アノテーションの遠隔指定</h2>
<p>ブロック内を除く変数の直後以外の場所にアノテーションを記述することも可能です。対象となる変数の直後に id を記述した上で、遠隔指定のアノテーションからはその id を指定します。使用可能な id は次の通りです。行頭からコメントを始める必要があります。行頭には必ず *_id を記述します。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>名前</th>
      <th>シェーダー定義ファイルにおける対応要素</th>
      <th>省略時の扱い</th>
      <th>説明</th>
    </tr>
    <tr>
      <td style="text-align: right;">option_id</td>
      <td style="text-align: center;">&lt;option_var&gt;</td>
      <td style="text-align: center;">省略不可</td>
      <td>オプション変数の識別子です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">attrib_id</td>
      <td style="text-align: center;">&lt;attrib_var&gt;</td>
      <td style="text-align: center;">省略不可</td>
      <td>頂点属性変数の識別子です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">sampler_id</td>
      <td style="text-align: center;">&lt;sampler_var&gt;</td>
      <td style="text-align: center;">省略不可</td>
      <td>サンプラー変数の識別子です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">block_id</td>
      <td style="text-align: center;">&lt;block_var&gt;</td>
      <td style="text-align: center;">省略不可</td>
      <td>ユニフォームブロックの識別子です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">uniform_id</td>
      <td style="text-align: center;">&lt;uniform_var&gt;</td>
      <td style="text-align: center;">省略不可</td>
      <td>ユニフォーム変数の識別子です。</td>
    </tr>
  </tbody>
</table>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>  <span class="n">in</span> <span class="n">vec4</span>   <span class="n">i_Position</span><span class="p">;</span>     <span class="c1">// @@ id=&quot;_p0&quot;   hint=&quot;position0&quot;
</span>
<span class="cm">/* @@
&nbsp;&nbsp;&nbsp;&nbsp;attrib_id=&quot;_p0&quot;   label=&quot;位置座標&quot; editable=&quot;false&quot;
*/</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_84052806_h2_5">choice 記法</h2>
<p>オプション変数や描画情報にある choice アノテーションは、範囲で記述する方法と、リストで記述する方法があります。</p>
<p>範囲で記述する場合は、choice=&quot;[0, 4]&quot; のように最小値と最大値を数値で指定します。リストで記述する場合は、choice=&quot;add, sub, mul, div&quot; のように文字列を列挙します。このとき、choice=&quot;add:加算, sub:減算&quot; のように、それぞれの要素について UI ラベルを指定することができます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="c1">// @@ renderinfo=&quot;culling&quot; type=&quot;int&quot; default=&quot;0&quot; choice=&quot;0:表面を表示,1:裏面を表示,2:両面を表示,3:表示しない&quot; order=&quot;1&quot; label=&quot;カリングモード&quot;
</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>
  <a name="Anchor_84052806_optionvalue"></a>
</p>
<h1 id="Anchor_84052806_h1_3">オプション変数</h1>
<p>オプション変数は、シェーダーバリエーションを生成するキーとなるプリプロセッサ変数です。シェーダー設定ファイル (fsc) でシェーダーバリエーションを制御する際は、オプション変数に指定した id によって対象を識別します。</p>
<p>オプション変数に使用可能なアノテーションは次の通りです。</p>
<div class="section">
  <p>
    <br />
  </p>
  <table class="wrapped">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">enable</td>
        <td style="text-align: center;">
          <br />
        </td>
        <td style="text-align: center;">true</td>
        <td>オプション変数が有効かどうかの値です。false の場合、シェーダー定義ファイルに抽出されません。</td>
      </tr>
      <tr>
        <td style="text-align: right;">id</td>
        <td style="text-align: center;">&lt;option_var&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>オプション変数の識別子です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">type</td>
        <td style="text-align: center;">&lt;option_var&gt;</td>
        <td style="text-align: center;">static</td>
        <td>オプション変数のバリエーション種別です。static、dynamic のいずれかです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">choice</td>
        <td style="text-align: center;">&lt;option_var&gt;</td>
        <td style="text-align: center;">bool</td>
        <td>
          <p>オプション変数の値の範囲です。</p>
          <p>2 値の場合は &quot;bool&quot;、整数値の場合は &quot;[0, 4]&quot; のように、列挙値の場合は &quot;add:加算, sub:減算&quot; のように定義します。</p>
        </td>
      </tr>
      <tr>
        <td style="text-align: right;">default</td>
        <td style="text-align: center;">&lt;option_var&gt;</td>
        <td style="text-align: center;">choice 中の最初の候補</td>
        <td>オプション変数のデフォルト値です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">label</td>
        <td style="text-align: center;">&lt;ui_label&gt;</td>
        <td style="text-align: center;">id と同一</td>
        <td>変数を編集する UI のラベルです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">comment</td>
        <td style="text-align: center;">&lt;ui_comment&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>変数を編集する UI のコメントです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">group</td>
        <td style="text-align: center;">&lt;ui_group&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>変数を編集する UI のグループです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">order</td>
        <td style="text-align: center;">&lt;ui_order&gt;</td>
        <td style="text-align: center;">0</td>
        <td>変数を編集する UI の並び順優先度です。数字が小さなものが上位です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">visible</td>
        <td style="text-align: center;">&lt;ui_visible&gt;</td>
        <td style="text-align: center;">true</td>
        <td>変数を編集する UI を表示するかどうかです。</td>
      </tr>
    </tbody>
  </table>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="cp">#define SKINNING                   ( 0 )       </span><span class="c1">// @@ id=&quot;skinning&quot; choice=&quot;[0, 9]&quot; type=&quot;dynamic&quot;
</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>
    <br />
  </p>
</div>
<h1 id="Anchor_84052806_h1_4">頂点属性変数</h1>
<p>頂点属性変数に使用可能なアノテーションは次の通りです。</p>
<div class="section">
  <p>
    <br />
  </p>
  <table class="wrapped">
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">id</td>
        <td style="text-align: center;">&lt;attrib_var&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>頂点属性変数の識別子です</td>
      </tr>
      <tr>
        <td style="text-align: right;">hint</td>
        <td style="text-align: center;">&lt;attrib_var&gt;</td>
        <td style="text-align: center;">空文字列</td>
        <td>頂点属性変数の関連付けに利用するヒント情報です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">type</td>
        <td style="text-align: center;">&lt;attrib_var&gt;</td>
        <td style="text-align: center;">定義された型</td>
        <td>頂点属性変数の論理的な型です。&lt;attrib_var&gt; の type と同一です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">label</td>
        <td style="text-align: center;">&lt;ui_label&gt;</td>
        <td style="text-align: center;">id と同一</td>
        <td>変数を編集する UI のラベルです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">comment</td>
        <td style="text-align: center;">&lt;ui_comment&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>変数を編集する UI のコメントです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">group</td>
        <td style="text-align: center;">&lt;ui_group&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>変数を編集する UI のグループです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">order</td>
        <td style="text-align: center;">&lt;ui_order&gt;</td>
        <td style="text-align: center;">0</td>
        <td>変数を編集する UI の並び順優先度です。数字が小さなものが上位です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">editable</td>
        <td style="text-align: center;">&lt;ui_editable&gt;</td>
        <td style="text-align: center;">true</td>
        <td>変数の UI が編集可能かどうかです。</td>
      </tr>
    </tbody>
  </table>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>  <span class="n">in</span> <span class="n">vec4</span>   <span class="n">i_Position</span><span class="p">;</span>     <span class="c1">// @@ id=&quot;_p0&quot; hint=&quot;position0&quot; label=&quot;位置座標&quot; editable=&quot;false&quot;
</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>
    <br />
  </p>
</div>
<h1 id="Anchor_84052806_h1_5">サンプラー変数</h1>
<p>サンプラー変数に使用可能なアノテーションは次の通りです。</p>
<div class="section">
  <p>
    <br />
  </p>
  <table class="wrapped">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">id</td>
        <td style="text-align: center;">&lt;sampler_var&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>サンプラー変数の識別子です</td>
      </tr>
      <tr>
        <td style="text-align: right;">hint</td>
        <td style="text-align: center;">&lt;sampler_var&gt;</td>
        <td style="text-align: center;">空文字列</td>
        <td>サンプラー変数の関連付けに利用するヒント情報です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">type</td>
        <td style="text-align: center;">&lt;sampler_var&gt;</td>
        <td style="text-align: center;">定義された型</td>
        <td>サンプラー変数の論理的な型です。&lt;sampler_var&gt; の type と同一です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">alt</td>
        <td style="text-align: center;">&lt;sampler_var&gt;</td>
        <td style="text-align: center;">black</td>
        <td>サンプラーが関連付けられていない場合に使用する代替値です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">nostrip</td>
        <td style="text-align: center;">&lt;sampler_var&gt;</td>
        <td style="text-align: center;">false</td>
        <td>サンプラー変数のデッドストリップを抑制するかどうかです。抑制すると、使用されていない場合でも中間ファイルに要素が書き出されます。</td>
      </tr>
      <tr>
        <td style="text-align: right;">label</td>
        <td style="text-align: center;">&lt;ui_label&gt;</td>
        <td style="text-align: center;">id と同一</td>
        <td>変数を編集する UI のラベルです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">comment</td>
        <td style="text-align: center;">&lt;ui_comment&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>変数を編集する UI のコメントです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">group</td>
        <td style="text-align: center;">&lt;ui_group&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>変数を編集する UI のグループです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">order</td>
        <td style="text-align: center;">&lt;ui_order&gt;</td>
        <td style="text-align: center;">0</td>
        <td>変数を編集する UI の並び順優先度です。数字が小さなものが上位です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">visible</td>
        <td style="text-align: center;">&lt;ui_visible&gt;</td>
        <td style="text-align: center;">true</td>
        <td>変数を編集する UI を表示するかどうかです。</td>
      </tr>
    </tbody>
  </table>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">albedoTex0</span><span class="p">;</span>    <span class="c1">// @@ id=&quot;_a0&quot; hint=&quot;albedo0&quot; label=&quot;アルベドテクスチャ0&quot;
</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>
    <br />
  </p>
</div>
<h1 id="Anchor_84052806_h1_6">
  <a name="Anchor_84052806_UniformBlock"></a>ユニフォームブロック</h1>
<p>ユニフォームブロックに使用可能なアノテーションは次の通りです。</p>
<div class="section">
  <p>
    <br />
  </p>
  <table class="wrapped">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">id</td>
        <td style="text-align: center;">&lt;block_var&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>ユニフォームブロックの識別子です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">type</td>
        <td style="text-align: center;">&lt;block_var&gt;</td>
        <td style="text-align: center;">none</td>
        <td>ユニフォームブロックの種類です。none、material、shape、skeleton、option のいずれかです。</td>
      </tr>
    </tbody>
  </table>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="n">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">)</span> <span class="n">uniform</span> <span class="n">Material</span> <span class="c1">// @@ id=&quot;mat&quot; type=&quot;material&quot;
</span><span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">texsrt0</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>        <span class="c1">// @@ id=&quot;texsrt0&quot; type=&quot;texsrt&quot; hint=&quot;albedo0&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">texsrt1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>        <span class="c1">// @@ id=&quot;texsrt1&quot; type=&quot;texsrt&quot; hint=&quot;albedo1&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">texsrt2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>        <span class="c1">// @@ id=&quot;texsrt2&quot; type=&quot;texsrt&quot; hint=&quot;normal0&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">texsrt3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>        <span class="c1">// @@ id=&quot;texsrt3&quot; type=&quot;texsrt&quot; hint=&quot;specular0&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec3</span> <span class="n">diffColor</span><span class="p">;</span>         <span class="c1">// @@ id=&quot;diffuse&quot; default=&quot;1 1 1&quot; item=&quot;color&quot; hint=&quot;diffuse&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">float</span> <span class="n">weightTex</span><span class="p">;</span>        <span class="c1">// @@ id=&quot;weight_tex&quot; default=&quot;1.0&quot; min=&quot;-1&quot; max=&quot;1&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">float</span> <span class="n">specInt</span><span class="p">;</span>          <span class="c1">// @@ id=&quot;spec_int&quot; min=&quot;0&quot; max=&quot;1&quot; default=&quot;0.2&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">float</span> <span class="n">specPower</span><span class="p">;</span>        <span class="c1">// @@ id=&quot;spec_power&quot; min=&quot;0&quot; default=&quot;50&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">float</span> <span class="n">rimInt</span><span class="p">;</span>           <span class="c1">// @@ id=&quot;rim_int&quot; min=&quot;0&quot; max=&quot;1&quot; default=&quot;0.5&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">float</span> <span class="n">rimPower</span><span class="p">;</span>         <span class="c1">// @@ id=&quot;rim_power&quot; min=&quot;0&quot; default=&quot;2.5&quot;
</span><span class="p">};</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>
    <br />
  </p>
</div>
<h1 id="Anchor_84052806_h1_7">ユニフォーム変数</h1>
<p>ユニフォーム変数に使用可能なアノテーションは次の通りです。</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>名前</th>
      <th>シェーダー定義ファイルにおける対応要素</th>
      <th>省略時の扱い</th>
      <th>説明</th>
    </tr>
    <tr>
      <td style="text-align: right;">id</td>
      <td style="text-align: center;">&lt;uniform_var&gt;</td>
      <td style="text-align: center;">省略不可</td>
      <td>ユニフォーム変数の識別子です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">hint</td>
      <td style="text-align: center;">&lt;uniform_var&gt;</td>
      <td style="text-align: center;">空文字列</td>
      <td>ユニフォーム変数の関連付けに利用するヒント情報です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">type</td>
      <td style="text-align: center;">&lt;uniform_var&gt;</td>
      <td style="text-align: center;">定義された型(配列は省略不可)</td>
      <td>ユニフォーム変数の論理的な型です。&lt;uniform_var&gt; の type と同一です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">default</td>
      <td style="text-align: center;">&lt;uniform_var&gt;</td>
      <td style="text-align: center;">既定の値</td>
      <td>ユニフォーム変数のデフォルト値です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">depend</td>
      <td style="text-align: center;">&lt;depend&gt;</td>
      <td style="text-align: center;">空文字列</td>
      <td>依存しているユニフォーム変数の id です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">converter</td>
      <td style="text-align: center;">&lt;converter&gt;</td>
      <td style="text-align: center;">空文字列</td>
      <td>CPU から転送される際に適用する変換処理の名前です。関連付けに利用するヒント情報です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">label</td>
      <td style="text-align: center;">&lt;ui_label&gt;</td>
      <td style="text-align: center;">id と同一</td>
      <td>変数を編集する UI のラベルです。</td>
    </tr>
    <tr>
      <td style="text-align: right;">comment</td>
      <td style="text-align: center;">&lt;ui_comment&gt;</td>
      <td style="text-align: center;">無指定</td>
      <td>変数を編集する UI のコメントです。</td>
    </tr>
    <tr>
      <td style="text-align: right;">group</td>
      <td style="text-align: center;">&lt;ui_group&gt;</td>
      <td style="text-align: center;">無指定</td>
      <td>変数を編集する UI のグループです。</td>
    </tr>
    <tr>
      <td style="text-align: right;">order</td>
      <td style="text-align: center;">&lt;ui_order&gt;</td>
      <td style="text-align: center;">0</td>
      <td>変数を編集する UI の並び順優先度です。数字が小さなものが上位です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">item</td>
      <td style="text-align: center;">&lt;ui_item&gt;</td>
      <td style="text-align: center;">auto</td>
      <td>変数を編集する UI の型です。type の型が対応している場合、 &quot;color&quot; を指定すると 3DEditor での UI が カラーピッカーに、また &quot;check&quot; を指定するとチェックボックスになります。</td>
    </tr>
    <tr>
      <td style="text-align: right;">min</td>
      <td style="text-align: center;">&lt;ui_min&gt;</td>
      <td style="text-align: center;">無指定</td>
      <td>変数を編集する UI の最小値です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">max</td>
      <td style="text-align: center;">&lt;ui_max&gt;</td>
      <td style="text-align: center;">無指定</td>
      <td>変数を編集する UI の最大値です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">visible</td>
      <td style="text-align: center;">&lt;ui_visible&gt;</td>
      <td style="text-align: center;">true</td>
      <td>変数を編集する UI を表示するかどうかです。パラメーター用編集 UI だけを表示したい場合はparam_only、アニメーション用編集 UI だけを表示したい場合はanim_onlyを指定します。</td>
    </tr>
    <tr>
      <td style="text-align: right;">default_min</td>
      <td style="text-align: center;">&lt;ui_default_min&gt;</td>
      <td style="text-align: center;">無指定</td>
      <td>変数を編集する UI の最小値のデフォルト値です。</td>
    </tr>
    <tr>
      <td style="text-align: right;">default_max</td>
      <td style="text-align: center;">&lt;ui_default_max&gt;</td>
      <td style="text-align: center;">無指定</td>
      <td>変数を編集する UI の最大値のデフォルト値です。</td>
    </tr>
  </tbody>
</table>
<p>type に指定する型はライブラリが書き込むパラメーターの型を指定しますが、GLSL 上では全く異なる型を指定して値を受け取ることもできます。メモリーレイアウトさえ一致していれば、1つのパラメーターを配列や複数の変数で値を受け取ることも可能です。ユニフォームブロック内のメモリーレイアウトについては OpenGL の仕様書を参照してください。</p>
<p>type に行列型を指定した場合、行ごとにパディングを含む行優先のベクトルがライブラリによって書き込まれます。例えば、type が float2x3 のパラメーターは GLSL の mat3x2 で受け取ることができます。</p>
<p>type が srt3d の場合、行優先の 3x4 行列がライブラリによって書き込まれます。すなわち、m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23 が連続して書き込まれます。GLSL では mat4x3 や vec4 の配列で値を受け取ることができます。</p>
<p>type が srt2d または texsrt の場合、列優先の 2x3 行列がライブラリによって書き込まれます。すなわち、m00, m10, m01, m11, m02, m12 が連続して書き込まれます。GLSL では次の例の texsrt0 や texsrt1 のように記述することで値を受け取ることができますが、texsrt2 のように vec2 の配列で記述すると vec2 同士の間にパディングが入り、値を受け取ることができないため、ご注意ください。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="n">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">)</span> <span class="n">uniform</span> <span class="n">Material</span> <span class="c1">// @@ id=&quot;mat&quot; type=&quot;material&quot;
</span><span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">texsrt0</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>        <span class="c1">// @@ id=&quot;texsrt0&quot; type=&quot;texsrt&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec2</span> <span class="n">texsrt1_column0</span><span class="p">;</span>   <span class="c1">// @@ id=&quot;texsrt1&quot; type=&quot;texsrt&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec2</span> <span class="n">texsrt1_column1</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec2</span> <span class="n">texsrt1_column2</span><span class="p">;</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// vec2 配列で記述すると vec2 同士の間にパディングが入るため、値を受け取れない
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//vec2 texsrt2[3];      // @@ id=&quot;texsrt2&quot; type=&quot;texsrt&quot;
</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">texsrt_ex0</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>     <span class="c1">// @@ id=&quot;texsrt_ex&quot; type=&quot;texsrt&quot; converter=&quot;texsrt_ex&quot;
</span><span class="p">};</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>type が texsrt のシェーダーパラメーターに CPU でアクセスする際は、<a href="../../../Api/HtmlNX/structnn_1_1g3d_1_1_tex_srt.html">nn::g3d::TexSrt</a> を用いてアクセスすることができます。default を指定する場合は、<a href="../../../Api/HtmlNX/structnn_1_1g3d_1_1_tex_srt.html">nn::g3d::TexSrt</a> のメンバを並べて指定してください。mode は整数値で、回転成分は degree 単位で指定する必要があります。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="k">struct</span> <span class="n">TexSrt</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">enum</span> <span class="n">Mode</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">MODE_MAYA</span><span class="p">,</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">MODE_3DSMAX</span><span class="p">,</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">MODE_SOFTIMAGE</span><span class="p">,</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NUM_MODE</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">Mode</span> <span class="n">mode</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">float</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>
  <span style="color: rgb(51,51,51);">&nbsp;<span style="color: rgb(51,51,51);">type が float3、float4 の場合は、3DEditor 上でカラーコントロールを利用することができます。詳しくは&nbsp;</span><a href="../Pages/Page_83955594.html#Anchor_83955594_VectorToColorControl">カラーコントロールと数値コントロールの切り替え</a><span style="color: rgb(51,51,51);"> を参照してください。</span></span>
</p>
<h2 id="Anchor_84052806_h2_6">ユニフォーム変数のカスタマイズ</h2>
<p>
  <span style="color: rgb(51,51,51);">&nbsp;</span>
</p>
<div class="section">
  <p>depend 及び converter アノテーションを使用することでユニフォーム変数をカスタマイズすることができます。</p>
  <p>converter アノテーションはライブラリがユニフォーム変数を計算する際に独自の計算に置き換えるための識別子です。ここで指定した識別子は、<a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_uniform_var.html#ad241ab7c97aa3bbbdbc84926e70262b2">nn::g3d::ResUniformVar::GetConverter()</a> で取得可能です。この識別子に基づいて初期化時にアプリケーションからライブラリにコールバックを登録します。コールバックの登録は <a href="../../../Api/HtmlNX/classnn_1_1g3d_1_1_res_shader_param.html#ab9298aece0c7b8114fddeaefb7aa1314">nn::g3d::ResShaderParam::SetConvertShaderParamCallback()</a> で行うことが出来ます。</p>
  <p>depend アノテーションは converter で独自の計算を行う際に、別のユニフォーム変数、または外部のデータを参照するように指定することができます。別のユニフォーム変数を使用する場合はそのユニフォーム変数の id を、外部のデータを参照する際は自分自身の id を指定します。</p>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="n">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">)</span> <span class="n">uniform</span> <span class="n">Material</span>  <span class="c1">// @@ id=&quot;mat&quot; type=&quot;material&quot;
</span><span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">color</span><span class="p">;</span>          <span class="c1">// @@ id=&quot;color&quot; depend=&quot;intensity&quot; converter=&quot;mul_intensity&quot;
</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">float</span> <span class="n">intensity</span><span class="p">;</span>     <span class="c1">// @@ id=&quot;intensity&quot;
</span><span class="p">};</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>
    <br />
  </p>
</div>
<h1 id="Anchor_84052806_h1_8">シェーダーストレージブロック</h1>
<p>シェーダーストレージブロックに使用可能なアノテーションは次の通りです。</p>
<div class="section">
  <p>
    <br />
  </p>
  <table class="wrapped">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th style="text-align: center;">シェーダー定義ファイルにおける対応要素</th>
        <th style="text-align: center;">省略時の扱い</th>
        <th style="text-align: center;">説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">id</td>
        <td style="text-align: center;">&lt;shader_storage_block_var&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>シェーダーストレージブロックの識別子です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">type</td>
        <td style="text-align: center;">&lt;shader_storage_block_var&gt;</td>
        <td style="text-align: center;">none</td>
        <td>シェーダーストレージブロックの種類です。none、skeleton のいずれかです。</td>
      </tr>
    </tbody>
  </table>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="n">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">)</span> <span class="n">buffer</span> <span class="n">PositionBuffer0</span> <span class="c1">// @@ id=&quot;pos_buf0&quot; type=&quot;none&quot;
</span><span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">positions0</span><span class="p">[];</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>
    <br />
  </p>
</div>
<h1 id="Anchor_84052806_h1_9">バッファー変数</h1>
<p>バッファー変数に使用可能なアノテーションは次の通りです。</p>
<table class="wrapped" style="margin-left: 1.5em;">
  <tbody>
    <tr>
      <th>名前</th>
      <th style="text-align: center;">シェーダー定義ファイルにおける対応要素</th>
      <th style="text-align: center;">省略時の扱い</th>
      <th style="text-align: center;">説明</th>
    </tr>
    <tr>
      <td style="text-align: right;">id</td>
      <td style="text-align: center;">&lt;buffer_var&gt;</td>
      <td style="text-align: center;">
        <p>省略不可</p>
      </td>
      <td>バッファー変数の識別子です。</td>
    </tr>
  </tbody>
</table>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="n">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">)</span> <span class="n">buffer</span> <span class="n">WeightBuffer</span> <span class="c1">// @@ id=&quot;weight_buf&quot; type=&quot;none&quot;
</span><span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec3</span> <span class="n">weight</span><span class="p">;</span> <span class="c1">// @@ id=&quot;weight&quot;
</span><span class="p">};</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_84052806_h1_10">描画情報</h1>
<div class="section">
  <p>描画情報は、GPU に直接送られないマテリアルのパラメーターです。描画優先度や影描画時のポリゴンオフセット、影を受けるかどうかのフラグなどを自由に定義してマテリアルに持たせることができます。</p>
  <p>描画情報として使用可能なアノテーションは次の通りです。行頭からコメントを始める必要があります。</p>
  <table class="wrapped">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">renderinfo</td>
        <td style="text-align: center;">&lt;render_info_slot&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>描画情報の識別子です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">type</td>
        <td style="text-align: center;">&lt;render_info_slot&gt;</td>
        <td style="text-align: center;">string</td>
        <td>&lt;render_info_slot&gt; の type と同一です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">choice</td>
        <td style="text-align: center;">&lt;render_info_slot&gt;</td>
        <td style="text-align: center;">空文字列</td>
        <td>
          <p>描画情報の値の範囲です。数値の場合は &quot;[0, 4]&quot; のように、または &quot;0:加算, 1:減算&quot; のように定義します。文字列の場合は &quot;add:加算, sub:減算&quot; のように定義します。</p>
          <p>choice を指定しない場合、3DEditor との接続時にアプリケーションから動的に描画情報の choice を指定することができます。詳しくは <a href="../Pages/Page_99806869.html#Anchor_99806869_RenderInfo">描画情報を組み込む</a> を参照してください。</p>
        </td>
      </tr>
      <tr>
        <td style="text-align: right;">default</td>
        <td style="text-align: center;">&lt;render_info_slot&gt;</td>
        <td style="text-align: center;">空文字列</td>
        <td>描画情報のデフォルト値です。空白区切りで選択肢を列挙します。選択肢が count より少ない場合、残りは空になります。</td>
      </tr>
      <tr>
        <td style="text-align: right;">count</td>
        <td style="text-align: center;">&lt;render_info_slot&gt;</td>
        <td style="text-align: center;">1</td>
        <td>描画情報の値の最大個数です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">optional</td>
        <td style="text-align: center;">&lt;render_info_slot&gt;</td>
        <td style="text-align: center;">true</td>
        <td>描画情報の値の数を可変数（任意の数）にできるようにするかの真偽値です。false にした場合は count で指定した数に固定されるようになります。文字列型で、 3DEditor の選択 UI に空白の選択肢を追加したくない場合には false を指定します。</td>
      </tr>
      <tr>
        <td style="text-align: right;">label</td>
        <td style="text-align: center;">&lt;ui_label&gt;</td>
        <td style="text-align: center;">renderinfo と同一</td>
        <td>変数を編集する UI のラベルです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">comment</td>
        <td style="text-align: center;">&lt;ui_comment&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>変数を編集する UI のコメントです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">group</td>
        <td style="text-align: center;">&lt;ui_group&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>変数を編集する UI のグループです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">order</td>
        <td style="text-align: center;">&lt;ui_order&gt;</td>
        <td style="text-align: center;">0</td>
        <td>変数を編集する UI の並び順優先度です。数字が小さなものが上位です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">item</td>
        <td style="text-align: center;">&lt;ui_item&gt;</td>
        <td style="text-align: center;">auto</td>
        <td>変数を編集する UI の型です。type が数値、もしくは文字列の場合に &quot;check&quot; を指定すると 3DEditor での UI がチェックボックスになります。文字列の場合は <span style="color: rgb(51,51,51);">choice に 2 つの列挙値を指定する必要があります。この場合、列挙値は定義した順番に偽、真がチェックボックスの値に割り当てられます。例えば、choice=&quot;A, B&quot; と指定した場合、A が偽、B が真として扱われます。</span></td>
      </tr>
    </tbody>
  </table>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="c1">// @@ renderinfo=&quot;clear_color&quot; type=&quot;float&quot; count=&quot;3&quot; default=&quot;0.5 0.5 0.5&quot; choice=&quot;[0, 1]&quot; label=&quot;クリアカラー&quot; optional=&quot;false&quot;
</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <h1 id="Anchor_84052806_h1_11">テキストブロック</h1>
  <p>テキストブロックは 3DEditor の UI 上に表示される任意のテキストです。3DEditor で編集するデータには影響はしません。</p>
  <p>テキストブロックとして使用可能なアノテーションは以下の通りです。行頭からコメントを始める必要があります。</p>
  <table class="table">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">textblock</td>
        <td style="text-align: center;">&lt;textblock&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>テキストブロックの識別子です。値の指定を省略、もしくは値に空文字列を指定した場合は自動的に識別子が割り振られます。</td>
      </tr>
      <tr>
        <td style="text-align: right;">text</td>
        <td style="text-align: center;">&lt;textblock&gt;</td>
        <td style="text-align: center;">空文字列</td>
        <td>テキストブロックに設定するテキストです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">group</td>
        <td style="text-align: center;">&lt;ui_group&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>変数を編集する UI のグループです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">order</td>
        <td style="text-align: center;">&lt;ui_order&gt;</td>
        <td style="text-align: center;">0</td>
        <td>変数を編集する UI の並び順優先度です。数字が小さなものが上位です。</td>
      </tr>
    </tbody>
  </table>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="c1">// @@ textblock=&quot;dev_group_comment&quot; text=&quot;このグループのパラメーターは開発者用です。触らないでください。&quot;
</span><span class="cm">/* @@ dev_group_a:
&nbsp;&nbsp;&nbsp;&nbsp;textblock=&quot;dev_group_comment&quot;
&nbsp;&nbsp;&nbsp;&nbsp;renderinfo=&quot;param_a&quot; label=&quot;パラメーターA&quot;
&nbsp;&nbsp;&nbsp;&nbsp;textblock text=&quot;ここから下はテスト用のパラメーターです。&quot;
&nbsp;&nbsp;&nbsp;&nbsp;renderinfo=&quot;param_b&quot; label=&quot;パラメーターB&quot;
&nbsp;&nbsp;&nbsp;&nbsp;renderinfo=&quot;param_c&quot; label=&quot;パラメーターC&quot;
*/</span>

<span class="cm">/* @@ dev_group_b:
&nbsp;&nbsp;&nbsp;&nbsp;textblock=&quot;dev_group_comment&quot;
&nbsp;&nbsp;&nbsp;&nbsp;renderinfo=&quot;param_d&quot; label=&quot;パラメーターD&quot;
*/</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>
    <br />
  </p>
</div>
<h1 id="Anchor_84052806_h1_12">
  <span style="color: rgb(117,117,117);">頂点インターリーブ</span>
</h1>
<div class="section">
  <p>頂点インターリーブを指定することで、どの頂点属性を同一の頂点バッファにインターリーブするかを指定することができます。頂点バッファ内の頂点属性の順序はバイナリコンバータが量子化フォーマットに応じて並び替えるため、指定することはできません。</p>
  <p>頂点インターリーブとして使用可能なアノテーションは次の通りです。行頭からコメントを始める必要があります。</p>
  <table class="wrapped">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">interleave</td>
        <td style="text-align: center;">&lt;interleave&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>頂点インターリーブ情報です。インターリーブする頂点属性の id をスペース区切りで指定します。空文字列を指定した場合はインターリーブ指定されていない残りの頂点属性を表します。</td>
      </tr>
      <tr>
        <td style="text-align: right;">binarize</td>
        <td style="text-align: center;">&lt;interleave&gt;</td>
        <td style="text-align: center;">true</td>
        <td>false を指定した場合はバイナリ化されません。</td>
      </tr>
    </tbody>
  </table>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>  <span class="n">in</span> <span class="n">vec4</span>   <span class="n">i_Position</span><span class="p">;</span>     <span class="c1">// @@ id=&quot;_p0&quot;   hint=&quot;position0&quot;
</span><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>  <span class="n">in</span> <span class="n">ivec4</span>  <span class="n">i_Index0</span><span class="p">;</span>       <span class="c1">// @@ id=&quot;_i0&quot;   hint=&quot;blendindex0&quot;
</span><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>  <span class="n">in</span> <span class="n">ivec4</span>  <span class="n">i_Index1</span><span class="p">;</span>       <span class="c1">// @@ id=&quot;_i1&quot;   hint=&quot;blendindex1&quot;
</span><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>  <span class="n">in</span> <span class="n">vec4</span>   <span class="n">i_Weight0</span><span class="p">;</span>      <span class="c1">// @@ id=&quot;_w0&quot;   hint=&quot;blendweight0&quot;
</span><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>  <span class="n">in</span> <span class="n">vec4</span>   <span class="n">i_Weight1</span><span class="p">;</span>      <span class="c1">// @@ id=&quot;_w1&quot;   hint=&quot;blendweight1&quot;
</span>
<span class="cm">/* @@
&nbsp;&nbsp;&nbsp;&nbsp;attrib_id=&quot;_p0&quot;   label=&quot;位置座標&quot;                    editable=&quot;false&quot;
&nbsp;&nbsp;&nbsp;&nbsp;attrib_id=&quot;_i0&quot;   label=&quot;ブレンドインデックス1-4&quot;     editable=&quot;false&quot;
&nbsp;&nbsp;&nbsp;&nbsp;attrib_id=&quot;_i1&quot;   label=&quot;ブレンドインデックス5-8&quot;     editable=&quot;false&quot;
&nbsp;&nbsp;&nbsp;&nbsp;attrib_id=&quot;_w0&quot;   label=&quot;ブレンドウェイト1-4&quot;         editable=&quot;false&quot;
&nbsp;&nbsp;&nbsp;&nbsp;attrib_id=&quot;_w1&quot;   label=&quot;ブレンドウェイト5-8&quot;         editable=&quot;false&quot;
&nbsp;&nbsp;&nbsp;&nbsp;interleave=&quot;_p0 _i0 _i1 _w0 _w1&quot;
*/</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>
    <a name="Anchor_84052806_Group"></a>
  </p>
</div>
<h1 id="Anchor_84052806_h1_13">グループ</h1>
<div class="section">
  <p>パラメーターをまとめるグループの定義です。パラメーターに対してグループを指定した場合は、対応するグループを定義する必要があります。同一グループのパラメーターは 3DEditor 上でグループ化して表示されます。</p>
  <p>グループとして使用可能なアノテーションは次の通りです。行頭からコメントを始める必要があります。C スタイルコメント内では定義できません。</p>
  <p>同じ id を 2つ以上の複数のグループに定義することは出来ません。</p>
  <table class="wrapped">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">group</td>
        <td style="text-align: center;">&lt;group&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>グループの id として定義されている場合はグループの名前になります。id に対する属性として定義されている場合はグループが所属する親グループの名前になります。親グループの名前を指定している場合、3DEditor 上ではグループが指定した親グループのサブグループとして表示されるようになります。</td>
      </tr>
      <tr>
        <td style="text-align: right;">page</td>
        <td style="text-align: center;">&lt;group&gt;</td>
        <td style="text-align: center;">空文字列</td>
        <td>グループが所属するページです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">condition</td>
        <td style="text-align: center;">&lt;group&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>
          <p>グループを表示するかどうかを、式の評価結果で制御することができます。式には英数字と各種演算子（四則演算、ビット演算、論理演算）に加えて、3 種類の変数（option、uniform、renderinfo）を使用できます。変数は、$renderinfo.mode のように種類名と識別子を '.' で繋ぎ、それに接頭子 '$' をつけて記述します。種類名を省略した場合は option の識別子として扱います。また特殊文字として true と false も使用できます。true は 1、false は 0 としても評価されます。</p>
          <p>変数の使用には次の制約があります。「2 次元以上のパラメーターの uniform には対応していません」「描画情報値の数が 2 以上 (count が 2 以上) 又は、可変長（optional が true）の renderinfo には対応していません」</p>
        </td>
      </tr>
      <tr>
        <td style="text-align: right;">label</td>
        <td style="text-align: center;">&lt;ui_label&gt;</td>
        <td style="text-align: center;">group と同一</td>
        <td>UI のラベルです。ui_label を空にした場合は 3DEditor 上でのグループの枠線は非表示になります。</td>
      </tr>
      <tr>
        <td style="text-align: right;">comment</td>
        <td style="text-align: center;">&lt;ui_comment&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>UI のコメントです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">order</td>
        <td style="text-align: center;">&lt;ui_order&gt;</td>
        <td style="text-align: center;">0</td>
        <td>UI の並び順優先度です。数字が小さなものが上位です。</td>
      </tr>
    </tbody>
  </table>
  <p>condition を使うことでバリエーションによっては使用されないパラメーターを非表示にすることができます。次の例では id=&quot;normal_map&quot; に対応するオプション変数が偽の場合に、group=&quot;normal_map_group&quot; に対応するグループの中で condition に使用されていないパラメーターが非表示になります。</p>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="cp">#define USE_NORMAL_MAP      ( 0 )       </span><span class="c1">// @@ id=&quot;normal_map&quot;
</span>&nbsp;
<span class="c1">// @@ group=&quot;normal_map_group&quot; label=&quot;法線マップ&quot; order=&quot;5&quot; condition=&quot;$option.normal_map&quot;
</span><span class="cm">/* @@ normal_map_group:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;option_id=&quot;normal_map&quot;          order=&quot;1&quot;   label=&quot;法線マップ&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sampler_id=&quot;_n0&quot;                order=&quot;2&quot;   label=&quot;法線マップ&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uniform_id=&quot;texsrt2&quot;            order=&quot;3&quot;   label=&quot;法線マップ用SRT&quot;
*/</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>3DEditor 上でのグループの表示については、<a href="../Pages/Page_83955594.html">マテリアルプロパティウィンドウ シェーダページ</a>&nbsp;を参照してください。</p>
</div>
<h1 id="Anchor_84052806_h1_14">
  <ac:macro ac:name="anchor" ac:schema-version="1" ac:macro-id="58675506-bdbf-4ff2-b2ee-0b20fc8f9e5e" xmlns:ac="ac">
    <ac:parameter ac:name="">Page</ac:parameter>
  </ac:macro>ページ</h1>
<div class="section">
  <p>グループをまとめるページの定義です。グループに対してページ指定した場合は、対応するページを定義する必要があります。</p>
  <p>ページとして使用可能なアノテーションは次の通りです。行頭からコメントを始める必要があります。C スタイルコメント内では定義できません。</p>
  <table class="wrapped">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">page</td>
        <td style="text-align: center;">&lt;page&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>ページの名前です。</td>
      </tr>
      <tr>
        <td style="text-align: right;">label</td>
        <td style="text-align: center;">&lt;ui_label&gt;</td>
        <td style="text-align: center;">page と同一</td>
        <td>UI のラベルです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">comment</td>
        <td style="text-align: center;">&lt;ui_comment&gt;</td>
        <td style="text-align: center;">無指定</td>
        <td>UI のコメントです。</td>
      </tr>
      <tr>
        <td style="text-align: right;">order</td>
        <td style="text-align: center;">&lt;ui_order&gt;</td>
        <td style="text-align: center;">0</td>
        <td>UI の並び順優先度です。数字が小さなものが上位です。</td>
      </tr>
    </tbody>
  </table>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="c1">// @@ page=&quot;common_page&quot; label=&quot;全般&quot;
</span>&nbsp;
<span class="c1">// @@ group=&quot;diffuse&quot; label=&quot;ディフューズ&quot; page=&quot;common_page&quot;
</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>
    <br />
  </p>
</div>
<p>
  <br />
</p>
<h1 id="Anchor_84052806_h1_15">リビジョン</h1>
<div class="section">
  <p>シェーダーにリビジョンを埋め込んでおくことで、モデルがどのリビジョンのシェーダーと関連付けられているかを追跡することができます。シェーダーの更新によってシェーダーパラメーターの値の意味が変わった場合などに、リビジョンを判定しながら中間ファイルフィルタの処理を変えることができます。</p>
  <p>リビジョンとして使用可能なアノテーションは次の通りです。行頭からコメントを始める必要があります。</p>
  <table class="wrapped">
    <colgroup>
      <col />
      <col />
      <col />
      <col />
    </colgroup>
    <tbody>
      <tr>
        <th>名前</th>
        <th>シェーダー定義ファイルにおける対応要素</th>
        <th>省略時の扱い</th>
        <th>説明</th>
      </tr>
      <tr>
        <td style="text-align: right;">revision</td>
        <td style="text-align: center;">&lt;revision&gt;</td>
        <td style="text-align: center;">省略不可</td>
        <td>リビジョン情報です。ユーザー定義のリビジョン番号を指定します。</td>
      </tr>
    </tbody>
  </table>
  <p>
    <br />
  </p>
</div>
<h1 id="Anchor_84052806_h1_16">ラベル属性</h1>
<div class="section">
  <p>label および choice リストの記述に使用すると 3DEditor での表示方法をカスタマイズできるラベル属性があります。次の例のように文字列の最後に付加することにより label や choice リストの表示方法を制御します。複数指定することも可能です。</p>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="c1">// @@ uniform_id=&quot;diffuse&quot; label=&quot;ディフューズ:color{red}:background-color{black}&quot;
</span>&nbsp;
<span class="c1">// @@ id=&quot;albedo_color&quot; choice=&quot;0::ref{group/texture0}, 1::ref{option_var/const_color0}&quot;
</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <h2 id="Anchor_84052806_h2_7">ラベル色</h2>
  <p>3DEditor で表示する際のラベルの色を変更します。</p>
  <table class="wrapped">
    <tbody>
      <tr>
        <th>記法</th>
        <th>概要</th>
        <th>記述例</th>
        <th>記述例の説明</th>
      </tr>
      <tr>
        <td rowspan="2">:color{}</td>
        <td rowspan="2">文字色を指定します。</td>
        <td>:color{red}</td>
        <td>文字色を赤色にします。</td>
      </tr>
      <tr>
        <td>:color{#FF0000}</td>
        <td>文字色を赤色にします。</td>
      </tr>
      <tr>
        <td rowspan="2">:background-color{}</td>
        <td rowspan="2">背景色を指定します。</td>
        <td>:background-color{red}</td>
        <td>背景色を赤色にします。</td>
      </tr>
      <tr>
        <td>:background-color{#FF0000}</td>
        <td>背景色を赤色にします。</td>
      </tr>
    </tbody>
  </table>
  <h2 id="Anchor_84052806_h2_8">ラベル参照</h2>
  <p>同じシェーディングモデル内に含まれる他のラベルを参照します。他ラベルの内容を代わりに表示したり、3DEditor 上のラベル表示の右側に参照先のラベルへページを移動できる参照ボタンを付加したりすることができます。下記のような記法で参照先を指定します。</p>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre>:ref{種類/種類のidまたはname}</pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>参照先の種類には、シェーダー定義ファイルにおける次の要素が指定できます。</p>
  <table class="codeblock">
    <tbody>
      <tr>
        <td class="code">
          <div class="codeblock"><pre><span class="nt">&lt;option_var&gt;</span>
<span class="nt">&lt;attrib_var&gt;</span>
<span class="nt">&lt;sampler_var&gt;</span>
<span class="nt">&lt;uniform_var&gt;</span>
<span class="nt">&lt;render_info_slot&gt;</span>
<span class="nt">&lt;group&gt;</span>
<span class="nt">&lt;page&gt;</span></pre></div>
        </td>
      </tr>
    </tbody>
  </table>
  <p>3DEditor では、 label や choice リスト内の文字列を省略して :ref{} を記述すると、:ref{} で指定した参照先のラベルの内容を表示します。例えばシェーダーアノテーションで label=&quot;:ref{group/texture0}&quot; と記述すると &lt;group name=&quot;texture0&quot;&gt; の &lt;ui_label&gt; の内容を表示します。</p>
</div>
<h1 id="Anchor_84052806_h1_17">制限事項</h1>
<p>アノテーションの抽出はプリプロセス後のシェーダーソースに対して行われるため、プリプロセスによって消えるアノテーションは抽出されません。以下のような記述をすると、mat や texsrt のアノテーションの抽出に失敗します。バリエーションによってアノテーションが消えてしまわないように注意してください。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="cp">#define OPTION </span><span class="c1">// @@ id=&quot;option&quot; choice=&quot;bool&quot;
</span><span class="cp">#ifndef OPTION
</span><span class="n">uniform</span> <span class="n">Material</span> <span class="c1">// @@ id=&quot;mat&quot; type=&quot;material&quot;
</span><span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">vec4</span> <span class="n">texsrt</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// @@ id=&quot;texsrt&quot; type=&quot;texsrt&quot;
</span><span class="p">};</span>
<span class="cp">#endif
</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
