<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>テクスチャー</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- テクスチャー -->
<div class="pagetitle" id="PageId_83955793">テクスチャー</div>
<div class="text_separate">
<h1 id="Anchor_83955793_h1_1">テクスチャー</h1>
<h2 id="Anchor_83955793_h2_1">概要</h2>
<p>テクスチャーは、GPU によって参照されるテクスチャーを管理するための機能を提供します。テクスチャーサンプリングの挙動は<a href="../Pages/Page_83955849.html">サンプラー</a>によって扱われます。<br />テクスチャーは、その提供される機能やキャッシュ管理、GPU アクセスの最適化方法などにおいてバッファーとはいくつか異なります。どちらを使うかを判断する際は、それらの特性を参照してください。</p>
<p>テクスチャーは単一のピクセル配列を意味せず、同じフォーマット、同じ次元でのピクセル配列を複数格納しているコンテナーです。単一のピクセル配列のことをイメージと呼び、テクスチャーの一部のことをサブリソースと呼ぶことにします。テクスチャーがミップマップをもつとき、またはテクスチャーの次元が配列であるとき、そのテクスチャーは複数のイメージを含んでいます。</p>
<p>テクスチャーは、直接 GPU にセットされるための機能を提供していません。テクスチャーをセットするには、テクスチャービュー、カラーターゲットビュー、深度ステンシルビューのいずれかを構築する必要があります。</p>
<h2 id="Anchor_83955793_h2_2">情報<a name="Anchor_83955793_Info"></a></h2>
<p>テクスチャーの情報は <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html">nn::gfx::TextureInfo</a>&nbsp;として定義されています。</p>
<h3 id="Anchor_83955793_h3_1">次元</h3>
<p>次元は、テクスチャーに含まれるすべてのイメージの次元を表します。<br />一次元・二次元・三次元の中から選択します。<br />配列かどうかについては配列長、マルチサンプルかどうかについてはマルチサンプル数によって次元とは別に設定します。<br />次元は<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#aaa18ee4de787719b54b654ada806a13b">SetImageStorageDimension</a> &nbsp;関数により設定されます。&nbsp;</p>
<h3 id="Anchor_83955793_h3_2">イメージフォーマット</h3>
<p>イメージフォーマットは、テクスチャーに含まれるすべてのイメージのフォーマットを表します。<br />要素数、それぞれの要素のビット数、要素の型、圧縮フォーマットかどうか、を表す列挙値を <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#a44d3aa87b2114dad387b55f12b436b9e">SetImageFormat</a>&nbsp;に指定します。</p>
<h3 id="Anchor_83955793_h3_3">GPU がアクセスする方法</h3>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#aa46057ce0c70ecd38933c1ca377db242">SetGpuAccessFlag</a>&nbsp;により、GPU がテクスチャーをどのように使うつもりであるのかを指定します。</p>
<h3 id="Anchor_83955793_h3_4">タイリングモード</h3>
<p>テクスチャーに含まれるすべてのイメージのピクセル配列について、線形かまたは GPU に最適なタイリングかを指定します。</p>
<p>タイリングモードは <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#a4873eec7150e00db27a93549f23d5fac">SetTileMode</a>&nbsp;により設定されます。</p>
<h3 id="Anchor_83955793_h3_5">サイズ</h3>
<p>ベースレベルのイメージについて、幅、高さ、深さをそれぞれ <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#ab0c3612f217bcc1508be3b9f418d40f2">SetWidth</a>、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#ab4d4d69f1f1409b46b022f50326109d0">SetHeight</a>、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#ad35adb6ab009a16621bcaa944c5c210b">SetDepth</a>&nbsp;により設定します。</p>
<h3 id="Anchor_83955793_h3_6">配列長</h3>
<p>イメージフォーマットが配列である場合は、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#a3c07b1f215c43eb471f9fca8c4350bc9">SetArrayLength</a>&nbsp;を通してその配列長を設定します。</p>
<h3 id="Anchor_83955793_h3_7">スウィズリング</h3>
<p>スウィズリングのベース値を <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#a2482481cc781bfbd985efb1ac8baa29c">SetSwizzle</a>&nbsp;により設定できます。<br />このパラメーターはいくつかの低レベルグラフィックス API によっては無視されることがあります。</p>
<h3 id="Anchor_83955793_h3_8">マルチサンプル数</h3>
<p>&nbsp;次元がマルチサンプルである場合は、そのマルチサンプル数を <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#a245d1342d455927547ee80d18e5bcffe">SetMultiSampleCount</a>&nbsp;により設定します。</p>
<h3 id="Anchor_83955793_h3_9">ミップマップ数</h3>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_texture_info.html#aec99f3d86b353e498d6ff55e6050dbcc">SetMipCount</a>&nbsp;によりミップマップの数を設定します。</p>
<h2 id="Anchor_83955793_h2_3">オブジェクト<a name="Anchor_83955793_Object"></a></h2>
<p>テクスチャーのオブジェクトは <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a1aaa1504dbd528662d53ba66faba4313">nn::gfx::Texture</a> として定義されています。</p>
<h3 id="Anchor_83955793_h3_10">初期化と破棄</h3>
<p>テクスチャーの初期化と破棄は通常の<a href="../Pages/Page_83955654.html">オブジェクト</a>の方法に従います。</p>
<h3 id="Anchor_83955793_h3_11">メモリープール</h3>
<p>CPU と GPU の間でメモリを共有するアーキテクチャーとそうでないアーキテクチャーを扱うために、メモリープールが要求されるかどうかを表す <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_texture.html#ad72a001ac78d43ddcd4858d9b7793005">IsMemoryPoolRequired</a> 静的変数を定義しています。</p>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_texture.html#ad72a001ac78d43ddcd4858d9b7793005">IsMemoryPoolRequired</a> が true の場合、初期化時に有効なメモリープールを渡すことが要求され、それなしにテクスチャーを初期化することは初期化失敗を引き起こします。また、この場合はメモリープールについて以下で説明するいくつかの制限があります。</p>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_texture.html#ad72a001ac78d43ddcd4858d9b7793005">IsMemoryPoolRequired</a> が false の場合、メモリープールの引数に NULL を渡してテクスチャーを初期化することが可能です。その場合、 デバイス側でテクスチャーメモリーの確保だけが行われ、その内容は未定義です。有効なメモリープールをセットした場合、それは初期値として考慮され、同じ内容でデバイス側にテクスチャーメモリーが確保されます。</p>
<h3 id="Anchor_83955793_h3_12">メモリープールにおける制限</h3>
<p>初期化時に設定するメモリープールは、以下のいくつかの制限に従っている必要があります。これらの制限内容を取得するために、いくつかの静的関数を用意しています。それらは初期化する予定の情報を引数にとります。このときの情報は、実際に初期化するつもりの情報とパラメーターが一致している必要があります。</p>
<h4 id="Anchor_83955793_h4_1">ベースレベルイメージのアライメント</h4>
<p>メモリープールへのオフセットとして指定されるベースレベルイメージの位置にはアライメント制限があります。これは、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_texture.html#a6580c829bab613b6e9850e543f9a7203">CalculateMipDataAlignment</a> 静的関数により計算されます。</p>
<h4 id="Anchor_83955793_h4_2">それぞれのミップマップイメージのオフセット</h4>
<p>それぞれのレベルのミップマップイメージのオフセットは、ベースレベルイメージのオフセットからの適切なオフセットに従っている必要があります。これは、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_texture.html#a17ca46f2f683062163aaaa0ba3e2d7c4">CalculateMipDataOffset</a> 静的関数により計算されます。</p>
<h4 id="Anchor_83955793_h4_3">データ全体のサイズ</h4>
<p>データ全体に要求されるサイズは、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_texture.html#ac9d3334566c6451da3f015e5ed1fd1ad">CalculateMipDataSize</a> 静的関数により計算することができます。</p>
<h4 id="Anchor_83955793_h4_4">線形イメージの行ピッチ</h4>
<p>線形イメージにおけるあるピクセルから同じ列の次の行のピクセルまでのバイト数は、<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_texture.html#a1cb515928e54198e11bdad346f61f3ca">GetRowPitch</a> 静的関数により取得できます。テクスチャーのイメージフォーマットや幅によっては、それぞれの行の最後にパディングが入っていることを考慮にいれる必要があります。</p>
<h2 id="Anchor_83955793_h2_4">イメージのコピー</h2>
<p>テクスチャーにおける特定のイメージの特定のピクセル範囲を別のテクスチャーにおける特定のイメージの特定のイメージ部分にコピーすることが可能です。<br /><a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#af719859a76c249a182d878f0cffd47c5">nn::gfx::CommandBuffer</a> クラスの <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_command_buffer.html#afd05d1e63d9009d74cf7de5088dab91c">CopyImage</a>&nbsp;を呼ぶことによって、イメージをコピーするコマンドが追加されます。</p>
<h3 id="Anchor_83955793_h3_13">イメージのコピーにおける制限<a name="Anchor_83955793_image_copy_restriction"></a></h3>
<p>イメージのコピーにおいて、コピー元となるテクスチャは GPU がアクセスする方法として <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5ac1b684c53b2d80f1692d75485018a5d6">nn::gfx::GpuAcessFlag_Read</a> を含んで初期化されている必要があり、コピー先となるテクスチャは GPU がアクセスする方法として <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a24dbcd6d86531138895622b5a854e4f5a4119e17a73b3f0569dfff61b11af8caa">nn::gfx::GpuAccessFlag_Write</a> を含んで初期化されている必要があります。<br />それぞれのテクスチャーの次元は一致している必要があります。また、コピー元とコピー先の範囲が重なってはいけません。</p>
<p>イメージのコピーのコマンドは最終的に、コピー機能性をもつキューに提出される必要があります。</p>
<h2 id="Anchor_83955793_h2_5">伸縮付きのイメージのコピー</h2>
<p>単純なイメージのコピーではなく、イメージを伸縮付きでコピーすることも可能です。イメージを伸縮付きでコピーするコマンドは&nbsp;<a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#af719859a76c249a182d878f0cffd47c5">nn::gfx::CommandBuffer</a>&nbsp;クラスの&nbsp;<a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_command_buffer.html#aa4b9f2b5bce7360871e24a89175cdb0b">BlitImage</a> を呼ぶことによってセットされます。<br />イメージのコピーとは異なり、ソースとデスティネーションの両方についてコピー範囲を指定します。コピー範囲が一致していない場合は、<a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#ab4ec3f26b32ff15b2eec7eae4a229f05">nn::gfx::ImageCopyFlag</a> によって指定される方法でフィルタリングされながら伸縮処理が行われます。</p>
<h3 id="Anchor_83955793_h3_14">伸縮付きのイメージのコピーにおける制限</h3>
<p>
  <a href="#Anchor_83955793_image_copy_restriction">イメージのコピーにおける制限</a>と同じ制限が適用されます。</p>
<h2 id="Anchor_83955793_h2_6">バッファー・イメージ間のコピー</h2>
<p>イメージの内容を更新するために、また線形なデータとタイリングデータを相互変換するために、バッファーから、またはバッファーへイメージをコピーすることができます。バッファーからイメージへのコピーは <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_command_buffer.html#a095e642fd735cffd203522b54fd32b0f">nn::gfx::CommandBuffer::CopyBufferToImage</a>&nbsp;によって、イメージからバッファーへのコピーは <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_command_buffer.html#a2dd01209c849897716bea6e871112d45">nn::gfx::CommandBuffer::CopyImageToBuffer</a>&nbsp;によってそれぞれ行われます。バッファー側ではデータ内容は線形として扱われ、テクスチャー側ではデータ内容は設定されているタイリングモードに従って扱われます。</p>
<h2 id="Anchor_83955793_h2_7">イメージフォーマットクエリー</h2>
<p>
  <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#a21c5e5a1eb8c95aedd04be175b23192e">nn::gfx::GetImageFormatProperty</a> を呼ぶことにより、指定されるイメージフォーマットの特性を動的に取得することができます。たとえば、あるフォーマットをカラーターゲットとして利用可能かどうかを調べるために使うことができます。返る特性の値は低レベルグラフィックス API によって異なります。</p>
<h2 id="Anchor_83955793_h2_8">テクスチャーリソースステート</h2>
<p>テクスチャーの使用法が変化する際は、そのキャッシュの整合性などをとるために、ステートの遷移をコマンドバッファーに通知します。<br />テクスチャーリソースステートの遷移は <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#af719859a76c249a182d878f0cffd47c5">nn::gfx::CommandBuffer</a> の <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_command_buffer.html#a9d3efd13c434bb824fadb39977b1d6df">SetTextureStateTransition</a>&nbsp;により行われ、そこでは関数を呼ぶ以前の使用法と以後の使用法をステートとシェーダーステージの引数により指定します。<br />もっとも一般的なケースはレンダリングされたカラーターゲットからテクスチャーへの遷移であり、この場合は <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#ab4aaf139c1aa33c4c175e21423cc86fda6bb2a9982ebe869b8e6f4d4b4678f875">TextureState_ColorTarget</a> ステートから <a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#ab4aaf139c1aa33c4c175e21423cc86fda954cebcb3b7eab59c779a7cff2b20ae2">TextureState_ShaderRead</a> ステートへの遷移となります。</p>
<p>リソースステートの方式を使うとより多くの API で動作できる可能性がありますが、<a href="../../../Api/HtmlNX/namespacenn_1_1gfx.html#af719859a76c249a182d878f0cffd47c5">nn::gfx::CommandBuffer</a> の <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_command_buffer.html#a3b43b17e57f564190229a914370bfb9b">FlushMemory</a> と <a href="../../../Api/HtmlNX/classnn_1_1gfx_1_1_t_command_buffer.html#a7e5cade7802122a5272657dfaec5d1f1">InvalidateMemory</a> によりその大部分を代用できます。</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
