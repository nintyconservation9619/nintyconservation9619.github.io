<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>cmdl コンバーター</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- cmdl コンバーター -->
<div class="pagetitle" id="PageId_187883213">cmdl コンバーター</div>
<div class="text_separate">
<p>cmdl コンバーター(%NINTENDO_SDK_ROOT%\Tools\Graphics\3dTools\3dCmdlConverter.exe)の使用方法と注意事項を説明します。</p>
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_187883213_h1_1">概要</a>
    </li>
    <li>
      <a href="#Anchor_187883213_h1_2">コマンドラインオプション</a>
    </li>
    <li>
      <a href="#Anchor_187883213_h1_3">機能</a>
    </li>
    <li>
      <a href="#Anchor_187883213_h1_4">利用例</a>
    </li>
  </ul>
</p>
<h1 id="Anchor_187883213_h1_1">概要</h1>
<p>NintendoWare for CTR (NW4C) 用のグラフィックス中間ファイル（モデル、テクスチャー、アニメーション）を NintendoSDK の NintendoWare 用の 3D 中間ファイルに変換します。</p>
<p>マテリアルは、カラー、カリングモード、テクスチャー、アルファテスト、フラグメントオペレーションなどの設定が変換されます。<br />このコンバーターではシェーダーを割り当てないので、テクスチャーコンバイナー設定は fmd ファイルに反映されません。</p>
<h1 id="Anchor_187883213_h1_2">コマンドラインオプション</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dCmdlConverter.exe [入力ファイル] [--args-file &quot;&quot;] [--job-list &quot;&quot;] [--version] [-h] [-s]
[--project-root &quot;&quot;] [--disable-file-info]
[-o &quot;&quot;] [-n &quot;&quot;] [-g &quot;&quot;] [-d] [-a] [-x] [--mip-gen-filter &quot;&quot;] [-l &quot;&quot;] [-c &quot;&quot;]
[--use-fcl-fts-ftp] [--separate-material-anim] [--comment &quot;&quot;]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>
  <strong>入力ファイル</strong>
  <br />NW4C 用の中間ファイルを指定します。以下の拡張子のファイルに対応しています。<br /> 　cmdl / ctex / cskla / cmdla / cmata / cmcla / cmtsa / cmtpa<br />　ccam / clgt / cfog / cenv / cres<br /><br />インデックスでバインドする形式の cmdla ファイルは変換できません。</p>
<p>
  <strong>--args-file &quot;&quot;</strong>
  <br />引数ファイルに記述した内容を、引数として指定できます。<br /> 引数ファイルは複数行に渡って各オプションを記述できます。<br /> 行頭に # がある行はコメントとして扱います。<br />オプション値指定の &quot;&quot; によるエスケープに改行を含めることはできません。</p>
<p>
  <strong>--job-list &quot;&quot;</strong>
  <br />ジョブリストファイルを指定します。<br />ジョブリストを使用すると 1 回のプロセス起動で複数の変換処理を実行できます。<br />ジョブリストファイルには改行区切りで各処理の引数を記述します。<br />--job-list 以外の引数を同時に指定した場合、--job-list 以外の引数の後にジョブリストファイルの各行で指定した引数を追加した場合と同様の動作になります。<br /> 行頭に # がある行はコメントとして扱います。 <br />ジョブリストファイル内で --version、-h、-s、--job-list オプションは指定できません。</p>
<p>
  <strong>--version</strong>
  <br />バージョン情報を表示します。</p>
<p>
  <strong>-h --help</strong>
  <br />ヘルプを表示します。</p>
<p>
  <strong>-s --silent</strong>
  <br />処理中のメッセージ表示を抑制します。</p>
<p>
  <strong>--project-root &quot;&quot;</strong>
  <br />プロジェクトのルートフォルダーを指定します。<br />指定した場合、中間ファイルの &lt;create&gt; の src_path にルートフォルダーからの相対パスを出力します。</p>
<p>
  <strong>--disable-file-info<br /></strong>このオプションを指定すると、中間ファイルに &lt;file_info&gt; を出力しません。</p>
<p>
  <strong>-o &quot;&quot; --output &quot;&quot;</strong>
  <br />出力ファイルを指定します。<br /> 拡張子を省略した場合、入力ファイルに応じた拡張子で出力します。<br />このオプションを指定しない場合、入力ファイルと同じフォルダーに拡張子を変更したファイルを出力します。<br /> 出力ファイルの末尾が \ または / なら、出力フォルダーとみなします。その場合、出力ファイル名は入力ファイル名と同じになります。<br /><br /> 入力ファイルが cres ファイルの場合、出力ファイルの拡張子を省略すると、入力ファイルに含まれるモデルおよびアニメーションに対応する NintendoSDK 用の 3D 中間ファイルがそれぞれ出力されます。<br /> 出力ファイルの拡張子を指定すると、指定した種類の 3D 中間ファイルのみ出力されます。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <th>入力ファイル</th>
      <th>既定の出力ファイル</th>
      <th>他に指定可能な出力ファイル</th>
    </tr>
    <tr>
      <td>cmdl</td>
      <td>fmdb</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>ctex</td>
      <td>ftxb</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>cskla</td>
      <td>fskb</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>cmdla</td>
      <td>fvbb</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>cmata</td>
      <td>fmab</td>
      <td>fclb / ftsb / ftpb</td>
    </tr>
    <tr>
      <td>cmcla</td>
      <td>fmab</td>
      <td>fclb</td>
    </tr>
    <tr>
      <td>cmtsa</td>
      <td>fmab</td>
      <td>ftsb</td>
    </tr>
    <tr>
      <td>cmtpa</td>
      <td>fmab</td>
      <td>ftpb</td>
    </tr>
    <tr>
      <td>ccam / clgt / cfog / cenv</td>
      <td>fsnb</td>
      <td>
        <br />
      </td>
    </tr>
    <tr>
      <td>cres</td>
      <td>fmdb / fskb / fvbb / fmab / fsnb</td>
      <td>fclb / ftsb / ftpb</td>
    </tr>
  </tbody>
</table>
<p>
  <strong>-n &quot;&quot; --name &quot;&quot;</strong>
  <br /> NW4C 用の中間ファイルに複数のモデルまたはアニメーションまたはテクスチャーの要素が含まれる場合に、変換する要素の名前を指定します。<br />このオプションを指定しない場合、先頭の要素を変換します。</p>
<p>
  <strong>-g &quot;&quot; --magnify &quot;&quot;</strong>
  <br />モデルの頂点座標や移動値に掛ける倍率を指定します。<br />このオプションを指定しない場合は等倍で出力します。</p>
<p>
  <strong>-d --disable-texture</strong>
  <br />このオプションを指定すると、入力ファイル（cmdl / cmata / cmtpa / cres ファイル）が参照しているテクスチャー（ctex ファイル）を ftx ファイルに変換しません。<br />このオプションを指定しない場合、入力ファイルが参照しているテクスチャーを ftx ファイルに変換します。</p>
<p>
  <strong>-a --all-textures</strong>
  <br />このオプションを指定すると、cmdl / cres ファイルを変換する際、入力ファイルのフォルダーとその下の Textures フォルダーに存在する ctex ファイルをすべて変換します。<br />このオプションを指定しない場合、入力ファイルが参照している ctex ファイルのみ変換します。<br />-d オプションを指定している場合、このオプションを指定しても変換しません。</p>
<p>
  <strong>-x --max-mipmap</strong>
  <br />このオプションを指定すると、ctex ファイルがミップマップを使用する場合に、ctex ファイルのミップマップ画像を無視して幅と高さが 1 になるレベルまで強制的にミップマップを作成します。<br />このオプションを指定しない場合、ctex ファイルのミップマップ（画像とレベル数）を ftx ファイルに反映します。</p>
<p>
  <strong>--mip-gen-filter &quot;&quot;</strong>
  <br />ミップマップを作成する際のフィルタ（point / linear / cubic）を指定します。 <br />このオプションを指定しない場合、linear を使用します。</p>
<p>
  <strong>-l &quot;&quot; --linear-texture &quot;&quot;</strong>
  <br />テクスチャーの RGBA の各成分に対して、ガンマを sRGB からリニアに変換するかどうかを指定します。<br />リニアに変換するなら 1、変換しないなら 0 を RGBA の順に 4 文字で指定します。<br />たとえば -l 1110 とすると、RGB 成分はリニアに変換しますが、A 成分は変換しません。<br />このオプションを指定しない場合、どの成分もリニアに変換しません。<br />ctex ファイルのフォーマットが Hilo8 の場合、どの成分もリニアに変換しません。<br />1110 または 1111 を指定した場合、ctex ファイルのフォーマットが Rgb8 / Rgba8 / Etc1 / Etc1_a4 なら srgb_* フォーマットで出力します。<br />ctex ファイルがミップマップを使用する場合、リニアに変換する際に ctex ファイルのミップマップ画像を無視して幅と高さが 1 になるレベルまで強制的にミップマップを作成します（リニア空間で計算）。</p>
<p>
  <strong>-c &quot;&quot; --linear-vertex-color &quot;&quot;</strong>
  <br />頂点カラーの RGBA の各成分に対して、ガンマを sRGB からリニアに変換するかどうかを指定します。<br />リニアに変換するなら 1、変換しないなら 0 を RGBA の順に 4 文字で指定します。<br />たとえば -c 1110 とすると、RGB 成分はリニアに変換しますが、A 成分は変換しません。<br />このオプションを指定しない場合、どの成分もリニアに変換しません。</p>
<p>
  <strong>--use-fcl-fts-ftp</strong>
  <br />このオプションを指定すると、マテリアルアニメーションの種類ごとに異なる拡張子の 3D 中間ファイルを出力します（カラーアニメーションは fcl ファイル、テクスチャー SRT アニメーションは fts ファイル、テクスチャーパターンアニメーションは ftp ファイル）。<br />このオプションを指定しない場合、すべてのマテリアルアニメーションを fma ファイルに出力します。<br />-o オプションで出力ファイルの拡張子を指定した場合、このオプションに関係なく指定した拡張子の&nbsp;3D 中間ファイルを出力します。</p>
<p>
  <strong>--separate-material-anim</strong>
  <br />このオプションを指定すると、マテリアルアニメーションの種類ごとに個別の fma ファイルに出力します。出力ファイル名には既定のサフィックスが追加されます（カラーアニメーションは _fcl、テクスチャー SRT アニメーションは _fts、テクスチャーパターンアニメーションは _ftp）<br />このオプションを指定しない場合、1 つの fma ファイルにすべてのマテリアルアニメーションを出力します。<br />--use-fcl-fts-ftp オプションを指定した場合、このオプションは無視されます。</p>
<p>
  <strong>--comment &quot;&quot;</strong>
  <br />中間ファイルの編集用コメント文を指定します。</p>
<h1 id="Anchor_187883213_h1_3">機能</h1>
<h2 id="Anchor_187883213_h2_1">ユーザー頂点属性</h2>
<p>cmdl ファイルのユーザ頂点属性は、ヒント情報 color1 ～ color3 の頂点属性として fmd ファイルに出力されます。</p>
<h2 id="Anchor_187883213_h2_2">テクスチャー</h2>
<p>入力ファイルが cmdl / cmata / cmtpa / cres ファイルの場合、入力ファイルが参照しているテクスチャー（ctex ファイル）を ftx ファイルに変換して、(出力ファイルのフォルダー)/textures フォルダーに出力します（-d オプションを指定すると出力しません）。<br /><br /> 入力ファイルが cmdl / cres ファイルの場合、ftx ファイルのヒント情報は、法線マップなら normal、環境マップなら reflection、それ以外なら albedo となります。<br /> 入力ファイルが cmata / cmtpa ファイルの場合、ftx ファイルのヒント情報は常に albedo になります。<br /> 入力ファイルが ctex ファイルの場合、ftx ファイルのヒント情報は、フォーマットが Hilo8 なら normal、Hilo8 以外なら albedo となります。<br /><br />テクスチャーフォーマットは次のように変換されます。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <th>ctex ファイル</th>
      <th>ftx ファイル</th>
    </tr>
    <tr>
      <td>L4 / L8 / A4 / A8</td>
      <td>unorm_8</td>
    </tr>
    <tr>
      <td>La4 / La8</td>
      <td>unorm_8_8</td>
    </tr>
    <tr>
      <td>Hilo8</td>
      <td>snorm_bc5</td>
    </tr>
    <tr>
      <td>Rgb565</td>
      <td>unorm_5_6_5</td>
    </tr>
    <tr>
      <td>Rgb5_a1</td>
      <td>unorm_5_5_5_1</td>
    </tr>
    <tr>
      <td>Rgba4</td>
      <td>unorm_4_4_4_4</td>
    </tr>
    <tr>
      <td>Rgb8 / Rgba8</td>
      <td>unorm_8_8_8_8 または srgb_8_8_8_8</td>
    </tr>
    <tr>
      <td>Etc1</td>
      <td>unorm_bc1 または srgb_bc1</td>
    </tr>
    <tr>
      <td>Etc1_a4</td>
      <td>unorm_bc3 または srgb_bc3</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_187883213_h2_3">カラーアニメーション</h2>
<p>cmata / cmcla ファイルの CTR 特有のカラーアニメーションは、以下のヒント情報で出力されます。</p>
<table class="wrapped">
  <tbody>
    <tr>
      <th>cmata / cmcla ファイル</th>
      <th>fma / fcl ファイル</th>
    </tr>
    <tr>
      <td>Specular1</td>
      <td>specular1</td>
    </tr>
    <tr>
      <td>Constant0～5 の RGB 成分</td>
      <td>constant0 ～ constant5</td>
    </tr>
    <tr>
      <td>Constant0～5 の A 成分</td>
      <td>constant0_opacity ～ constant5_opacity（target=&quot;color_r&quot;）</td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_187883213_h1_4">利用例</h1>
<h2 id="Anchor_187883213_h2_4">中間ファイルの変換</h2>
<p>model.cmdl を変換して model.fmdb を作成します。<br />model.cmdl がテクスチャーを参照している場合、textures フォルダーに ftx ファイルが作成されます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dCmdlConverter.exe model.cmdl -o model.fmdb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>face.ctex を変換して face.ftxb を作成します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dCmdlConverter.exe face.ctex -o face.ftxb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>ジョブリストファイルを用いてまとめて変換します。<br />human.fmdb と walk.fskb と run.fskb は 10 倍の大きさ、dog.fmdb は 5 倍の大きさで出力されます。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>list.txt

human.cmdl -o human.fmdb
walk.cskla -o walk.fskb
run.cskla -o run.fskb
dog.cmdl -o dog.fmdb --magnify 5</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dCmdlConverter.exe --job-list list.txt --magnify 10 --linear-texture 1110</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_187883213_h2_5">中間ファイルオプティマイザーの実行</h2>
<p>NintendoSDK 用の 3D 中間ファイルに変換した後、中間ファイルオプティマイザーを実行するバッチファイルの例です。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>ConvertAndOptimize.bat

if &quot;%~x1&quot; == &quot;.cmdl&quot; set ext=.fmdb
if &quot;%~x1&quot; == &quot;.cskla&quot; set ext=.fskb
if &quot;%~x1&quot; == &quot;.cmdla&quot; set ext=.fvbb
&quot;%NINTENDO_SDK_ROOT%\Tools\Graphics\3dTools\3dCmdlConverter.exe&quot; &quot;%~1&quot;
if %ERRORLEVEL% NEQ 0 pause &amp; goto :eof
set optimizer=%NINTENDO_SDK_ROOT%\Tools\Graphics\3dTools\3dIntermediateFileOptimizer.exe
set opts=--quantization-analysis
if &quot;%~x1&quot; == &quot;.cmdl&quot; set opts=%opts% --optimize-primitive --optimize-primitive-options=&quot;--mode=Normal&quot;
&quot;%optimizer%&quot; &quot;%~dpn1%ext%&quot; %opts%</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>ConvertAndOptimize.bat model.cmdl
ConvertAndOptimize.bat anim.cskla</pre></div>
      </td>
    </tr>
  </tbody>
</table>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
