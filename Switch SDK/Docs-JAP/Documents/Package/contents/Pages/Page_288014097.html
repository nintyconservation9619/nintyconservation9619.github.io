<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>証明書ストア</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- 証明書ストア -->
<div class="pagetitle" id="PageId_288014097">証明書ストア</div>
<div class="text_separate">
<div class="layout-root">
  <div class="layout-base">
    <div class="layout-section two_right_sidebar">
      <div class="layout-cell">
        <h1 id="Anchor_288014097_h1_1">組み込み証明書ストア</h1>
        <p>SSL ライブラリは、広く使用されている商用 CA 証明書を収めた組み込み証明書ストアを備えています。サーバの検証では、必要に応じてこれらの証明書が自動的に使用されます。</p>
        <p>組み込み証明書ストアに用意されている各証明書については以下のページを参照してください。</p>
        <ul>
          <li>
            <a href="../Pages/Page_170073986.html">組み込みデータ</a>
          </li>
        </ul>
        <h1 id="Anchor_288014097_h1_2">CA 証明書のインポート</h1>
        <p>SSL ライブラリには、組み込み証明書ストアのほか、CA 証明書をインポートする手段も用意されています。CA 証明書は <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> クラスの <a href="../../../Api/HtmlNX/classnn_1_1ssl_1_1_context.html#a43b4cf238b81ba8d166c65b92b2e4ef2">ImportServerPki()</a> メソッドでインポートできます。以下のいずれかのフォーマットによる CA 証明書を使用できます。</p>
        <ul>
          <li>DER バイナリフォーマット</li>
          <li>PEM Base64 エンコードの ASCII フォーマット</li>
        </ul>
        <p>
          <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> のそれぞれのインスタンスによって、SSL 通信で使用するためにインポートした証明書が維持されます。インポートした証明書が不要になった場合は、<span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> の <a href="../../../Api/HtmlNX/classnn_1_1ssl_1_1_context.html#aa5e1409720e9f5d8273a59bda7593140">RemovePki()</a> メソッドでその証明書を削除できます。証明書を明示的に削除しなくても、証明書をインポートした <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> を破棄した場合や <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> のインスタンスを解放した場合、その証明書は自動的に削除されます。</p>
        <p>なお、インポートした CA 証明書は永続的なものではありません。これまでに説明したように、<span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> にインポートした証明書は、その <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> の破棄や解放に伴って削除されます。SSL ライブラリでは、永続的な格納場所に証明書とキーが保持されません。アプリケーションで証明書が必要になるたびに、その証明書をインポートする必要があります。</p>
      </div>
      <div class="layout-cell">
        <table class="wrapped">
          <colgroup>
            <col />
          </colgroup>
          <tbody>
            <tr>
              <th style="text-align: center;">目次</th>
            </tr>
            <tr>
              <td>
                <div class="content-wrapper">
                  <p>
                    <ul class="macro_toc">
                      <li>
                        <a href="#Anchor_288014097_h1_1">組み込み証明書ストア</a>
                      </li>
                      <li>
                        <a href="#Anchor_288014097_h1_2">CA 証明書のインポート</a>
                      </li>
                      <li>
                        <a href="#Anchor_288014097_h1_3">クライアント証明書およびその秘密鍵のインポート</a>
                      </li>
                      <li>
                        <a href="#Anchor_288014097_h1_4">デバイスクライアント証明書</a>
                      </li>
                      <ul>
                        <ul>
                          <li>
                            <a href="#Anchor_288014097_h3_1">仮想デバイスクライアント証明書</a>
                          </li>
                          <ul>
                            <li>
                              <a href="#Anchor_288014097_h4_1">Nintendo SDK 0.15.0 よりも前の SDK の場合 </a>
                            </li>
                            <li>
                              <a href="#Anchor_288014097_h4_2">Nintendo SDK 0.15.0 の場合</a>
                            </li>
                            <li>
                              <a href="#Anchor_288014097_h4_3">仮想デバイスクライアント証明書の取得</a>
                            </li>
                          </ul>
                        </ul>
                      </ul>
                    </ul>
                  </p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="layout-base">
    <div class="layout-section single">
      <div class="layout-cell">
        <h1 id="Anchor_288014097_h1_3">クライアント証明書およびその秘密鍵のインポート</h1>
        <p>SSL ライブラリは、クライアントのサーバ認証が必要な場合に使用するクライアント証明書とその秘密鍵をインポートする方法を提供します。クライアント証明書は <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> クラスの <a href="../../../Api/HtmlNX/classnn_1_1ssl_1_1_context.html#a2a7677e363b3bad66086670dc0ec73ec"> ImportClientPki() </a> メソッドでインポートできます。PKCS12 フォーマットによるクライアント PKI のみを使用できます。PKCS12 データとともに、PKCS12 データのパスワードも ImportClientPki() メソッドに渡すことができます。</p>
        <p>
          <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> のそれぞれのインスタンスによって、SSL 通信で使用するためにインポートしたクライアント PKI が維持されます。CA 証明書のインポートと異なり、<span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> を使用する場合にコンテキストごとにインポートできるクライアント PKI は 1 つのみです。インポートしたクライアント PKI が不要になった場合は、<span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> クラスの <a href="../../../Api/HtmlNX/classnn_1_1ssl_1_1_context.html#aa5e1409720e9f5d8273a59bda7593140">RemovePki()</a> メソッドでそのクライアント PKI を削除できます。クライアント PKI を明示的に削除しなくても、クライアント PKI をインポートした <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> を破棄した場合や <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> のインスタンスを解放した場合、そのクライアント PKI は自動的に削除されます。</p>
        <p>なお、インポートしたクライアント PKI も永続的なものではありません。これまでに説明したように、<span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> にインポートしたクライアント PKI は、その <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> の破棄や解放に伴って削除されます。SSL ライブラリでは、永続的な格納場所にクライアント PKI が保持されません。アプリケーションでクライアント PKI が必要になるたびに、そのクライアント PKI をインポートする必要があります。</p>
        <h1 id="Anchor_288014097_h1_4">デバイスクライアント証明書</h1>
        <p>デバイスクライアント証明書は、各デバイスに格納されているクライアント PKI です。任天堂が提供するネットワークサービスを使用するときに必要になります。</p>
        <p>インポートして取得するクライアント PKI と異なり、デバイスクライアント証明書は SSL ライブラリ外部からはインポートされません。その代わり、SSL ライブラリには、サーバがクライアント認証を必要とするときにデバイス固有のクライアント PKI を使用することを <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> に指示する方法が用意されています。詳細については、<a href="../../../Api/HtmlNX/classnn_1_1ssl_1_1_context.html#a3287af00bd1d6a4a4342d6f62a960294">nn::ssl::Context::RegisterInternalPKI()</a> を参照してください。</p>
        <p>デバイスクライアント証明書の登録は、クライアント PKI のインポートの一種と見なすことができます。つまり、特定の <span class="ApiLink_nn__ssl__Context">nn::ssl::Context</span> オブジェクトに対しては、通常のクライアント PKI またはデバイスクライアント証明書のいずれかのみを使用できます。</p>
        <p>
          <br />
        </p>
        <p>以下のサンプルコードは、デバイスクライアント証明書の登録方法を示しています。</p>
        <table class="codeblock">
          <tbody>
            <tr>
              <td class="code">
                <div class="codeblock"><pre><span class="nn">nn::</span><span class="n">Result</span>       <span class="n">result</span><span class="p">;</span>
<span class="nn">nn::ssl::</span><span class="n">Context</span> <span class="n">sslContext</span><span class="p">;</span>
<span class="nn">ssl::</span><span class="n">CertStoreId</span> <span class="n">deviceCertId</span><span class="p">;</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">sslContext</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="nn">ssl::Context::</span><span class="n">SslVersion_Auto</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsSuccess</span><span class="p">())</span>
<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">result</span> <span class="o">=</span> <span class="n">sslContext</span><span class="p">.</span><span class="n">RegisterInternalPki</span><span class="p">(</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">&amp;</span><span class="n">deviceCertId</span><span class="p">,</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nn">ssl::Context::</span><span class="n">InternalPki_DeviceClientCertDefault</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">IsFailure</span><span class="p">())</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">NN_LOG</span><span class="p">(</span><span class="s">&quot;Failed to register the device unique client certificate.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>
<span class="p">}</span></pre></div>
              </td>
            </tr>
          </tbody>
        </table>
        <p>
          <span style="color: rgb(51,51,51);">任天堂のサーバで明示的に SSL/TLS または HTTPS を実行するアプリケーションでなければ、このプロセスは不要です。 例えば、ACCOUNT ライブラリではデバイスクライアント証明書が内部的に登録されるので、アプリケーションでの手動による登録は不要です。</span>
        </p>
        <p>
          <span style="color: rgb(51,51,51);">デバイスクライアント証明書を実際のデバイスから取得できない環境では、開発段階で仮想デバイスクライアント証明書を特定の場所に用意する必要があります。詳細は、以下の「<a href="#Anchor_288014097_VirtualDeviceClientCertificate">仮想デバイスクライアント証明書</a>」のセクションを参照してください。</span>
        </p>
        <h3 id="Anchor_288014097_h3_1">仮想デバイスクライアント証明書<a name="Anchor_288014097_VirtualDeviceClientCertificate"></a></h3>
        <p>SSL ライブラリでは、デバイスが実際のハードウェア上で実行されていれば、そのデバイスからデバイスクライアント証明書を取得します。そのようなデバイスクライアント証明書が得られない環境では（アプリケーションを Windows 上で実行している場合など）、SSL ライブラリが特定の場所から仮想デバイスクライアント証明書を取得しようとします。アプリケーション開発段階でこの機能を使用するには、以下の 2 つのファイルを用意する必要があります。</p>
        <ul>
          <li>device_cert.p12<ul><li>これは、PKCS#12 形式のクライアント証明書です。</li></ul></li>
          <li>device_cert.key<ul><li>p12 ファイルの復号化に使用するパスワードを ASCII 文字列（BOM なし、改行なし）で記述したテキストファイルです。</li></ul></li>
        </ul>
        <!--Remove-->
        <div class="platform_nx">
          <h4 id="Anchor_288014097_h4_1">
            <span class="confluence-anchor-link conf-macro output-inline">Nintendo SDK 0.15.0 よりも前の SDK の場合 </span>
          </h4>
          <p>NX デバイス環境では、これらのファイルを SD カードのルートに配置する必要があります。</p>
          <p>
            <br />
          </p>
          <table class="codeblock">
            <tbody>
              <tr>
                <td class="code">
                  <div class="codeblock"><pre>sdcard/
&nbsp;&nbsp;+- device_cert.p12
&nbsp;&nbsp;+- device_cert.key</pre></div>
                </td>
              </tr>
            </tbody>
          </table>
          <h4 id="Anchor_288014097_h4_2">Nintendo SDK 0.15.0 の場合</h4>
          <p>NX デバイス環境では、実際のデバイスが備えるストレージから、SSL ライブラリがデバイスクライアント証明書を自動的に取得します。したがって、仮想クライアント証明書の準備は不要です。</p>
          <div class="info_new">
            <div class="info_new_left">参考：</div>
            <div class="info_new_right">
              <p>下記のハードウェアの場合、デフォルトでは正しくないデバイスクライアント証明書がデバイスのストレージに用意されています。</p>
              <ul>
                <li>SDEV PreMP1</li>
                <li>SDEV PreMP2</li>
                <li>EDEV Ep2-2</li>
              </ul>
              <p>これらのハードウェアにあるデバイスクライアント証明書を適切に使用するには、RepairSslCertificate ツールを実行してから目的のコードを実行してください。このプロセスが必要なのは 1 回だけです。SDK が更新されるたびに実行する必要はありません。RepairSslCertificate は TargetTools/NX-NXFP2-a64/RepairSslCertificate/Release/ にあります。</p>
            </div>
          </div>
        </div>
        <h4 id="Anchor_288014097_h4_3">仮想デバイスクライアント証明書の取得</h4>
        <p>仮想デバイスクライアント証明書は、特定のユーザ向けに発行する必要があります。複数のユーザで共有することは認められていません。仮想デバイスクライアント証明書を取得するには、<a href="https://tool.vdc.mng.nintendo.net/">https://tool.vdc.mng.nintendo.net/</a> を参照して、そこの指示に従います。</p>
      </div>
    </div>
  </div>
</div>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
<!--AddLink-->
<script>
var NintendoSdkApiRefernce = {
    idMap: {},
    linkRewrite: function ()
    {
        var idMap = NintendoSdkApiRefernce.idMap;
        function rewrite(el)
        {
            var e = idMap[el.className];
            if (e === undefined)
            {
                return;
            }
            var html = '';
            html += '<a href=';
            html += e.url;
            html += ' target="_blank">';
            html += el.innerHTML;
            html += '</a>';
            el.innerHTML = html;
        }
        var apiLinkElems = document.querySelectorAll('span[class*="ApiLink_"]');
        for (var i = 0, n = apiLinkElems.length; i< n; ++i) {
            rewrite(apiLinkElems[i]);
        }
    }
};
function SetUrl( id, url )
{
    NintendoSdkApiRefernce.idMap[id] = { url: url };
}
SetUrl( 'ApiLink_nn__ssl__Context', '../../../Api/HtmlNX/classnn_1_1ssl_1_1_context.html' )

NintendoSdkApiRefernce.linkRewrite();
</script>
<!--AddLink-->
</body>
</html>
