<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>SoundProjectConverter</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- SoundProjectConverter -->
<div class="pagetitle" id="PageId_83956139">SoundProjectConverter</div>
<div class="text_separate">
<h1 id="Anchor_83956139_h1_1">はじめに</h1>
<p>サウンドプロジェクトコンバータは、NintendoWare SoundMaker プロジェクトファイル (*.fspj) をライブラリから利用されるサウンドアーカイブファイル (*.bfsar) に変換するためのコマンドラインツールです。</p>
<p>ここでは、サウンドプロジェクトコンバータの使い方と機能について説明します。</p>
<h1 id="Anchor_83956139_h1_2">サウンドプロジェクトコンバータの使い方</h1>
<h2 id="Anchor_83956139_h2_1">サウンドプロジェクトコンバータの実行方法</h2>
<p>サウンドプロジェクトコンバータを使うには、コマンドラインから以下の形式で実行します。</p>
<p>
  <strong>SoundProjectConverter.exe&nbsp; [オプション] &nbsp;&lt;プロジェクトファイルパス&gt;</strong>
</p>
<p>例）</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>SoundProjectConverter.exe sample.fspj
SoundProjectConverter.exe -c sample/sample.fspj</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>コンバートを行うと、プロジェクトファイルの拡張子を *.bfsar に変えたサウンドアーカイブファイルが出力されます。</p>
<h3 id="Anchor_83956139_h3_1">プロジェクトファイルパス</h3>
<p>プロジェクトファイル (.fspj) &nbsp;のパスを指定します。</p>
<h3 id="Anchor_83956139_h3_2">コマンドラインオプション</h3>
<table class="wrapped">
  <colgroup>
    <col style="width: 202.0px;" />
    <col style="width: 843.0px;" />
  </colgroup>
  <thead>
    <tr>
      <th>
        <p>オプション</p>
      </th>
      <th>
        <p>説明</p>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <p>-c</p>
      </td>
      <td>
        <p>ファイルの更新日時に依らず、全てのファイルをコンバートします。</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>-j, --jobs &lt;conversion-count-max&gt;</p>
      </td>
      <td>
        <p>並列コンバートの最大数を設定します。&lt;0 - 99&gt;　[デフォルト値: 0]</p>
        <p>値に 0 を指定した場合、PC の CPU コア数と同じに自動設定されます。</p>
      </td>
    </tr>
    <tr>
      <td>-o, --output &lt;output-dirpath&gt;</td>
      <td>
        <p>コンバート結果の出力先ディレクトリを指定します。</p>
        <p>プロジェクトファイルに設定されている出力先ディレクトリよりも、ここで指定した値が優先されます。</p>
        <p>このオプションにより出力先を切り替えてコンバートすると、bfsar, bfstm, bfgrp などキャッシュディレクトリを介さず出力先ディレクトリに直接出力されるファイルは、再コンバート扱いになります。</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>-s, --silent</p>
      </td>
      <td>
        <p>ログの出力を抑制します。</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>-v, --verbose</p>
      </td>
      <td>
        <p>詳細なログを出力します。</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>--ignore-pre-convert-commands</p>
      </td>
      <td>
        <p>コンバート前ユーザーコマンドを実行しません。</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>--ignore-post-convert-commands</p>
      </td>
      <td>
        <p>コンバート後ユーザーコマンドを実行しません。</p>
      </td>
    </tr>
    <tr>
      <td>--exclude-list &lt;arg&gt;</td>
      <td>
        <p>アイテムの除外フィルタ設定（yaml 形式）のファイルパスを指定すると、このリストに指定されたアイテムがサウンドアーカイブから除外されます。</p>
      </td>
    </tr>
    <tr>
      <td>--include-list &lt;arg&gt;</td>
      <td>
        <p>アイテムの包含フィルタ設定（yaml 形式）のファイルパスを指定すると、このリストに指定されたアイテムのみがサウンドアーカイブに含まれます。</p>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83956139_h1_3">サウンドプロジェクトコンバータの機能</h1>
<h2 id="Anchor_83956139_h2_2">ファイルの更新日時チェック</h2>
<p>サウンドプロジェクトコンバータは、デフォルトではファイルの更新日時をチェックし、生成ファイルがソースファイルより新しければ、そのファイルをコンバートしません。<br />そのため、コンバート時間を短縮させることができます。</p>
<p>-c オプションを指定すると、ファイル更新日時はチェックされず、すべてのファイルがコンバートされます。</p>
<h2 id="Anchor_83956139_h2_3">サウンドプロジェクトコンバータの内部動作</h2>
<p>サウンドプロジェクトコンバータは、以下の手順でコンバート行います。</p>
<ul>
  <li>コンバート前コマンドの実行</li>
  <li>サウンドアーカイブのコンバート</li>
  <li>HTML サウンドリストの生成</li>
  <li>コンバート後コマンドの実行</li>
</ul>
<h3 id="Anchor_83956139_h3_3">コンバート前コマンドの実行</h3>
<p>サウンドプロジェクトに設定されたコンバート前コマンドを実行します。</p>
<h3 id="Anchor_83956139_h3_4">サウンドアーカイブのコンバート</h3>
<p>サウンドアーカイブファイル (*.bfsar) を生成します。</p>
<p>このコンバートを行うために、&quot;インストールディレクトリ&quot;\Tools\Audio\SoundMaker フォルダ内の各種コンバータを起動します。<br />コンバータはそれぞれ、サウンドデータをランタイムライブラリ用バイナリデータへコンバートし、最後に&nbsp;1 つのサウンドアーカイブファイルにまとめます。</p>
<p>-j オプションで並列コンバート数が指定されている場合、その数値を上限値として、依存関係のないサウンドのコンバートを並列実行することができます。<br />並列コンバート数は、0 ～ 99 の間で自由に設定でき、0 を設定すると「CPU コア数」と解釈されます。<br />オプションを指定しない場合は 0 が設定されます。</p>
<h3 id="Anchor_83956139_h3_5">HTMLサウンドリストの生成</h3>
<p>サウンドプロジェクトに設定された HTML サウンドリスト設定に基づき、HTML ファイル形式のサウンドリストファイルを出力します。</p>
<h3 id="Anchor_83956139_h3_6">コンバート後コマンドの実行</h3>
<p>サウンドプロジェクトに設定されたコンバート後コマンドを実行します。</p>
<h2 id="Anchor_83956139_h2_4">コンバート時のアイテムフィルタリング</h2>
<p>コンバートのタイミングでサウンドプロジェクトのアイテムや、バンクのインストルメントをフィルタして、サウンドアーカイブに含めるかどうかを制御することができます。</p>
<p>この機能を利用するには、SoundProjectConverter の&nbsp;--exclude-list, --include-list オプションを利用します。<br />SoundMaker GUI から同機能を利用することはできません。</p>
<h3 id="Anchor_83956139_h3_7">フィルタの種類</h3>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>除外フィルタ</th>
      <td>--exclude-list</td>
      <td>正規表現パターンにマッチしたアイテムをサウンドアーカイブから除外します。</td>
    </tr>
    <tr>
      <th>包含フィルタ</th>
      <td>--include-list</td>
      <td>正規表現パターンにマッチしたアイテムのみをサウンドアーカイブに含めます。</td>
    </tr>
  </tbody>
</table>
<h3 id="Anchor_83956139_h3_8">フィルタリストファイルのフォーマット</h3>
<p>下のような yml 形式で指定します。</p>
<p>除外フィルタファイル、包含フィルタファイルの両方に同じフォーマットを利用します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>filters:
&nbsp;&nbsp;&nbsp;&nbsp;# サウンドプロジェクトのアイテムフィルタ
&nbsp;&nbsp;&nbsp;&nbsp;- patterns:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ^STRM_MARIOKART$
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ^WSDSET_VOICE
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- PLAYER_DEFAULT
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ^GROUP_PS
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ^GROUP_USER_AUTO
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ^WARC_*
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ^BANK_BGM
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ^SE_IDLE
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ^SEQ_MARIOKART$

&nbsp;&nbsp;&nbsp;&nbsp;# bgm_kart のインストルメントフィルタ
&nbsp;&nbsp;&nbsp;&nbsp;- target: bnk/bgm_kart.fbnk
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;patterns:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ^INST_00*</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>要素</th>
      <th>説明</th>
    </tr>
    <tr>
      <td>filters</td>
      <td>フィルタのリストです。</td>
    </tr>
    <tr>
      <td>filter/target</td>
      <td>
        <p>フィルタの適用対象です。</p>
        <p>サウンドプロジェクトからの .fbnk 相対パスを指定すると、バンクがフィルタの適用対象になります。</p>
        <p>指定を省略すると、サウンドプロジェクト全体（バンクを除く）がフィルタの適用対象になります。</p>
      </td>
    </tr>
    <tr>
      <td>filter/patterns</td>
      <td>フィルタの正規表現パターンリストです。</td>
    </tr>
  </tbody>
</table>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
