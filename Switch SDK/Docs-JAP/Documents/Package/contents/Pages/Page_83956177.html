<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>圧縮オーディオ</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- 圧縮オーディオ -->
<div class="pagetitle" id="PageId_83956177">圧縮オーディオ</div>
<div class="text_separate">
<h1 id="Anchor_83956177_h1_1">圧縮オーディオ</h1>
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_83956177_h2_1">概要</a>
    </li>
    <li>
      <a href="#Anchor_83956177_h2_2">事前準備</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_1">ライセンス条項の確認</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83956177_h2_3">Opus ファイルの作成</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_2">サポートするフォーマット</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_3">SoundMaker で Opus ファイルにループを設定する</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_4"> 圧縮オーディオのループ関連の設定について</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83956177_h2_4">SoundMaker への登録</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_5">PC プレビュー再生</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_6">ハードウェアアクセラレータの利用</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83956177_h2_6">トラブルシューティング</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_7">ループしない</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_8">ループ情報が再抽出されない</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_9">意図しないループ情報が埋め込まれる</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_10">SoundMaker の PC プレビュー再生で意図しない波形が再生される</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83956177_h2_7">既知の問題</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_11">開始オフセットを指定した再生において、正しく再生されない場合がある</a>
      </li>
    </ul>
  </ul>
</p>
<h2 id="Anchor_83956177_h2_1">概要</h2>
<p>Atk ライブラリ、SoundMaker を利用して、圧縮オーディオ Opus を利用することができます。</p>
<p>このページでは、Opus の利用方法を説明します。</p>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <p>Atk ライブラリで Opus を使用するには、CODEC ライブラリも併せてリンクする必要があります</p>
  </div>
</div>
<h2 id="Anchor_83956177_h2_2">事前準備</h2>
<h3 id="Anchor_83956177_h3_1">ライセンス条項の確認</h3>
<p>Opus を利用する前に、必ず <a href="../Pages/Page_99804830.html">Opus のライセンス条項</a> を確認してください。</p>
<h2 id="Anchor_83956177_h2_3">Opus ファイルの作成</h2>
<h3 id="Anchor_83956177_h3_2">サポートするフォーマット</h3>
<p>NintendoSDK に含まれる <a href="../Pages/Page_99805022.html">OpusEncoder</a> で作成された Opus ファイルのみをサポートします。<br />また、フレームサイズが 20 ms でエンコードされたデータのみをサポートしています。&nbsp;<br /></p>
<p>詳しくは、<a href="../Pages/Page_99805022.html">OpusEncoder の解説ページ</a>&nbsp;を参照ください。&nbsp;</p>
<h3 id="Anchor_83956177_h3_3">SoundMaker で Opus ファイルにループを設定する</h3>
<p>ループ付き波形ファイルを Opus エンコードして利用したい場合は、Opus ファイルと同じフォルダに同名、拡張子違いの元波形ファイル (.wav/.aiff/.aif) を置いて、このファイルにループ情報を埋め込んでください。<br />SoundMaker は、そのファイルからループ情報を参照します。&nbsp;</p>
<h4 id="Anchor_83956177_h4_1">例</h4>
<table style="margin-left: 1.5em;" class="table">
  <tbody>
    <tr>
      <th>Opus ファイル</th>
      <td>foo.opus</td>
    </tr>
    <tr>
      <th>ループ情報参照用ファイル</th>
      <td>foo.wav or foo.aiff or foo.aif</td>
    </tr>
  </tbody>
</table>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <ul>
      <li>ループ情報として参照するファイルの優先度は [.wav] ＞ [.aiff] ＞ [.aif] です</li>
      <li>ループ抽出用波形ファイルが更新された場合は、【再コンバート】が必要です</li>
    </ul>
  </div>
</div>
<h3 id="Anchor_83956177_h3_4">
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_83956177/124259561.png" class="embedded-image" />
  </span>&nbsp;圧縮オーディオのループ関連の設定について</h3>
<p>Opus などの圧縮フォーマットは、デコード後波形の先頭に無音が挟まることで元波形よりも少し遅れて再生されます。<br />これにより、実際のループ範囲は想定したループ範囲とは異なり、無音が挟まった分だけ手前にループ範囲がずれてしまいます。</p>
<p>例えば、イントロ終了直後からループするように調整していると、イントロの後半部分がループ範囲に含まれてしまう可能性があります。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_83956177/124259562.png" width="500" class="embedded-image" />
  </span>
</p>
<p>&nbsp;</p>
<p>この問題を回避するためには、元波形のループ範囲を予め後ろにずらしておく必要があります。<br />（どれくらいずらすべきかは、圧縮率などに依存します。）</p>
<p>これにより、実際のループ範囲がずれたとしても、想定したサンプルデータがループされるようになります。</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_83956177/124259574.png" width="500" class="embedded-image" />
  </span>
</p>
<p>&nbsp;</p>
<p>また、ループが正しくつながるようにするために、ループ前後で補正処理を行っています。<br />この補正処理が正しくされるようにするために、エンコード前の波形に以下のように波形をコピーしておく必要があります。</p>
<p>&nbsp;</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_83956177/125194424.png" width="500" class="embedded-image" />
  </span>
</p>
<p>&nbsp;</p>
<div class="warn_new">
  <div class="warn_new_left">警告：</div>
  <div class="warn_new_right">
    <p>現状、 atk からループ付き opus を再生すると、これらの対処を入れていたとしても、ループタイミングでノイズがのるケースがあります。<br />これは、opus のコンテキスト情報をもとにデコードする仕様に起因する問題で、対応を検討中です。</p>
    <p>この問題は、波形によって再現性が異なります。</p>
  </div>
</div>
<h2 id="Anchor_83956177_h2_4">SoundMaker への登録</h2>
<p>SoundMaker のストリームサウンドリスト上で、ソースファイルとして Opus ファイルを指定します。<br />この状態でコンバートすると、ストリーム出力先ディレクトリに Opus ファイルがコピーされ、バイナリサウンドアーカイブファイル (.bfsar) と合わせて利用可能になります。</p>
<div class="info_new">
  <div class="info_new_left">参考：</div>
  <div class="info_new_right">
    <ul>
      <li>SoundMaker には、あらかじめ <a href="../Pages/Page_99805022.html">OpusEncoder</a>&nbsp; でエンコード済みの Opus ファイルを登録する必要があります</li>
      <li>現在、SoundMaker で .wav/.aiff/.aif を&nbsp;Opus エンコードする機能は提供していません</li>
      <li>現在、マルチトラックストリームには対応していません</li>
    </ul>
  </div>
</div>
<h3 id="Anchor_83956177_h3_5">PC プレビュー再生</h3>
<p>SoundMaker では&nbsp;Opus ファイルを直接プレビュー再生できないため、前述のループ情報を参照する同名、拡張子違いのファイルを参照して、プレビュー再生を行います。<br />ループしない Opus ファイルに対しても、拡張子違いのファイルを配置するようにしてください。</p>
<!--Remove-->
<h3 id="Anchor_83956177_h3_6">ハードウェアアクセラレータの利用</h3>
<p>通常、 Opus 再生では CPU によるデコードが行われますが、<br />SoundMaker により、ハードウェアアクセラレータによるデコード処理を行い、 Opus 再生を行う設定を利用することができます。</p>
<p>
  <span style="color: rgb(255,0,0);">この機能は NintendoSDK NX Addon 4.0.0 以降で使用できるようになります。</span>
</p>
<p>[プロジェクト] -&gt; [プロジェクトの設定] -&gt; [コンバート] の項にある、 [ターゲットでの Opus のデコードにはハードウェアを使用するように指定する] をチェックすることで、<br />全ての Opus ファイルについて、 ハードウェアアクセラレータによるデコード処理を利用した再生が行われるようになります。</p>
<h2 id="Anchor_83956177_h2_6">
  <a name="Anchor_83956177_TroubleShooting"></a>トラブルシューティング</h2>
<h3 id="Anchor_83956177_h3_7">ループしない</h3>
<ul>
  <li>&nbsp; ループ情報を埋め込むためには、Opus ファイルと同じフォルダに「拡張子を .wav などに置き換えた名前の波形ファイル」を配置しておく必要があります。</li>
</ul>
<h3 id="Anchor_83956177_h3_8">ループ情報が再抽出されない</h3>
<ul>
  <li>&nbsp; ループ情報抽出用の波形ファイルを更新した場合は、[コンバート] ではなく [再コンバート] を行う必要があります。</li>
</ul>
<h3 id="Anchor_83956177_h3_9">意図しないループ情報が埋め込まれる</h3>
<ul>
  <li>&nbsp; ループ情報は、Opus ファイルと同じフォルダにある「拡張子を .wav などに置き換えた名前の波形ファイル」のループ情報が参照されます。</li>
  <li>&nbsp; 意図せずそのような名前の波形ファイルを置いている場合は、Opus ファイルあるいは .wav ファイルなどを別名にする必要があります。</li>
</ul>
<h3 id="Anchor_83956177_h3_10">SoundMaker の PC プレビュー再生で意図しない波形が再生される</h3>
<ul>
  <li>&nbsp; プレビュー再生には、Opus ファイルではなく、Opus ファイルとと同じフォルダにある「拡張子を .wav などに置き換えた名前の波形ファイル」が利用されます。</li>
  <li>&nbsp; 該当する波形ファイルの内容が&nbsp;Opus ファイル (をデコードした内容) に相当するかどうか、確認してください。</li>
</ul>
<h2 id="Anchor_83956177_h2_7">既知の問題</h2>
<h3 id="Anchor_83956177_h3_11">開始オフセットを指定した再生において、正しく再生されない場合がある</h3>
<ul>
  <li>開始オフセットを指定した再生において、現状はファイル先頭からのデコードではなく、直前のフレームからデコードする実装となっています。<br />聴感上違和感があるケースは確認されていませんが、正しくデコードされていない可能性があります。</li>
</ul>
<p>&nbsp;</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
