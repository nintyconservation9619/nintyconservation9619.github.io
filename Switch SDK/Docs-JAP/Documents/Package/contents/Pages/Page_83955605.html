<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>MessageQueue クラス</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- MessageQueue クラス -->
<div class="pagetitle" id="PageId_83955605">MessageQueue クラス</div>
<div class="text_separate">
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_83955605_h1_1">MessageQueue クラス</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955605_h2_1">機能概要</a>
      </li>
      <li>
        <a href="#Anchor_83955605_h2_2">MessageQueue クラスの使用例</a>
      </li>
    </ul>
  </ul>
</p>
<h1 id="Anchor_83955605_h1_1">MessageQueue クラス</h1>
<h2 id="Anchor_83955605_h2_1">機能概要</h2>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html">MessageQueue</a> クラスは、１つ以上の<a href="../Pages/Page_83955697.html">スレッド</a>間で任意のデータを送受信するための同期通信機能です。</p>
<p>
  <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html">MessageQueue</a>&nbsp;クラスは、<a href="../../../Api/HtmlNX/structnn_1_1os_1_1_message_queue_type.html">nn::os::MessageQueueType</a> オブジェクトを利用した <a href="../Pages/Page_83955748.html">メッセージキュー機能</a> をラッピングしたもので以下のメンバ関数を持ちます。API リファレンスはリンク先を参照して下さい。</p>
<table class="table">
  <tbody>
    <tr>
      <th>名前</th>
      <th>説明</th>
      <th>備考</th>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#aecf9071427181d945451dcf4c88135a0">MessageQueue</a>
      </td>
      <td>コンストラクタ</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ab7baa013ea5d9d4f9e84eb5d1afcec49">InitializeMessageQueue()</a> 同等の初期化を実行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#a63a6df7516f1306a75406d889cc9f3e2">~MessageQueue</a>
      </td>
      <td>デストラクタ</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#af9c98095075b7ef0570c1a449545e392">FinalizeMessageQueue()</a> 同等の破棄を実行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#a1e0edcd5c43e237312e0f2e91c3d796a">Send</a>
      </td>
      <td>メッセージキュー末尾へ送信</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#afec9c0c3cacf43c7aa82f323da656af5">SendMessageQueue()</a> 同等のメッセージキュー末尾へ待機送信</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#a250b13d988d3a0551d9d66f2ca809680">TrySend</a>
      </td>
      <td>同上（ポーリング）</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a78cd82954aa87f10f881a7e34fad596b">TrySendMessageQueue()</a> 同等のメッセージキュー末尾へ送信の試行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#a76e8356bec287a12a2dd9edc7b8ad432">TimedSend</a>
      </td>
      <td>同上（時限付き）</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ad5e14ae7d5a67147af209a1029991095">TimedSendMessageQueue()</a> 同等のメッセージキュー末尾へ時限付き送信</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#ac9761c1ac40faa8a10cf93f886a2c13b">Jam</a>
      </td>
      <td>メッセージキュー先頭へ送信</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a7a47bc9d914dbdf48011deeb859cb877">JamMessageQueue()</a> 同等のメッセージキュー先頭へ待機送信</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#ab5c2b1180101adf3b87f06537c3c564a">TryJam</a>
      </td>
      <td>同上（ポーリング）</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#aa6fd916fb5a94b34c37d2b8faa43ce3c">TryJamMessageQueue()</a> 同等のメッセージキュー先頭へ送信の試行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#a71d97328feb7e0718f8baf99c7eeb7bf">TimedJam</a>
      </td>
      <td>同上（時限付き）</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ad4cfd66c4587832586ee7a50e5fd90b0">TimedJamMessageQueue()</a> 同等のメッセージキュー先頭へ時限付き送信</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#ab7de404c7794aeb63b015645b8d615fb">Receive</a>
      </td>
      <td>メッセージキューから受信</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ace7ad0de1da8fdeeeb01e7de7494dc87">ReceiveMessageQueue()</a> 同等のメッセージキューから待機受信</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#a4cb85115b61ccbdd16394bea8536e2b1">TryReceive</a>
      </td>
      <td>同上（ポーリング）</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a921571e9781d3e6fbf60ca8ee4a1825d">TryReceiveMessageQueue()</a> 同等のメッセージキューから受信の試行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#af1e6cad0d2ac3acde22446bed02cf937">TimedReceive</a>
      </td>
      <td>同上（時限付き）</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#ae0838f36e8391d50f81549950611aeb4">TimedReceiveMessageQueue()</a> 同等のメッセージキューから時限付き受信</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#a3bb1687572948597ee640a4ab06d3704">Peek</a>
      </td>
      <td>メッセージキューを参照</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a7fab6d997fb47451e6c9cd47ef754e99">PeekMessageQueue()</a> 同等のメッセージキューを待機参照</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#ab74ade83883759d4abca1db733d505b8">TryPeek</a>
      </td>
      <td>同上（ポーリング）</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a6f08aef79a422888383a8ab1d5786fe3">TryPeekMessageQueue()</a> 同等のメッセージキュー参照の試行</td>
    </tr>
    <tr>
      <td>
        <a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html#a23ce005847599400940d424e82e45b6f">TimedPeek</a>
      </td>
      <td>同上（時限付き）</td>
      <td>
        <a href="../../../Api/HtmlNX/namespacenn_1_1os.html#a0dc5fb4ad2ef7a5dfff029e0128efa55">TimedPeekMessageQueue()</a> 同等のメッセージキュー時限付き参照</td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h2 id="Anchor_83955605_h2_2">MessageQueue クラスの使用例</h2>
<p>ここでは例として、<a href="../../../Api/HtmlNX/classnn_1_1os_1_1_message_queue.html">MessageQueue</a> クラスを使った StackBuffer クラスを実装します。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre><span class="cp">#include &lt;nn/os.h&gt;
</span>
<span class="k">class</span> <span class="nc">StackBuffer</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">StackBuffer</span><span class="p">()</span> <span class="o">:</span> <span class="n">m_MessageQueue</span><span class="p">(</span><span class="n">m_Buffer</span><span class="p">,</span> <span class="n">s_Count</span><span class="p">)</span> <span class="p">{}</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">void</span> <span class="n">Push</span><span class="p">(</span><span class="kt">uintptr_t</span> <span class="n">data</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">m_MessageQueue</span><span class="p">.</span><span class="n">Jam</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">uintptr_t</span> <span class="n">Pop</span><span class="p">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">uintptr_t</span> <span class="n">data</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">m_MessageQueue</span><span class="p">.</span><span class="n">Receive</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">data</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>

&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">bool</span> <span class="n">IsEmpty</span><span class="p">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">uintptr_t</span> <span class="n">data</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="n">m_MessageQueue</span><span class="p">.</span><span class="n">TryPeek</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
 &nbsp; &nbsp;<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span>       <span class="n">s_Count</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kt">uintptr_t</span>              <span class="n">m_Buffer</span><span class="p">[</span><span class="n">s_Count</span><span class="p">];</span>
 &nbsp; &nbsp;<span class="nn">nn::os::</span><span class="n">MessageQueue</span>   <span class="n">m_MessageQueue</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>
  <code>StackBuffer</code> クラスは、&nbsp;<code>MessageQueue</code> クラスを利用したスタック操作を行なうバッファを提供するクラスです。</p>
<p>最初にコンストラクタにて 8 個分のデータを扱うメッセージキューとしてインスタンスを初期化しています。キューのバッファとして&nbsp;<code>m_Buffer[]</code> の領域が使用されます。</p>
<p>データの蓄積と取得には&nbsp;<code>Push()</code> 関数と&nbsp;<code>Pop()</code> 関数を使用します。 <code>Push()</code> 関数は引数に渡されたデータをバッファの先頭に蓄積します。この時、既にバッファが満杯だった場合はバッファに空きができるまで待機します。一方、&nbsp;<code>Pop()</code> 関数では&nbsp;<code>Push()</code> した順番とは逆順に（スタック操作）、バッファからデータを取り出して返します。この時、バッファにデータが１つもない場合にはバッファにデータが蓄積されるまで待機します。</p>
<p>バッファにデータが１つ以上あるか否かを検査するためには&nbsp;<code>IsEmpty()</code> 関数を使用します。返値が&nbsp;<code>true</code> であれば蓄積データあり、&nbsp;<code>false</code> ならばバッファが空であることを示します。</p>
<p>&nbsp;</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
