<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>拡張シーケンスコマンド</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="border: 4px double black; margin: 4px; padding: 2px; font-weight: bold; background-color: #FFFFCC;">
<p>お使いのブラウザは JavaScript が使用できないため、本ドキュメントの一部機能が無効になっています。</p><p>JavaScript が無効の環境では目次を使用することができません。<br />JavaScriptの実行が許可された状態で閲覧してください。<br /><br /></p>
</div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- 拡張シーケンスコマンド -->
<div class="pagetitle" id="PageId_83955717">拡張シーケンスコマンド</div>
<div class="text_separate">
<h1 id="Anchor_83955717_h1_1">目次</h1>
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_83955717_h2_1">時間変化コマンド</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955717_h3_1">書式</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_2">時間変化コマンド一覧</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_3">時間変化コマンドの拡張</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955717_h2_2">ランダムコマンド</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955717_h3_4">書式</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_5">ランダムコマンド一覧</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_6">ランダム音長ノートコマンド</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955717_h2_3">変数コマンド</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955717_h3_7">変数とは</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_8">各変数の文字列による指定</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_9">変数演算コマンド</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_10">変数コマンド</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_11">書式</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_12">変数コマンド一覧</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_13">音長変数ノートコマンド</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_14">変数間演算コマンド</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955717_h2_4">条件コマンド</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955717_h3_15">比較コマンド</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_16">条件コマンド</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955717_h2_5">拡張シーケンスコマンドの組み合わせ</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955717_h3_17">時間変化コマンドの拡張</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_18">拡張シーケンスコマンドの組み合わせ</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955717_h2_6">プログラムとの通信</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955717_h3_19">MIDI シーケンスとの通信</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_20">条件コマンドとの組み合わせ</a>
      </li>
      <li>
        <a href="#Anchor_83955717_h3_21">変数のデバッグ</a>
      </li>
    </ul>
  </ul>
</p>
<h1 id="Anchor_83955717_h1_2">拡張シーケンスコマンド</h1>
<p>拡張シーケンスコマンドとは、これまで説明したシーケンスコマンドの機能に対し、より自由度の高い設定を行えるようにしたコマンド群です。</p>
<p>通常のシーケンス再生には、普通のシーケンスコマンドを使うだけで十分ですが、拡張シーケンスコマンドを使うことによって、より凝った演出や、インタラクティブなシーケンス再生などが行えるようになります。</p>
<h2 id="Anchor_83955717_h2_1">時間変化コマンド</h2>
<p>いくつかのシーケンスコマンドに対して、時間変化指定を行うことができます。指定した時間をかけて滑らかにパラメータ変更を行います。</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>volume_t 64, 48</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>上記のコマンド例は、48 tick かけて音量値を現在の値から 64 に変化させます。</p>
<p>時間変化コマンドは、通常のコマンドと同じパラメータ値を操作します。すなわち、時間変化コマンドで時間に 0 を指定することと、通常のコマンドを使用することは同じです。</p>
<p>また、時間変化コマンドは常に後で設定されたものが有効となります。例えば時間変化コマンドで音量を変化させている途中で新たに時間変化の音量コマンドを実行すると、そのときの現在値から新たな時間変化を開始します。</p>
<h3 id="Anchor_83955717_h3_1">書式</h3>
<p>時間変化コマンドの書式は次のとおりです。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>(command)_t x, time </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>x はコマンドのパラメータ、time は変化時間です。時間の単位はノートコマンドや wait コマンドと同様に tick 単位です。time に設定できる値の範囲は 0 ～ 32767 です。</p>
<h3 id="Anchor_83955717_h3_2">時間変化コマンド一覧</h3>
<p>表 9 時間変化コマンド一覧表</p>
<table class="table">
  <tbody>
    <tr>
      <td>
        <p>volume_t</p>
      </td>
      <td>
        <p>pan_t</p>
      </td>
      <td>
        <p>span_t</p>
      </td>
      <td>
        <p>pitchbend_t</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>volume2_t</p>
      </td>
      <td>
        <p>main_volume_t</p>
      </td>
      <td>
        <p>&nbsp;</p>
      </td>
      <td>
        <p>&nbsp;</p>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h3 id="Anchor_83955717_h3_3">時間変化コマンドの拡張</h3>
<p>指定時間の値に乱数や変数を使用することができます。詳しくは後述の「拡張シーケンスコマンドの組み合わせ」を参照してください。</p>
<h2 id="Anchor_83955717_h2_2">ランダムコマンド</h2>
<p>幾つかのシーケンスコマンドでは、値に乱数を設定できます。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>pitchbend_r -12 , 12 </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>上記の例では、-12 ～ +12 の範囲の乱数値で、pitchbend コマンドを実行します。これにより、鳴らすたびに微妙に音程を変えて再生することができます。</p>
<h3 id="Anchor_83955717_h3_4">書式</h3>
<p>ランダムコマンドの基本的な書式は次の通りです。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>(command)_r min, max </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>最小値 min の値から、最大値 max の値までの範囲で乱数が生成され、その値を command の引数として実行します。</p>
<h3 id="Anchor_83955717_h3_5">ランダムコマンド一覧</h3>
<p>表 10 ランダムコマンド一覧表</p>
<table class="table">
  <tbody>
    <tr>
      <td>
        <p>wait_r</p>
      </td>
      <td>
        <p>prg_r</p>
      </td>
      <td>
        <p>tempo_r</p>
      </td>
      <td>
        <p>volume_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>volume2_r</p>
      </td>
      <td>
        <p>main_volume_r</p>
      </td>
      <td>
        <p>pitchbend_r</p>
      </td>
      <td>
        <p>pan_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>transpose_r</p>
      </td>
      <td>
        <p>porta_time_r</p>
      </td>
      <td>
        <p>sweep_pitch_r</p>
      </td>
      <td>
        <p>mod_depth_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>mod_speed_r</p>
      </td>
      <td>
        <p>attack_r</p>
      </td>
      <td>
        <p>decay_r</p>
      </td>
      <td>
        <p>sustain_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>release_r</p>
      </td>
      <td>
        <p>mod_delay_r</p>
      </td>
      <td>
        <p>loop_start_r</p>
      </td>
      <td>
        <p>mute_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>bank_select_r</p>
      </td>
      <td>
        <p>mod_period_r</p>
      </td>
      <td>
        <p>mod_phase_r</p>
      </td>
      <td>
        <p>mod_curve_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>setvar_r</p>
      </td>
      <td>
        <p>addvar_r</p>
      </td>
      <td>
        <p>subvar_r</p>
      </td>
      <td>
        <p>mulvar_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>divvar_r</p>
      </td>
      <td>
        <p>shiftvar_r</p>
      </td>
      <td>
        <p>randvar_r</p>
      </td>
      <td>
        <p>andvar_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>orvar_r</p>
      </td>
      <td>
        <p>xorvar_r</p>
      </td>
      <td>
        <p>notvar_r</p>
      </td>
      <td>
        <p>modvar_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>cmp_eq_r</p>
      </td>
      <td>
        <p>cmp_ge_r</p>
      </td>
      <td>
        <p>cmp_gt_r</p>
      </td>
      <td>
        <p>cmp_le_r</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>cmp_lt_r</p>
      </td>
      <td>
        <p>cmp_ne_r</p>
      </td>
      <td>
        <p>&nbsp;</p>
      </td>
      <td>
        <p>&nbsp;</p>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>表中 setvar_r 以降のコマンドについては、次節以降の「変数コマンド」と「条件コマンド」を参照してください。</p>
<p>mod_ コマンドについては、mod2_ ～ mod4_ でも同様に対応されています。</p>
<p>普通のシーケンスコマンドとの対応表は、このドキュメントの付録にある「<a href="../Pages/Page_83955585.html">全シーケンスコマンド一覧表</a>」をご覧ください。</p>
<h3 id="Anchor_83955717_h3_6">ランダム音長ノートコマンド</h3>
<p>ノートコマンドに対し、&quot;_r&quot; をつけてランダムコマンドとすることもできます。この時、音長がランダムに設定されることになります。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>cn4_r velocity, min, max </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>音程をランダムに変化させたい場合は、transpose_r で代用してください。また、ベロシティをランダムに変化させたい場合は、volume_r や volume2_r などで代用してください。</p>
<h2 id="Anchor_83955717_h2_3">変数コマンド</h2>
<p>シーケンス中で変数を扱うことができます。</p>
<h3 id="Anchor_83955717_h3_7">変数とは</h3>
<p>変数とは、数値を保存しておけるメモリのことです。1 つの変数には、-32768 ～ 32767 の範囲の値を格納できます。</p>
<p>ひとつのシーケンス内でのみ自由に使える変数が 16 個、システム全体で共有して使用する変数が 16 個、さらにシーケンス内の各シーケンストラック内でのみ自由に使える変数が 16 個あります。</p>
<p>シーケンス内でのみ扱う変数のことを「ローカル変数」。システム全体で共有する変数を「グローバル変数」。シーケンストラック内でのみ扱う変数のことを「シーケンストラック変数」とよびます。</p>
<p>図 7 変数の種類と有効範囲</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_83956113/83080142.gif" width="500" class="embedded-image" />
  </span>
</p>
<p>シーケンス中では、各変数を番号で指定します。</p>
<p>0 から 15 の値を指定すると、ローカル変数 16 個の内の 1 つを表します。</p>
<p>16 から 31 の値を指定すると、グローバル変数 16 個の内の 1 つを表します。ただし、変数番号としては 16 を引いた値になります。すなわち、16 から 31 で、グローバル変数の 0 から 15 を表します。</p>
<p>32 から 47 の値を指定すると、シーケンストラック変数 16 個の内の 1 つを表します。ただし、変数番号としては 32 を引いた値になります。すなわち、32 から 47 で、シーケンストラック変数の 0 から 15 を表します。</p>
<p>変数の初期値は、-1 です。グローバル変数はシステム起動時に、ローカル変数とトラック変数はシーケンス開始時に初期化されます。</p>
<h3 id="Anchor_83955717_h3_8">各変数の文字列による指定</h3>
<p>各変数の番号は数値の他に、マクロの文字列によっても指定できます。各変数を指定するマクロは、この後解説する変数コマンドなどで、変数番号 (varNo) のかわりに記述することができます。</p>
<p>以下に変数番号を指定するマクロの一覧を示します。</p>
<p>表 11 変数番号を指定するマクロの一覧</p>
<table class="table">
  <thead>
    <tr>
      <th>
        <p>マクロ</p>
      </th>
      <th>
        <p>説明</p>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <p>VAR_0, VAR_1 &hellip; VAR_15</p>
      </td>
      <td>
        <p>ローカル変数の0から15に対応</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>GVAR_0, GVAR_1 &hellip; GVAR_15</p>
      </td>
      <td>
        <p>グローバル変数の0から15に対応</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>TVAR_0, TVAR_1 &hellip; TVAR_15</p>
      </td>
      <td>
        <p>シーケンストラック変数の0から15に対応</p>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h3 id="Anchor_83955717_h3_9">変数演算コマンド</h3>
<p>それぞれの変数に対して、値のセット、四則演算などを行えます。</p>
<p>表 12 変数演算コマンド一覧</p>
<table class="table">
  <thead>
    <tr>
      <th>
        <p>コマンド名</p>
      </th>
      <th>
        <p>説明</p>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <p>setvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数に x をセット</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>addvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値に、x を加算</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>subvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値から、x を減算</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>mulvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値に、x をかける</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>divvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値を、x で割る</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>shiftvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値を、x ビット左へシフト (負値なら右へシフト)</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>randvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数に、0 ～ ｘ の範囲の乱数値をセット (負値なら、x ～ 0 の範囲)</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>andvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値と、x のビットごとの論理積</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>orvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値と、x のビットごとの論理和</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>xorvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値と、x のビットごとの排他的論理和</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>notvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値と、x のビットごとの否定</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>modvar <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>変数の値と、x の剰余演算</p>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h3 id="Anchor_83955717_h3_10">変数コマンド</h3>
<p>上記の変数演算コマンドでセットした変数の値を使って、シーケンスコマンドを実行することができます。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>pitchbend_v 0 </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>上記の例では、ローカル変数0の値を使って、pitchbend コマンドを実行します。</p>
<h3 id="Anchor_83955717_h3_11">書式</h3>
<p>変数コマンドの基本的な書式は、次の通りです。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>(command)_v varNo </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>varNo で指定した変数の値を使って、command を実行します。</p>
<p>なお、各シーケンスコマンドの引数には値の範囲が設定されていますが、その範囲を超えた値を変数に設定していた場合の動作は保証できませんので、ご注意ください。</p>
<h3 id="Anchor_83955717_h3_12">変数コマンド一覧</h3>
<p>ランダムコマンドとして使えるシーケンスコマンドは、全て変数コマンドとしても使えます。</p>
<p>表 13 変数コマンド一覧表</p>
<table class="table">
  <tbody>
    <tr>
      <td>
        <p>wait_v</p>
      </td>
      <td>
        <p>prg_v</p>
      </td>
      <td>
        <p>tempo_v</p>
      </td>
      <td>
        <p>volume_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>volume2_v</p>
      </td>
      <td>
        <p>main_volume_v</p>
      </td>
      <td>
        <p>pitchbend_v</p>
      </td>
      <td>
        <p>pan_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>transpose_v</p>
      </td>
      <td>
        <p>porta_time_v</p>
      </td>
      <td>
        <p>sweep_pitch_v</p>
      </td>
      <td>
        <p>mod_depth_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>mod_speed_v</p>
      </td>
      <td>
        <p>attack_v</p>
      </td>
      <td>
        <p>decay_v</p>
      </td>
      <td>
        <p>sustain_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>release_v</p>
      </td>
      <td>
        <p>mod_delay_v</p>
      </td>
      <td>
        <p>loop_start_v</p>
      </td>
      <td>
        <p>mute_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>setvar_v</p>
      </td>
      <td>
        <p>addvar_v</p>
      </td>
      <td>
        <p>subvar_v</p>
      </td>
      <td>
        <p>mulvar_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>divvar_v</p>
      </td>
      <td>
        <p>shiftvar_v</p>
      </td>
      <td>
        <p>randvar_v</p>
      </td>
      <td>
        <p>andvar_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>orvar_v</p>
      </td>
      <td>
        <p>xorvar_v</p>
      </td>
      <td>
        <p>notvar_v</p>
      </td>
      <td>
        <p>modvar_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>bank_select_v</p>
      </td>
      <td>
        <p>mod_period_v</p>
      </td>
      <td>
        <p>mod_curve_v</p>
      </td>
      <td>
        <p>mod_phase_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>cmp_eq_v</p>
      </td>
      <td>
        <p>cmp_ge_v</p>
      </td>
      <td>
        <p>cmp_gt_v</p>
      </td>
      <td>
        <p>cmp_le_v</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>cmp_lt_v</p>
      </td>
      <td>
        <p>cmp_ne_v</p>
      </td>
      <td>
        <p>&nbsp;</p>
      </td>
      <td>
        <p>&nbsp;</p>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>表中の cmp_ で始まるコマンドは、比較コマンドと呼び、次節の「条件コマンド」を参照してください。</p>
<p>mod_ コマンドについては、mod2_ ～ mod4_ でも同様に対応されています。</p>
<p>普通のシーケンスコマンドとの対応表は、このドキュメントの付録にある「<a href="../Pages/Page_83955585.html">全シーケンスコマンド一覧表</a>」をご覧ください。</p>
<h3 id="Anchor_83955717_h3_13">音長変数ノートコマンド</h3>
<p>ノートコマンドに対し、&quot;_v&quot; をつけて変数コマンドとすることもできます。この時、音長の指定を変数で行うことになります。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>cn4_v velocity, varNo </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>音程を変数指定したい場合は、transpose_v で代用してください。また、ベロシティを変数指定したい場合は、volume_v や volume2_v などで代用してください。</p>
<h3 id="Anchor_83955717_h3_14">変数間演算コマンド</h3>
<p>上記の変数演算コマンドは、ある変数に対し、ある数値を足したり引いたりするコマンドですが、変数コマンドの setvar_v などを使用することにより、変数間の代入や、ある変数に別の変数の値を足したりすることができます。</p>
<p>&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>setvar_v 0, 1    ; 変数 0 に変数 1 の値を代入
addvar_v 2, 3    ; 変数 2 に変数 3 の値を足す </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h2 id="Anchor_83955717_h2_4">条件コマンド</h2>
<p>変数を使って、あるシーケンスコマンドを実行する／実行しないといったことを制御することができます。</p>
<h3 id="Anchor_83955717_h3_15">比較コマンド</h3>
<p>条件コマンドを使うためには、その前に比較コマンドを実行します。比較コマンドで 2 つの値を比較した結果に基づいて、条件コマンドを実行するかしないかを決めることになります。</p>
<p>比較コマンドには以下のものがあります。</p>
<p>表 14 比較コマンド一覧</p>
<table class="table">
  <thead>
    <tr>
      <th>
        <p>コマンド名</p>
      </th>
      <th>
        <p>数式</p>
      </th>
      <th>
        <p>説明</p>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <p>cmp_eq <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>(変数) == x</p>
      </td>
      <td>
        <p>変数の値と x が等しければ真 (equalの略)</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>cmp_ge <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>(変数) &gt;= x</p>
      </td>
      <td>
        <p>変数の値が x より大きいか、等しければ真 （greater equal の略）</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>cmp_gt <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>(変数) &gt; x</p>
      </td>
      <td>
        <p>変数の値が x より大きければ真 (greater&nbsp; than の略)</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>cmp_le <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>(変数) &lt;= x</p>
      </td>
      <td>
        <p>変数の値が x より小さいか、等しければ真 (less equal の略)</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>cmp_lt <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>(変数) &lt; x</p>
      </td>
      <td>
        <p>変数の値が x より小さければ真 (less&nbsp; than の略）</p>
      </td>
    </tr>
    <tr>
      <td>
        <p>cmp_ne <em>varNo</em>, <em>x</em></p>
      </td>
      <td>
        <p>(変数) != x</p>
      </td>
      <td>
        <p>変数の値と x が等しくなければ真&nbsp;&nbsp; (not equal の略)</p>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>比較の結果、真となれば、以降の条件コマンドは実行され、偽となれば、以降の条件コマンドは実行されません。</p>
<h3 id="Anchor_83955717_h3_16">条件コマンド</h3>
<p>全てのシーケンスコマンドに対し、条件コマンドが存在します。条件コマンドは、元のコマンド名の最後に &quot;_if&quot; をつけます。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>pitchbend_if +48 </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>次の例では、乱数にもとづいてある音を鳴らしたり、鳴らさなかったりします。</p>
<p>&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>randvar 0, 100   ; 0～100の乱数値セット
cmp_le 0, 80     ; 乱数値が80以下なら真
cn4 96, 12
dn4_if 96, 12    ; 真の時のみ鳴る
en4 96, 12
fin </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<h2 id="Anchor_83955717_h2_5">拡張シーケンスコマンドの組み合わせ</h2>
<p>これまで解説してきた拡張シーケンスコマンドは、一定の組み合わせで同時に使用することができます。</p>
<h3 id="Anchor_83955717_h3_17">時間変化コマンドの拡張</h3>
<p>時間変化コマンドに対応したコマンドでは、時間変化コマンドを拡張し、変化時間の値をランダムあるいは変数値とすることができます。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>(command)_tr x, timeMin, timeMax
(command)_tv x, timeVarNo </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>変化時間をランダムにするには &rdquo;_tr&rdquo; を、変化時間を変数で指定するには &ldquo;_tv&rdquo; を、時間変化コマンドの &ldquo;_t&rdquo; の代わりに記述します。</p>
<h3 id="Anchor_83955717_h3_18">拡張シーケンスコマンドの組み合わせ</h3>
<p>拡張シーケンスコマンドは一定の規則で組み合わせることが出来ます。コマンドが対応している拡張のみ、組み合わせることができます。</p>
<p class="Code">&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>(command){_r,_v}{_t,_tr,_tv}{_if} </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>ランダムコマンドの &rdquo;_r&rdquo; や、変数コマンドの &ldquo;_v&rdquo; を先に記述し、時間変化コマンドの &ldquo;_t&rdquo; をそれらに続けて記述します。条件コマンドの &ldquo;_if&rdquo; は最後に記述します。記述順を変更することは出来ません。</p>
<p>例えば以下のようなコマンドを記述できます。</p>
<p>&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>volume_r_tv_if min, max, timeVarNo </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>このコマンドは、比較コマンドが真の場合に timeVarNo の変数番号の時間をかけて min ～ max のランダムな音量を設定します。</p>
<h2 id="Anchor_83955717_h2_6">プログラムとの通信</h2>
<p>変数を使って、プログラムと通信を行うことができます。変数は、プログラムから読み取り及び書き込みができますので、これを使って情報のやりとりができます。</p>
<h3 id="Anchor_83955717_h3_19">MIDI シーケンスとの通信</h3>
<p>変数を使って、MIDI シーケンスからの情報をプログラムに通知することができます。</p>
<p>コントロールチェンジ 16 ～ 19 および 80 ～ 83 の 8 つは、それぞれ setvar コマンドに変換されます。コントロールチェンジ 16 はローカル変数 0 番にセットします。以下 17、 18、 19 はそれぞれローカル変数 1、 2、 3 番にセットします。また、コントロールチェンジ 80 はトラック変数 0 番にセットします。以下 81、 82、 83 はそれぞれトラック変数 1、 2、 3 番にセットします。</p>
<p>例えば、曲の構成ブロックの切れ目ごとに変数をセットすると、プログラム側で、現在どこの構成ブロックを再生中なのかを知ることができるようになります。</p>
<h3 id="Anchor_83955717_h3_20">条件コマンドとの組み合わせ</h3>
<p>条件コマンドとプログラムからの変数書き込みを組み合わせると、プログラムからのタイミングで、シーケンスを変化させることができます。</p>
<p>&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>_loop:
&nbsp;&nbsp;&nbsp;&nbsp;cmp_eq 0, 1
&nbsp;&nbsp;&nbsp;&nbsp;jump_if _loop2  ; 変数 0 が 1 の時のみジャンプ
&nbsp;&nbsp;&nbsp;&nbsp;cn4 96, 12
&nbsp;&nbsp;&nbsp;&nbsp;dn4 96, 12
&nbsp;&nbsp;&nbsp;&nbsp;jump _loop
_loop2:
&nbsp;&nbsp;&nbsp;&nbsp;cn4 96, 12
&nbsp;&nbsp;&nbsp;&nbsp;en4 96, 12
&nbsp;&nbsp;&nbsp;&nbsp;jump _loop2 </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>上記の例では、プログラム側で何もしなければ、「ド・レ・ド・レ&hellip;」と鳴り続けますが、プログラムでローカル変数 0 番に 1 を書き込むことによって、「ド・ミ・ド・ミ&hellip;」と鳴るように変化します。</p>
<h3 id="Anchor_83955717_h3_21">変数のデバッグ</h3>
<p>複雑な変数処理を扱うと、処理のミスにより、思った通りの動作をしない場合があります。そのようなときに、想定通りの値が変数に入っているかどうかを確認するためのシーケンスコマンドが用意されています。</p>
<p>表 15 変数デバッグコマンド一覧</p>
<table class="table">
  <thead>
    <tr>
      <th>
        <p>コマンド名</p>
      </th>
      <th>
        <p>説明</p>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <p>printvar <em>varNo</em></p>
      </td>
      <td>
        <p>変数の値をデバッグ出力</p>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>このコマンドが処理されると、次のような１行がデバッグ出力されます。</p>
<p>&nbsp;</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>#8077a450[1]: printvar GVAR_2(18) = -1 </pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>&nbsp;</p>
<p>コロンより手前の &quot;#8077a450[1]&quot; の部分は、プレイヤー識別子が 8077a450、トラック番号が 1 であることを表しています。プレイヤー識別子は、値自身には重要な意味はありません。ただ、プレイヤー識別子が異なれば、それは違うシーケンスからの出力であることがわかるだけです。トラック番号は、あるシーケンス中のどのトラックから出力されたかを表しています。</p>
<p>printvar の表示に続き、変数の内容が表示されます。ローカル変数では VAR_、グローバル変数では GVAR_、トラック変数では TVAR_ に続き変数番号が表示されます。カッコ内はシーケンスデータで使用されるときの、変数の通し番号です。上記の例ではグローバル変数 2 の値が -1 であることを表しています。</p>
<p>AtkPlayer は printvar 出力が有効になっています。ユーザープログラムの場合は、デフォルトでは printvar 出力が無効になっていますので、SoundSystem::EnableSeqPrintVar 関数で出力を有効にする必要があります。詳しくは関数リファレンスマニュアルをご覧ください。</p>
<p>&nbsp;</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
</div>
</div>
</body>
</html>
